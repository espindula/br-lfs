# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2019-09-02 09:14+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: Plain text
#: origin/scp-before-relay.txt:2
msgid "AUTHOR: Gerard Beekmans <gerard@linuxfromscratch.org>"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:4
msgid "DATE: 2003-10-09"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:6
msgid "LICENSE: BSD"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:8
msgid "SYNOPSIS: An alternative to the pop-before-relay scheme"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:12
msgid ""
"DESCRIPTION: This hint describes a way to dynamically configure an SMTP "
"server such as Postfix to allow your specific (dynamic) IP address to use it "
"as a relay server."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:14
msgid "PREREQUISITES:\tWorking SMTP server (tested with Postfix)."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:16
msgid "HINT:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:18
#, no-wrap
msgid ""
"Disclaimer\n"
"----------\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:25
#, no-wrap
msgid ""
"\tThis document is, at the moment, mostly a quick hack. I had to\n"
"\timplement this in between releasing the LFS-3.0 book and some\n"
"\tother pending LFS work, because my ISP's SMTP servers went offline.\n"
"\tThe scripts are anything but effecient, but it gets the job done, \n"
"\twhich is good enough for me at the moment. There's nothing elegant \n"
"\tabout it, so be warned ;)\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:27
#, no-wrap
msgid "\tHaving that said, let's get the show on the road.\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:30
#, no-wrap
msgid ""
"what is pop-before-relay\n"
"------------------------\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:37
msgid ""
"A lot of ISP's give their users dynamically assigned IP addresses. One of "
"the side-effects of this is that remote servers never know who is behind a "
"particular IP address. You cannot simply tell the SMTP server you wish to "
"relay with to allow it from one or a block of IP addresses, because this "
"would allow anybody from your ISP to exploit the relay."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:47
msgid ""
"So, people came up with the pop-before-relay scheme. When you login to a "
"server to check for new mail, your current IP address is logged and added to "
"the SMTP's server relay database. A pop-before-relay (helper) daemon will "
"check that database and expire IP addresses after they have been in the "
"database for a certain amount of time, because you could have gone offline "
"after you checked for new email, so the IP address should be flushed from "
"that database as soon as possible to lower the chance of somebody else "
"obtaining the IP address and exploit the relay, unless you check for new "
"mail again within the expire time."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:51
#, no-wrap
msgid ""
"scp-before-relay\n"
"----------------\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:55
msgid ""
"What is this scp-before-relay and why not use pop-before-relay if software "
"has already been written to support it?"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:63
msgid ""
"The problem I encountered is that I use ssh tunneling to login to my pop3 "
"server at linuxfromscratch.org. With pop3 your password is transmitted as "
"clear text, much like happens with telnet. I don't quite like that, so I use "
"port forwarding with openssh. The downside is that the pop3 daemon now logs "
"my login attempt with the IP address of the server itself (since I'm ssh'ed "
"into the server and connect to localhost there, so the originating IP "
"address is that of localhost as well)."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:66
msgid ""
"So I had to come up with something different, and I call it "
"scp-before-relay."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:69
#, no-wrap
msgid ""
"Note:\tThis was in the old days. Today we use imap-ssl on the LFS server "
"so\n"
"\tthis isn't an issue anymore.\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:71
#, no-wrap
msgid ""
"How it works\n"
"------------\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:75
msgid "My workstation, called gwaihir, runs the following script every 4 minutes:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:78
#, no-wrap
msgid ""
"\t#!/bin/bash\n"
"\t# Begin send-ip\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:80 origin/scp-before-relay.txt:109 origin/scp-before-relay.txt:197
#, no-wrap
msgid "\tPATH=/bin:/sbin:/usr/bin:/usr/sbin\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:82
#, no-wrap
msgid "\tifconfig ppp0 > /home/gerard/tmp/ppp.tmp || exit 1\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:85
#, no-wrap
msgid ""
"\tIP=$(cat /home/gerard/tmp/ppp.tmp|grep \"inet addr\"| \\\n"
"\t\tcut -f 2 -d \":\"|cut -f 1 -d \" \")\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:87
#, no-wrap
msgid "\techo \"$IP 0\" > /home/gerard/tmp/gwaihir-ip\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:90
#, no-wrap
msgid ""
"\t/usr/bin/scp /home/gerard/tmp/gwaihir-ip \\\n"
"\t\tlinuxfromscratch.org:tmp\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:92
#, no-wrap
msgid "\t# End send-ip\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:96
msgid ""
"The above script will obtain gwaihir's current IP address on the ppp0 link, "
"if it's up at the moment. Then send the file, gwaihir-ip, to the "
"linuxfromscratch.org server in my ~/tmp directory over there."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:99
#, no-wrap
msgid ""
"The format of the file is:\n"
"\t\tIP 0\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:102
msgid ""
"The 0 can be any value you want, it's not used in the current scheme. It's "
"just to satisfy the hash database format used by Postfix."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:104
msgid "The server, shadowfax, runs the following script every 10 minutes:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:107
#, no-wrap
msgid ""
"\t#!/bin/sh\n"
"\t# Start update-postfix-relay\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:127
#, no-wrap
msgid ""
"\tif [ -f /home/gerard/tmp/gwaihir-ip ]\n"
"\tthen\n"
"\t        mv /home/gerard/tmp/gwaihir-ip /etc/postfix\n"
"\t        chown root.root /etc/postfix/gwaihir-ip\n"
"\t        postmap /etc/postfix/gwaihir-ip\n"
"\t        date +%s > /etc/postfix/gwaihir-ip.log\n"
"\telse\n"
"\t        LAST=$(cat /etc/postfix/gwaihir-ip.log)\n"
"\t        if [ $(expr $(date +%s) - $LAST) -lt 1200 ]\n"
"\t        then\n"
"\t                exit\n"
"\t        else\n"
"        \t        echo \"0 0\" > /etc/postfix/gwaihir-ip\n"
"\t                postmap /etc/postfix/gwaihir-ip\n"
"\t        fi\n"
"\tfi\n"
"\t# End update-postfix-relay\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:135
msgid ""
"This script checks for a new gwaihir-ip file. If found, move the file to "
"/etc/postfix and run postmap to update the database (else postfix will "
"complain that the database file is older than it's source file). Also log "
"the time when this update took place. The +%s option will log the amount of "
"seconds since January 1970. This makes it easier to calculate when it's "
"supposed to expire."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:139
msgid ""
"In order for Postfix to actually use this file, edit the main.cf "
"configuration file and edit the \"mynetworks\" variable. It probably already "
"contains the \"$mydestination\" value. Modify it as follows:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:141
#, no-wrap
msgid "\tmynetworks = hash:/etc/postfix/gwaihir-ip $mydestination\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:145
msgid ""
"The mynetwork variable defines trusted SMTP clients within Postfix. These "
"clients will have more privileges such as being able to relay through this "
"server."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:148
msgid ""
"Back to the scripts. If there is no file gwaihir-ip present on shadowfax, it "
"usually is caused by one of the following:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:153
#, no-wrap
msgid ""
"1) both scripts were run at the same time. There will always be a point in\n"
"time where both systems will be running the scripts at the exact same\n"
"time, so gwaihir could be in the middle of sending the new file while\n"
"shadowfax is checking for it to exist.\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:157
#, no-wrap
msgid ""
"2) gwaihir is still online, but there's a network problem between "
"gwaihir's\n"
"ISP and shadowfax, which could have caused shadowfax to be unreachable "
"from\n"
"gwaihir for a short period of time.\n"
msgstr ""

#. type: Bullet: '3) '
#: origin/scp-before-relay.txt:159
msgid "gwaihir went offline"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:163
msgid ""
"There is no way for shadowfax to know which of the 3 reasons applies at the "
"moment. It's most likely reason 1 or 2, so we don't want to turn off the "
"relay authorization right away."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:170
msgid ""
"So instead, shadowfax checks gwaihir-ip.log's contents against the current "
"time. If the difference is less than 1200 seconds (20 minutes), then it "
"won't do anything. Since shadowfax checks every 10 minutes, gwaihir will "
"have 10 minutes to send the file. Because gwaihir tries to send it every 4 "
"minutes, it gives gwaihir 2 more chances to get the file delivered before "
"shadowfax checks again, when the 1200 seconds are up."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:175
msgid ""
"If during the next check (after 1200 seconds) gwaihir still hasn't sent a "
"file, we'll have to disable gwaihir's ability to relay. At that time \"0 0\" "
"is put in postfix's database. There is no IP address that matches '0', so "
"this effectively disables the relay."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:178
#, no-wrap
msgid ""
"Improvements\n"
"------------\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:181
msgid "There is much room for improvement."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:187
msgid ""
"Shortly after I activated this scheme I got the idea to put the date +%s "
"output in the gwaihir-ip file as the second value, which would elimate the "
"need for the gwaihir-ip.log file. gwaihir can't put the date +%s in it's "
"file, because the systems are in different timezones. So shadowfax will have "
"to do this when it finds the new file."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:189
msgid "The send-ip script could be changed to write the gwaihir-ip file as:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:191
#, no-wrap
msgid "\techo \"$IP stub\" > /home/gerard/tmp/gwaihir-ip\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:195
#, no-wrap
msgid ""
"Then the modified update-postfix-relay script could look like:\n"
"\t#!/bin/sh\n"
"\t# Start update-postfix-relay\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:215
#, no-wrap
msgid ""
"\tif [ -f /home/gerard/tmp/gwaihir-ip ]\n"
"\tthen\n"
"\t\tsed s/stub/$(date +%s)/ /home/gerard/tmp/gwaihir-ip \\\n"
"\t\t\t> /etc/postfix/gwaihir-ip\n"
"\t\trm /home/gerard/tmp/gwaihir-ip\n"
"\t\tpostmap /etc/postfix/gwaihir-ip\n"
"\telse\n"
"\t\tLAST=$(cat /etc/postfix/gwaihir-ip|cut -f 2 -d \" \")\n"
"\t\tif [ $(expr $(date +%s) - $LAST) -lt 1200 ]\n"
"\t\tthen\n"
"\t\t\texit\n"
"\t\telse\n"
"\t\t\techo \"0 0\" > /etc/postfix/gwaihir-ip\n"
"\t\t\tpostmap /etc/postfix/gwaihir-ip\n"
"\t\tfi\n"
"\tfi\n"
"\t# End update-postfix-relay\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:218
msgid "I'm pretty sure this works, I just haven't tried it yet."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:221
msgid ""
"Another obvious improvent would be using variables in the scripts for the "
"gwaihir-ip file locations, like:"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:224
#, no-wrap
msgid ""
"\tSOURCE=/home/gerard/tmp/gwaihir-ip\n"
"\tDEST=/etc/postfix/gwaihir-ip\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:236
msgid ""
"Other than that, this is designed to work with one user. If you have more "
"people you want to be able to use the server as a relay, you need to make "
"some changes. You could use seperate files for every user, and put the "
"script in a loop to parse the files and disable or refresh somebody's relay "
"abilities accordingly. I haven't bothered giving multi-user functionality "
"any thought, so you're on your own for now. Feel free to get back to me if "
"you have any ideas on the matter. I'm not going to pursue it right now "
"because I don't have the need for it. The need may arise in the future, so "
"who knows."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:241
#, no-wrap
msgid ""
"Note:\tThis scheme isn't in use anymore on the server. I've got a mostly\n"
"\tstatic IP address now that hasn't changed since I signed up\n"
"\tfor this Internet service a year ago. So I just do a manual\n"
"\tupdate of the IP address in the relay database when necessary.\n"
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:245
#, no-wrap
msgid ""
"CHANGELOG:\n"
"[2003-10-11]\n"
"\t* Updated pre-requisites section.\n"
msgstr ""

#. type: Bullet: '	* '
#: origin/scp-before-relay.txt:248
msgid ""
"Added an important missing piece of information: configuring Postfix to use "
"the file containing the IP address."
msgstr ""

#. type: Plain text
#: origin/scp-before-relay.txt:250
#, no-wrap
msgid ""
"[2003-10-09]\n"
"\t* Converted to comply with the new hint format.\n"
msgstr ""
