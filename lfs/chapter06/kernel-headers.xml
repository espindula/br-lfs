<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-system-kernel-headers">
<title>En-têtes Linux-&linux-version;</title>
<?dbhtml filename="kernelheaders.html"?>

<indexterm zone="ch-system-kernel-headers">
<primary sortas="a-Linux">Linux</primary>
<secondary>système, en-tête</secondary></indexterm>

<screen>&buildtime; 0,1&nbsp;SBU
&diskspace; 186&nbsp;Mo</screen>


<sect2>
<title>Installation des en-têtes du noyau</title>

<para>Nous ne compilerons pas encore un nouveau noyau. Nous le ferons une
fois que nous aurons terminé l'installation de tous les paquets. Mais les
bibliothèques installées dans la prochaine section ont besoin de se
référer aux fichiers d'en-têtes du noyau pour savoir comment s'interfacer avec
le noyau. Au lieu de déballer une nouvelle fois les sources du noyau, créer le
fichier de versions, les liens symboliques et ainsi de suite, nous allons
simplement copier les en-têtes à partir du répertoire des outils temporaires en
une commande&nbsp;:</para>

<screen><userinput>cp -a /tools/include/{asm,asm-generic,linux}
/usr/include</userinput></screen>

<para>Quelques fichiers d'en-têtes du noyau réfèrent au fichier d'en-tête
<filename>autoconf.h</filename>. Comme nous n'avons pas encore configuré le
noyau, nous avons besoin de créer ce fichier nous-même pour éviter un échec
lors de la compilation de Sysklogd. Créez un fichier
<filename>autoconf.h</filename> vide avec&nbsp;:</para>

<screen><userinput>touch /usr/include/linux/autoconf.h</userinput></screen>

</sect2>

<sect2>
<title>Pourquoi nous copions les en-têtes du noyau</title>

<para>Auparavant, une pratique commune consistait à créer des liens symboliques 
pour les répertoires <filename
class="directory">/usr/include/{linux,asm}</filename> vers respectivement 
<filename class="directory">/usr/src/linux/include/{linux,asm}</filename>.
Ceci est une <emphasis>mauvaise</emphasis> idée d'après cet extrait d'un message
de Linus Torvalds sur la liste de diffusion du noyau Linux:</para>

<screen>Je suggère que les personnes qui compilent des noyaux devraient:

 - ne pas créer un seul lien symbolique (sauf celui créé lors de la
construction du noyau, <quote>linux/include/asm</quote> qui est utilisé pour la
compilation du noyau lui-même)

Et oui, c'est ce que je fais. Mon répertoire /usr/src/linux a toujours les
anciens en-têtes du noyau 2.2.13, même si je n'ai pas lancé cette version du
noyau depuis un _loong_ moment. Mais Glibc a été compilé avec, donc ces
en-têtes correspondent aux objets de la bibliothèque.

Et cela correspond à l'environnement suggéré depuis au moins les cinq dernières 
années. Je ne sais pas pourquoi l'idée du lien symbolique est toujours vivante, 
comme un mauvais zombie. Pratiquement toutes les distributions conservent
l'idée du lien et tout le monde se souvient que les sources du noyau doivent
aller sous <quote>/usr/src/linux</quote> même si ce n'est plus vrai depuis
_trèès_ longtemps.</screen>

<para>La partie essentielle se trouve là où Linus indique que les fichiers
d'en-tête doivent être <emphasis>ceux avec lesquels gblic a été
compilé</emphasis>. Ces en-têtes doivent être utilisés plus tard lorsque vous
compilerez d'autres paquets, car ce sont eux qui représentent les fichiers
de bibliothèques. En copiant les en-têtes, nous nous assurons qu'ils restent
disponibles plus tard lors d'une mise à jour du noyau.</para>

<para>Notez qu'il est parfaitement normal d'avoir les sources du noyau dans
<filename class="directory">/usr/src/linux</filename>, aussi longtemps que
vous n'avez pas les liens symboliques
<filename class="directory">/usr/include/{linux,asm}</filename>.</para>

</sect2>

</sect1>
