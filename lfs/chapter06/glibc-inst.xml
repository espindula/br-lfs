<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Installation de Glibc</title>

<para>Avant de commencer l'installation de glibc, vous devez entrer (cd) dans le
répertoire glibc-&glibc-version; et déballer glibc-linuxthreads à l'intérieur
du répertoire glibc-&glibc-version;, et non pas dans /usr/src comme vous le
feriez normalement.</para>

<para>Ce package est connu pour mal se comporter si vous changez ses options
d'optimisation par défaut (ceci inclut les options -march et -mcpu). Donc, si
vous avez défini des variables d'environnement, telles que CFLAGS et CXXFLAGS,
qui annulent les optimisations par défaut, nous vous recommendons de les
supprimer ou de les modifier pour la copnstruction de GCC.</para>

<para>Habituellement, compiler Glibc d'une toute autre façon que ce que le livre
suggère fait courir un gros risque à votre système.</para>

<para>Nous commencerons à appliquer ce correctif, corrigeant ce qui suit:</para>

<itemizedlist>
<listitem><para>Il convertit toutes les occurrences de
<emphasis>$(PERL)</emphasis> en <emphasis>/usr/bin/perl</emphasis> dans le
fichier <filename>malloc/Makefile</filename>. Ceci est fait parce que Glibc ne
peut pas détecter automatiquement l'emplacement de perl, car le paackage Perl
n'a pas encore été installé. Et si Glibc pense que Perl n'est pas installé, le
programme perl <userinput>mtrace</userinput> ne sera pas non plus installé.
</para></listitem>

<listitem><para>Il remplace toutes les occurrences de <emphasis>root</emphasis>
avec <emphasis>0</emphasis> dans le fichier <filename>login/Makefile</filename>.
Ceci est fait parce que Glibc lui-même n'est pas encore installé et donc la
résolution du nom de l'utilisateur en identifiant ne fonctionne pas encore, donc
un <userinput>chown root file</userinput> échouera, néanmoins ceci fonctionnera
bien si vous utilisez les identifiants numériques (tel que <userinput>chown 0
file</userinput>).</para></listitem>

</itemizedlist>

<para><screen><userinput>patch -Np1 -i ../glibc-&glibc-rootperl-patch-version;-root-perl.patch</userinput></screen></para>

<para>Il existe un problème potentiel qui fait que des binaires liés
statiquement se "plantent" avec la Glibc-2.2 et précédentes. Même si les
binaires statiques ont toutes les parties nécessaires de la Glibc intégrée, ils
sont toujours liés à un ensemble externe de bibliothèques: les bibliothèques
NSS de Glibc. Ces bibliothèques, en plus d'autres choses, indiquent que les
programmes où la base de données de mots de passe du système est /etc/password,
ou NIS ou sur tout autre schéma qui a été configuré.</para>

<para>Glibc a réalisé quelques changements depuis la version 2.2.x et le nouveau
code NSS est incompatible avec l'ancien. Donc lorsque Glibc est installé, il
installera ses nouvelles bibliothèques NSS et les programmes statiques
chargeront leurs nouvelles bibliothèques NSS et commencera à planter avec des
erreurs de <emphasis>segmentation fault</emphasis>. Ce correctif défait un
certain nombre de changements pour arranger ce problème.</para>

<para>Si vous commencez le chapitre 5 avec un système hôte utilisant Glibc-2.2.x
ou plus ancien, vous devez appliquer le correctif suivant. Nous installerons
encore Glibc à la fin de ce chapitre pour supprimer ce correctif, donc vous
aurez une Glibc comme les développeurs le souhaitent.</para>

<para><screen><userinput>patch -Np1 -i ../glibc-&glibc-libnss-patch-version;-libnss.patch</userinput></screen></para>

<para>Glibc cherchera le fichier <filename>/etc/ld.so.conf</filename> et
finira avec une erreur si le ficher est manquant, donc nous devons le créer:
</para>

<para><screen><userinput>touch /etc/ld.so.conf</userinput></screen></para>

<para>Il est recommendé par la documentation d'installation de Glibc de
construire Glibc, en dehors du répertoire des sources, dans un répertoire dédié:
</para>

<para><screen><userinput>mkdir ../glibc-build &amp;&amp;
cd ../glibc-build</userinput></screen></para>

<para>Ensuite, préparez la compilation de Glibc:</para>

<para><screen><userinput>../glibc-&glibc-version;/configure --prefix=/usr \
&nbsp;&nbsp;&nbsp;&nbsp;--disable-profile --enable-add-ons \
&nbsp;&nbsp;&nbsp;&nbsp;--libexecdir=/usr/bin</userinput></screen></para>

<para>La signification des options de configure est:</para>

<itemizedlist>
<listitem><para><userinput>--disable-profile</userinput> : Ceci désactive la
construction des biliothèques avec des informations de profilage. Cette commande
peut être omise si vous plannifiez de faire du profiling.
</para></listitem>

<listitem><para><userinput>--enable-add-ons</userinput> : Ceci active le module
supplémentaire que nous installons avec Glibc, linuxthreads</para></listitem>

<listitem><para><userinput>--libexecdir=/usr/bin</userinput> : Ceci fera que le
programme pt_chown sera installé dans le répertoire /usr/bin.</para></listitem>
</itemizedlist>

<para>Durant cette étape, vous verrez le message d'avertissement suivant:</para>

<blockquote><screen>configure: warning:
*** These auxiliary programs are missing or too old: msgfmt
*** some features will be disabled.
*** Check the INSTALL file for required versions.</screen></blockquote>

<para>Le msgfmt manquant (du package gettext que nous installerons plus tard
dans ce chapitre) ne causera pas de problèmes. msgfmt permet de générer les
fichiers binaires de traduction qui sont utilisés pour que votre système parle
une autre langue. Comme les fichiers de traduction ont déjà été générés pour
vous, il n'y a pas besoin de msgfmt. Vous aurez besoin de msgfmt uniquement si
vous devez changer les fichiers source de traduction (les fichiers
<filename>*.po</filename> dans le sous-répertoire <filename
class="directory">po</filename>) ce qui vous réclamera de regénérer les fichiers
binaires.</para>

<para>Comme Glibc n'a pas encore été installé, un des tests, qui ont été lancé
par le script configure, a échoué. Ce test est supposé tester gcc pour
déterminer si, oui ou non, un cross-compilateur est installé. Néanmoins, Glibc
a besoin d'être déjà installé pour lancer ce test. Comme le test échoue, le
script configure suppose automatiquement que nous avons un cross-compilateur.
Nous devons laisser cette information et dire explicitement à Glibc que nous ne
faisons pas de cross-compilation. Ne pas faire cela impose un certain nombre
d'effets de bord non voulus, tel que ne pas installer les fichiers timezone.
</para>

<para><screen><userinput>echo "cross-compiling = no" &gt; configparms</userinput></screen></para>

<para>Continuez avec la compilation du package:</para>

<para><screen><userinput>make</userinput></screen></para>

<para>Nous continuerons avec l'installation du package. Les pages man de
Linuxthreads ne vont pas être installés à ce moment parce qu'il nécessite une
installation fonctionnelle de Perl. Nous installerons Perl plus tard sur ce
chapitre, et les pages man seront installées lorsque Glibc sera installé pour la
deuxième fois à la fin de ce chapitre.</para>

<para><screen><userinput>make install</userinput></screen></para>

<para>Les locales ne sont pas installés lorsque vous lancez
<userinput>make install</userinput>, donc nous devons le faire nous-même. Les
locales sont utilisées par Glibc pour que votre système Linux parle une autre
langue:</para>

<para><screen><userinput>make localedata/install-locales</userinput></screen></para>

<para>Une alternative au lancement de <userinput>make
localedata/install-locales</userinput> est d'installer seulement ces locales
dont vous aurez besoin. On peut y arriver en utilisant la commande localedef.
Les informations là-dessus sont disponibles dans le fichier INSTALL, du
répertoire glibc-&glibc-version;.</para>

<para>Pour finir l'installation, nous relancerons Bash pour qu'il utilise les
fichiers libnss. Ceci nous débarrasse du message <emphasis>I have no
name!</emphasis> ("Je n'ai pas de nom!") à l'invite:</para>

<para><screen><userinput>exec /static/bin/bash --login</userinput></screen></para>

</sect2>

