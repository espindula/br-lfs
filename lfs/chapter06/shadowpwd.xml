<sect1 id="ch06-shadow">
<title>Installer Shadow-&shadow-version;</title>
<?dbhtml filename="shadow.html" dir="chapter06"?>

<screen>Estimation du temps de construction:           &shadow-time;
Estimation de l'espace disque requis:  &shadow-compsize;</screen>

&aa-shadowpwd-shortdesc;
&aa-shadowpwd-dep;

<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Installation de Shadow</title>

<para>Les programmes <userinput>login</userinput>, <userinput>getty</userinput>
et <userinput>init</userinput> (ainsi que quelques autres) maintiennent des
journaux pour enregistrer qui est ou était connecté au système. Néanmoins, ces
programmes ne créent pas ces journaux lorsque ceux-ci n'existent pas. Donc, si
vous souhaitez que ces traces soient générées, vous devrez créer ces fichiers
vous-même. Le package Shadow doit détecter ces fichiers au bon endroit, donc
nous les créons maintenant avec de bons droits&nbsp;:</para>

<screen><userinput>touch /var/run/utmp /var/log/{btmp,lastlog,wtmp}
chmod 644 /var/run/utmp /var/log/{btmp,lastlog,wtmp}</userinput></screen>

<para>Le fichier <filename>/var/run/utmp</filename> contient la liste des
utilisateurs actuellement connectés, le fichier
<filename>/var/log/wtmp</filename> ceux qui l'<emphasis>étaient</emphasis> et
quand. Le fichier <filename>/var/log/lastlog</filename> affiche pour chaque
utilisateur quand il, ou elle, s'est connecté la dernière fois alors que le
fichier <filename>/var/log/btmp</filename> contient les tentatives échouées de
connexion.</para>

<para>Shadow code en dur le chemin vers le binaire <userinput>passwd</userinput>
à l'intérieur du binaire lui-même mais fait cela d'une mauvaise façon. Si un
binaire <userinput>passwd</userinput> n'est pas présent lors de l'installation
de Shadow, le package suppose de manière erronée que celui-ci se trouve dans
<filename>/bin</filename> mais l'installe ensuite dans
<filename>/usr/bin</filename>. Ceci amène des erreurs sur l'absence de
<filename>/bin/passwd</filename>. Pour contourner ce problème, créez un fichier
<filename>passwd</filename> de façon à ce qu'il soit bien codé&nbsp;:</para>

<screen><userinput>touch /usr/bin/passwd</userinput></screen>

<para>La suite actuelle Shadow a un problème avec la commande
<userinput>newgrp</userinput> faisant échouer celle-ci. Le correctif suivant
(apparaissant aussi dans le code CVS de Shadow) corrige ce problème&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../&shadow-patch;</userinput></screen>

<para>Maintenant, préparez la compilation de Shadow&nbsp;:</para>

<screen><userinput>./configure --prefix=/usr --libdir=/usr/lib --enable-shared</userinput></screen>

<para>Compilez le package&nbsp;:</para>

<screen><userinput>make</userinput></screen>

<para>Et installez-le&nbsp;:</para>

<screen><userinput>make install</userinput></screen>

<para>Shadow utilise deux fichiers pour configurer les paramètrages
d'authentification du système. Installez ces deux fichiers de
configuration&nbsp;:</para>

<screen><userinput>cp etc/{limits,login.access} /etc</userinput></screen>

<para>Nous voulons modifier la méthode de cryptage du mot de passe en activant
les mots de passe MD5 théoriquement plus sécurisés qu'avec la méthode par
défaut, crypt, et permettant en plus des mots de passe dépassant huit
caractères. Nous avons aussi besoin de changer l'ancien emplacement
<filename class="directory">/var/spool/mail</filename> des boîtes mail des
utilisateurs par l'emplacement actuel,
<filename class="directory">/var/mail</filename>. Nous faisons cela en modifiant
le fichier de configuration correct lors de sa copie&nbsp;:</para>

<screen><userinput>sed -e 's%/var/spool/mail%/var/mail%' \
&nbsp;&nbsp;&nbsp;&nbsp;-e 's%#MD5_CRYPT_ENAB.no%MD5_CRYPT_ENAB yes%' \
&nbsp;&nbsp;&nbsp;&nbsp;etc/login.defs.linux &gt; /etc/login.defs</userinput></screen>

<note><para>Faites attention en tapant la commande ci-dessus. Il est
probablement plus sûr de la copier et coller plutôt que d'essayer de la taper
entièrement.</para></note>

<para>En accord avec la page man de <userinput>vipw</userinput>, un programme
<userinput>vigr</userinput> devrait aussi exister. Comme la procédure
d'installation ne crée pas ce programme, créons le lien symbolique
manuellement&nbsp;:</para>

<screen><userinput>ln -s vipw /usr/sbin/vigr</userinput></screen>

<para>Comme le lien symbolique <filename>/bin/vipw</filename> est redondant (et
pointe même vers un fichier inexistant), supprimez-le&nbsp;:</para>

<screen><userinput>rm /bin/vipw</userinput></screen>

<para>Maintenant, déplacez le programme <userinput>sg</userinput> à son bon
emplacement&nbsp;:</para>

<screen><userinput>mv /bin/sg /usr/bin</userinput></screen>

<para>Et déplacez les bibliothèques partagées de Shadow à un endroit plus
approprié&nbsp;:</para>

<screen><userinput>mv /usr/lib/lib{shadow,misc}.so.0* /lib</userinput></screen>

<para>Comme certains packages s'attendent à trouver les bibliothèques tout juste
déplacées dans <filename>/usr/lib</filename>, créez les liens symboliques
suivants&nbsp;:</para>

<screen><userinput>ln -sf ../../lib/libshadow.so.0 /usr/lib/libshadow.so
ln -sf ../../lib/libmisc.so.0 /usr/lib/libmisc.so</userinput></screen>

<para>Coreutils a déjà installé un programme <userinput>groups</userinput> dans
<filename>/usr/bin</filename>. Si vous le souhaitez, vous pouvez supprimer celui
installé par Shadow&nbsp;:</para>

<screen><userinput>rm /bin/groups</userinput></screen>

</sect2>

&c6-cf-shadowpwd;

</sect1>
