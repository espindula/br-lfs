<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-system-readjusting">
<title>Ré-ajustement de l'ensemble d'outils</title>
<?dbhtml filename="readjusting.html"?>

<para>Maintenant que les bibliothèques C finales ont été
installées, il est temps d'ajuster de nouveau l'ensemble d'outils. L'ensemble
d'outils sera ajusté de façon à ce qu'il lie tout programme nouvellement
compilé avec ces nouvelles bibliothèques. C'est le même processus que celui
utilisé dans la phase <quote>Ajustement</quote> au début du <xref
linkend="chapter-temporary-tools"/>, avec les ajustements inversés. Dans <xref
linkend="chapter-temporary-tools"/>, l'ensemble était passé des répertoires
<filename class="directory">/{,usr/}lib</filename> de l'hôte dans le nouveau
répertoire <filename class="directory">/tools/lib</filename>. Maintenant,
l'ensemble sera guidé du même répertoire <filename
class="directory">/tools/lib</filename> vers les répertoires
<filename class="directory">/{,usr/}lib</filename> de LFS.</para>

<para>Commencez en ajustant l'éditeur de liens. Les répertoires des sources et
de construction de la duxième passe de Binutils ont été conservés dans ce 
but. Installez l'éditeur de liens ajusté en exécutant la commande suivante à
partir du répertoire <filename
class="directory">binutils-build</filename>&nbsp;:</para>

<screen><userinput>make -C ld INSTALL=/tools/bin/install
install</userinput></screen>

<note><para>Si le précédent avertissement pour conserver les répertoires des
sources et de construction de Binutils lors de la deuxième passe dans <xref
linkend="chapter-temporary-tools"/> a été oublié, ou s'ils ont été
accidentellement supprimés ou rendus inaccessubles, ignorez la commande
ci-dessus. Le résultat en sera que le prochain paquet, Binutils, sera lié aux
bibliothèques C dans <filename class="directory">/tools</filename> plutôt que
dans <filename class="directory">/{,usr/}lib</filename>. Ceci n'est pas idéal.
Néanmoins, les tests ont montrés que les binaires Binutils résultants devraient
être identiques.</para></note>

<para>À partir de maintenant, chaque programme compilé sera lié avec les
bibliothèques de <filename class="directory">/usr/lib</filename> et de
<filename class="directory">/lib</filename>. L'option supplémentaire
<parameter>INSTALL=/tools/bin/install</parameter> est nécessaire car le fichier
<filename>Makefile</filename> créé lors de la seconde passe contient toujours
la référence à <command>/usr/bin/install</command>, qui n'a pas encore été
installé. Quelques distributions hôtes contiennent un lien symbolique <filename
class="symlink">ginstall</filename> qui est prioritaure dans le fichier
<filename>Makefile</filename> et peut cause un problème. La commande ci-dessus
tient compte de ce problème.</para>

<para>Supprimez les répertoires des sources et de construction de Binutils
maintenant.</para>

<para>Ensuite, modifiez le fichier specs de GCC pour qu'il pointe sur le nouvel
éditeur de liens. Une commande <command>perl</command> accomplit ceci&nbsp;:</para>

<screen><userinput>perl -pi -e 's@ /tools/lib/ld-linux.so.2@ /lib/ld-linux.so.2@g;' \
    -e 's@\*startfile_prefix_spec:\n@$_/usr/lib/ @g;' \
        `gcc --print-file specs`</userinput></screen>

<para>C'est une bonne idée d'inspecter visuellement le fichier specs pour
vérifier que les modifications attendues ont réellement été effectuées.</para>

<important><para>En travaillant sur une plateforme où le nom de l'éditeur de
liens est quelque chose d'autres que <filename
class="libraryfile">ld-linux.so.2</filename>, substituez
<quote>ld-linux.so.2</quote> par le nom de l'éditeur de liens dans les
commandes suivantes. Référez-vous à <xref
linkend="ch-tools-toolchaintechnotes" role=","/> si
nécessaire.</para></important>

<beginpage/>

<caution><para>Il est impératif à ce moment d'arrêter et de vous assurer que le
s fonctions basiques (compilation et édition des liens) de l'ensemble des
outils ajusté fonctionnent comme attendu. Pour cela, réalisez une petite
vérification&nbsp;:</para>

<screen><userinput>echo 'main(){}' &gt; dummy.c
cc dummy.c
readelf -l a.out | grep ': /lib'</userinput></screen>

<para>Si tout fonctionne correctement, il ne devrait pas y avoir d'erreurs et
la sortie de la commande sera (avec des différences spécifiques aux plateformes
dans le nom de l'éditeur de liens)&nbsp;:</para>

<screen><computeroutput>[Requesting program interpreter:
/lib/ld-linux.so.2]</computeroutput></screen>

<para>Notez que <filename class="directory">/lib</filename> est maintenant le
préfixe de notre éditeur de liens.</para>

<para>Si la sortie n'apparaît pas comme ce qui est montré ci-dessus ou si
aucune sortie n'est renvoyée, alors quelque chose s'est mal passé. Investiguez
et retracez les étapes pour savoir d'où vient le problème et comment le
corriger. La raison la plus probable est que quelque chose s'est mal passé lors
de la modification du fichier specs ci-dessus. Tout probl_me devra être résolu
avant de continuer le processus.</para>

<para>Une fois que tout fonctionne correctement, nettoyez les fichiers
tests&nbsp;:</para>

<screen><userinput>rm dummy.c a.out</userinput></screen></caution>

</sect1>
