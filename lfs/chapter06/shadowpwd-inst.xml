<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Installation de la suite Shadow Password</title>

<para>Avant d'installer ce package, vous pouvez jeter un oeil sur l'astuce LFS
pour Shadow. Il indique comment rendre votre système plus sécurisé en ce qui
concerne les mots de passe, comment activer les mots de passe MD5 plus sécurisés
et comment disposer du meilleur du package Shadow. L'astuce LFS Shadow est
disponible sur <ulink url="&hints-root;shadowpasswd_plus.txt"/>.</para>

<para>Les programmes comme login, shutdown, uptime et d'autres veulent lire et
écrire les fichiers /var/run/utmp, /var/log/btmp and /var/log/wtmp. Ces fichiers
contiennent de l'information sur qui est actuellement connecté. Ils contiennent
aussi des informations sur le moment où l'ordinateur a été lancé et arrêté pour
la dernière fois ainsi qu'un enregistrement des tentatives de connexion.</para>

<para>Créez ces fichiers avec leur bons droits en lançant les commandes
suivantes:</para>

<para><screen><userinput>touch /var/run/utmp /var/log/{btmp,lastlog,wtmp}
chmod 644 /var/run/utmp /var/log/{btmp,lastlog,wtmp)</userinput></screen></para>

<para>Shadow code en dur le chemin vers le binaire passwd, mais il le fait d'une
mauvaise façon. Si aucun binaire passwd n'est présent avant l'installation de
Shadow, il assume (par erreur) qu'il sera dans /bin alors qu'il installe sa
version dans /usr/bin. Ceci nous amènera quelques problèmes étranges sur un
/bin/passwd introuvable. Pour corriger ce bug dans Shadow, nous allons créer un
fichier passwd de façon à ce que le chemin soit correctement codé:</para>

<para><screen><userinput>touch /usr/bin/passwd</userinput></screen></para>

<para>La suite shadow actuelle a un problème avec la commande newgrp qui la fait
échouer. Le correctif suivant (apparaissant aussi dans le code CVS de Shadow) corrige
ce problème.</para>

<para><screen><userinput>patch -Np1 -i ../shadow-&shadow-patch-version;.patch
</userinput></screen></para>

<para>Maintenant, préparez la compilation de Shadow:</para>

<para><screen><userinput>./configure --prefix=/usr --libdir=/usr/lib \
&nbsp;&nbsp;&nbsp;&nbsp;--enable-shared</userinput></screen></para>

<para>Continuez avec sa compilation:</para>

<para><screen><userinput>make</userinput></screen></para>

<para>Installez le package:</para>

<para><screen><userinput>make install</userinput></screen></para>

<para>Shadow utilise deux fichiers pour configurer les paramètrages
d'authentification du système. Installez ces deux fichiers de configuration:
</para>

<para><screen><userinput>cp etc/{limits,login.access} /etc</userinput></screen></para>

<para><filename class="directory">/var/spool/mail</filename> est l'ancien
emplacement pour les boîtes mail de l'utilisateur. Le nouvel emplacement est
/var/mail. Lancez la commande suivante pour modifier l'emplacement de la boîte
mail:</para>

<para><screen><userinput>sed 's%/var/spool/mail%/var/mail%' \
&nbsp;&nbsp;&nbsp;&nbsp;etc/login.defs.linux &gt; /etc/login.defs</userinput></screen></para>

<para>Suivant la page man de <userinput>vipw</userinput>, un lien symbolique
<userinput>vigr</userinput> doit exister. Parce que la procédure d'installation
de shadow ne crée pas ce lien, il doit être créé manuellement:</para>

<para><screen><userinput>ln -s vipw /usr/sbin/vigr</userinput></screen></para>

<para>Le lien <filename>vipw</filename> pointe actuellement sur un fichier
inexistant. Comme ce fichier n'est pas nécessaire, supprimez-le:</para>

<para><screen><userinput>rm /bin/vipw</userinput></screen></para>

<para>Déplacez le fichier <userinput>sg</userinput> vers le répertoire
<filename class="directory">/usr/bin</filename>:</para>

<para><screen><userinput>mv /bin/sg /usr/bin</userinput></screen></para>

<para>Déplacez les bibliothèques dynamiques de Shadow vers un emplacement plus
approprié:</para>

<para><screen><userinput>mv /usr/lib/lib{shadow,misc}.so.0* /lib</userinput></screen></para>

<para>Les bibliothèques ont été déplacées, mais certains packages s'attendent à
les trouver dans le répertoire <filename class="directory">/usr/lib</filename>.
Pour en tenir compte, créez les liens symboliques suivants:</para>

<para><screen><userinput>ln -sf ../../lib/libshadow.so.0 /usr/lib/libshadow.so
ln -sf ../../lib/libmisc.so.0 /usr/lib/libmisc.so</userinput></screen></para>

<para>Sh-utils et la suite Shadow Password installent tous les deux un même
programme <filename>groups</filename>. Si vous le souhaitez, vous pouvez
supprimer le programme <filename>groups</filename> installé par la suite Shadow
Password:</para>

<para><screen><userinput>rm /bin/groups</userinput></screen></para>

</sect2>
