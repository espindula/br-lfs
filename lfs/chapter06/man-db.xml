<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-man-db" role="wrap">
  <?dbhtml filename="man-db.html"?>

  <sect1info condition="script">
    <productname>man-db</productname>
    <productnumber>&man-db-version;</productnumber>
    <address>&man-db-url;</address>
  </sect1info>

  <title>Man-DB-&man-db-version;</title>

  <indexterm zone="ch-system-man-db">
    <primary sortas="a-Man-DB">Man-DB</primary>
  </indexterm>

  <sect2 role="package">
    <title/>

    <para>Le paquet Man-DB contient des programmes pour trouver et voir
    des pages de manuel.</para>

    <segmentedlist>
      <segtitle>&buildtime;</segtitle>
      <segtitle>&diskspace;</segtitle>

      <seglistitem>
        <seg>&man-db-ch6-sbu;</seg>
        <seg>&man-db-ch6-du;</seg>
      </seglistitem>
    </segmentedlist>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Man-DB</title>

    <para>LFS crée <filename>/usr/man</filename> et
    <filename>/usr/local/man</filename> en tant que liens symboliques. 
    Supprimez-les du fichier <filename>man_db.conf</filename> pour empêcher les
    résultats redondants lors de l'utilisation de programmes tels
    <command>whatis</command>&nbsp;:</para>
    
<screen><userinput remap="pre">sed -i -e '\%\t/usr/man%d' -e '\%\t/usr/local/man%d' -e '\%\t/usr/local/man%d' src/man_db.conf.in</userinput></screen>

    <para>Préparez la compilation de man-DB&nbsp;:</para>
<screen><userinput remap="configure">./configure --prefix=/usr --libexecdir=/usr/lib \
   --sysconfdir=/etc --disable-setuid \
   --enable-mb-groff --with-browser=/usr/bin/lynx \
   --with-col=/usr/bin/col --with-vgrind=/usr/bin/vgrind \
   --with-grap=/usr/bin/grap</userinput></screen>
   
    <variablelist>
      <title>Voici la signification des options de configuration&nbsp;:</title>

      <varlistentry>
        <term><parameter>--disable-setuid</parameter></term>
        <listitem>
          <para>Ceci empêche que le programme <command>man</command> se voit 
          attribué l'ID de l'utilisateur  <systemitem class="username">man</systemitem>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><parameter>--enable-mb-groff</parameter></term>
        <listitem>
          <para>Ce paramètre dit à <application>man-db</application> de
          s'attendre à la version corrigée de Debian multibits de
          <application>groff</application>.</para>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term><parameter>--with-...</parameter></term>
        <listitem>
          <para>Ces quatre paramètres sont utilises pour initialiser quelques
          programmes par défaut. Le programme <command>col</command> fait partie
          du paquet Util-linux-ng, <command>lynx</command> est un navigateur Web
          en console (voir BLFS pour les instructions d'installation),
          <command>vgrind</command> convertit du code source de programme en 
          entrée Groff et <command>grap</command> est utile pour la composition
          de texte de graphes dans les documents Groff. Les programmes
          <command>vgrind</command> et <command>grap</command> ne sont normalement pas
          nécessaires pour la visualisation des pages de manuel. Ils ne font pas partie
          de LFS ou de BLFS mais vous devriez être capable de les installer vous-même 
          après avoir fini LFS si vous souhaitez faire cela.</para>
        </listitem>
      </varlistentry>

    </variablelist>

    <para>Compilez le paquet&nbsp;:</para>

<screen><userinput remap="make">make</userinput></screen>

    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>

    <para>Installez le paquet&nbsp;:</para>

<screen><userinput remap="install">make install</userinput></screen>

  </sect2>

  <sect2>
    <title>Pages de manuel non anglaises dans LFS</title>

    <para>Certains paquets fournissent des pages de man UTF-8. Elles ne sont 
    affichées correctement que si leur emplacement et leur encodage correspond
    à ce qu'attend le programme "man". Cependant, diverses distributions
    Linux ont des politiques différentes (exprimées dans le choix du programme
    <command>man</command>, sa configuration et les correctifs qui lui sont
    appliqués) concernant l'encodage de caractères dans lequel les pages de
    manuel sont conservées sur le système de fichiers.</para>
    
    <para>Par exemple, Debian exigeait auparavant que les pages de man russes 
    soient encodées en KOI8-R et situées dans <filename class="directory">/usr/share/man/ru</filename>.
    Maintenant, en plus, leur programme <command>man</command>
    (<application>Man-DB</application>) cherche les pages de manuel en russe 
    encodées en UTF-8 dans <filename class="directory">/usr/share/man/ru.UTF-8</filename>.
    Au contraire, Fedora utilise exclusivement celles encodées en UTF-8. On trouve
    les pages de man en russe dans
    <filename class="directory">/usr/share/man/ru</filename> et leur programme
    <command>man</command> n'admet que <filename class="directory">/usr/share/man/ru.UTF-8</filename>.
    Beaucoup d'autres distributions ignorent totalement les encodages présents
    sur le disque, laissant
    l'utilisajeur final face à un mélange de pages de manuel mal encodées pour
    leur configuration. Lorsque <command>man</command> traite la page
    demandée, il affichera le contenu tel que configuré, donnant un résultat
    complètement illisible si l'encodage sur le disque n'est pas celui attendu
    pour cette configuration.</para>
    
    <para>Le désaccord entre les fabricants de distribution sur l'encodage 
    attendu des pages de manuel a conduit a une confusion pour les mainteneurs
    originels des paquets. Il se peut qu'un paquet contienne des pages de
    manuel en UTF-8 tandis qu'un autre est livré avec des pages de manuel en
    encodages finaux. <command>man</command> cherche les pages de manuel basées
    sur les paramètres de la locale de l'utilisateur.
    <application>Man-DB</application> utilise une table intégrée (voir
    ci-dessous) pour déterminer l'encodage sur le disque des pages de manuel
    trouvées pour la locale d'un utilisateur, du moins si les répertoires n'ont
    pas d'extension qui décrit l'encodage. Par exemple, avec un ".UTF-8"
    dans le nom d'un répertoire, <application>Man-DB</application> sait que
    toutes les pages de manuel se trouvant dans
    <filename class="directory">/usr/share/man/fr.UTF-8</filename> sont encodées
    en UTF-8 et, selon la table intégrée, s'attend à ce que toutes les pages de
    manuel se trouvant dans
    <filename class="directory">/usr/share/man/ru</filename> soient encodées en
    utilisant KOI8-R.</para>

    <!-- Origin: man-db-2.4.3/src/encodings.c -->
    <table>
      <title>Encodage de caractère attendu des pages de manuel</title>
      <?dbfo table-width="2.5in" ?>

      <tgroup cols="2">

        <colspec colnum="1" colwidth="1.5in"/>
        <colspec colnum="2" colwidth="1in"/>

        <thead>
          <row>
            <entry>Langue (code)</entry>
            <entry>Encodage</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry>Danois (da)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Allemand (de)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Anglais (en)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Espagnol (es)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Finnois (fi)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Français (fr)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Irlandais (ga)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Galicien (gl)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Indonésien (id)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Islandais (is)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Italien (it)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Néerlandais (nl)</entry>
            <entry>ISO-8859-1</entry>
          </row>
	  <!-- FIXME: BUG: "no" is deprecated, should use "nb" or "nn" and
          symlinks -->
          <row>
            <entry>Norvégien (no)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <!-- END BUG -->
          <row>
            <entry>Portugais (pt)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <row>
            <entry>Suédois (sv)</entry>
            <entry>ISO-8859-1</entry>
          </row>
          <!-- Languages below require patched groff -->
          <row>
            <entry>Bulgare (bg)</entry>
            <entry>CP1251</entry>
          </row>
          <row>
            <entry>Tchèque (cs)</entry>
            <entry>ISO-8859-2</entry>
          </row>
          <row>
            <entry>Croate (hr)</entry>
            <entry>ISO-8859-2</entry>
          </row>
          <row>
            <entry>Hongrois (hu)</entry>
            <entry>ISO-8859-2</entry>
          </row>
          <row>
            <entry>Japonais (ja)</entry>
            <entry>EUC-JP</entry>
          </row>
          <row>
            <entry>Coréen (ko)</entry>
            <entry>EUC-KR</entry>
          </row>
          <row>
            <entry>Polonais (pl)</entry>
            <entry>ISO-8859-2</entry>
          </row>
          <row>
            <entry>Russe (ru)</entry>
            <entry>KOI8-R</entry>
          </row>
          <row>
            <entry>Slovaque (sk)</entry>
            <entry>ISO-8859-2</entry>
          </row>
          <row>
            <entry>Serbe (sr)</entry>
            <entry>ISO-8859-5</entry>
          </row>
          <row>
            <entry>Turc (tr)</entry>
            <entry>ISO-8859-9</entry>
          </row>
          <row>
            <entry>Chinese simplifié (zh_CN)</entry>
            <entry>GBK</entry>
        </row>
        <row>
          <entry>Chinese simplifié, Singapour (zh_SG)</entry>
          <entry>GBK</entry>
        </row>
        <row>
          <entry>Chinois traditionnel (zh_TW)</entry>
          <entry>BIG5</entry>
        </row>
        <row>
          <entry>Chinois traditionnel, Hong Kong (zh_HK)</entry>
          <entry>BIG5HKSCS</entry>
        </row>
          
        </tbody>

      </tgroup>

    </table>

    <note>
      <para>Les pages de manuel dont la langue ne figure pas dans la liste ne
      sont pas supportées. Le norvégien ne fonctionne pas maintenant à cause du
      passage de la locale no_NO à nb_NO, et sera corrigé dans la prochaine
      version de <application>Man-DB</application>. Le Coréen n'est pas 
      actuellement fonctionnel à cause d'un correctif de Groff incomplet.</para>
    </note>

    <para>Il se peut que des paquets installent des pages de manuel dans un
    répertoire mal nommé, selon les distributions pour laquelle l'auteur
    développe le paquet. Pour aider la conversion des pages de manuel dans le
    bon encodage dans le répertoire o elles sont installées, on a écrit le
    script <command>convert-mans</command>. Il va convertir les pages de manuel
    dans un autre encodage avant (ou après) l'installation. Installez le script
    <command>convert-mans</command> avec les instructions suivantes&nbsp;:</para>
    
 
<screen><userinput remap="install">cat &gt;&gt; convert-mans &lt;&lt; "EOF"
<literal>#!/bin/sh -e
FROM="$1"
TO="$2"
shift ; shift
while [ $# -gt 0 ]
do
        FILE="$1"
        shift
        iconv -f "$FROM" -t "$TO" "$FILE" >.tmp.iconv
        mv .tmp.iconv "$FILE"
done</literal>
EOF
install -v -m755 convert-mans  /usr/bin</userinput></screen>
                                
    <para>Si dès l'origine les pages de manuel sont distribuées dans
    l'encodage final, les pages de manuel peuvent simplement être copiées vers
    <filename class="directory">/usr/share/man/<replaceable>&lt;code de langue&gt;</replaceable></filename>.
    Par exemple, <ulink url="http://www.infodrom.org/projects/manpages-de/download/manpages-de-0.5.tar.gz">les pages de manuel en allemand</ulink>
    peuvent être installées avec les commandes suivantes&nbsp;:</para>
    
<screen role="nodump"><userinput>mkdir -p /usr/share/man/de
cp -rv man? /usr/share/man/de</userinput></screen>

    <para>Si à l'origine les pages de manuel sont distribuées en UTF-8
    (par exemple, <quote>pour RedHat</quote>) au lieu du codage indiqué
    dans la table ci-dessus, soit elles peuvent être converties de l'UTF-8
    vers le codage listé dans la table ci-dessus avant d'être installées, soit
    elles peuvent être installées directement dans
    <filename class="directory">/usr/share/man/<replaceable>&lt;code langue&gt;</replaceable>.UTF-8</filename>.</para>
    
    <para>Par exemple, pour installer
    <ulink url="http://manpagesfr.free.fr/download/man-pages-fr-2.40.0.tar.bz2">les pages de manuel en français</ulink>
    dans l'encodage final, utilisez les commandes suivantes&nbsp;:</para>

<screen role="nodump"><userinput>convert-mans UTF-8 ISO-8859-1 man?/*.?
mkdir -p /usr/share/man/fr
cp -rv man? /usr/share/man/fr</userinput></screen>

    <note><para>Bes pages de manuel en français sont livrées avec des scripts
    tout prêts pour faire la même conversion. Les idstructions
    ci-dessus sont utilisées seulement pour exemple d'utilisation du script
    <command>convert-mans</command> script.</para></note>
    
    <para>Finalement, pour un exemple d'installation de pages de manuel en UTF-8,
    de nouveau vous pourriez installer les pages de manuel en français avec
    les commandes suivantes&nbsp;:</para>
    
<screen role="nodump"><userinput>mkdir -p /usr/share/man/fr.UTF-8
cp -rv man? /usr/share/man/fr.UTF-8</userinput></screen>

  </sect2>

  <sect2 id="contents-man-db" role="content">
    <title>Contenu de Man-DB</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>

      <seglistitem>
        <seg>apropos, catman, convert-mans, lexgrog, man, mandb,
        manpath, whatis et zsoelim</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <!-- <varlistentry id="accessdb">
        <term><command>accessdb</command></term>
        <listitem>
          <para>Transforme le contenu de la base de données <command>whatis</command>
          en format lisible par un humain</para>
          <indexterm zone="ch-system-man-db accessdb">
            <primary sortas="b-accessdb">accessdb</primary>
          </indexterm>
        </listitem>
      </varlistentry> -->

      <varlistentry id="apropos">
        <term><command>apropos</command></term>
        <listitem>
          <para>Recherche la base de données <command>whatis</command> et
          affiche les descriptions courtes des commandes système qui contiennent une
          chaîne donnée</para>
          <indexterm zone="ch-system-man-db apropos">
            <primary sortas="b-apropos">apropos</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="catman">
        <term><command>catman</command></term>
        <listitem>
          <para>Crée ou met à jour les pages de manuel préformatées</para>
          <indexterm zone="ch-system-man-db catman">
            <primary sortas="b-catman">catman</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="convert-mans">
        <term><command>convert-mans</command></term>
        <listitem>
          <para>Reformate des pages de manuel afin que Man-DB puisse les afficher</para>
          <indexterm zone="ch-system-man-db convert-mans">
            <primary sortas="b-convert-mans">convert-mans</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="lexgrog">
        <term><command>lexgrog</command></term>
        <listitem>
          <para>Affiche des informations en résumé d'une ligne à propos d'une
          page de manuel donnée</para>
          <indexterm zone="ch-system-man-db lexgrog">
            <primary sortas="b-lexgrog">lexgrog</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="man">
        <term><command>man</command></term>
        <listitem>
          <para>Formate et affiche les pages de manuel demandées</para>
          <indexterm zone="ch-system-man-db man">
            <primary sortas="b-man">man</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mandb">
        <term><command>mandb</command></term>
        <listitem>
          <para>Crée ou met à jour la base de données <command>whatis</command></para>
          <indexterm zone="ch-system-man-db mandb">
            <primary sortas="b-mandb">mandb</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="manpath">
        <term><command>manpath</command></term>
        <listitem>
          <para>Affiche le contenu de $MANPATH ou (si $MANPATH n'est pas paramé!ré)
          d'un chemin de recherche convenable basé sur les paramètres de l'environnement 
          de l'utilisateur</para>
          <indexterm zone="ch-system-man-db manpath">
            <primary sortas="b-manpath">manpath</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="whatis">
        <term><command>whatis</command></term>
        <listitem>
          <para>Recherche la base de données <command>whatis</command> et
          affiche les descriptions courtes des commandes système qui contiennent
          le mot-clé donné sous la forme d'un mot séparé</para>
          <indexterm zone="ch-system-man-db whatis">
            <primary sortas="b-whatis">whatis</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="zsoelim">
        <term><command>zsoelim</command></term>
        <listitem>
          <para>Lit des fichiers et remplace les lignes de la forme 
          <emphasis>fichier .so</emphasis> par le contenu du <emphasis>fichier</emphasis>
          mentionné</para>
          <indexterm zone="ch-system-man-db zsoelim">
            <primary sortas="b-zsoelim">zsoelim</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
