<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-system-devices">
<title>Peupler /dev</title>
<?dbhtml filename="devices.html"?>

<indexterm zone="ch-system-devices"><primary sortas="e-/dev">/dev/*</primary></indexterm>

<sect2>
<title>Créer les n&oelig;uds périphériques initiaux</title>

<para>Lorsque le noyau démarre le système, il requiert la présence de quelques
n&oelig;uds périphériques, en particulier les périphériques <filename
class="devicefile">console</filename> et <filename
class="devicefile">null</filename>. Les n&oelig;uds de périphérique seront
créés sur le disque dur pour être disponibles avant l'exécution de
<command>udev</command>. Ils sont aussi créés quand Linux est démarré en mode
simple utilisateur (d'où les droits restreints sur
<filename class="devicefile">console</filename>). Créez les périphériques
en exécutant les commandes suivantes&nbsp;:</para>

<screen><userinput>mknod -m 600 /dev/console c 5 1
mknod -m 666 /dev/null c 1 3</userinput></screen>
</sect2>

<sect2>
<title>Monter tmpfs et peupler /dev</title>

<para>La méthode recommandée pour peupler le répertoire <filename
class="directory">/dev</filename> de périphériques est de monter un système de
fichiers virtuel (comme <systemitem class="filesystem">tmpfs</systemitem>) sur
le répertoire <filename class="directory">/dev</filename>, et d'autoriser la
création dynamique des périphériques sur le système de fichiers virtuels une
fois qu'ils sont détectés ou que quelque chose tente d'y accéder. Ceci est
fait généralement lors du démarrage. Comme ce nouveau système n'a pas encore
été démarré, il est nécessaire de faire ce que le paquetage LFS-Bootscripts
aurait fait en montant <filename class="directory">/dev</filename>&nbsp;:</para>

<screen><userinput>mount -nvt tmpfs none /dev</userinput></screen>

<para>Le paquetage Udev est celui qui va créer les périphériques dans le répertoire
<filename class="directory">/dev</filename>. Comme il ne sera installé que plus
tard lors de ce processus, créez manuellement l'ensemble minimum de n&oelig;uds
de périphériques nécessaire pour terminer la construction de ce système&nbsp;:</para>

<screen><userinput>mknod -m 622 /dev/console c 5 1
mknod -m 666 /dev/null c 1 3
mknod -m 666 /dev/zero c 1 5
mknod -m 666 /dev/ptmx c 5 2
mknod -m 666 /dev/tty c 5 0
mknod -m 444 /dev/random c 1 8
mknod -m 444 /dev/urandom c 1 9
chown -v root:tty /dev/{console,ptmx,tty}</userinput></screen>

<para>Certains liens symboliques et répertoires sont requis par LFS qui les crée
lors du démarrage du système grâce au paquetage LFS-Bootscripts. Comme il s'agit
d'un environnement chroot et que nous n'avons pas démarré avec lui, ces liens
symboliques et répertoires doivent être créés ici&nbsp;:</para>

<screen><userinput>ln -sv /proc/self/fd /dev/fd
ln -sv /proc/self/fd/0 /dev/stdin
ln -sv /proc/self/fd/1 /dev/stdout
ln -sv /proc/self/fd/2 /dev/stderr
ln -sv /proc/kcore /dev/core
mkdir -v /dev/pts
mkdir -v /dev/shm</userinput></screen>

<para>Enfin, montez les bons systèmes de fichiers virtuels (noyau) sur les
répertoires nouvellement créés&nbsp;:</para>

<screen><userinput>mount -vt devpts -o gid=4,mode=620 none /dev/pts
mount -vt tmpfs none /dev/shm</userinput></screen>

<beginpage/>
<para>Les commandes <command>mount</command> exécutées ci-dessus pourraient
causer les messages d'avertissement suivants&nbsp;:</para>

<screen><computeroutput>can't open /etc/fstab: No such file or directory.</computeroutput></screen>

<para>Ce fichier&mdash;<filename>/etc/fstab</filename>&mdash;n'a pas été encore
créé mais il n'est pas non plus requis pour le bon montage des systèmes de
fichiers. De cette façon, le message peut être ignoré sans crainte.</para>
</sect2>

</sect1>

