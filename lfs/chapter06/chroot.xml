<sect1 id="ch06-chroot">
<title>Entrée dans l'environnement chroot</title>
<?dbhtml filename="chroot.html" dir="chapter06"?>

<para>C'est le moment d'entrer dans l'environnement chroot afin d'installer
le reste des programmes nécessaires. Avant de lancer la commande chroot, vous
devez être <emphasis>root</emphasis> car seul cet utilisateur
peut utiliser cette commande.</para>

<para>Comme précédemment, assurez-vous que la variable d'environnement LFS est
configurée correctement en lançant <userinput>echo $LFS</userinput> et en
vérifiant que le chemin affiché pointe bien vers le point de montage de la
partition LFS, c'est-à-dire <filename class="directory">/mnt/lfs</filename> si
vous avez suivi notre exemple.</para>

<para>Devenez <emphasis>root</emphasis> et lancez la commande suivante pour
entrer dans l'environnement chroot:</para>

<screen><userinput>chroot $LFS /tools/bin/env -i \
&nbsp;&nbsp;&nbsp;&nbsp;HOME=/root TERM=$TERM PS1='\u:\w\$ ' \
&nbsp;&nbsp;&nbsp;&nbsp;PATH=/bin:/usr/bin:/sbin:/usr/sbin:/tools/bin \
&nbsp;&nbsp;&nbsp;&nbsp;LDFLAGS="-s" \
&nbsp;&nbsp;&nbsp;&nbsp;/tools/bin/bash --login</userinput></screen>

<para>L'option <userinput>-i</userinput> donné à la commande
<userinput>env</userinput> efface toutes les variables de l'environnement
chroot. Après cela, seules les variables HOME, TERM, PS1 et PATH sont
initialisées de nouveau. La commande TERM=$TERM initialise la variable
TERM à l'intérieur de chroot avec la même valeur que celle qu'elle avait à
l'extérieur; cette variable est utilisée par des programmes comme
<userinput>vim</userinput> et <userinput>less</userinput>
pour fonctionner correctement. Si vous avez besoin d'autres variables, telles
que CFLAGS ou CXXFLAGS, vous pouvez aussi les initialiser ici.</para>

<para>Dès maintenant, nous n'avons plus besoin d'utiliser la variable LFS --
car ce que le shell pense être <filename class="directory">/</filename>
est la valeur de <filename class="directory">$LFS</filename>, qui a été passé à
la commande chroot.</para>

<para>Notez que <filename class="directory">/tools/bin</filename> est le dernier
dans PATH. Ceci signifie qu'un outil temporaire ne sera pas utilisé tant que sa
version finale ne sera pas installée. Enfin, au moins lorsque le shell ne se
rappelle pas de l'emplacement des binaires exécutés, et c'est pour cette raison
que le hachage est désactivé un peu plus tard.</para>

<para>Assurez-vous que les commandes dans le reste de ce chapitre et dans
les suivants sont exécutées dans l'environnement chroot. Si vous quittez
l'environnement chroot (en redémarrant l'ordinateur par exemple), Pensez
à retourner de nouveau dans l'environnement chroot et à monter une nouvelle
fois les systèmes de fichiers proc et devpts (comme indiqué plus tard) avant de
continuer dans le livre.</para>

<para>Notez que l'invite de bash contiendra "I have no name!" 
(je n'ai pas de nom!) ce qui est normal puisque <filename>/etc/passwd</filename>
n'a pas encore été créé.</para>

</sect1>
