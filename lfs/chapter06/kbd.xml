<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<!-- FIXME: upstream git has been persuaded by SuSe to build resizecons on x86_64,
so the sed will need attention if that change is not removed before the next release -->

<sect1 id="ch-system-kbd" role="wrap">
  <?dbhtml filename="kbd.html"?>

  <sect1info condition="script">
    <productname>kbd</productname>
    <productnumber>&kbd-version;</productnumber>
    <address>&kbd-url;</address>
  </sect1info>

  <title>Kbd-&kbd-version;</title>

  <indexterm zone="ch-system-kbd">
    <primary sortas="a-Kbd">Kbd</primary>
  </indexterm>

  <sect2 role="package">
    <title/>

    <para>Le paquet Kbd contient les fichiers de tables de caractères, les polices de la console et des
    outils pour le clavier.</para>

    <segmentedlist>
      <segtitle>&buildtime;</segtitle>
      <segtitle>&diskspace;</segtitle>

      <seglistitem>
        <seg>&kbd-ch6-sbu;</seg>
        <seg>&kbd-ch6-du;</seg>
      </seglistitem>
    </segmentedlist>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Kbd</title>

   <para>Le comportement des touches Effacement et Supprimer n'est pas
    logique dans les tables de correspondance du clavier du paquet Kbd.
    Le correctif suivant répare ce problème pour les tables de
    correspondance du clavier de i386&nbsp;:</para>

<screen><userinput remap="pre">patch -Np1 -i ../&kbd-backspace-patch;</userinput></screen>

    <para>Après la correction, la touche Effacement génère le caractère
    de code 127, et la touche Supprimer génère une séquence
    d'échappement bien connue.</para>

<para>Supprimez le programme <command>resizecons</command> redondant (il exige
    la feu svgalib pour fournir les fichiers du mode graphique - pour une
    utilisation normale, <command>setfont</command> redimensionne correctement
    la console) ainsi que sa page de man.</para>

<screen><userinput remap="pre">sed -i 's/\(RESIZECONS_PROGS=\)yes/\1no/g' configure
sed -i 's/resizecons.8 //' docs/man/man8/Makefile.in</userinput></screen>


    <para>Préparez la compilation de Kbd&nbsp;:</para>

<screen><userinput remap="configure">PKG_CONFIG_PATH=/tools/lib/pkgconfig ./configure --prefix=/usr --disable-vlock</userinput></screen>

    <variablelist>
      <title>Voici la signification des options de configuration&nbsp;:</title>

<!--
      <varlistentry>
        <term><parameter>- -datadir=/lib/kbd</parameter></term>
        <listitem>
          <para>Cette option place les données de type de clavier dans un répertoire
          qui sera toujours sur la partition racine au lieu du <filename
          class="directory">/usr/share/kbd</filename> par défaut.</para>
       </listitem>
      </varlistentry>-->
      <varlistentry>
        <term><parameter>--disable-vlock</parameter></term>
        <listitem>
          <para>Cette option empêche la construction de l'utilitaire vlock, il requiert
             la bibliothèque PAM qui n'est pas disponible dans l'environnement chroot.</para>
       </listitem>
      </varlistentry>

    </variablelist>

    <para>Compilez le paquet&nbsp;:</para>

<screen><userinput remap="make">make</userinput></screen>

    <para>Pour tester les résultats, lancez&nbsp;:</para>

<screen><userinput remap="test">make check</userinput></screen>

    <para>Installez le paquet&nbsp;:</para>

<screen><userinput remap="install">make install</userinput></screen>

    <note>
      <para>Pour certaines langues (comme le biélorusse), le paquet Kbd ne 
      fournit pas une table de correspondance utile, puisque le contenu
      de la table assume l'encodage ISO-8859-5, et la table
      CP1251 est normalement utilisée. Les utilisateurs de telles langues doivent
      télécharger les tables de correspondance qui conviennent séparément.</para>
    </note>

<!--
    <para>Certains des scripts du paquet LFS-Bootscripts dépendent de
    <command>kbd_mode</command>, <command>loadkeys</command>,
    <command>openvt</command>, et de <command>setfont</command>. Comme

    <filename class="directory">/usr</filename> peut ne pas être
    disponible lors des premières étapes du démarrage, ces binaires
    doivent être sur la partition racine&nbsp;:</para>

<screen><userinput remap="install">mv -v /usr/bin/{kbd_mode,loadkeys,openvt,setfont} /bin</userinput></screen>
-->

    <para>Si désiré, installez la documentation&nbsp;:</para>

<screen><userinput remap="install">mkdir -v       /usr/share/doc/kbd-&kbd-version; 
cp -R -v docs/doc/* /usr/share/doc/kbd-&kbd-version;</userinput></screen>

  </sect2>

  <sect2 id="contents-kbd" role="content">
    <title>Contenu de Kbd</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>chvt, deallocvt, dumpkeys, fgconsole, getkeycodes, kbdinfo, 
        kbd_mode, kbdrate, loadkeys, loadunimap,
        mapscrn, openvt, psfaddtable (lien vers psfxtable), psfgettable (lien vers
        psfxtable), psfstriptable (lien vers psfxtable), psfxtable,
        setfont, setkeycodes, setleds, setmetamode,
        showconsolefont, showkey, unicode_start et unicode_stop</seg>
        <seg>/usr/share/consolefonts, /usr/share/consoletrans, /usr/share/keymaps,
         et /usr/share/unimaps</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="chvt">
        <term><command>chvt</command></term>
        <listitem>
          <para>Change le terminal virtuel en avant plan</para>
          <indexterm zone="ch-system-kbd chvt">
            <primary sortas="b-chvt">chvt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="deallocvt">
        <term><command>deallocvt</command></term>
        <listitem>
          <para>Désalloue les terminaux virtuels inutilisés</para>
          <indexterm zone="ch-system-kbd deallocvt">
            <primary sortas="b-deallocvt">deallocvt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dumpkeys">
        <term><command>dumpkeys</command></term>
        <listitem>
          <para>Affiche la table de traduction du clavier</para>
          <indexterm zone="ch-system-kbd dumpkeys">
            <primary sortas="b-dumpkeys">dumpkeys</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="fgconsole">
        <term><command>fgconsole</command></term>
        <listitem>
          <para>Affiche le numéro du terminal virtuel actif</para>
          <indexterm zone="ch-system-kbd fgconsole">
            <primary sortas="b-fgconsole">fgconsole</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="getkeycodes">
        <term><command>getkeycodes</command></term>
        <listitem>
          <para>Affiche la table de correspondance des <quote>scancode</quote> avec
          les <quote>keycode</quote></para>
          <indexterm zone="ch-system-kbd getkeycodes">
            <primary sortas="b-getkeycodes">getkeycodes</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="kbdinfo">
        <term><command>kbdinfo</command></term>
        <listitem>
          <para>Obtient des informations sur l'état d'une console</para>
          <indexterm zone="ch-system-kbd kbdinfo">
            <primary sortas="b-kbdinfo">kbdinfo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="kbd_mode">
        <term><command>kbd_mode</command></term>
        <listitem>
          <para>Affiche ou initialise le mode du clavier</para>
          <indexterm zone="ch-system-kbd kbd_mode">
            <primary sortas="b-kbd_mode">kbd_mode</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="kbdrate">
        <term><command>kbdrate</command></term>
        <listitem>
          <para>Initialise les taux de répétition et de délai du clavier</para>
          <indexterm zone="ch-system-kbd kbdrate">
            <primary sortas="b-kbdrate">kbdrate</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="loadkeys">
        <term><command>loadkeys</command></term>
        <listitem>
          <para>Charge les tables de traduction du clavier</para>
          <indexterm zone="ch-system-kbd loadkeys">
            <primary sortas="b-loadkeys">loadkeys</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="loadunimap">
        <term><command>loadunimap</command></term>
        <listitem>
          <para>Charge la table de correspondance du noyau unicode-police</para>
          <indexterm zone="ch-system-kbd loadunimap">
            <primary sortas="b-loadunimap">loadunimap</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mapscrn">
        <term><command>mapscrn</command></term>
        <listitem>
          <para>Un programme obsolète utilisé pour charger une table de
          correspondance
          des caractères de sortie définie par l'utilisateur dans le pilote de la
          console. Ceci est maintenant fait par <command>setfont</command></para>
          <indexterm zone="ch-system-kbd mapscrn">
            <primary sortas="b-mapscrn">mapscrn</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="openvt">
        <term><command>openvt</command></term>
        <listitem>
          <para>Lance un programme sur un nouveau terminal virtuel (VT)</para>
          <indexterm zone="ch-system-kbd openvt">
            <primary sortas="b-openvt">openvt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="psfaddtable">
        <term><command>psfaddtable</command></term>
        <listitem>
          <para>Ajoute une table de caractères a Unicode à la police d'une console</para>
          <indexterm zone="ch-system-kbd psfaddtable">
            <primary sortas="b-psfaddtable">psfaddtable</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="psfgettable">
        <term><command>psfgettable</command></term>
        <listitem>
          <para>Extrait la table de caractères Unicode embarquée dans la police
          de la console</para>
          <indexterm zone="ch-system-kbd psfgettable">
            <primary sortas="b-psfgettable">psfgettable</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="psfstriptable">
        <term><command>psfstriptable</command></term>
        <listitem>
          <para>Supprime la table de caractères Unicode embarquée dans la police de la
          console.</para>
          <indexterm zone="ch-system-kbd psfstriptable">
            <primary sortas="b-psfstriptable">psfstriptable</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="psfxtable">
        <term><command>psfxtable</command></term>
        <listitem>
          <para>Gére les tables de caractères Unicode pour les polices de la 
          console</para>
          <indexterm zone="ch-system-kbd psfxtable">
            <primary sortas="b-psfxtable">psfxtable</primary>
          </indexterm>
        </listitem>
      </varlistentry>

  <!--<varlistentry id="resizecons">
        <term><command>resizecons</command></term>
        <listitem>
          <para>Changes the kernel idea of the console size</para>
          <indexterm zone="ch-system-kbd resizecons">
            <primary sortas="b-resizecons">resizecons</primary>
          </indexterm>
        </listitem>
      </varlistentry>-->

      <varlistentry id="setfont">
        <term><command>setfont</command></term>
        <listitem>
          <para>Modifie les polices EGA/VGA
          (<foreignphrase>Enhanced Graphic Adapter</foreignphrase>-<foreignphrase>Video Graphics Array</foreignphrase>
          sur la console</para>
          <indexterm zone="ch-system-kbd setfont">
            <primary sortas="b-setfont">setfont</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="setkeycodes">
        <term><command>setkeycodes</command></term>
        <listitem>
          <para>Charge les entrées de la table de correspondance entre scancode et
          keycode, utile si vous avez des touches inhabituelles sur votre clavier</para>
          <indexterm zone="ch-system-kbd setkeycodes">
            <primary sortas="b-setkeycodes">setkeycodes</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="setleds">
        <term><command>setleds</command></term>
        <listitem>
          <para>Initialise les drapeaux et LED du clavier</para>
          <indexterm zone="ch-system-kbd setleds">
            <primary sortas="b-setleds">setleds</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="setmetamode">
        <term><command>setmetamode</command></term>
        <listitem>
          <para>Définit la gestion des touches meta du clavier</para>
          <indexterm zone="ch-system-kbd setmetamode">
            <primary sortas="b-setmetamode">setmetamode</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="showconsolefont">
        <term><command>showconsolefont</command></term>
        <listitem>
          <para>Affiche la police de l'écran pour la console EGA/VGA</para>
          <indexterm zone="ch-system-kbd showconsolefont">
            <primary sortas="b-showconsolefont">showconsolefont</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="showkey">
        <term><command>showkey</command></term>
        <listitem>
          <para>Affiche les scancodes, keycodes et codes ASCII des touches appuyées sur
          le clavier</para>
          <indexterm zone="ch-system-kbd showkey">
            <primary sortas="b-showkey">showkey</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unicode_start">
        <term><command>unicode_start</command></term>
        <listitem>
          <para>Met le clavier et la console en mode UNICODE [N'utilisez pas ce
          programme sauf si votre fichier de correspondance est encodé en utf-8.
          Pour les autres encodages, cet utilitaire donne de mauvais résultats.]</para>
          <indexterm zone="ch-system-kbd unicode_start">
            <primary sortas="b-unicode_start">unicode_start</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unicode_stop">
        <term><command>unicode_stop</command></term>
        <listitem>
          <para>Ramène le clavier et la console dans le mode avant UNICODE</para>
          <indexterm zone="ch-system-kbd unicode_stop">
            <primary sortas="b-unicode_stop">unicode_stop</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
