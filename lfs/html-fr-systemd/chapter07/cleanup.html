<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.14.&nbsp;Nettoyage et Sauvegarde du système temporaire
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r10.1-212-g6711c-systemd+">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r10.1-212-g6711c-systemd+
      </h4>
      <h3>
        Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des
        outils temporaires supplémentaires
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="util-linux.html" title=
          "Util-linux-2.37.2">Précédent</a>
          <p>
            Util-linux-2.37.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../part4.html" title=
          "Construction du système LFS">Suivant</a>
          <p>
            Construction du système LFS
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des outils temporaires supplémentaires">
          Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="ch-tools-cleanup" name="ch-tools-cleanup"></a>7.14. Nettoyage
        et Sauvegarde du système temporaire
      </h1>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          7.14.1. Nettoyage
        </h2>
        <p>
          Tout d'abord, supprimez la documentation actuellement installée
          pour éviter qu'elle ne se retrouve sur le système final, et pour
          récupérer environ 35&nbsp;Mo&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">rm -rf /usr/share/{info,man,doc}/*</kbd></pre>
        <p>
          Ensuite, les fichiers .la de libtool ne sont utiles que pour se
          lier à des bibliothèques statiques. Ils ne sont pas utiles voir
          potentiellement dangereux quand on utilise des bibliothèques
          partagées, surtout pour les systèmes de construction qui ne sont
          pas basés sur les autotools. Toujours dans le chroot, supprimez ces
          fichiers maintenant&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">find /usr/{lib,libexec} -name \*.la -delete</kbd></pre>
        <p>
          La taille du système est maintenant d'environ 3&nbsp;Go, mais le
          répertoire /tools n'est plus requis. Il utilise environ 1&nbsp;Go
          d'espace disque. Supprimez-le maintenant&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">rm -rf /tools</kbd></pre>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          7.14.2. Sauvegarde
        </h2>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Toutes les étapes restantes dans cette section sont facultatives.
            Cependant, dès que vous commencez à installer des paquets dans le
            <a class="xref" href="../chapter08/chapter08.html" title=
            "Chapitre&nbsp;8.&nbsp;Installer les logiciels du système de base">
            Chapitre&nbsp;8</a>, les fichiers temporaires seront remplacés.
            Donc c'est peut-être une bonne idée d'effectuer une sauvegarde du
            système actuel, comme on le décrit plus bas.
          </p>
        </div>
        <p>
          Les étapes suivantes sont à effectuer en dehors de l'environnement
          chroot. Cela signifie que vous devez quitter l'environnement chroot
          avant de continuer. La raison est est qu'il faut pouvoir accéder à
          des emplacement du système de fichiers en dehors de l'environnement
          chroot pour stocker et lire l'archive de sauvegarde, qui ne devrait
          pas se trouver dans la hiérarchie <code class=
          "filename">$LFS</code> pour plus de sûreté.
        </p>
        <div class="admon important">
          <img alt="[Important]" src="../images/important.png" />
          <h3>
            Important
          </h3>
          <p>
            Toutes les instructions suivantes sont exécutées en <code class=
            "systemitem">root</code>. Faites particulièrement attention aux
            commandes que vous allez exécuter car toute erreur ici peut
            modifier votre système hôte. Soyez conscient que la variable
            d'environnement <code class="envar">LFS</code> a une valeur pour
            l'utilisateur <code class="systemitem">lfs</code> par défaut,
            mais peut ne <span class="emphasis"><em>pas</em></span> exister
            pour <code class="systemitem">root</code>. Quand les commandes
            doivent être exécutées par <code class="systemitem">root</code>,
            assurez-vous d'avoir la variable <code class="envar">LFS</code>.
            On en a déjà parlé dans le <a class="xref" href=
            "../chapter02/aboutlfs.html" title=
            "2.6.&nbsp;Définir la variable $LFS">Section&nbsp;2.6,
            «&nbsp;Définir la variable $LFS&nbsp;»</a>.
          </p>
        </div>
        <p>
          Maintenant, si vous effectuez une sauvegarde, quittez
          l'environnement chroot&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">exit</kbd></pre>
        <p>
          À ce point, les programmes et bibliothèques essentiels ont été
          créés et votre système actuel est en bon état. Votre système peut
          maintenant être sauvegardé pour être réutilisé plus tard. Si vous
          rencontrez une erreur fatale dans les chapitres suivants, il arrive
          souvent que tout supprimer et recommencer (avec plus de prudence)
          soit la meilleure option. Malheureusement, tous les fichiers
          temporaires seront aussi supprimés. Pour éviter de passer du temps
          en plus pour refaire quelque chose que vous avez déjà réussi,
          préparez une sauvegarde.
        </p>
        <p>
          Assurez-vous d'avoir au moins 1&nbsp;Go d'espace disque libre (les
          archives des sources seront incluses dans l'archive de sauvegarde)
          dans le répertoire personnel de l'utilisateur <code class=
          "systemitem">root</code>.
        </p>
        <p>
          Avant de faire la sauvegarde, démontez les systèmes de fichiers
          virtuels&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">umount $LFS/dev{/pts,}
umount $LFS/{sys,proc,run}</kbd></pre>
        <p>
          Créez l'archive de sauvegarde en lançant la commande
          suivante&nbsp;:
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Comme l'archive de sauvegarde est compressée, elle prend un temps
            relativement long (plus de 10 minutes) même sur un système
            raisonnablement rapide.
          </p>
          <p>
            Assurez-vous aussi que la variable d'environnement <code class=
            "envar">LFS</code> existe pour l'utilisateur root.
          </p>
        </div>
        <pre class="userinput"><kbd class="command">cd $LFS 
tar -cJpf $HOME/lfs-temp-tools-r10.1-212-g6711c-systemd+.tar.xz .</kbd></pre>
        <p>
          Remplacez <code class="envar">$HOME</code> par un répertoire de
          votre choix si vous ne voulez pas stoker la sauvegarde dans le
          répertoire personnel de <code class="systemitem">root</code>.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          7.14.3. Restauration du système
        </h2>
        <p>
          Dans le cas où vous avez fait des erreurs et que vous devez
          recommencer du début, vous pouvez utiliser cette sauvegarde pour
          réinitialiser le système et gagner du temps. Comme les sources se
          trouvent dans <code class="filename">$LFS</code>, elles sont
          incluses dans l'archive de sauvegarde, donc vous n'aurez pas besoin
          de les télécharger de nouveau. Après avoir vérifié que <code class=
          "envar">$LFS</code> est définie correctement, restaurez la
          sauvegarde en exécutant les commandes suivantes&nbsp;:
        </p>
        <div class="admon warning">
          <img alt="[Avertissement]" src="../images/warning.png" />
          <h3>
            Avertissement
          </h3>
          <p>
            Les commandes suivantes sont extrêmement dangereuses. Si vous
            lancez <span class="command"><strong>rm -rf ./*</strong></span>
            en tant que root et que vous ne vous êtes pas déplacés dans le
            répertoire $LFS ou que la variable d'environnement <code class=
            "envar">LFS</code> n'est pas définie pour l'utilisateur root,
            elle détruira votre système hôte complet. ON VOUS AURA PRÉVENU.
          </p>
        </div>
        <pre class="screen"><code class="computeroutput">cd $LFS 
rm -rf ./* 
tar -xpf $HOME/lfs-temp-tools-r10.1-212-g6711c-systemd+.tar.xz</code></pre>
        <p>
          De nouveau, vérifiez que l'environnement a été correctement
          paramétré et continuez à construire le reste du système.
        </p>
        <div class="admon important">
          <img alt="[Important]" src="../images/important.png" />
          <h3>
            Important
          </h3>
          <p>
            Si vous quittez l'environnement chroot pour créer une sauvegarde
            ou pour recommencer à construire à partir d'une sauvegarde,
            rappelez-vous de vérifier que les systèmes de fichiers virtuels
            sont toujours montés (<span class="command"><strong>findmnt |
            grep $LFS</strong></span>). S'ils ne sont pas montés,
            remontez-les maintenant comme décrit dans le <a class="xref"
            href="kernfs.html" title=
            "7.3.&nbsp;Préparer les systèmes de fichiers virtuels du noyau">Section&nbsp;7.3,
            «&nbsp;Préparer les systèmes de fichiers virtuels du
            noyau&nbsp;»</a> et entrez de nouveau dans l'environnement chroot
            (voir le <a class="xref" href="chroot.html" title=
            "7.4.&nbsp;Entrer dans l'environnement chroot">Section&nbsp;7.4,
            «&nbsp;Entrer dans l'environnement chroot&nbsp;»</a>) avant de
            continuer.
          </p>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="util-linux.html" title=
          "Util-linux-2.37.2">Précédent</a>
          <p>
            Util-linux-2.37.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../part4.html" title=
          "Construction du système LFS">Suivant</a>
          <p>
            Construction du système LFS
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des outils temporaires supplémentaires">
          Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
