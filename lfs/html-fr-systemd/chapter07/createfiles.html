<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      7.6.&nbsp;Créer les fichiers et les liens symboliques essentiels
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r10.1-205-g49170-systemd+">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r10.1-205-g49170-systemd+
      </h4>
      <h3>
        Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des
        outils temporaires supplémentaires
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title=
          "Créer les répertoires">Précédent</a>
          <p>
            Créer les répertoires
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass2.html" title=
          "Libstdc++ de GCC-11.2.0, Passe 2">Suivant</a>
          <p>
            Libstdc++ de GCC-11.2.0, Passe 2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des outils temporaires supplémentaires">
          Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-205-g49170-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="ch-tools-createfiles" name="ch-tools-createfiles"></a>7.6.
        Créer les fichiers et les liens symboliques essentiels
      </h1>
      <p>
        Historiquement, Linux gère la liste des systèmes de fichiers montés
        dans le fichier <code class="filename">/etc/mtab</code>. Les noyaux
        modernes gèrent cette liste en interne via le système de fichiers
        <code class="filename">/proc</code>. Pour contenter les outils qui
        s'attendent à la présence de <code class="filename">/etc/mtab</code>,
        créez le lien symbolique suivant&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">ln -sv /proc/self/mounts /etc/mtab</kbd></pre>
      <p>
        Créez un fichier <code class="filename">/etc/hosts</code> de base qui
        sera utilisé dans certaines suites de tests, et par l'un des fichiers
        de configuration de Perl&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/hosts &lt;&lt; EOF
127.0.0.1  localhost $(hostname)
::1        localhost
EOF</kbd></pre>
      <p>
        Afin que l'utilisateur <code class="systemitem">root</code> puisse
        s'identifier et que le nom <span class="quote">«&nbsp;<span class=
        "quote">root</span>&nbsp;»</span> soit reconnu, il doit y avoir des
        entrées cohérentes dans les fichiers <code class=
        "filename">/etc/passwd</code> et <code class=
        "filename">/etc/group</code>.
      </p>
      <p>
        Créez le fichier <code class="filename">/etc/passwd</code> en lançant
        la commande suivante&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/passwd &lt;&lt; "EOF"
<code class="literal">root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/dev/null:/bin/false
daemon:x:6:6:Daemon User:/dev/null:/bin/false
messagebus:x:18:18:D-Bus Message Daemon User:/run/dbus:/bin/false
systemd-bus-proxy:x:72:72:systemd Bus Proxy:/:/bin/false
systemd-journal-gateway:x:73:73:systemd Journal Gateway:/:/bin/false
systemd-journal-remote:x:74:74:systemd Journal Remote:/:/bin/false
systemd-journal-upload:x:75:75:systemd Journal Upload:/:/bin/false
systemd-network:x:76:76:systemd Network Management:/:/bin/false
systemd-resolve:x:77:77:systemd Resolver:/:/bin/false
systemd-timesync:x:78:78:systemd Time Synchronization:/:/bin/false
systemd-coredump:x:79:79:systemd Core Dumper:/:/bin/false
uuidd:x:80:80:UUID Generation Daemon User:/dev/null:/bin/false
systemd-oom:x:81:81:systemd Out Of Memory Daemon:/:/bin/false
nobody:x:99:99:Unprivileged User:/dev/null:/bin/false</code>
EOF</kbd></pre>
      <p>
        Le mot de passe réel pour <code class="systemitem">root</code> sera
        paramétré plus tard.
      </p>
      <p>
        Créez le fichier <code class="filename">/etc/group</code> en
        exécutant la commande suivante&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">cat &gt; /etc/group &lt;&lt; "EOF"
<code class="literal">root:x:0:
bin:x:1:daemon
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
usb:x:14:
cdrom:x:15:
adm:x:16:
messagebus:x:18:
systemd-journal:x:23:
input:x:24:
mail:x:34:
kvm:x:61:
systemd-bus-proxy:x:72:
systemd-journal-gateway:x:73:
systemd-journal-remote:x:74:
systemd-journal-upload:x:75:
systemd-network:x:76:
systemd-resolve:x:77:
systemd-timesync:x:78:
systemd-coredump:x:79:
uuidd:x:80:
systemd-oom:x:81:81:
wheel:x:97:
nogroup:x:99:
users:x:999:</code>
EOF</kbd></pre>
      <p>
        Les groupes créés ne font partie d'aucun standard—ce sont des groupes
        décidés en partie en fonction des besoins de la configuration de Udev
        dans le chapitre 9, et en partie par la coutume utilisée par un
        certain nombre de distributions Linux existantes. En outre, certaines
        suites de tests s'appuient sur des groupes et des utilisateurs
        spécifiques. La base Linux standard (Linux Standard Base ou LSB,
        disponible sur <a class="ulink" href=
        "http://refspecs.linuxfoundation.org/lsb.shtml">http://refspecs.linuxfoundation.org/lsb.shtml</a>)
        recommande seulement cela, ainsi que la présence d'un groupe
        <code class="systemitem">root</code> (GID 0) et d'un groupe
        <code class="systemitem">bin</code> (GID 1). Tous les autres noms de
        groupe et GID peuvent être librement choisis par l'administrateur du
        système puisque les programmes bien écrits ne dépendent pas des
        numéros GID, mais utilisent plutôt le nom du groupe.
      </p>
      <p>
        Certains tests dans <a class="xref" href=
        "../chapter08/chapter08.html" title=
        "Chapitre&nbsp;8.&nbsp;Installer les logiciels du système de base">Chapitre&nbsp;8</a>
        ont besoin d'un utilisateur non privilégié. Nous ajoutons cet
        utilisateur ici et supprimons ce compte à la fin de ce chapitre.
      </p>
      <pre class="userinput"><kbd class=
      "command">echo "tester:x:101:101::/home/tester:/bin/bash" &gt;&gt; /etc/passwd
echo "tester:x:101:" &gt;&gt; /etc/group
install -o tester -d /home/tester</kbd></pre>
      <p>
        Pour supprimer l'invite <span class="quote">«&nbsp;<span class=
        "quote">I have no name!</span>&nbsp;»</span>, démarrez un nouveau
        shell. Comme nous avons créé les fichiers <code class=
        "filename">/etc/passwd</code> et <code class=
        "filename">/etc/group</code>, la résolution du nom d'utilisateur et
        de groupe fonctionnera à présent&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">exec /bin/bash --login +h</kbd></pre>
      <p>
        Remarquez l'utilisation du paramètre <em class=
        "parameter"><code>+h</code></em>. Il dit à <span class=
        "command"><strong>bash</strong></span> de ne pas utiliser son hachage
        de chemin interne. Sans ce paramètre, <span class=
        "command"><strong>bash</strong></span> se rappellerait des chemins
        vers les binaires qu'il a exécutés. Pour s'assurer que les binaires
        nouvellement compilés seront utilisés dès qu'ils seront installés, le
        paramètre <em class="parameter"><code>+h</code></em> sera utilisée
        durant tout le chapitre.
      </p>
      <p>
        Les programmes <span class="command"><strong>login</strong></span>,
        <span class="command"><strong>agetty</strong></span>, et <span class=
        "command"><strong>init</strong></span> (et d'autres) utilisent un
        nombre de journaux applicatifs pour enregistrer des informations
        comme qui s'est connecté sur le système et quand. Mais ces programmes
        n'écriront pas vers ces journaux s'ils n'existent pas. Initialisez
        les journaux et donnez-leur les bons droits&nbsp;:
      </p>
      <pre class="userinput"><kbd class=
      "command">touch /var/log/{btmp,lastlog,faillog,wtmp}
chgrp -v utmp /var/log/lastlog
chmod -v 664  /var/log/lastlog
chmod -v 600  /var/log/btmp</kbd></pre>
      <p>
        Le fichier <code class="filename">/var/log/wtmp</code> enregistre
        toutes les connexions et les déconnexions. Le fichier <code class=
        "filename">/var/log/lastlog</code> enregistre le moment de dernière
        connexion de chaque utilisateur. Le fichier <code class=
        "filename">/var/log/faillog</code> enregistre les tentatives de
        connexion échouées. Le fichier <code class=
        "filename">/var/log/btmp</code> enregistre les mauvaises tentatives
        de connexion.
      </p>
      <div class="admon note">
        <img alt="[Note]" src="../images/note.png" />
        <h3>
          Note
        </h3>
        <p>
          Le fichier <code class="filename">/run/utmp</code> enregistre les
          utilisateurs qui sont actuellement connectés. Ce fichier est créé
          de manière dynamique dans les scripts de démarrage.
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title=
          "Créer les répertoires">Précédent</a>
          <p>
            Créer les répertoires
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass2.html" title=
          "Libstdc++ de GCC-11.2.0, Passe 2">Suivant</a>
          <p>
            Libstdc++ de GCC-11.2.0, Passe 2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter07.html" title=
          "Chapitre&nbsp;7.&nbsp;Entrée dans le chroot et construction des outils temporaires supplémentaires">
          Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-205-g49170-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
