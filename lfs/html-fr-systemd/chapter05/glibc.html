<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      5.5.&nbsp;Glibc-2.34
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r10.1-212-g6711c-systemd+">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r10.1-212-g6711c-systemd+
      </h4>
      <h3>
        Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="linux-headers.html" title=
          "Linux-5.13.12 API Headers">Précédent</a>
          <p>
            Linux-5.13.12 API Headers
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass1.html" title=
          "Libstdc++ de GCC-11.2.0, passe 1">Suivant</a>
          <p>
            Libstdc++ de GCC-11.2.0, passe 1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="wrap" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="ch-tools-glibc" name="ch-tools-glibc"></a>5.5. Glibc-2.34
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <p>
          Le paquet Glibc contient la bibliothèque C principale. Cette
          bibliothèque fournit toutes les routines basiques pour allouer de
          la mémoire, rechercher des répertoires, ouvrir et fermer des
          fichiers, les lire et les écrire, gérer les chaînes, faire
          correspondre des modèles, faire de l'arithmétique et ainsi de
          suite.
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Temps de construction
              approximatif:</strong> <span class="segbody">4.2 SBU</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Espace disque requis:</strong>
              <span class="segbody">744 Mo</span>
            </div>
          </div>
        </div>
      </div>
      <div class="installation" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          5.5.1. Installation de Glibc
        </h2>
        <p>
          Tout d'abord, créez un lien symbolique pour respecter le LSB. En
          plus, pour x86_64, créez un lien symbolique de compatibilité requis
          pour le bon fonctionnement du chargeur de bibliothèques
          dynamiques&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">case $(uname -m) in
    i?86)   ln -sfv ld-linux.so.2 $LFS/lib/ld-lsb.so.3
    ;;
    x86_64) ln -sfv ../lib/ld-linux-x86-64.so.2 $LFS/lib64
            ln -sfv ../lib/ld-linux-x86-64.so.2 $LFS/lib64/ld-lsb-x86-64.so.3
    ;;
esac</kbd></pre>
        <p>
          Certains programmes de Glibc utilisent le répertoire <code class=
          "filename">/var/db</code> qui ne respecte pas le FHS pour stocker
          leurs données d'exécution. Appliquez le correctif suivant pour que
          ces programmes stockent leurs données d'exécution à l'emplacement
          indiqué par le FHS&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">patch -Np1 -i ../glibc-2.34-fhs-1.patch</kbd></pre>
        <p>
          La documentation de Glibc recommande de construire Glibc dans un
          répertoire dédié&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">mkdir -v build
cd       build</kbd></pre>
        <p>
          Assurez-vous que <span class=
          "command"><strong>ldconfig</strong></span> et <span class=
          "command"><strong>sln</strong></span> sont installés dans
          <code class="filename">/usr/sbin</code>&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">echo "rootsbindir=/usr/sbin" &gt; configparms</kbd></pre>
        <p>
          Ensuite, préparez la compilation de Glibc&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">../configure                             \
      --prefix=/usr                      \
      --host=$LFS_TGT                    \
      --build=$(../scripts/config.guess) \
      --enable-kernel=3.2                \
      --with-headers=$LFS/usr/include    \
      libc_cv_slibdir=/usr/lib</kbd></pre>
        <div class="variablelist">
          <p class="title">
            <strong>Voici la signification des options de
            configure&nbsp;:</strong>
          </p>
          <dl class="variablelist">
            <dt>
              <span class="term"><em class="parameter"><code>--host=$LFS_TGT,
              --build=$(../scripts/config.guess)</code></em></span>
            </dt>
            <dd>
              <p>
                L'effet combiné de ces commutateurs est que le système de
                construction de Glibc se configure pour se compiler de
                manière croisée en utilisant l'éditeur de liens croisé et le
                compilateur croisé dans <code class=
                "filename">$LFS/tools</code>.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-kernel=3.2</code></em></span>
            </dt>
            <dd>
              <p>
                Ceci indique à Glibc de compiler la bibliothèque avec la
                prise en charge des noyaux Linux 3.2 et supérieurs. Les
                contournements pour les noyaux plus anciens ne sont pas
                activés.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--with-headers=$LFS/usr/include</code></em></span>
            </dt>
            <dd>
              <p>
                Ceci dit à Glibc de se compiler contre les en-têtes récemment
                installés dans le répertoire $LFS/usr/include, afin qu'il
                connaisse exactement les fonctionnalités du noyau et puisse
                s'optimiser en conséquence.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>libc_cv_slibdir=/usr/lib</code></em></span>
            </dt>
            <dd>
              <p>
                Cela s'assure que la bibliothèque est installée dans /usr/lib
                au lieu du répertoire /lib64 par défaut sur les machines
                64&nbsp;bits.
              </p>
            </dd>
          </dl>
        </div>
        <p>
          Lors de cette étape, le message d'avertissement suivant peut
          apparaître&nbsp;:
        </p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <pre class="screen"><code class=
            "computeroutput">configure: WARNING:
*** These auxiliary programs are missing or
*** incompatible versions: msgfmt
*** some features will be disabled.
*** Check the INSTALL file for required versions.</code></pre>
          </blockquote>
        </div>
        <p>
          Le programme <span class="command"><strong>msgfmt</strong></span>,
          manquant ou incompatible, ne pose généralement pas de problème. Ce
          programme <span class="command"><strong>msgfmt</strong></span> fait
          partie du paquet Gettext que la distribution hôte devrait fournir.
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Il a été reporté que ce paquet pouvait échouer avec un
            «&nbsp;make parallèles&nbsp;». Si cela arrive, relancez la
            commande avec l'option «&nbsp;-j1&nbsp;».
          </p>
        </div>
        <p>
          Compilez le paquet&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">make</kbd></pre>
        <p>
          Installez le paquet&nbsp;:
        </p>
        <div class="admon warning">
          <img alt="[Avertissement]" src="../images/warning.png" />
          <h3>
            Avertissement
          </h3>
          <p>
            Si <code class="envar">LFS</code> n'est pas correctement
            initialisée, et malgré les recommandations, que vous construisez
            en <code class="systemitem">root</code>, la commande suivante
            installera la glibc nouvellement construite sur votre système
            hôte, ce qui le rendra inutilisable. Alors assurez-vous que
            l'environnement est correctement initialisé avant de lancer la
            commande suivante.
          </p>
        </div>
        <pre class="userinput"><kbd class=
        "command">make DESTDIR=$LFS install</kbd></pre>
        <div class="variablelist">
          <p class="title">
            <strong>Voici la signification de l'option de <span class=
            "command"><strong>make install</strong></span>&nbsp;::</strong>
          </p>
          <dl class="variablelist">
            <dt>
              <span class="term"><em class=
              "parameter"><code>DESTDIR=$LFS</code></em></span>
            </dt>
            <dd>
              <p>
                La variable make <code class="envar">DESTDIR</code> est
                utilisée par presque tous les paquets pour définir
                l'emplacement où le paquet devrait être installé. Si elle
                n'est pas indiquée, elle correspond par défaut à la racine
                (<code class="filename">/</code>). Ici, nous spécifions que
                le paquet doit être installé dans <code class=
                "filename">$LFS</code>, qui deviendra la racine après
                <a class="xref" href="../chapter07/chroot.html" title=
                "7.4.&nbsp;Entrer dans l'environnement chroot">Section&nbsp;7.4,
                «&nbsp;Entrer dans l'environnement chroot&nbsp;»</a>.
              </p>
            </dd>
          </dl>
        </div>
        <p>
          Corrigez un chemin codé en dur vers le chargeur d'exécutable dans
          le script <span class="command"><strong>ldd</strong></span>&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">sed '/RTLDLIST=/s@/usr@@g' -i $LFS/usr/bin/ldd</kbd></pre>
        <div class="admon caution">
          <img alt="[Attention]" src="../images/caution.png" />
          <h3>
            Attention
          </h3>
          <p>
            À ce moment, il est impératif de vous arrêter et de vous assurer
            que les fonctions de base (compilation et édition des liens) du
            nouvel ensemble d'outils fonctionnent comme prévu. Pour effectuer
            un test de propreté, lancez les commandes suivantes&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">echo 'int main(){}' &gt; dummy.c
$LFS_TGT-gcc dummy.c
readelf -l a.out | grep '/ld-linux'</kbd></pre>
          <p>
            Si tout fonctionne correctement, il ne devrait pas y avoir
            d'erreurs et la sortie de la dernière commande sera de la
            forme&nbsp;:
          </p>
          <pre class="screen"><code class=
          "computeroutput">[Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]</code></pre>
          <p>
            Notez que pour les machines 32&nbsp;bits, le nom de
            l'interpréteur sera <code class=
            "filename">/lib/ld-linux.so.2</code>.
          </p>
          <p>
            Si l'affichage diffère ou s'il n'y a aucun affichage, alors
            quelque chose ne se passe pas bien. Enquêtez et tracez vos étapes
            pour trouver où se cache le problème et comment le corriger. Ce
            problème doit être corrigé avant de continuer.
          </p>
          <p>
            Une fois que tout va bien, nettoyez les fichiers de test&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">rm -v dummy.c a.out</kbd></pre>
        </div>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            La construction des paquets dans le prochain chapitre servira de
            test supplémentaire pour vérifier que l'ensemble d'outils a été
            construit correctement. Si certains paquets, en particulier
            binutils-pass2 ou gcc-pass2, échouent à se construire, c'est une
            indication que quelque chose ne va pas dans les installations
            précédentes de Binutils, GCC, ou Glibc.
          </p>
        </div>
        <p>
          Maintenant que notre chaîne d'outils croisée est complète,
          finalisez l'installation de l'en-tête limits.h. Pour cela, lancez
          un utilitaire fournit par les développeurs de GCC&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">$LFS/tools/libexec/gcc/$LFS_TGT/11.2.0/install-tools/mkheaders</kbd></pre>
      </div>
      <div class="content" lang="fr" xml:lang="fr">
        <p>
          Les détails sur ce paquet sont situés dans <a class="xref" href=
          "../chapter08/glibc.html#contents-glibc" title=
          "8.5.3.&nbsp;Contenu de Glibc">Section&nbsp;8.5.3, «&nbsp;Contenu
          de Glibc.&nbsp;»</a>
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="linux-headers.html" title=
          "Linux-5.13.12 API Headers">Précédent</a>
          <p>
            Linux-5.13.12 API Headers
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="gcc-libstdc++-pass1.html" title=
          "Libstdc++ de GCC-11.2.0, passe 1">Suivant</a>
          <p>
            Libstdc++ de GCC-11.2.0, passe 1
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
