<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      9.2.&nbsp;Configuration générale du réseau
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r10.1-205-g49170-systemd+">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r10.1-205-g49170-systemd+
      </h4>
      <h3>
        Chapitre&nbsp;9.&nbsp;Configuration du système
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title=
          "Introduction">Précédent</a>
          <p>
            Introduction
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="udev.html" title=
          "Manipulation des périphériques et modules">Suivant</a>
          <p>
            Manipulation des périphériques et modules
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "Chapitre&nbsp;9.&nbsp;Configuration du système">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-205-g49170-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="ch-config-network" name="ch-config-network"></a>9.2.
        Configuration générale du réseau
      </h1>
      <p>
        Cette section s'applique seulement si une carte réseau doit être
        configurée.
      </p>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          9.2.1. Fichier de configuration d'interface réseau
        </h2>
        <p>
          À partir de la version 209, systemd contient un démon de
          configuration réseau nommé <span class=
          "command"><strong>systemd-networkd</strong></span> qui peut être
          utilisé pour la configuration basique du réseau. De plus, depuis la
          version 213, la résolution de nom DNS peut être prise en charge par
          <span class="command"><strong>systemd-resolved</strong></span> au
          lieu d'un fichier <code class="filename">/etc/resolv.conf</code>
          statique. Ces deux services sont activés par défaut.
        </p>
        <p>
          Les fichiers de configuration pour <span class=
          "command"><strong>systemd-networkd</strong></span> (et <span class=
          "command"><strong>systemd-resolved</strong></span>) peuvent être
          placés dans <code class="filename">/usr/lib/systemd/network</code>
          ou <code class="filename">/etc/systemd/network</code>. Les fichiers
          dans <code class="filename">/etc/systemd/network</code> ont une
          priorité supérieure à ceux dans <code class=
          "filename">/usr/lib/systemd/network</code>. Il existe trois types
          de fichiers de configuration&nbsp;: <code class=
          "filename">.link</code>, <code class="filename">.netdev</code> et
          <code class="filename">.network</code>. Pour une description
          détaillée et des exemples de contenu de ces fichiers de
          configuration, consultez des pages de manuel <code class=
          "filename">systemd-link(5)</code>, <code class=
          "filename">systemd-netdev(5)</code> et <code class=
          "filename">systemd-network(5)</code>.
        </p>
        <div class="sect3">
          <h3 class="sect3">
            <a id="systemd-network-devices" name=
            "systemd-network-devices"></a>9.2.1.1. Nommage des périphériques
            réseau
          </h3>
          <p>
            Udev assigne normalement des noms d'interface basés sur les
            caractéristiques physiques comme enp2s1. Si vous n'êtes pas sûr
            de votre nom d'interface, vous pouvez toujours lancer
            <span class="command"><strong>ip link</strong></span> après avoir
            lancé votre système.
          </p>
          <p>
            Pour la plupart des systèmes, il n'y a qu'une interface réseau
            pour chaque type de connexion. Par exemple, le nom classique pour
            une connexion filaire est eth0. Une connexion sans fil aura
            souvant pour nom wifi0 ou wlan0.
          </p>
          <p>
            Si vous préférez utiliser les noms d'interfaces réseau classiques
            ou personnalisés, il y a trois manières de procéder&nbsp;:
          </p>
          <div class="itemizedlist">
            <ul>
              <li class="listitem">
                <p>
                  Masquez le fichier .link d'udev pour la politique par
                  défaut&nbsp;:
                </p>
                <pre class="userinput"><kbd class=
                "command">ln -s /dev/null /etc/systemd/network/99-default.link</kbd></pre>
              </li>
              <li class="listitem">
                <p>
                  Créez une convention de nommage manuelle, par exemple en
                  nommant les interface comme «&nbsp;internet0&nbsp;»,
                  «&nbsp;dmz0&nbsp;» ou «&nbsp;lan0&nbsp;». Pour cela, créez
                  des fichiers .link dans /etc/systemd/network/, qui
                  choisissent un nom explicite ou une meilleure convention de
                  nommage pour vos interfaces. Par exemple&nbsp;:
                </p>
                <pre class="userinput"><kbd class=
                "command">cat &gt; /etc/systemd/network/10-ether0.link &lt;&lt; "EOF"
<code class="literal">[Match]
# Changez l'adresse MAC comme il faut pour votre périphérique réseau
MACAddress=12:34:45:78:90:AB

[Link]
Name=ether0</code>
EOF</kbd></pre>
                <p>
                  Voir la page de manuel de systemd.link(5) pour plus
                  d'informations.
                </p>
              </li>
              <li class="listitem">
                <p>
                  Dans /boot/grub/grub.cfg, passez l'option net.ifnames=0 sur
                  la ligne de commande du noyau.
                </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="systemd-networkd-static" name=
            "systemd-networkd-static"></a>9.2.1.2. Configuration en IP
            statique
          </h3>
          <p>
            La commande suivante crée un fichier de configuration basique
            pour la configuration d'une adresse ip statique (en utilisant
            systemd-networkd et systemd-resolved)&nbsp;:
          </p>
          <pre class="userinput">
<kbd class=
"command">cat &gt; /etc/systemd/network/10-eth-static.network &lt;&lt; "EOF"
<code class="literal">[Match]
Name=<em class="replaceable"><code>&lt;network-device-name&gt;</code></em>

[Network]
Address=192.168.0.2/24
Gateway=192.168.0.1
DNS=192.168.0.1
Domains=<em class=
"replaceable"><code>&lt;Your Domain Name&gt;</code></em></code>
EOF</kbd></pre>
          <p>
            Vous pouvez ajouter plusieurs entrées DNS si vous avez plus d’un
            serveur DNS. Ne rajoutez pas d’entrée DNS ou Domains si vous
            voulez utiliser un fichier <code class=
            "filename">/etc/resolv.conf</code> statique.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="systemd-networkd-dhcp" name=
            "systemd-networkd-dhcp"></a>9.2.1.3. Configuration du DHCP
          </h3>
          <p>
            La commande suivante crée un fichier de configuration basique
            pour la configuration de DHCP en IPv4&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">cat &gt; /etc/systemd/network/10-eth-dhcp.network &lt;&lt; "EOF"
<code class="literal">[Match]
Name=&lt;network-device-name&gt;

[Network]
DHCP=ipv4

[DHCP]
UseDomains=true</code>
EOF</kbd></pre>
        </div>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="resolv.conf" name="resolv.conf"></a>9.2.2. Créer le fichier
          /etc/resolv.conf
        </h2>
        <p>
          Si le système a besoin d'être connecté à Internet, il aura besoin
          d'un DNS pour résoudre les noms de domaines Internet en adresse IP,
          et vice-versa. Ceci se fait en plaçant les adresses IP des serveurs
          DNS, disponibles auprès du FAI ou de l'administrateur système, dans
          <code class="filename">/etc/resolv.conf</code>.
        </p>
        <div class="sect3">
          <h3 class="sect3">
            <a id="resolv-conf-systemd-resolved" name=
            "resolv-conf-systemd-resolved"></a>9.2.2.1. Configuration de
            systemd-resolved
          </h3>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Si vous utilisez un moyen incompatible pour configurer vos
              interfaces réseaux (par exemple ppp, etc), ou si vous utilisez
              un résolveur local (par exemple bind, dnsmasq, unbound, etc),
              ou tout autre logiciel générant un fichier <code class=
              "filename">/etc/resolv.conf</code> (par exemple <span class=
              "command"><strong>resolvconf</strong></span>), le service
              <span class="command"><strong>systemd-resolved</strong></span>
              ne devrait pas être utilisé.
            </p>
          </div>
          <p>
            Lorsque vous utilisez <span class=
            "command"><strong>systemd-resolved</strong></span> pour
            configurer le DNS, il crée le fichier <code class=
            "filename">/run/systemd/resolve/resolv.conf</code>. Créez un lien
            symbolique dans <code class="filename">/etc</code> pour utiliser
            le fichier généré&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">ln -sfv /run/systemd/resolve/resolv.conf /etc/resolv.conf</kbd></pre>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="resolv-conf-static" name="resolv-conf-static"></a>9.2.2.2.
            Configuration de resolv.conf statique
          </h3>
          <p>
            Si un fichier statique <code class=
            "filename">/etc/resolv.conf</code> est désiré, créez-le en
            lançant la commande suivante&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">cat &gt; /etc/resolv.conf &lt;&lt; "EOF"
<code class="literal"># Début de /etc/resolv.conf

domain <em class="replaceable"><code>&lt;Votre nom de domaine&gt;</code></em>
nameserver <em class=
"replaceable"><code>&lt;Adresse IP du DNS primaire&gt;</code></em>
nameserver <em class=
"replaceable"><code>&lt;Adresse IP du DNS secondaire&gt;</code></em>

# Fin de /etc/resolv.conf</code>
EOF</kbd></pre>
          <p>
            Le paramètre <code class="varname">domain</code> peut être omis
            ou remplacé par un paramètre <code class="varname">search</code>.
            Voir la page de manuel de resolv.conf pour plus de détails.
          </p>
          <p>
            Remplacez <em class="replaceable"><code>&lt;Adresse IP du
            DNS&gt;</code></em> par l'adresse IP du DNS le plus approprié
            pour votre configuration. Il y aura souvent plus d'une entrée
            (les serveurs secondaires sont utiles en cas d'indisponibilité du
            premier). Si vous avez seulement besoin ou si vous voulez
            seulement un serveur DNS, supprimez la seconde ligne <span class=
            "emphasis"><em>nameserver</em></span> du fichier. L'adresse IP
            pourrait aussi être un routeur sur le réseau local. Une autre
            possibilité est d'utiliser le service DNS public de Google avec
            les adresse IP suivantes comme serveurs de noms.
          </p>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Les adresses des DNS publiques de Google sont <em class=
              "parameter"><code>8.8.8.8</code></em> et <em class=
              "parameter"><code>8.8.4.4</code></em> en IPv4 et <em class=
              "parameter"><code>2001:4860:4860::8888</code></em> et
              <em class="parameter"><code>2001:4860:4860::8844</code></em> en
              IPv6. Autrement, vous pouvez aussi utiliser les résolveurs de
              FDN: <em class="parameter"><code>80.67.169.12</code></em> et
              <em class="parameter"><code>80.67.169.40</code></em> en IPv4 et
              <em class="parameter"><code>2001:910:800::12</code></em> et
              <em class="parameter"><code>2001:910:800::40</code></em> en
              IPv6.
            </p>
          </div>
        </div>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="ch-config-hostname" name="ch-config-hostname"></a>9.2.3.
          Configurer le nom d'hôte du système
        </h2>
        <p>
          Pendant le processus de démarrage, le fichier <code class=
          "filename">/etc/hostname</code> est utilisé pour donner un nom
          d'hôte au système.
        </p>
        <p>
          Créez le fichier <code class="filename">/etc/network</code> et
          saisissez le nom du système en lançant&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">echo "<em class=
        "replaceable"><code>&lt;lfs&gt;</code></em>" &gt; /etc/hostname</kbd></pre>
        <p>
          <em class="replaceable"><code>&lt;lfs&gt;</code></em> doit être
          remplacé par le nom de l'ordinateur. Ne saisissez pas le FQDN ici.
          Cette information sera saisie dans le fichier <code class=
          "filename">/etc/hosts</code>.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="ch-config-hosts" name="ch-config-hosts"></a>9.2.4.
          Personnaliser le fichier /etc/hosts
        </h2>
        <p>
          Choisissez un nom de domaine pleinement qualifié (<span class=
          "foreignphrase"><em class="foreignphrase">fully-qualified domain
          name</em></span>, ou FQDN) et les alias possibles à déclarer dans
          le fichier <code class="filename">/etc/hosts</code>. Si vous
          utilisez des adresses statiques, vous devrez aussi choisir une
          adresse IP. La syntaxe d’une entrée du fichier hosts est&nbsp;:
        </p>
        <pre class="screen"><code class=
        "literal">IP_address myhost.example.org aliases</code></pre>
        <p>
          Sauf si votre ordinateur doit être visible à partir d'Internet
          (c-à-d que c'est un domaine enregistré et un bloc d'adresses IP
          valide—la plupart des utilisateurs n'ont pas ceci), assurez-vous
          que l'adresse IP se trouve dans la plage d'adresses réservée aux
          réseaux privés. Les plages valides sont&nbsp;:
        </p>
        <pre class="screen"><code class=
        "literal">Plage d'adresses réseau privés      Préfixe normal
     10.0.0.1 - 10.255.255.254                    8
    172.x.0.1 - 172.x.255.254                    16
  192.168.y.1 - 192.168.y.254                    24</code></pre>
        <p>
          x peut être un nombre compris entre 16 et 31. y peut être un nombre
          compris entre 0 et 255.
        </p>
        <p>
          Une adresse IP privée valide pourrait être 192.168.1.1. Un FQDN
          valide pour cette IP pourrait être lfs.example.org.
        </p>
        <p>
          Même si vous ne possédez pas de carte réseau, un FQDN valide est
          toujours requis. Certains programmes, comme les MTA, en ont besoin
          pour fonctionner correctement.
        </p>
        <p>
          Créez le fichier <code class="filename">/etc/hosts</code> avec la
          commande suivante&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">cat &gt; /etc/hosts &lt;&lt; "EOF"
<code class="literal"># Begin /etc/hosts

127.0.0.1 localhost.localdomain localhost
127.0.1.1 <em class="replaceable"><code>&lt;FQDN&gt;</code></em> <em class=
"replaceable"><code>&lt;HOSTNAME&gt;</code></em>
<em class="replaceable"><code>&lt;192.168.0.2&gt;</code></em> <em class=
"replaceable"><code>&lt;FQDN&gt;</code></em> <em class=
"replaceable"><code>&lt;HOSTNAME&gt;</code></em> <em class=
"replaceable"><code>[alias1] [alias2] ...</code></em>
::1       localhost ip6-localhost ip6-loopback
ff02::1   ip6-allnodes
ff02::2   ip6-allrouters

# End /etc/hosts</code>
EOF</kbd></pre>
        <p>
          Les valeurs <em class=
          "replaceable"><code>&lt;192.168.0.2&gt;</code></em>, <em class=
          "replaceable"><code>&lt;FQDN&gt;</code></em> et <em class=
          "replaceable"><code>&lt;HOSTNAME&gt;</code></em> doivent être
          remplacées suivant les contraintes et les besoins spécifiques (si
          la machine se voit affecter une adresse IP par un administrateur
          réseau/système et que cette machine est connectée à un réseau
          existant). Vous pouvez omettre le ou les noms d'alias facultatifs,
          et la ligne <em class=
          "replaceable"><code>&lt;192.168.0.2</code></em> si vous utilisez
          une connexion configurée avec DHCP ou l'autoconfiguration IPv6.
        </p>
        <p>
          L'adresse ::1 est l'équivalent en IPv6 à 127.0.0.1 et représente
          l'interface de rebouclage IPv6. 127.0.1.1 est une entrée de
          rebouclage réservée spécifiquement pour le FQDN.
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title=
          "Introduction">Précédent</a>
          <p>
            Introduction
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="udev.html" title=
          "Manipulation des périphériques et modules">Suivant</a>
          <p>
            Manipulation des périphériques et modules
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter09.html" title=
          "Chapitre&nbsp;9.&nbsp;Configuration du système">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-205-g49170-systemd+">Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
