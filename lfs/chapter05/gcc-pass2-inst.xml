<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Réinstallation de GCC</title>

<para>Déballez les trois archives tar de GCC dans un seul et même répertoire.
Ils construiront un seul sous-répertoire <filename>gcc-&gcc-version;/</filename>
.</para>

<para>Tout d'abord, corrigez deux problèmes et faites un ajustement essentiel:
</para>

<para><screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-mmap_test.patch
patch -Np1 -i ../gcc-&gcc-version;-no_fixincludes.patch
patch -Np1 -i ../gcc-&gcc-specs-version;.patch</userinput></screen></para>

<para>Le dernier correctif modifie l'emplacement par défaut de l'éditeur de
liens de GCC, une simple substitution de "/lib/ld-linux.so.2" avec
"/stage1/lib/ld-linux.so.2" dans <filename>config/i386/linux.h</filename>.
Corriger maintenant plutôt qu'ajuster le fichier specs après installation nous
assure que notre nouvel éditeur de liens sera utilisé lors de la contruction de
GCC. Donc, tous les binaires finaux (et temporaires) créés lors de la
construction seront liés à la nouvelle Glibc.</para>

<para>Créez de nouveau un répertoire de construction séparé:</para>

<para><screen><userinput>mkdir ../gcc-build
cd ../gcc-build</userinput></screen></para>

<para>Avant de commencer la construction de GCC, rappelez-vous de déconfigurer
toute variable d'environnement qui surcharge les options d'optimisation par
défaut.</para>

<para>Maintenant, préparez la compilation de GCC:</para>

<para><screen><userinput>../gcc-&gcc-version;/configure --prefix=/stage1 \
&nbsp;&nbsp;&nbsp;&nbsp;--with-local-prefix=/stage1 \
&nbsp;&nbsp;&nbsp;&nbsp;--enable-clocale=gnu --enable-shared \
&nbsp;&nbsp;&nbsp;&nbsp;--enable-threads=posix --enable-__cxa_atexit \
&nbsp;&nbsp;&nbsp;&nbsp;--enable-languages=c,c++</userinput></screen></para>

<para>Compilez le package:</para>

<para><screen><userinput>make</userinput></screen></para>

<para>Il n'y a pas besoin d'utiliser la cible <userinput>bootstrap</userinput>
maintenant car le compilateur que nous utilisons pour compiler ce GCC a été
construit avec les mêmes sources exactement.</para>

<para>Testez ce qui en résulte:</para>

<para><screen><userinput>make -k check</userinput></screen></para>

<para>L'option <userinput>-k</userinput> est utilisé pour lancer la suite de
tests de façon complète et de ne pas s'arrêter au premier échec. La suite de
tests de GCC est très importante et il est pratiquement garanti qu'elle génèrera
quelques échecs. Pour obtenir un résumé des résultats de la suite de tests,
lancez ceci:</para>
 
<para><screen><userinput>../gcc-3*/contrib/test_summary | less</userinput></screen></para>

<para>Vous pouvez comparé vos résultats à ceux postés sur la liste de diffusion
gcc-testresults pour les configurations similaires à la vôtre. Pour
un exemple de la version actuelle GCC-3.2.x sur i686-pc-linux-gnu, voir
<ulink url="http://gcc.gnu.org/ml/gcc-testresults/2003-02/msg00204.html"/>.</para>

<para>Notez que les résultats contiennent:</para>

<screen>* 1 XPASS (unexpected pass) for g++
* 26 XPASS's for libstdc++
* 1 FAIL for libstdc++</screen>
 
<para>La réussite inattendue pour g++ est dûe à l'utilisation de
<userinput>--enable-__cxa_atexit</userinput>. Apparemment, toutes les
plateformes supportées par GCC n'ont pas le support de "__cxa_atexit" dans
leurs bibliothèques C, donc personne n'attend que ce test réussie partout.
</para>

<para>Les 26 réussites inattendues pour libstdc++ sont dûes à l'utilisation de
<userinput>--enable-clocale=gnu</userinput>, qui est le bon choix sur les
systèmes à base de Glibc, version 2.2.5 et ultérieure. Le support de locale
sous-jacent dans la bibliothèque GNU C est supérieur au modèle "generic"
autrement sélectionné (qui peut être applicable si vous utilisiez Newlibc,
Sun-libc ou toute autre libc). La suite de tests libstd++ attend apparemment le
modèle "generic", mais ces tests ne sont pas non plus censés réussir en
permanence.</para>

<para>L'échec pour libstdc++ est dans
<filename>26_numerics/c99_classification_macros_c.cc</filename> et est un échec
connu depuis longtemps (au moins depuis janvier 2002) que les développeurs sont
apparemment incapables de corriger.</para>

<para>Et finalement, installez le package:</para>                                              

<para><screen><userinput>make install</userinput></screen></para>

</sect2>

