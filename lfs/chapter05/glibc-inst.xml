<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Installation de Glibc</title>

<para>Avant de commencer l'installation de Glibc, vou devez entrer
(<userinput>cd</userinput>) dans le répertoire
<filename>glibc-&glibc-version;</filename> et déballer Glibc-linuxthreads dans
ce répertoire, et pas dans <filename>/usr/src</filename> comme vous le faites
habituellement.</para>

<note><para>Nous allons lancer la suite de tests pour Glibc dans ce chapitre.
Néanmoins, est intéressant de noter que la suite de tests de Glibc que nous
lançons dans ce chapitre n'est pas considéré aussi critique que celui que
nous lançons dans le chapitre 6.</para></note>

<para>Ce package est connu pour mal se comporter si ses options d'optimisation
par défaut ont été changées (incluant les options -march et -mcpu). Donc, si
vous avez défini des variables d'environnement qui surchargent les
optimisations par défaut, telles que CFLAGS et CXXFLAGS, nous vous recommandons
de les supprimer ou de les modifier lors de la construction de Glibc.</para>

<para>En gros, compiler Glibc d'une autre façon que ce qu'indique le livre met
la stabilité de votre système en grand danger.</para>

<para>Bien que ce soit un message non dangereux, la phase d'installation de
Glibc se plaindra de la présence de <filename>/tools/etc/ld.so.conf</filename>.
Corrigez cette petite erreur ennuyante:</para>

<para><screen><userinput>mkdir /tools/etc
touch /tools/etc/ld.so.conf</userinput></screen></para>

<para>De même, Glibc a un problème subtile lorsqu'il est compilé avec GCC 3.3.1.
Appliquez le correctif suivant pour corriger cela:</para>
<para><screen><userinput>patch -Np1 -i ../glibc-2.3.2-sscanf-1.patch
</userinput></screen></para>

<para>La documentation venant avec Glibc recommende de construire le package
en dehors du répertoire des sources, dans un répertoire séparé et dédié à cela:
</para>

<para><screen><userinput>mkdir ../glibc-build
cd ../glibc-build</userinput></screen></para>

<para>Ensuite, préparez la compilation de Glibc:</para>

<para><screen><userinput>../glibc-&glibc-version;/configure --prefix=/tools \
&nbsp;&nbsp;&nbsp;&nbsp;--disable-profile --enable-add-ons \
&nbsp;&nbsp;&nbsp;&nbsp;--with-headers=/tools/include \
&nbsp;&nbsp;&nbsp;&nbsp;--with-binutils=/tools/bin \
&nbsp;&nbsp;&nbsp;&nbsp;--without-gd</userinput></screen></para>

<para>La signification des nouvelles options de configure est:</para>

<itemizedlist>
<listitem><para><userinput>--disable-profile</userinput> : Ceci désactive la
construction des bibliothèques avec des informations de profilage. Cette
commande peut être omise si vous plannifiez de faire du profilage.
</para></listitem>

<listitem><para><userinput>--enable-add-ons</userinput> : Ceci active tous les
modules supplémentaires qui étaient installés avec Glibc, c'est-à-dire
linuxthreads dans notre cas.</para></listitem>

<listitem><para><userinput>--with-binutils=/tools/bin</userinput> et
<userinput>--with-headers=/tools/include</userinput>: De façon stricte, ces
options ne sont pas requises. Mais elles nous assurent que rien n'ira mal en ce
qui concerne les entêtes du noyau et les programmes Binutils sont utilisés
durant la construction de Glibc.</para></listitem>

<listitem><para><userinput> --without-gd</userinput>: Cette option s'assure que
nous ne construisons pas le programme <userinput>memusagestat</userinput>, qui
assez bizarrement insiste pour lier de nouveau les bibliothèques de l'hôte 
(libgd, libpng, libz, et ainsi de suite).</para></listitem>
</itemizedlist>

<para>Durant cette étape, vous verrez le message d'avertissement suivant:</para>

<blockquote><screen>configure: warning:
*** These auxiliary programs are missing or too old: msgfmt
*** some features will be disabled.
*** Check the INSTALL file for required versions.</screen></blockquote>

<para>Le programme <filename>msgfmt</filename> manquant (du package Gettext que
nous installerons plus tard) ne causera pas de problèmes.
<filename>msgfmt</filename> est utilisé pour générer les fichiers binaires de
traduction que votre système utilise pour parler une autre langue. Comme les
fichiers de traduction ont déjà été générés pour vous, il n'y a pas besoin de
<filename>msgfmt</filename>. Vous aurez besoin de ce programme uniquement si
vous devez changer les fichiers source de traduction (les fichiers
<filename>*.po</filename> dans le sous-répertoire <filename
class="directory">po</filename>) ce qui nécessitera de regénérer les fichiers
binaires.</para>

<para>Continuez avec la compilation du package:</para>

<para><screen><userinput>make
make check
make install</userinput></screen></para>

<para>Le processus make check de glibc est hautement dépendant de certaines
fonctions sur votre système d'exploitation hôte. La plus commune est un hôte qui
échoue lors du montage d'un système de fichiers tmpfs sur /dev/shm, qui fera
que plusieurs tests de glibc pourraient échouer.</para>

<para>Les <quote>locales</quote> (utilisées par Glibc pour que votre système
Linux puisse parler une autre langue) n'ont pas été installées lorsque vous
avez lancé la commande précédente, donc vous devez le faire vous-même
maintenant:</para>

<para><screen><userinput>make localedata/install-locales</userinput></screen></para>

<para>Une alternative au lancement de le commande précédente est d'installer
seulement les <quote>locales</quote> dont vous aurez besoin. On peut y arriver
en utilisant la commande <userinput>localedef</userinput>. Les informations à
ce sujet sont disponibles dans le fichier <filename>INSTALL</filename>, du
répertoire <filename>glibc-&glibc-version;</filename>. Néanmoins, il existe
plusieurs locales essentielles pour que les tests des futurs packages n'échouent
pas, en particulier mes tests de libstdc++ de GCC. Les instructions suivantes,
au même endroit que pour la commande install-locales ci-dessus, installera
l'ensemble minimum de locales nécessaires aux tests pour s'exécuter
correctement:</para>

<para><screen><userinput>mkdir -p /tools/lib/locale
localedef -i de_DE -f ISO-8859-1 de_DE
localedef -i de_DE@euro -f ISO-8859-15 de_DE@euro
localedef -i en_HK -f ISO-8859-1 en_HK
localedef -i en_PH -f ISO-8859-1 en_PH
localedef -i en_US -f ISO-8859-1 en_US
localedef -i es_MX -f ISO-8859-1 es_MX
localedef -i fr_FR -f ISO-8859-1 fr_FR
localedef -i fr_FR@euro -f ISO-8859-15 fr_FR@euro
localedef -i it_IT -f ISO-8859-1 it_IT
localedef -i ja_JP -f EUC-JP ja_JP</userinput></screen></para>

</sect2>

