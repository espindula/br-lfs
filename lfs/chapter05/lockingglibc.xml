<sect1 id="ch05-locking-glibc">
<title>"Verrouiller" Glibc</title>
<?dbhtml filename="lockingglibc.html" dir="chapter05"?>

<para>Maintenant que les bibliothèques C temporaires ont été installées, nous
voulons que les outils compilés avec le reste de ce chapitre soient liés avec
ces bibliothèques. Pour accomplir ceci, nous avons besoin d'ajuster les scripts
de l'éditeur de liens et le fichier specs du compilateur.</para>

<para>Tout d'abord, installée les scripts améliorés de l'éditeur de liens en
lançant ce qui suit à l'intérieur du répertoire <filename
class="directory">binutils-build</filename>:</para>

<para><screen><userinput>make -C ld install-data-local</userinput></screen></para>

<para>Ces scripts ont été améliorés un peu avant, à la fin de la première passe
de Binutils et ne contiennent aucune mention de <filename>/lib</filename>,
<filename>/usr/lib</filename> ou <filename>/usr/local/lib</filename>.
A partir de ça, tout va être lier <emphasis>seulement</emphasis> avec les
bibliothèques dans <filename>/stage1/lib</filename>.</para>

<para>Vous pouvez maintenant supprimer les répertoires des sources et de
construction de Binutils.</para>

<para>L'autre chose à faire est de modifier le fichier specs de GCC de
façon à ce qu'ils pointent vers le nouvel éditeur de liens dynamiques. Une
simple commande sed accomplira ceci:</para>
   
<para><screen><userinput>SPECFILE=/stage1/lib/gcc-lib/*/*/specs
sed -e 's@/lib/ld.so.1@/stage1/lib/ld.so.1@g' \
&nbsp;&nbsp;&nbsp;&nbsp;-e 's@/lib/ld-linux.so.2@/stage1/lib/ld-linux.so.2@g' \
&nbsp;&nbsp;&nbsp;&nbsp;$SPECFILE > tempspecfile
mv tempspecfile $SPECFILE
unset SPECFILE</userinput></screen></para>

<para>Nous recommendons de copier/coller les commandes ci-dessus plutôt que
vous tentiez de taper tout ce qui s'y trouve. Ou vous pouvez éditer le fichier
specs à la main si vous le voulez: remplacez "/lib/ld-linux.so.2" par
"/stage1/lib/ld-linux.so.2".</para>

<para>De même, parce que nous avons autorisé que le script "Fixincludes" de GCC
modifie les fichiers d'entête de notre hôte (et ceci était nécessaire à cause de
la mauvaise utilisation du mot clé __thread dans des anciens logiciels), nous
voulons nous débarasser de ces fichiers d'entêtes modifiés et de les remplacer
avec les bons.</para>

<para><screen><userinput>GCCDIR=/stage1/lib/gcc-lib/*/*
rm -rf $GCCDIR/include/*
cp $GCCDIR/install-tools/include/* $GCCDIR/include
cp $GCCDIR/install-tools/gsyslimits.h \
   $GCCDIR/include/syslimits.h
unset GCCDIR</userinput></screen></para>

<para>Ceci complète l'installation de l'ensemble d'outils qui pourra maintenant
être utilisé pour construire le reste des outils temporaires.</para>

</sect1>

