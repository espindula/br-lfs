<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-tools-settingenviron">
<title>Configurer l'environnement</title>
<?dbhtml filename="settingenvironment.html"?>

<para>Définissez un bon environnement de travail en créant deux nouveaux
fichiers de démarrage pour le shell <command>bash</command>. En étant connecté
en tant qu'utilisateur <emphasis>lfs</emphasis>, lancez la commande suivante
pour créer un nouveau <filename>.bash_profile</filename>&nbsp;:</para>

<screen><userinput>cat &gt; ~/.bash_profile &lt;&lt; "EOF"
<literal>exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash</literal>
EOF</userinput></screen>

<para>Lorsque vous êtes connecté en tant que <emphasis>lfs</emphasis>, le shell
initial est habituellement un shell de <emphasis>connexion</emphasis> qui lit
le fichier <filename>/etc/profile</filename> de l'hôte (contenant probablement
quelques paramètrages et variables d'environnement), puis
<filename>.bash_profile</filename>. La commande <command>exec env
-i.../bin/bash</command> dans le fichier <filename>.bash_profile</filename>
remplace le shell en cours par un nouveau avec un environnement entièrement 
vide, à l'exception des variables <envar>HOME</envar>, <envar>TERM</envar> et
<envar>PS1</envar>. Cette technique nous assure un environnement prore en empêchant 
les variables d'environnement du système hôte de s'inviter dans le système LFS, au 
risque d'y faire des dégats.</para>

<para>La nouvelle instance du shell est un shell <emphasis>sans
connexion</emphasis>, qui ne lit donc pas les fichiers
<filename>/etc/profile</filename> et <filename>.bash_profile</filename> mais
plutôt le fichier <filename>.bashrc</filename>. Créez le fichier
<filename>.bashrc</filename> maintenant&nbsp;:</para>

<screen><userinput>cat &gt; ~/.bashrc &lt;&lt; "EOF"
<literal>set +h
umask 022
LFS=/mnt/lfs
LC_ALL=POSIX
PATH=/tools/bin:/bin:/usr/bin
export LFS LC_ALL PATH</literal>
EOF</userinput></screen>

<para>La commande <command>set +h</command> désactive la fonction de hachage de
<command>bash</command>. D'habitude, le hachage est une fonctionnalité utile que  
<command>bash</command> utilise pour se souvenir du chemin d'accès 
aux fichiers exécutables, évitant ainsi de reparcourir le 
<envar>PATH</envar> quand un exécutable est lancé une seconde fois.
Cependant, nous voulons utiliser les nouveaux outils dès leur installation.
En désactivant la fonction de hachage, le shell parcourt le 
<envar>PATH</envar> à chaque appel d'un programme. Ainsi, le shell
utilisera les nouveaux outils présents dans <filename
class="directory">$LFS/tools</filename> au fur et à mesure de leur apparition, au lieu de 
réutiliser sans cesse les versions originales de ces programmes dont la fonction de hachage 
garderait la trace.</para>

<para>Attribuer la valeur 022 au masque de création de fichier (umask) nous assure que
les nouveaux fichiers et répertoires créés ne seront modifiables que par 
leurs propriétaires, mais lisibles et exécutables par tout le monde (en
supposant que les modes par défaut sont utilisés par l'appel système open(2),
les nouveaux fichiers finiront avec les droits 644 et les répertoires avec
les droits 755).</para>

<para>La variable <envar>LFS</envar> devrait pointer sur le point de
montage choisi.</para>

<para>La variable <envar>LC_ALL</envar> contrôle la localisation de certains
programmes, adaptant leurs messages aux conventions du pays
spécifié. Si le système hôte utilise une version de Glibc plus ancienne que la
2.2.4, avoir <envar>LC_ALL</envar> initialisée à quelque chose d'autre que
<quote>POSIX</quote> ou <quote>C</quote> (pendant ce chapitre) pourrait poser
des problèmes si vous quittez l'environnement chroot et souhaitez y retourner
plus tard. Initialiser <envar>LC_ALL</envar> à <quote>POSIX</quote> ou
<quote>C</quote> (les deux sont équivalents) nous assure que tout fonctionnera
comme prévu dans l'environnement chroot.</para>

<para>En plaçant <filename class="directory">/tools/bin</filename> au début du
<envar>PATH</envar> standard, tous les programmes installées dans <xref
linkend="chapter-temporary-tools"/> sont utilisés par le shell immédiatement
après leur installation. Ceci, combiné avec la désactivation du hachage, limite
le risque que d'anciens programmes de l'hôte soient utilisés alors que les mêmes
programmes sont disponibles depuis l'environnement du chapitre 5.</para>

<beginpage/>

<para>Enfin, pour terminer la préparation de l'environnement en vue de la 
construction des outils temporaires, chargez le profil de
l'utilisateur tout juste créé&nbsp;:</para>

<screen><userinput>source ~/.bash_profile</userinput></screen>

</sect1>

