<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-revisedchroot">
  <?dbhtml filename="revisedchroot.html"?>

  <title>Nettoyer</title>

  <para>Enfin, nettoyez des fichiers résultant des tests&nbsp;:</para>

<screen><userinput>rm -rf /tmp/*</userinput></screen>

  <para>Maintenant déconnectez-vous et entrez de nouveau dans l'environnement chroot
avec une nouvelle commande chroot. À partir de maintenant, utilisez cette
nouvelle commande chroot à chaque fois que vous devrez entrer dans
l'environnement chroot après l'avoir quitté&nbsp;:</para>

<screen role="nodump"><userinput>logout

chroot "$LFS" /usr/bin/env -i          \
    HOME=/root TERM="$TERM"            \
    PS1='(lfs chroot) \u:\w\$ '        \
    PATH=/bin:/usr/bin:/sbin:/usr/sbin \
    /bin/bash --login</userinput></screen>

  <para>Ici l'option <parameter>+h</parameter> n'est plus utilisée, comme tous les
programmes précédents ont été remplacés&nbsp;: le hashage est donc possible.</para>

  <para>Si les systèmes de fichiers virtuels du noyau ont été démontés, manuellement
ou suite à un redémarrage, assurez-vous que les systèmes de fichiers
virtuels du noyau seront montés lorsque vous entrerez à nouveau dans le
chroot. On a expliqué cette procédure dans <xref
linkend="ch-tools-bindmount"/> et <xref linkend="ch-tools-kernfsmount"/>.</para>

  <para>Il y a aussi de nombreux fichiers installés dans les répertoires /usr/lib et
/usr/libexec dont l'extension est .la. Ce sont les fichiers «&nbsp;d'archive
libtool&nbsp;». Comme on l'a déjà dit, ils ne sont utiles que pour lier des
bibliothèques statiques. Ils sont inutiles, et potentiellement dangereux,
lorsqu'on utilise des bibliothèque partagée, surtout avec les systèmes de
construction non autotools. Pour les supprimer, lancez&nbsp;:</para>

<screen><userinput>find /usr/lib /usr/libexec -name \*.la -delete</userinput></screen>

   <para>Pour plus d'informations sur les fichiers d'archive libtool, voir la <ulink
url="&blfs-book;/introduction/la-files.html">section BLFS «&nbsp;À propos
des fichiers d'archive libtool (.la)&nbsp;»</ulink>.</para>

   <para>Le compilateur construit dans <xref linkend="chapter-temporary-tools"/> et
<xref linkend="chapter-chroot-temporary-tools"/> est toujours partiellement
installé et n'est plus requis. Supprimez-le avec&nbsp;:</para>

<screen><userinput>find /usr -depth -name $(uname -m)-lfs-linux-gnu\* | xargs rm -rf</userinput></screen>

   <para>Le répertoire <filename class="directory">/tools</filename> peut aussi être
supprimé pour gagner un peu plus de place&nbsp;:</para>

<screen><userinput>rm -rf /tools</userinput></screen>

   <para>Enfin, supprimez le compte utilisateur temporaire «&nbsp;tester&nbsp;» créé
au début du chapitre précédent.</para>

<screen><userinput>userdel -r tester</userinput></screen>
</sect1>
