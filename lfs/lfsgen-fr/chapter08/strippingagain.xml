<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-strippingagain">
  <?dbhtml filename="strippingagain.html"?>

  <title>Supprimer de nouveau les symboles des fichiers objets</title>

  <para>Cette section est facultative. Si l'utilisateur initial n'est pas un
développeur et ne pense pas faire de débogage sur les logiciels du système,
la taille du système peut être diminué d'environ 2&nbsp;Go en supprimant les
symboles de débogage contenus dans les binaires et dans les
bibliothèques. Ceci ne pose pas de problème autre que le fait de ne plus
pouvoir les déboguer.</para>

  <para>La plupart des personnes qui utilisent la commande mentionnée ci-dessous ne
rencontrent aucune difficulté. Néanmoins, il est facile de faire une erreur
de saisie et rendre le nouveau système complètement inutilisable, donc avant
d'exécuter la commande <command>strip</command>, il est recommandé de faire
une sauvegarde de l'état actuel du système LFS.</para>

  <para>Tout d'abord placez les symboles des bibliothèques choisies dans des
fichiers séparés. Ces informations sont requises si vous lancez des tests de
régression qui utilisent <ulink
url='&blfs-book;/general/valgrind.html'>valgrind</ulink> ou <ulink
url='&blfs-book;/general/gdb.html'>gdb</ulink> plus tard dans BLFS.
  </para>




<!--  <para>
Before performing the stripping, take special care to ensure that
  none of the binaries that are about to be stripped are running:</para>

<screen role="nodump"><userinput>exec /tools/bin/bash</userinput></screen>
  
  <para>Now the binaries and libraries can be safely stripped:</para>
-->
<screen><!-- also of interest are libgfortan, libgo, libgomp, and libobjc from GCC -->
<!--<screen>
<userinput>save_lib="ld-2.25.so libc-2.25.so libpthread-2.25.so libthread_db-1.0.so"-->
<!-- libcilkrts.so.&libcilkrts-version;-->
<userinput>save_lib="ld-&glibc-version;.so libc-&glibc-version;.so libpthread-&glibc-version;.so libthread_db-&libthread_db-version;.so"

cd /lib

for LIB in $save_lib; do
    objcopy --only-keep-debug $LIB $LIB.dbg 
    strip --strip-unneeded $LIB
    objcopy --add-gnu-debuglink=$LIB.dbg $LIB 
done    

save_usrlib="libquadmath.so.&libquadmath-version; libstdc++.so.&libstdcpp-version;
             libitm.so.&libitm-version; libatomic.so.&libatomic-version;" 

cd /usr/lib

for LIB in $save_usrlib; do
    objcopy --only-keep-debug $LIB $LIB.dbg
    strip --strip-unneeded $LIB
    objcopy --add-gnu-debuglink=$LIB.dbg $LIB
done

unset LIB save_lib save_usrlib</userinput></screen>


  <para>Maintenant, les binaires et les bibliothèques peuvent être nettoyées&nbsp;:</para>
<screen><userinput>find /usr/lib -type f -name \*.a \
   -exec strip --strip-debug {} ';'

find /lib /usr/lib -type f -name \*.so* ! -name \*dbg \
   -exec strip --strip-unneeded {} ';'

find /{bin,sbin} /usr/{bin,sbin,libexec} -type f \
    -exec strip --strip-all {} ';'</userinput></screen>

  <para>Un grand nombre de fichiers seront rapportés comme ayant un format non
reconnu. Ces messages d'avertissement indiquent que ces fichiers sont des
scripts et non pas des binaires.</para>

</sect1>
