<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-bootable-grub">
<title>Rendre le système LFS démarrable</title>
<?dbhtml filename="grub.html"?>

<indexterm zone="ch-bootable-grub">
<primary sortas="a-Grub">Grub</primary>
<secondary>configuration</secondary></indexterm>

<para>Votre nouveau système LFS est pratiquement fini. Une des dernières choses
à faire est de vous assurer que vous pouvez le démarrer. Les instructions
ci-dessous s'appliquent seulement aux ordinateurs de l'architecture IA-32,
c'est-à-dire les PC standards. Des informations sur le <quote>chargement au
démarrage</quote> pour les autres architectures devraient être disponibles aux
emplacements habituelles des ressources pour ces architectures.</para>

<para>Le chargement au démarrage est un domaine complexe. Tout d'abord, quelques
mots de mise en garde. Vous devez vraiment connaitre votre chargeur actuel et
tout autre système d'exploitation présent sur votre disque dur que vous
souhaitez pouvoir lancer. Assurez-vous d'avoir une disquette de démarrage de
façon à pouvoir réparer votre ordinateur si, par malheur, votre ordinateur
devenait inutilisable (non démarrable).</para>

<para>Plus tôt, nous avons compilé et installé le chargeur de démarrage Grub
pour cette étape. La procédure implique l'écriture de quelques fichiers spéciaux
de Grub en des endroits spécifiques sur le disque dur. Avant d'en arriver là,
nous vous recommendons fortement de créer une disquette de démarrage Grub au cas
où. Insérez une disquette de démarrage vierge et lancez les commandes
suivantes&nbsp;:</para>

<screen><userinput>dd if=/boot/grub/stage1 of=/dev/fd0 bs=512 count=1
dd if=/boot/grub/stage2 of=/dev/fd0 bs=512 seek=1</userinput></screen>

<para>Enlevez la disquette et rangez-la dans un endroit sûr. Maintenant, nous
allons lancer le shell <userinput>grub</userinput>:</para>

<screen><userinput>grub</userinput></screen>

<para>Grub utilise sa propre structure de nommage des disques et partitions, de
la forme (hdn,m), où <emphasis>n</emphasis> est le numéro du disque dur et
<emphasis>m</emphasis> le numéro de la partition, tout deux commençant à zéro.
Ceci signifie, par exemple, que la partition <filename>hda1</filename> est
(hd0,0) pour Grub alors que <filename>hdb2</filename> est (hd1,1). Contrairement
à Linux, Grub ne considère pas les lecteurs de CDRoms comme des disques durs,
donc si vous avez un CD sur <filename>hdb</filename>, par exemple, et un second
disque dur sur <filename>hdc</filename>, ce dernier disque sera malgré tout
(hd1).</para>

<para>En utilisant les informations ci-dessus, déterminez la désignation
appropriée pour votre partition root (ou votre partition de démarrage si celle
que vous utilisez est séparée). Pour l'exemple suivant, nous supposerons que
votre partition root (ou votre partition séparée) est
<filename>hda4</filename>.</para>

<para>Tout d'abord, indiquez à Grub où chercher ses fichiers
<filename>stage{1,2}</filename> -- vous pouvez utiliser la touche tabulation
partout pour que Grub vous affiche les alternatives&nbsp;:</para>

<screen><userinput>root (hd0,3)</userinput></screen>

<literallayout></literallayout>

<warning><para>La commande suivante écrasera votre chargeur de démarrage actuel.
Ne lancez pas cette commande si ce n'est pas ce que vous voulez. Par exemple,
vous pourriez utiliser un gestionnaire de démarrage autre pour gérer votre MBR
(Master Boot Record). Dans ce cas, il serait probablement plus sensé
d'installer Grub dans le <quote>secteur de boot</quote> de la partition LFS,
auquel cas cette prochaine commande deviendrait&nbsp;:
<userinput>setup (hd0,3)</userinput>.</para></warning>

<literallayout></literallayout>

<para>Ensuite, indiquez à Grub de s'installer dans le MBR de
<filename>hda</filename>&nbsp;:</para>

<screen><userinput>setup (hd0)</userinput></screen>

<para>Si tout va bien, Grub indiquera avoir trouvé ses fichiers dans
<filename>/boot/grub</filename>. C'est tout ce qu'il y a à faire &nbsp;:</para>

<screen><userinput>quit</userinput></screen>

<para>Maintenant, nous avons besoin de créer un fichier <quote>liste de
menus</quote> définissant le menu de démarrage de Grub&nbsp;:</para>

<screen><userinput>cat &gt; /boot/grub/menu.lst &lt;&lt; "EOF"</userinput>
# Debut de /boot/grub/menu.lst

# Par defaut, lance la premiere entree du menu.
default 0

# Attends 30 secondes avant de lancer le defaut.
timeout 30

# Utilise de jolis couleurs.
color green/black light-green/black

# La premiere entree concerne LFS.
title LFS &milestone;
root (hd0,3)
kernel --no-mem-option /boot/lfskernel root=/dev/hda4
<userinput>EOF</userinput></screen>

<note><para>Par défaut, Grub passera automatiquement un argument
<quote>mem=xxx</quote> au noyau. Néanmoins, Grub obtient occasionellement une
mauvaise taille mémoire, ce qui peut causer des problèmes dans certaines
circonstances. Il est préférable de désactiver cette fonctionnalité et de
laisser le noyau déterminer la taille mémoire lui-même, d'où l'utilisation de
<emphasis>--no-mem-option</emphasis> ci-dessus.</para></note>

<para>Vous pouvez souhaiter ajouter une entrée pour votre distribution hôte.
Cela pourrait ressembler à ceci&nbsp;:</para>

<screen><userinput>cat &gt;&gt; /boot/grub/menu.lst &lt;&lt; "EOF"</userinput>
title Red Hat
root (hd0,2)
kernel /boot/kernel-2.4.20 root=/dev/hda3
initrd /boot/initrd-2.4.20
<userinput>EOF</userinput></screen>

<para>De même, s'il vous arrive de lancer Windows, l'entrée suivante devrait le
permettre&nbsp;:</para>

<screen><userinput>cat &gt;&gt; /boot/grub/menu.lst &lt;&lt; "EOF"</userinput>
title Windows
rootnoverify (hd0,0)
chainloader +1
<userinput>EOF</userinput></screen>

<para>Si <command>info grub</command> ne vous dit pas tout ce que vous
souhaitez savoir, vous pouvez trouver plus d'informations concernant Grub sur
son site web, situé sur
<ulink url="http://www.gnu.org/software/grub/"/>.</para>

</sect1>

