<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-bootable-grub" role="wrap">

  <sect1info condition="script">
    <productname>grub</productname>
    <productnumber>&grub-version;</productnumber>
    <address>&grub-url;</address>
  </sect1info>

  <?dbhtml filename="grub.html"?>

  <title>Utilisation de GRUB pour paramétrer le processus de démarrage</title>


  <sect2>
    <title>Introduction</title>

    <warning><para>Une mavvaise configuration de GRUB peut rendre votre système
    inutilisable si vous n'avez pas de périphérique d'amorçage alternatif
    comme un CD-ROM.  Cette section n'est pas obligatoire pour démarrer votre
    système LFS. Il se peut que vous vouliez simplement modifier votre chargeur
    de démarrage actuel, comme Grub-Legacy, GRUB2, ou LILO.</para></warning>

    <para>Assurez-vous d'avoir un disque de démarrage de façon à pouvoir
  <quote>sauver</quote> l'ordinateur si, par malheur, celui-ci devenait
  inutilisable (non amorçable). Si vous n'avez pas déjà de périphérique de 
  démarrage, vous pouvez en créer un. Afin que la procédure ci-dessous fonctionne,
  vous devez vers un tour du côté de BLFS et installer <ulink
  url="http://www.linuxfromscratch.org/blfs/view/svn/multimedia/xorriso.html">
  xorriso</ulink>.</para>

<screen role="nodump"><userinput>cd /tmp &amp;&amp;
grub-mkrescue --output=grub-img.iso &amp;&amp;
xorriso -as cdrecord -v dev=/dev/cdrw blank=as_needed grub-img.iso</userinput></screen>

  </sect2>

  <sect2>
    <title>Conventions de nommage de GRUB</title>

  <para>GRUB utilise sa propre structure de nommage des disques et
  partitions, de la forme <emphasis>(hdn,m)</emphasis>, où
  <emphasis>n</emphasis> est le numéro du disque dur et
  <emphasis>m</emphasis> le numéro de la partition.
  Le numéro du disque dur commence à zéro, mais le numéro de la partition
  commence à un pour des partition normales et à cinq pour les partitions étendues. Notez
  que ceci change des versions des versions précédentes où les deux numéros commençaient à zéro. Par exemple, la partition
  <filename class="partition">sda1</filename> signifie <emphasis>(hd0,1)</emphasis> pour GRUB
  et <filename class="partition">sdb3</filename> signifie
  <emphasis>(hd1,3)</emphasis>. Contrairement à Linux, Grub ne considère
  pas les lecteurs de CDRoms comme des disques durs. Par exemple, si un
  CD se trouve sur <filename class="partition">hdb</filename> 
  et un second disque dur sur <filename class="partition">hdc</filename>,
  ce dernier disque sera malgré tout <emphasis>(hd1)</emphasis>.</para>

  <para>Vous pouvez déterminer la façon de voir vos lecteurs de disque par GRUB en lançant&nbsp;:</para>

<screen role="nodump"><userinput>grub-mkdevicemap --device-map=device.map
cat device.map</userinput></screen>

  </sect2>
  
  <sect2>
    <title>Réglage de la configuration</title>

    <para>GRUB fonctionne en écrivant les données sur le premier secteur physique
    du disque dur. Cet endroit ne fait partie d'aucun szstème de fichiers. Les
    programmes accèdent alors aux modules de GRUB dans la partition de
    démarrage. L'emplacement par défaut est /boot/grub/.</para>

    <para>L'emplacement de la partition de démarrage est un choix
    de l'utilisateur qui change la configuration. Une recommendation est d'avoir une petite
    (la taille suggérée est de 100 Mio) partition à part pour les informations d'amorçage. De cette
    façon, chaque construction, que ce soit LFS ou d'autres distributions commerciales,
    peut accéder aux mêmes fichiers de démarrage et on peut y accéder
    à partir n'importe quel système amorcé. Si vous choisissez de faire
    cela, vous aurez besoin de monter la partition à part,
    de déplacer tous les fichiers du répertoire
    <filename class="directory">/boot</filename> actuel (par
    exemple, le noyau linux que vous venez de construire à la section précédente) vers la
    nouvelle partition. Vous aurez ensuite besoin de démonter la partition
    puis de la remonter en tant que <filename class="directory">/boot</filename>. Si vous le faites,
    assurez-vous de mettre à jour
    <filename>/etc/fstab</filename>.</para>

    <para>L'utilisation de la partition lfs actuelle fonctionnera également,
    mais la configuration pour plusieurs systèmes est plus difficile.</para>

    <para>En utilisant les informations ci-dessus, déterminez le nom adapté
    à la partition racine (ou partition de démarrage, s'il en existe une à part). Pour l'exemple
    suivant, on suppose que la partition racine (ou
    (de démarrage à part) est <filename
    class="partition">sda2</filename>.</para>

    <para>Installez les fichiers de GRUB dans <filename
    class="directory">/boot/grub</filename> et paramétrez le secteur
    d'amorçage&nbsp;:</para> 

    <warning>
      <para>La commande suivante va écraser le chargeur de démarrage actuel. 
      Ne lancez pas la commande si ce n'est pas ce que vous désirez, par exemple
      si vous utilisez un gestionnaire de démarrage extérieur pour gérer la
      <foreignphrase>Master Boot Record</foreignphrase> (MBR).</para> 
    </warning>

<screen role="nodump"><userinput>grub-install /dev/sda</userinput></screen>

    <note><para><application>grub-install</application> est un script et il
    appelle un autre programme, grub-probe, qui peut échouer avec un message 
    "cannot stat `/dev/root'" (ne peut trouver /dev/root).  Dans un cas pareil,
    créez un lien symbolique temporaire entre votre partition racine et 
    /dev/root&nbsp;:</para>

<screen role="nodump"><userinput>ln -sv /dev/sda2 /dev/root</userinput></screen>

    <para>Le lien symbolique ne restera là que jusqu'au redémarrage du
    système. Le lien ne sert qu'à la procédure d'installation. 
    </para></note>
   
   </sect2>
   
   <sect2>
     <title>Créer le fichier de configuration</title>

     <para>Générez <filename>/boot/grub/grub.cfg</filename>&nbsp;:</para>
    <screen><userinput>cat &gt; /boot/grub/grub.cfg &lt;&lt; "EOF"
<literal># Début de /boot/grub/grub.cfg
set default=0
set timeout=5
insmod ext2
set root=(hd0,2)

menuentry "GNU/Linux, Linux &linux-version;-lfs-&version;" {
        linux   /boot/vmlinuz-&linux-version;-lfs-&version; root=/dev/sda2 ro
}</literal>
EOF</userinput></screen>

    <para>GRUB est un programme extrêmement puissant et il offre un très grand
    nombre d'options pour démarrer depuis une large gamme de périphériques, de
    systèmes d'exploitation et de types de partition. Il y a aussi beaucoup 
    d'options de personnalisation telles que les écrans flashies graphiques,
    jouer des sons, l'entrée souris etc. Les détails de ces options vont au-delà
    des objectifs de cette introduction.</para>

    <note><para>Il existe une commande, <application>grub-mkconfig</application> 
    qui peut écrire automatiquement un fichier de configuration. Elle utilise
    un ensemble de scripts situés dans /etc/grub.d/ et elle détruira les
    personnalisations que vous aurez faites. Ces scripts sont d'abord
    conçus pour des distributions non basées sur les sources et ils ne sont
    pas recommandés  pour LFS. Si vous installez une distribution Linux du marché,
    il est fort probable que ce programme soit lancé. Assurez-vous de sauvegarder
    votre fichier grub.cfg.</para></note> 

  </sect2>

</sect1>

