<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-bootable-grub" role="wrap">

  <sect1info condition="script">
    <productname>grub</productname>
    <productnumber>&grub-version;</productnumber>
    <address>&grub-url;</address>
  </sect1info>
  




  <?dbhtml filename="grub.html"?>

  <title>GRUB-&grub-version;</title>

  <indexterm zone="ch-bootable-grub">
    <primary sortas="a-Grub">GRUB</primary>
    <secondary>configuring</secondary>
  </indexterm>

  <sect2 role="package">
    <title/>
    

  <para>Le paquet Grub contient un chargeur de démarrage, le
  <foreignphrase>GRand Unified Bootloader</foreignphrase>.</para>
  
  <segmentedlist>
    <segtitle>&buildtime;</segtitle>
    <segtitle>&diskspace;</segtitle>
    <seglistitem>
      <seg>&grub-ch6-sbu;</seg>
      <seg>&grub-ch6-du;</seg>
    </seglistitem>
  </segmentedlist>
</sect2>

<sect2 role="installation">
    <title>Installation de GRUB</title>

    <caution>
       <para>Ce paquet ne se compilera que pour les architectures x86 et
       x86_64  contenant des bibliothèques 32 bits. Si  vous choisissez de
       construire sur x86_64 sans bibliothèques 32 bits (pas de multilib), vous
       devez utiliser LILO a$$ la place.</para>
    </caution>

    <para>Ce paquet est connu pour avoir des soucis quand les options
    d'optimisation par défaut (en incluant les options
    <parameter>-march</parameter> et <parameter>-mcpu</parameter>) sont
    sont modifiées. Donc, si des variables d'environne qui surchargent
    les optimisations par défaut, telles que <envar>CFLAGS</envar> et
    <envar>CXXFLAGS</envar>, supprimez cette initialisation pour la
    construction de GRUB.</para>

    <para>Commencez par appliquer le correctif suivant pour mieux détecter
    les lecteurs, corriger des problèmes de GCC 4.x,
    et fournir un meilleur support SATA pour certains contrôleurs de
    disque&nbsp;:</para>

<screen><userinput remap="pre">patch -Np1 -i ../&grub-geometry-patch;</userinput></screen>

    <para>Par défaut, GRUB ne supporte pas les systèmes de fichier ext2 avec
    des n&oelig;uds 256-byte. Corrigez cela en appliquant le correctif 
    suivant&nbsp;:</para>
    
<screen><userinput remap="pre">patch -Np1 -i ../&grub-inode-patch;</userinput></screen>

    <para>Préparez la compilation de Grub&nbsp;:</para>

<screen><userinput remap="configure">./configure --prefix=/usr</userinput></screen>

    <para>Compilez le paquet&nbsp;:</para>

<screen><userinput remap="make">make</userinput></screen>

    <para>Pour tester les résultats, lancez&nbsp;:</para>

<screen><userinput remap="test">make check</userinput></screen>

    <para>Installez le paquet&nbsp;:</para>

<screen><userinput remap="install">make install
mkdir -v /boot/grub
cp -v /usr/lib/grub/i386-pc/stage{1,2} /boot/grub</userinput></screen>

    <para>Remplacez <filename class="directory">i386-pc</filename> par
    le répertoire adéquat pour le matériel utilisé.</para>

    <para>Le répertoire <filename class="directory">i386-pc</filename>
    contient aussi un certain nombre de fichiers
    <filename>*stage1_5</filename>, différents suivant les différents
    systèmes de fichiers. Jetez un &oelig;il aux fichiers disponibles et
    copiez les bons dans le répertoire 

    <filename class="directory">/boot/grub</filename>. La plupart des
    utilisateurs copieront les fichiers
    <filename>e2fs_stage1_5</filename> et/ou
    <filename>reiserfs_stage1_5</filename></para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de GRUB</title>
    
  <para>Votre système LBS flambant neuf est pratiquement fini. Une des
  dernières choses à faire est de vous assurer que le système peut
  démarrer proprement. Les instructions ci-dessous s'appliquent
  seulement aux ordinateurs de l'architecture  IA-32, c'est-à-dire les
  PC standards. Des informations sur le <quote>chargement au
  démarrage</quote> pour les autres architectures devraient être
  disponibles aux emplacements habituels des ressources pour ces
  architectures.</para>

  <para>Le chargement au démarrage est un domaine complexe. Tout
  d'abord, quelques mots de mise en garde sont nécessaires. Vous devez
  vraiment connaître le chargeur actuel et tout autre système
  d'exploitation présent sur le disque dur amorçable. Assurez-vous
  d'avoir une disquette de démarrage de façon à pouvoir
  <quote>sauver</quote> l'ordinateur si, par malheur, celui-ci devenait
  inutilisable (non amorçable).</para>

  <para>Plus tôt, nous avons compilé et installé le chargeur de
  démarrage Grub pour cette étape. La procédure implique l'écriture de
  quelques fichiers spéciaux de Grub en des endroits spécifiques sur le
  disque dur. Nous recommandons fortement la création d'une disquette de
  démarrage Grub comme sauvegarde. Insérez une disquette de démarrage
  vierge et lancez les commandes suivantes&nbsp;:</para>

<screen><userinput>dd if=/boot/grub/stage1 of=/dev/fd0 bs=512 count=1
dd if=/boot/grub/stage2 of=/dev/fd0 bs=512 seek=1</userinput></screen>

  <para>Enlevez la disquette et rangez-la dans un endroit sûr.
  Maintenant, lancez le shell <command>grub</command>&nbsp;:</para>

<screen><userinput>grub</userinput></screen>

  <para>Grub utilise sa propre structure de nommage des disques et
  partitions, de la forme <emphasis>(hdn,m)</emphasis>, où
  <emphasis>n</emphasis> est le numéro du disque dur et
  <emphasis>m</emphasis> le numéro de la partition, tout deux commençant
  à zéro. Par exemple, la partition
  <filename class="partition">hda1</filename> est <emphasis>(hd0,0)</emphasis>
  pour GRUB alors que <filename class="partition">hdb3</filename> est
  Contrairement à Linux, Grub ne considère
  pas les lecteurs de CDRoms comme des disques durs. Par exemple, si un
  CD se trouve sur <filename class="partition">hdb</filename> 
  et un second disque dur sur <filename class="partition">hdc</filename>,
  ce dernier disque sera malgré tout <emphasis>(hd1)</emphasis>.</para>

  <para>En utilisant les informations ci-dessus, déterminez la
  désignation appropriée pour votre partition root (ou votre partition
  de démarrage si celle que vous utilisez est séparée). Pour l'exemple
  suivant, il est supposé que votre partition root (ou votre partition
  séparée) est
  <filename class="partition">hda4</filename>.</para>

  <para>Indiquez à Grub où chercher ses fichiers
  <filename>stage{1,2}</filename>. La touche tabulation est utilisable
  partout pour que Grub vous affiche les alternatives&nbsp;:</para>

<screen><userinput>root (hd0,3)</userinput></screen>

  <warning>
    <para>La commande suivante écrasera votre chargeur de démarrage actuel.
    Ne lancez pas cette commande si ce n'est pas désiré, par exemple, lors de
    l'utilisation d'un autre gestionnaire de démarrage pour gérer votre MBR
    (Master Boot Record). Dans ce cas, il serait probablement plus sensé
    d'installer Grub dans le <quote>secteur de boot</quote> de la partition LFS,
    auquel cas la prochaine commande deviendrait&nbsp;:

    <userinput>setup (hd0,3)</userinput>.</para>
  </warning>

  <para>Indiquez à Grub de s'installer dans le MBR de
  <filename class="partition">hda</filename>&nbsp;:</para>

<screen><userinput>setup (hd0)</userinput></screen>

  <para>Si tout va bien, Grub indiquera avoir trouvé ses fichiers dans
  <filename class="directory">/boot/grub</filename>. C'est tout ce qu'il
  y a à faire. Quittez le shell <command>grub</command>&nbsp;:</para>

<screen><userinput>quit</userinput></screen>

  <para>Créez un fichier <quote>liste de menus</quote> définissant le
  menu de démarrage de Grub&nbsp;:</para>

<screen><userinput>cat &gt; /boot/grub/menu.lst &lt;&lt; "EOF"
<literal># Begin /boot/grub/menu.lst

# démarre la première entrée du menu.
default 0

# Attend 30 secondes avant de démarrer l'entrée par défaut.
timeout 30

# Utilise de jolies couleurs.
color green/black light-green/black

# La première entrée est pour LFS.
title LFS &version;
root (hd0,3)
kernel /boot/lfskernel-&linux-version; root=/dev/hda4</literal>
EOF</userinput></screen>

  <para>Ajoutez une entrée pour votre distribution hôte si vous le
  souhaitez. Cela pourrait ressembler à ceci&nbsp;:</para>

<screen><userinput>cat &gt;&gt; /boot/grub/menu.lst &lt;&lt; "EOF"
<literal>title Red Hat
root (hd0,2)
kernel /boot/kernel-2.6.5 root=/dev/hda3
initrd /boot/initrd-2.6.5</literal>
EOF</userinput></screen>

  <para>Dans le cas d'une machine avec plusieurs systèmes
  d'exploitation, l'entrée suivante devrait le permettre&nbsp;:</para>

<screen><userinput>cat &gt;&gt; /boot/grub/menu.lst &lt;&lt; "EOF"
<literal>title Windows
rootnoverify (hd0,0)
chainloader +1</literal>
EOF</userinput></screen>

  <para>Si <command>info grub</command>
  ne fournit pas toutes les données nécessaires, plus d'informations
  concernant Grub sont disponibles sur le site web, situé sur
  <ulink url="http://www.gnu.org/software/grub/"/>.</para>

  <para>Le FHS stipule que le fichier <filename>menu.lst</filename> de
  GRUB doit être un lien symbolique vers
  <filename class="symlink">/etc/grub/menu.lst</filename>. Pour
  satisfaire ce pré-requis, lancez la commande suivante&nbsp;:</para>

<screen><userinput>mkdir -v /etc/grub
ln -sv /boot/grub/menu.lst /etc/grub</userinput></screen>

</sect2>

  <sect2 id="contents-gRUB" role="content">
    <title>Contenu de GRUB</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>

      <seglistitem>
        <seg>grub, grub-install, grub-md5-crypt, grub-set-default,
        grub-terminfo et mbchk</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="grub">
        <term><command>grub</command></term>
        <listitem>
          <para>Le shell de commande pour Grub (<foreignphrase>Grand Unified
          Bootloader</foreignphrase>)</para>
          <indexterm zone="ch-bootable-grub grub">
            <primary sortas="b-grub">grub</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="grub-install">
        <term><command>grub-install</command></term>
        <listitem>
          <para>Installe GRUB sur le périphérique spécifié</para>
          <indexterm zone="ch-bootable-grub grub-md5-crypt">
            <primary sortas="b-grub-install">grub-install</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="grub-md5-crypt">
        <term><command>grub-md5-crypt</command></term>
        <listitem>
          <para>Chiffre un mot de passe au format MD5</para>
          <indexterm zone="ch-bootable-grub grub-set-default">
            <primary sortas="b-grub-md5-crypt">grub-md5-crypt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="grub-set-default">
        <term><command>grub-set-default</command></term>
        <listitem>
          <para>Paramètre l'entrée de démarrage par défaut pour GRUB</para>
          <indexterm zone="ch-bootable-grub grub-terminfo">
            <primary sortas="b-grub-set-default">grub-set-default</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="grub-terminfo">
        <term><command>grub-terminfo</command></term>
        <listitem>
          <para>Génère une commande terminfo à partir d'un nom terminfo. Il est
          utilisable si vous avez un terminal non usuel</para>
          <indexterm zone="ch-bootable-grub mbchk">
            <primary sortas="b-grub-terminfo">grub-terminfo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mbchk">
        <term><command>mbchk</command></term>
        <listitem>
          <para>Vérifie le format d'un noyau multi-boot</para>
          <indexterm zone="ch-bootable-grub mbchk">
            <primary sortas="b-mbchk">mbchk</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>

