<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  <!ENTITY site               SYSTEM "../appendices/rc.site.script">
  %general-entities;
]>

<sect1 id="ch-scripts-site">
  <?dbhtml filename="site.html"?>

  <title>Le fichier rc.site</title>

  <indexterm zone="ch-scripts-site">
    <primary sortas="a-rc.site">rc.site</primary>
  </indexterm>

  <para>Le fichier facultatif <filename>/etc/sysconfig/rc.site</filename>
  contient les paramètres réglés automatiquement pour chaque script de démarrage de System V.
  Il peut aussi contrôler les valeurs des fichiers <filename>hostname</filename>,
  <filename>console</filename> et <filename>clock</filename> du répertoire
  <filename class='directory'>/etc/sysconfig/</filename>. Si les variables
  associées se trouvent à la fois dans ces fichiers distincts et dans
  <filename>rc.site</filename>, les valeurs des fichiers spécifiques ont la préséance.</para>

  <para><filename>rc.site</filename> contient aussi des paramètres pour
  personnaliser d'autres aspects du processus de démarrage. Le réglage de la
  variable IPROMPT permettra un lancement sélectif des scripts de démarrage.
  D'autres options sont décrites dans les commentaires du fichier. La version
  par défaut du fichier est ci-dessous&nbsp;:</para>

  <!-- Use role to fix a pdf generation problem -->
  <screen role="auto">&site;</screen>

  <sect2>
    <title>Personnaliser les scripts de démarrage et d'extinction</title>

    <para>Les scripts de démarrage LFS démarrent et arrêtent un système d'une
    façon très efficace, mais vous pouvez faire quelques bidouillages dans le
    fichier rc.site pour améliorer encore davantage la vitesse et ajuster les
    messages selon vos préférences. Pour cela, ajustez les paramètres du fichier
    <filename>/etc/sysconfig/rc.site</filename> ci-dessus.</para>

    <itemizedlist>

    <listitem><para>Pendant le script de démarrage <filename>udev</filename>,
    un appel à <command>udev settle</command> demande du temps pour s'achever.
    Ce temps peut être ou pas nécessaire pour des périphériques présents dans
    votre système. Si vous n'avez que des partitions simples et une seule carte
    ethernet, le processus de démarrage n'aura probablement pas besoin d'attendre
    cette commande. Pour la sauter, définissez la variable OMIT_UDEV_SETTLE=y.</para></listitem>

    <listitem><para>Le script de démarrage <filename>udev_retry</filename> lance
    aussi par défaut <command>udev settle</command>. Cette commande n'est nécessaire
    par défaut que si le répertoire <filename class='directory'>/var</filename>
     est monté séparément. Ceci car la vérification a besoin du fichier
    <filename>/var/lib/hwclock/adjtime</filename>.  D'autres personnalisations 
    peuvent nécessiter d'attendre qu'udev se termine mais dans beaucoup d'installations,
    ce n'est pas nécessaire. Sautez la commande en définissant la variable 
    OMIT_UDEV_RETRY_SETTLE=y.
    </para></listitem>

    <listitem><para>Par défaut, les vérifications des systèmes de fichiers sont
    sans message. Cela peut être vu comme un délai pendant le processus de démarrage.
    Pour activer la sortie de <command>fsck</command>, définissez la variable VERBOSE_FSCK=y.
    </para></listitem>

    <listitem><para>Lors du redémarrage, il se peut que vous vouliez sauter 
    la vérification du système de fichiers,
    <command>fsck</command>, complètement.  Pour cela, soit créez le fichier
    <filename>/fastboot</filename>, soit redémarrez le système avec la
    commande <command>/sbin/shutdown -f -r now</command>. Inversement, vous
    pouvez forcer la vérification de tous les systèmes de fichiers en créant
    <filename>/forcefsck</filename> ou en lançant <command>shutdown</command> 
    avec le paramètre <parameter>-F</parameter> plutôt que <parameter>-f</parameter>.  
    </para>
    
    <para>La définition de la variable FASTBOOT=y désactivera <command>fsck</command>
    lors du processus de démarrage jusqu'à ce qu'il soit supprimé. Ce n'est pas 
    recommandé de façon permanente.</para></listitem>

    <listitem><para>En principe, tous les fichiers du répertoire <filename
    class='directory'>/tmp</filename> sont effacés au moment du démarrage.
    Selon le nombre de fichiers ou de répertoires présents, cela peut provoquer
    un délai important dans le processus de démarrage. Pour sauter la suppression
    de ces fichiers, définissez la
    variable SKIPTMPCLEAN=y.</para></listitem>

    <listitem><para>Lors de l'extinction, le programme <command>init</command>
    envoie un signal TERM à chaque programme qu'il a démarré (comme agetty), il
    attend un moment de définition (par défaut, 3 secondes), et il envoie à
    chaque processus un signal KILL puis attend de nouveau. Ce processus se
    répète dans le script <command>sendsignals</command> pour tous les processus
    non terminés par leurs propres scripts.  Le délai de <command>init</command>
    peut être défini en passant un paramètre. Par
    exemple, pour supprimer le délai dans <command>init</command>, passez le
    paramètre -t0 lors de l'extinction ou du redémarrage (comme
    <command>/sbin/shutdown
    -t0 -r now</command>).  Le délai du script <command>sendsignals</command>
    peut être sauté en définissant le paramètre
    KILLDELAY=0.</para></listitem>

    </itemizedlist>

  </sect2>


</sect1>

