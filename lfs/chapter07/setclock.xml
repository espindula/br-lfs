<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-clock">
  <?dbhtml filename="clock.html"?>

  <title>Configurer l'horloge du système</title>

  <para>Les procédures pour régler l'horloge du système varient entre systemd et
  System V, mais elles n'entrent pas en conflit. Donc vous devriez suivre les deux
  pour pouvoir passer entre les systèmes.</para>

  <sect2 id="ch-scripts-setclock">
    <title>Configurer l'horloge avec System V</title>

    <indexterm zone="ch-scripts-setclock">
      <primary sortas="d-setclock">setclock</primary>
    <secondary>configuring</secondary></indexterm>

    <para>Le script <command>setclock</command> lit l'heure à partir de l'horloge
    matérielle, appelée aussi BIOS ou <foreignphrase>Complementary Metal Oxide 
    Semiconductor</foreignphrase> (CMOS). Si l'horloge matérielle est réglée sur
    UTC, ce script convertira l'heure de l'horloge matérielle en heure locale en utilisant
    le fichier <filename>/etc/localtime</filename> (qui indique au programme
    <command>hwclock</command> le fuseau horaire de l'utilisateur). Il n'y a aucun
    moyen de détecter si l'horloge matérielle est réglée sur UTC, donc vous
    devez le configurer manuellement.</para>

    <para><command>setclock</command> se lance
    <application>udev</application> quand le noyau détecte le matériel au démarrage. 
    Vous pouvez aussi le lancer à la main avec le paramètre stop pour stocker
    l'heure du système dans l'horloge CMOS.</para>

    <para>Si vous ne vous rappelez pas si l'horloge matérielle est réglée sur UTC,
    assurez-vous-en en lançant la commande <userinput>hwclock --localtime --show</userinput>.
    Cela affichera l'heure actuelle selon l'horloge matérielle. Si elle correspond à 
    ce qu'indique votre montre, l'horloge matérielle est en heure locale. Si la
    sortie de <command>hwclock</command> n'est pas l'heure locale, il y a des
    chances qu'il s'agisse de l'heure UTC. Vérifiez-le en ajoutant ou enlevant
    le bon nombre d'heures du fuseau horaire de l'heure affichée avec 
    <command>hwclock</command>. Par exemple, si vous êtes dans le fuseau MST,
    connu aussi sous le nom GMT -0700, ajoutez sept heures à l'heure locale.</para>

    <para>Passez la valeur de la variable <envar>UTC</envar> ci-dessous
    à la valeur <parameter>0</parameter> (zéro) si vhorloge matérielle
    <emphasis>n'est pas</emphasis> réglée sur l'heure UTC.</para>

    <para>Créez un nouveau fichier <filename>/etc/sysconfig/clock</filename> en
    lançant ce qui suit&nbsp;:</para>

<screen><userinput>cat &gt; /etc/sysconfig/clock &lt;&lt; "EOF"
<literal># Début de /etc/sysconfig/clock

UTC=1

# Mettez ici les options que vous pourriez devoir donner à hwclock,
# comme le type de l'horloge matérielle de la machine pour les Alphas.
CLOCKPARAMS=

# Fin de /etc/sysconfig/clock</literal>
EOF</userinput></screen>

    <para>Une bonne astuce expliquant la gestion de l'heure sur LFS est 
    disponible sur <ulink url="http://www.fr.linuxfromscratch.org/view/astuces/heure.txt"/>.
    Elle traite de sujets tels que les fuseaux horaires, UTC et la variable
    d'environnement <envar>TZ</envar>.</para>

    <note><para>Vous pouvez aussi régler les paramètres CLOCKPARAMS et UTC dans
    le fichier <filename>/etc/sysconfig/rc.site</filename>.</para></note>

  </sect2>

  <sect2 id="ch-scripts-systemd-clock">
    <title>Configurer l'heure avec Systemd</title>

  <indexterm zone="ch-scripts-clock">
    <primary sortas="d-clock">clock</primary>
  <secondary>configuring</secondary></indexterm>

  <para>Cette section explique comment configurer le service système
  <command>systemd-timedated</command>, qui configure l'horloge système et le
  fuseau horaire.</para>

  <para><command>systemd-timedated</command> lit
  <filename>/etc/adjtime</filename>, et selon le contenu du fichier, il met
  l'horloge en UTC ou en heure locale. Créez le fichier
  <filename>/etc/adjtime</filename> ayant le contenu suivant <emphasis>si votre
  horloge matérielle est en heure locale</emphasis>&nbsp;:</para>

<screen role="nodump"><userinput>cat &gt; /etc/adjtime &lt;&lt; "EOF"
<literal>0.0 0 0.0
0
LOCAL</literal>
EOF</userinput></screen>

    <para>Si <filename>/etc/adjtime</filename> n'est pas là au démarrage,
    <command>systemd-timedated</command> supposera que l'horloge matérielle est en
    UTC et il créera le fichier en utilisant ce paramètre.</para>

    <para>Vous pouvez aussi utiliser l'outil <command>timedatectl</command> pour
    dire à <command>systemd-timedated</command> si votre horloge matérielle est
    en UTC ou heure locale&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-local-rtc 1</userinput></screen>

    <para>Vous pouvez aussi utiliser <command>timedatectl</command> pour modifier
    l'heure du système et le fuseau.</para>

    <para>Pour modifier l'heure actuelle du système, lancez&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-time YYYY:MM:DD HH:MM:SS</userinput></screen>

    <para>L'horloge maérielle sera elle aussi mise à jour en conséquence.</para>

    <para>Pour modifier votre fuseau horaire actuel, lancez&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-timezone FUSEAU</userinput></screen>

    <para>Vous trouvez la liste des fuseaux disponibles en lançant&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl list-timezones</userinput></screen>

    <note><para>Merci de remarquer que <command>timedatectl</command> ne peut
    s'utiliser que sur un système démarré avec Systemd.</para></note>

  </sect2>

</sect1>
