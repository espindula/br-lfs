<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-setclock">
  <?dbhtml filename="setclock.html"?>

  <title>Configurer le script setclock</title>

  <indexterm zone="ch-scripts-setclock">
    <primary sortas="d-setclock">setclock</primary>
  <secondary>configuration</secondary></indexterm>

  <para>Le script <command>setclock</command> lit le temps sur l'horloge
  matérielle, aussi connu sous le nom d'horloge BIOS or CMOS.
  Si l'horloge matérielle est configurée en UTC, ce script convertira le
  temps de l'horloge matérielle en temps local en utilisant le fichier
  <filename>/etc/localtime</filename> (indiquant au programme
  <command>hwclock</command> le fuseau horaire où se situe
  l'utilisateur). Il n'existe pas de moyens de détecter si l'horloge
  matérielle est configurée en UTC, donc elle doit être configurée manuellement.</para>

  <para><command>setclock</command> est lancé via
  <application>udev</application> quand le noyau détecte la capacité du matériel au démarrage.
  Il peut aussi être lancé manuellement avec le paramètre stop
  pour stocker l'heure du système dans l'horloge CMOS.</para>

  <para>Si vous ne vous rappelez pas si l'horloge matérielle est configurée en
  UTC, découvrez-le en exécutant <userinput>hwclock --localtime --show</userinput>.
  Ceci affichera l'heure courante suivant l'horloge matérielle. Si l'heure
  correspond à ce qui vous dit votre montre, alors l'horloge matérielle est
  configurée sur l'heure locale. Si la sortie de <command>hwclock</command> n'est pas
  l'heure locale, il y a des chances qu'elle soit configurée en UTC. Vérifiez
  ceci en ajoutant ou en soustrayant le bon nombre d'heures pour votre fuseau
  horaire à l'heure affichée par
  <command>hwclock</command>. Par exemple, si vous êtes actuellement sur le fuseau horaire MST,
  aussi connu en tant que GMT -0700, ajoutez sept heures à l'heure locale.</para>

  <para>Modifiez la valeur de la variable <envar>UTC</envar> ci-dessous
  par une valeur <parameter>0</parameter> (zéro) si l'horloge matérielle
  n'est <emphasis>pas</emphasis> configurée en temps UTC.</para>

  <para>Créez un nouveau fichier <filename>/etc/sysconfig/clock</filename> en lançant ce qui
  suit&nbsp;:</para>

<screen><userinput>cat &gt; /etc/sysconfig/clock &lt;&lt; "EOF"
<literal># Début de /etc/sysconfig/clock

UTC=1

# Réglez ceci à toute option que vous pourriez devoir donner à hwclock,
# comme le type de l'horloge matérielle de la machine pour Alphas.
CLOCKPARAMS=

# Fin de /etc/sysconfig/clock</literal>
EOF</userinput></screen>

  <para> Une bonne astuce expliquant comment gérer l'horloge sur LFS est
  disponible sur <ulink url="http://lfs.traduc.org/view/astuces/heure.txt"/>. Elle explique certains concepts
  comme les fuseaux horaires, UTC et la variable d'environnement <envar>TZ</envar>.</para>

  <note><para>Vous pouvez régler les paramètres CLOCKPARAMS et UTC dans
  le fichier <filename>/etc/sysconfig/rc.site</filename>.</para></note>

</sect1>
