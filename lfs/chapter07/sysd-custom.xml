<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-sysd-custom">
  <?dbhtml filename="sysd-custom.html"?>

  <title>Utilisation et configuration de Systemd</title>

  <indexterm zone="ch-scripts-sysd-custom">
    <primary sortas="e-Systemd">Personnalisation de Systemd</primary>
  </indexterm>

  <sect2>
    <title>Configuration de base</title>

    <para>Le fichier <filename>/etc/systemd/system.conf</filename> contient un
    ensemble d'éléments de contrôle des opérations de base.  Le fichier contient
    par toutes les entrées mises en commentaire avec leurs paramètres par défaut 
    qui est indiqué. Ce fichier est l'endroit où vous pouvez changer le niveau
    de journalisation ainsi que certains paramètres de base du journal.</para>

  </sect2>

  <sect2>
    <title>Désactiver le nettoyage de l'écran lors du démarrage</title>

    <para>Le comportement ormal de systemd est de vider l'écran à la fin
    de la séquence de démarrage. Si vous le souhaitez, vous pouvez
    changer ce comportement avec ce qui suit&nbsp;:</para>

<screen role="nodump"><userinput>mkdir -p /etc/systemd/system/getty@tty1.service.d

cat > /etc/systemd/system/getty@tty1.service.d/noclear.conf &lt;&lt; EOF
[Service]
TTYVTDisallocate=no
EOF</userinput></screen>

    <para>Vous pouvez toujours relire les messages du démarrage en utilisant la
    commande <userinput>journalctl -b</userinput> en tant qu'utilisateur root.</para>

  </sect2>

  <sect2>
    <title>Désactiver tmpfs pour /tmp </title>

    <para>Par défaut, <filename class="directory">/tmp</filename> se crée
    comme un tmpfs. Si vous ne le souhaitez pas, vous pouvez changer cela par ce
    qui suit&nbsp;:</para>

<screen role="nodump"><userinput>ln -s /dev/null /etc/systemd/system/tmp.mount</userinput></screen>

    <para>Cela n'est pas nécessaire s'il existe une partition /tmp à part
    indiqué dans <filename>/etc/fstab</filename>.</para>
  </sect2>

  <sect2>
    <title>Configurer la création et l'effacement automatiques des fichiers</title>

    <para>Plusieurs services créent ou effacent des fichiers ou des
    répertoires&nbsp;:</para>

    <itemizedlist>
      <listitem><para>systemd-tmpfiles-clean.service</para></listitem>
      <listitem><para>systemd-tmpfiles-setup-dev.service</para></listitem>
      <listitem><para>systemd-tmpfiles-setup.service</para></listitem>
    </itemizedlist>

    <para>L'emplacement sur le système pour les fichiers de configuration est
    <filename>/usr/lib/tmpfiles.d/*.conf</filename>.  Les fichiers de
    configuration locaux sont dans <filename>/etc/tmpfiles.d/*.conf</filename>.
    Les fichiers de /etc/tmpfiles.d écrasent ceux du même nom situés dans 
    /usr/lib/tmpfiles.d.  Voir <userinput>man tmpfiles.d</userinput> 
    pour des détails sur le format des fichiers.</para>

  </sect2>

  <sect2>
    <title>Ajout personnalisé de services et d'unités</title>

    <para>Vous pouvez ajouter un service personnalisé en créant un répertoire et
    un fichier de configuration dans <filename class="directory">/etc/systemd/system/</filename>.
    Par exemple&nbsp;:</para>

<screen role="nodump"><userinput>mkdir -p /etc/systemd/system/foobar.service.d

cat > /etc/systemd/system/foobar.service.d/foobar.conf &lt;&lt; EOF
[Service]
Restart=always
RestartSec=30
EOF</userinput></screen>

     <para>Voir la page de man de systemd.unit pour plus d'informations.  Après
     avoir créé le fichier de configuration, lancez <userinput>systemctl
     daemon-reload</userinput> et <userinput>systemctl restart
     foobar</userinput> pour activer un service ou des changements sur un service.</para>

  </sect2>

  <sect2 id="ch-scripts-systemd-console">
    <title>Configurer les polices de la console Linux et le clavier</title>

  <indexterm zone="ch-scripts-systemd-console">
    <primary sortas="d-console">systemd console</primary>
    <secondary>configuration</secondary>
  </indexterm>

  <para>Cette section traite de la manière de configurer le service système
  <command>systemd-vconsole-setup</command> qui configure la police de la
  console virtuelle et la disposition du clavier dans la console.</para>

  <para>Le service <command>systemd-vconsole-setup</command> lit les informations
  de configuration dans le fichier <filename>/etc/vconsole.conf</filename>. Décidez
  de la disposition du clavier et de la police à l'écran qui seront utilisées.
  Il existe divers guides pratiques spécifiques à chaque langue qui peuvent vous
  aider. Voir <ulink
  url="http://www.tldp.org/HOWTO/HOWTO-INDEX/other-lang.html"/>.
  Observez la sortie de <command>localectl list-keymaps</command> pour une liste
  des dispositions de clavier valides sur la console. Regardez le répertoire
  <filename class="directory">/usr/share/consolefonts</filename> pour une liste
  des polices d'écran valides.</para>

  <para>Le fichier <filename>/etc/vconsole.conf</filename> devrait contenir
  des lignes de la forme&nbsp;: VARIABLE="valeur". Les variables suivantes sont
  reconnues&nbsp;:</para>

  <variablelist>

    <varlistentry>
      <term>KEYMAP</term>
      <listitem>
        <para>Cette variable spécifie la table de disposition du clavier. Si vous
        ne la définissez pas, elle est par défaut <literal>us</literal>.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>KEYMAP_TOGGLE</term>
      <listitem>
        <para>Vous pouvez utiliser cette variable pour configurer une disposition
        alternative  où vous pouvez basculer et elle n'est pas définie par défaut.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>FONT</term>
      <listitem>
        <para>Cette variable spécifie la police utilisée par la
        console virtuelle.</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>FONT_MAP</term>
      <listitem>
        <para>Cette variable spécifie la présentation de la console.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>FONT_UNIMAP</term>
      <listitem>
        <para>Cette variable spécifie la police de l'unicode.</para>
      </listitem>
    </varlistentry>

  </variablelist>

  <para>Voici un exemple pour un clavier allemand&nbsp;:</para>

<screen role="nodump"><userinput>cat &gt; /etc/vconsole.conf &lt;&lt; "EOF"
<literal>KEYMAP=de-latin1
FONT=Lat2-Terminus16</literal>
EOF</userinput></screen>

  <para>Vous pouvez modifier la valeur de KEYMAP lors de l'exécution en utilisant
  l'outil <command>localectl</command>&nbsp;:</para>

<screen role="nodump"><userinput>localectl set-keymap MAP</userinput></screen>

  <note><para>Merci de remarquer que la commande <command>localectl</command>
  n'est utilisable que sur un système démarré avec Systemd.</para></note>

  </sect2>

  <sect2>
    <title>Configurer l'horloge</title>

  <indexterm zone="ch-scripts-clock">
    <primary sortas="d-clock">clock</primary>
  <secondary>configuration</secondary></indexterm>

  <para>Cette section explique comment configurer le service système
  <command>systemd-timedated</command>, qui configure l'horloge système et le
  fuseau horaire.</para>

  <para><command>systemd-timedated</command> lit
  <filename>/etc/adjtime</filename>, et selon le contenu du fichier, il met
  l'horloge en UTC ou en heure locale. Créez le fichier
  <filename>/etc/adjtime</filename> ayant le contenu suivant <emphasis>si votre
  horloge matérielle est en heure locale</emphasis>&nbsp;:</para>

<screen role="nodump"><userinput>cat &gt; /etc/adjtime &lt;&lt; "EOF"
<literal>0.0 0 0.0
0
LOCAL</literal>
EOF</userinput></screen>

    <para>Si <filename>/etc/adjtime</filename> n'est pas là au démarrage,
    <command>systemd-timedated</command> supposera que l'horloge matérielle est en
    UTC et il créera le fichier en utilisant ce paramètre.</para>

    <para>Vous pouvez aussi utiliser l'outil <command>timedatectl</command> pour
    dire à <command>systemd-timedated</command> si votre horloge matérielle est
    en UTC ou heure locale&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-local-rtc 1</userinput></screen>

    <para>Vous pouvez aussi utiliser <command>timedatectl</command> pour modifier
    l'heure du système et le fuseau.</para>

    <para>Pour modifier l'heure actuelle du système, lancez&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-time YYYY:MM:DD HH:MM:SS</userinput></screen>

    <para>L'horloge maérielle sera elle aussi mise à jour en conséquence.</para>

    <para>Pour modifier votre fuseau horaire actuel, lancez&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl set-timezone FUSEAU</userinput></screen>

    <para>Vous trouvez la liste des fuseaux disponibles en lançant&nbsp;:</para>

<screen role="nodump"><userinput>timedatectl list-timezones</userinput></screen>

    <note><para>Merci de remarquer que <command>timedatectl</command> ne peut
    s'utiliser que sur un système démarré avec Systemd.</para></note>

  </sect2>

  <sect2>
    <title>Déboguer la séquence de démarrage</title>

    <para>Vous pouvez utiliser diverses commandes pour déboguer le processus de
    démarrage de systemd. Voici des exemples&nbsp;:</para>

    <itemizedlist>
       <listitem><para>systemctl list-units -t service [--all]</para></listitem>
       <listitem><para>systemctl list-units -t target  [--all]</para></listitem>
       <listitem><para>systemctl show -p Wants multi-user.target</para></listitem>
       <listitem><para>systemctl status sshd.service</para></listitem>
    </itemizedlist>

  </sect2>

</sect1>
