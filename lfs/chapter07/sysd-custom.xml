<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-sysd-custom">
  <?dbhtml filename="sysd-custom.html"?>

  <title>Personnalisation de Systemd</title>

  <indexterm zone="ch-scripts-sysd-custom">
    <primary sortas="e-Systemd">Personnalisation de Systemd</primary>
  </indexterm>

  <sect2>
    <title>Configuration de base</title>

    <para>Le fichier <filename>/etc/systemd/system.conf</filename> contient un
    ensemble d'éléments de contrôle des opérations de base.  Le fichier contient
    par toutes les entrées mises en commentaire avec leurs paramètres par défaut 
    qui est indiqué. Ce fichier est l'endroit où vous pouvez changer le niveau
    de journalisation ainsi que certains paramètres de base du journal.</para>

  </sect2>

  <sect2>
    <title>Désactiver le nettoyage de l'écran lors du démarrage</title>

    <para>Le comportement ormal de systemd est de vider l'écran à la fin
    de la séquence de démarrage. Si vous le souhaitez, vous pouvez
    changer ce comportement avec ce qui suit&nbsp;:</para>

<screen role="nodump"><userinput>mkdir -p /etc/systemd/system/getty@tty1.service.d

cat > /etc/systemd/system/getty@tty1.service.d/noclear.conf &lt;&lt; EOF
[Service]
TTYVTDisallocate=no
EOF</userinput></screen>

    <para>Vous pouvez toujours relire les messages du démarrage en utilisant la
    commande <userinput>journalctl -b</userinput> en tant qu'utilisateur root.</para>

  </sect2>

  <sect2>
    <title>Désactiver tmpfs pour /tmp </title>

    <para>Par défaut, <filename class="directory">/tmp</filename> se crée
    comme un tmpfs. Si vous ne le souhaitez pas, vous pouvez changer cela par ce
    qui suit&nbsp;:</para>

<screen role="nodump"><userinput>ln -s /dev/null /etc/systemd/system/tmp.mount</userinput></screen>

    <para>Cela n'est pas nécessaire s'il existe une partition /tmp à part
    indiqué dans <filename>/etc/fstab</filename>.</para>
  </sect2>

  <sect2>
    <title>Configurer la création et l'effacement automatiques des fichiers</title>

    <para>Plusieurs services créent ou effacent des fichiers ou des
    répertoires&nbsp;:</para>

    <itemizedlist>
      <listitem><para>systemd-tmpfiles-clean.service</para></listitem>
      <listitem><para>systemd-tmpfiles-setup-dev.service</para></listitem>
      <listitem><para>systemd-tmpfiles-setup.service</para></listitem>
    </itemizedlist>
  
    <para>L'emplacement sur le système pour les fichiers de configuration est
    <filename>/usr/lib/tmpfiles.d/*.conf</filename>.  Les fichiers de
    configuration locaux sont dans <filename>/etc/tmpfiles.d/*.conf</filename>.
    Les fichiers de /etc/tmpfiles.d écrasent ceux du même nom situés dans 
    /usr/lib/tmpfiles.d.  Voir <userinput>man tmpfiles.d</userinput> 
    pour des détails sur le format des fichiers.</para>

  </sect2>

  <sect2>
    <title>Ajout personnalisé de services et d'unités</title>

    <para>Vous pouvez ajouter un service personnalisé en créant un répertoire et
    un fichier de configuration dans <filename class="directory">/etc/systemd/system/</filename>.
    Par exemple&nbsp;:</para>

<screen role="nodump"><userinput>mkdir -p /etc/systemd/system/foobar.service.d

cat > /etc/systemd/system/foobar.service.d/foobar.conf &lt;&lt; EOF
[Service]
Restart=always
RestartSec=30
EOF</userinput></screen>

     <para>Voir la page de man de systemd.unit pour plus d'informations.  Après
     avoir créé le fichier de configuration, lancez <userinput>systemctl
     daemon-reload</userinput> et <userinput>systemctl restart
     foobar</userinput> pour activer un service ou des changements sur un service.</para>

  </sect2>

  <sect2>
    <title>Déboguer la séquence de démarrage</title>

    <para>Vous pouvez utiliser diverses commandes pour déboguer le processus de
    démarrage de systemd. Voici des exemples&nbsp;:</para>

    <itemizedlist>
       <listitem><para>systemctl list-units -t service [--all]</para></listitem>
       <listitem><para>systemctl list-units -t target  [--all]</para></listitem>
       <listitem><para>systemctl show -p Wants multi-user.target</para></listitem>
       <listitem><para>systemctl status sshd.service</para></listitem>
    </itemizedlist>

  </sect2>

</sect1>
