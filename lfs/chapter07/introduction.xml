<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-scripts-introduction">
  <?dbhtml filename="introduction.html"?>

  <title>Introduction</title>

    <para>Le démarrage d'un système Linux englobe plusieurs tâches. Le processus
    implique de monter les systèmes de fichiers virtuels et réels, d'initialiser
    les périphériques, activer l'échange (swap), vérifier l'intégrité des systèmes
    de fichiers, monter les partitions ou les fichiers d'échange, régler l'horloge du système,
    activer le réseau, démarrer les démons nécessaires au système et accomplir
    d'autres tâches personnalisées dont a besoin l'utilisateur. Il faut organiser
    le processus pour s'assurer que les tâches s'effectuent dans l'ordre, mais
    en même temps, le plus vite possible.</para>

    <para>Dans les paquets installés au chapitre 6, deux systèmes de démarrage
    ont été installés.  LFS offre la possibilité de sélectionner facilement
    le système à utiliser ainsi que de comparer et de différencier les deux systèmes
    en exécutant chacun en local sur l'ordinateur. Les avantages et les inconvénients
    de ces systèmes sont décrits ci-dessous.</para>

  <sect2 id='sysv-desc'>
    <title>System V</title>

    <para>System V est le système de démarrage classique qu'on utilise dans les
    systèmes Unix et Unix-like comme Linux depuis environ 1983.  Il consiste en
    un petit programme, <command>init</command>, qui initialise les programmes
    de base tels que <command>login</command> (via getty) et lance un script. Ce
       script, appelé en général <command>rc</command>,  contrôle l'exécution d'un
    ensemble d'autres scripts effectuant les tâches nécessaires pour initialiser
    le système.</para>

    <para>Le programme <command>init</command>  est contrôlé par le fichier
    <filename>/etc/inittab</filename> et s'organise en niveaux d'exécution lançables
    par l'utilisateur&nbsp;:</para>

<literallayout>
0 &mdash; arrêt
1 &mdash; mode mono-utilisateur
2 &mdash; Multiutilisateurs sans réseau
3 &mdash; mode multiutilisateurs complet
4 &mdash; Définissable par l'utilisateur
5 &mdash; mode multiutilisateur complet avec gestionnaire d'affichage
6 &mdash; redémarrage
</literallayout>

    <para>Le niveau d'exécution par défaut est en général 3 ou 5.</para>

    <bridgehead renderas="sect3">Avantages</bridgehead>

    <itemizedlist>
      <listitem>
          <para>Système stabilisé et maîtrisé.</para>
      </listitem>

      <listitem>
          <para>Facile à personnaliser.</para>
      </listitem>

    </itemizedlist>


    <bridgehead renderas="sect3">Inconvénients</bridgehead>

    <itemizedlist>
      <listitem>
          <para>Plus lent au démarrage. La vitesse moyenne d'un système LFS de
          base est de 8-12 secondes, le temps de l'hôte étant mesuré à partir du
          premier message du noyau jusqu'à l'invite de connexion. La connectivité
          réseau arrive en général 2 secondes après l'invite de connexion.</para>
      </listitem>

      <listitem>
          <para>Gestion en série des tâches de démarrage. Ceci est lié au point
          précédent. La durée d'un processus comme la vérification d'un système
          de fichiers retardera tout le processus de démarrage.</para>
      </listitem>

      <listitem>
          <para>Ne supporte pas directement les fonctionnalités avancées comme
          les groupes de contrôle (cgroups) et l'horodatage partagé finement par
          utilisateur.</para>
      </listitem>

      <listitem>
          <para>L'ajout de scripts se fait à la main, par décision séquenielles
          statiques.</para>
      </listitem>

    </itemizedlist>

  </sect2>

  <sect2 id='sysd-desc'>
    <title>Systemd</title>

    <para>Systemd est un ensemble de programmes interconnectés qui gère les requêtes
    du système et de chaque processus. Il offre un système de dépendances entre
    diverses entités qu'il appelle "unités".  Il gère automatiquement les
    dépendances entre les unités et il peut exécuter plusieurs tâches de
    démarrage en parallèle.  Il fournit les services login, inetd, logging, time
    et networking. </para>

    <bridgehead renderas="sect3">Avantages</bridgehead>

    <itemizedlist>
      <listitem>
          <para>Utilisé par défaut sur de nombreuses grandes distributions.</para>
      </listitem>

      <listitem>
          <para>Il exis!e une vaste documentation. 
          Voir <ulink url="http://www.freedesktop.org/wiki/Software/systemd/"/>.</para>
      </listitem>

      <listitem>
          <para>Exécution parallèle des processus de démarrage. La vitesse moyenne
          d'un système LFS de base est de 6-10 secondes à partir du démarrage du
          noyau jusqu'à l'invite de connexion. La connectivité réseau s'établit
          en général environ 2 secondes après l'invite de connexion. Des procédures
           de démarrage plus complexes peuvent offrir une meilleure vitesse 
           comparé à System V.</para>
      </listitem>

      <listitem>
          <para>Implémente des fonctionnalités avancées comme les groupes de
          contrôle pour gérer les processus liés.</para>
      </listitem>

      <listitem>
          <para>Maintient une rétro-compatibilité avec les programmes et les
          scripts de System V.</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Inconvénients</bridgehead>

    <itemizedlist>
      <listitem>
          <para>Il y a une courbe d'apprentissage importante.</para>
      </listitem>

      <listitem>
          <para>Certaines fonctions avancées comme dbus ou cgroups ne peuvent pas
          se gérer sans autres éléments requis.</para>
      </listitem>

      <listitem>
          <para>Bien qu'il se présente en plusieurs programmes exécutables,
          l'utilisateur ne peut pas choisir de n'implémenter que les parties
          qu'il désire.</para>
      </listitem>

      <listitem>
          <para>Etant donné qu'il utilise par nature des programmes compilés, systemd
          est plus difficile à déboguer.</para>
      </listitem>

      <listitem>
          <para>La journalisation s'effectue dans un format binaire. Il faut des
          extracteurs pour voir les journaux ou des processus supplémentaires
          pour imiter les programmes de journalisation traditionnels.</para>
      </listitem>

    </itemizedlist>

  </sect2>

  <sect2 id='sysv'>
    <title>Sélectionner une méthode de démarrage</title>

    <para>La sélection d'une méthode de démarrage dans un système LFS est
    relativement facile. Les deux systèmes sont installés chacun de leur côté.
    La seule chose à faire est de s'assurer que les fichiers nécessaires au
    système comportent les bons noms.
    Les scripts suivants s'en chargent.</para>

<screen><userinput remap="install">cat &gt; /usr/sbin/set-systemd &lt;&lt; "EOF"
#! /bin/bash

ln -svfn init-systemd   /sbin/init
ln -svfn init.d-systemd /etc/init.d

for tool in halt poweroff reboot runlevel shutdown telinit; do
  ln -sfvn  ${tool}-systemd   /sbin/${tool}
  ln -svfn  ${tool}-systemd.8 /usr/share/man/man8/${tool}.8
done

echo "Now reboot with /sbin/reboot-sysv"
EOF

chmod 0744 /usr/sbin/set-systemd

cat &gt; /usr/sbin/set-sysv &lt;&lt; "EOF"
#! /bin/bash

ln -sfvn init-sysv    /sbin/init
ln -svfn init.d-sysv  /etc/init.d

for tool in halt poweroff reboot runlevel shutdown telinit; do
  ln -sfvn  ${tool}-sysv   /sbin/${tool}
  ln -svfn  ${tool}-sysv.8 /usr/share/man/man8/${tool}.8
done

echo "Now reboot with /sbin/reboot-systemd"
EOF

chmod 0744 /usr/sbin/set-sysv</userinput></screen>

  <note><para>Le commentaire concernant la bonne commande de redémarrage dans les
  scripts ci-dessous est vrai. La commande de redémarrage du système de démarrage
  actuel doit s'utiliser après que lscript a it modifié la commande de redémarrage
   par défaut.
  </para></note>

  <para>Maintenant, définissez le système de démarrage. Par défaut, il s'agit de
  System V&nbsp;:</para>

<screen><userinput remap="install">/usr/sbin/set-sysv</userinput></screen>

  <para>Vous pouvez changer de système de démarrage n'importe quand en lançant
  le script ci-dessus adapté et en redémarrant.</para>

  </sect2>

</sect1>
