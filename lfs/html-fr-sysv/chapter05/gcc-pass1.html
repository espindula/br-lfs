<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      5.3.&nbsp;GCC-11.2.0 — Passe 1
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-r10.1-212-g6711c+">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version r10.1-212-g6711c+
      </h4>
      <h3>
        Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="binutils-pass1.html" title=
          "Binutils-2.37 — Passe 1">Précédent</a>
          <p>
            Binutils-2.37 — Passe 1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-5.13.12 API Headers">Suivant</a>
          <p>
            Linux-5.13.12 API Headers
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c+ ">Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="wrap" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="ch-tools-gcc-pass1" name="ch-tools-gcc-pass1"></a>5.3.
        GCC-11.2.0 — Passe 1
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <p>
          Le paquet GCC contient la collection de compilateurs GNU, qui
          inclut les compilateurs C et C++.
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Temps de construction
              approximatif:</strong> <span class="segbody">12 SBU</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Espace disque requis:</strong>
              <span class="segbody">3.4 Go</span>
            </div>
          </div>
        </div>
      </div>
      <div class="installation" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          5.3.1. Installation de GCC croisé
        </h2>
        <p>
          GCC requiert les paquets GMP, MPFR et MPC. Comme il se peut que ces
          paquets ne soient pas inclus dans votre distribution hôte, ils vont
          être compilés en même temps que GCC. Déballez chaque paquet dans le
          répertoire des sources de GCC et renommez les répertoires ainsi
          créés pour que les procédures de construction de GCC les utilisent
          automatiquement&nbsp;:
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Beaucoup d'incompréhensions existent concernant ce chapitre. Les
            procédures sont les mêmes que celles des autres chapitres, comme
            expliqué plus haut (<a class="xref" href=
            "../partintro/generalinstructions.html#buildinstr">Instructions
            de compilation des paquets</a>). Extrayez d'abord l'archive tar
            de gcc du répertoire des sources puis rendez-vous dans le
            répertoire créé. C'est seulement là que vous devriez suivre les
            instructions ci-dessous.
          </p>
        </div>
        <pre class="userinput"><kbd class=
        "command">tar -xf ../mpfr-4.1.0.tar.xz
mv -v mpfr-4.1.0 mpfr
tar -xf ../gmp-6.2.1.tar.xz
mv -v gmp-6.2.1 gmp
tar -xf ../mpc-1.2.1.tar.gz
mv -v mpc-1.2.1 mpc</kbd></pre>
        <p>
          Sur les systèmes x86_64, définissez <span class=
          "quote">«&nbsp;<span class="quote">lib</span>&nbsp;»</span> comme
          nom de répertoire par défaut pour les bibliothèques 64 bits&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">case $(uname -m) in
  x86_64)
    sed -e '/m64=/s/lib64/lib/' \
        -i.orig gcc/config/i386/t-linux64
 ;;
esac</kbd></pre>
        <p>
          La documentation de GCC recommande de construire GCC dans un
          répertoire de construction dédié&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">mkdir -v build
cd       build</kbd></pre>
        <p>
          Préparez la compilation de GCC&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">../configure                                       \
    --target=$LFS_TGT                              \
    --prefix=$LFS/tools                            \
    --with-glibc-version=2.11                      \
    --with-sysroot=$LFS                            \
    --with-newlib                                  \
    --without-headers                              \
    --enable-initfini-array                        \
    --disable-nls                                  \
    --disable-shared                               \
    --disable-multilib                             \
    --disable-decimal-float                        \
    --disable-threads                              \
    --disable-libatomic                            \
    --disable-libgomp                              \
    --disable-libquadmath                          \
    --disable-libssp                               \
    --disable-libvtv                               \
    --disable-libstdcxx                            \
    --enable-languages=c,c++</kbd></pre>
        <div class="variablelist">
          <p class="title">
            <strong>Voici la signification des options de
            configure&nbsp;:</strong>
          </p>
          <dl class="variablelist">
            <dt>
              <span class="term"><em class=
              "parameter"><code>--with-glibc-version=2.11</code></em></span>
            </dt>
            <dd>
              <p>
                Cette option s'assure que le paquet sera compatible avec la
                version de glibc de l'hôte. Il est configuré à la version de
                glibc requise la plus basse spécifiée dans les <a class=
                "xref" href="../chapter02/hostreqs.html" title=
                "2.2.&nbsp;Prérequis du système hôte">Prérequis du système
                hôte</a>.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--with-newlib</code></em></span>
            </dt>
            <dd>
              <p>
                Vu qu'aucune bibliothèque C fonctionnelle n'est encore
                disponible, ceci garantit que la constante inhibit_libc soit
                définie lors de la construction de libgcc. Cela empêche la
                compilation d'un code exigeant la prise en charge de la libc.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--without-headers</code></em></span>
            </dt>
            <dd>
              <p>
                Lors de la compilation d'un compilateur croisé complet, GCC
                exige des en-têtes standards compatibles avec le système
                cible. Pour nos objectifs, ces en-têtes ne seront pas
                nécessaires. Ce paramètre empêche GCC de les chercher.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-initfini-array</code></em></span>
            </dt>
            <dd>
              <p>
                Ce paramètre force l'utilisation de certaines structures de
                données internes qui sont requises mais ne peuvent pas être
                détectées lors de la construction d'un compilateur croisé.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-shared</code></em></span>
            </dt>
            <dd>
              <p>
                Ce paramètre oblige GCC à lier ses bibliothèques internes de
                manière statique. On procède ainsi parce que les
                bibliothèques partagées requièrent glibc, qui n'est pas
                encore installé sur le système cible.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-multilib</code></em></span>
            </dt>
            <dd>
              <p>
                Sur du x86_64, LFS ne prend pas en charge une configuration
                multilib. Ce paramètre n'a pas d'importance pour x86.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--disable-decimal-float, --disable-threads,
              --disable-libatomic, --disable-libgomp, --disable-libquadmath,
              --disable-libssp, --disable-libvtv,
              --disable-libstdcxx</code></em></span>
            </dt>
            <dd>
              <p>
                Ces paramètres désactivent la prise en charge de l'extension
                pour les nombres décimaux en virgules flottantes, de
                threading, libatomic, libgomp, libquadmath, libssp, libvtv et
                de la bibliothèque standard C++. La compilation de ces
                fonctions va échouer lors de la construction d'un compilateur
                croisé et celles-ci sont inutiles pour la compilation croisée
                de la libc temporaire.
              </p>
            </dd>
            <dt>
              <span class="term"><em class=
              "parameter"><code>--enable-languages=c,c++</code></em></span>
            </dt>
            <dd>
              <p>
                Cette option nous assure que seuls les compilateurs C et C++
                seront construits. Ce sont les seuls langages actuellement
                nécessaires.
              </p>
            </dd>
          </dl>
        </div>
        <p>
          Compilez GCC en lançant&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">make</kbd></pre>
        <p>
          Installez le paquet&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">make install</kbd></pre>
        <p>
          Cette construction de GCC a installé quelques en-têtes internes au
          système. Normalement l'un d'entre eux, <code class=
          "filename">limits.h</code>, incluerait à son tour l'en-tête
          <code class="filename">limits.h</code> du système, dans ce cas,
          <code class="filename">$LFS/usr/include/limits.h</code>. Cependant,
          au moment de la construction de GCC <code class=
          "filename">$LFS/usr/include/limits.h</code> n'existe pas, donc
          l'en-tête interne qui vient d'être construit est un fichier
          partiel, auto-contenu et n'inclus pas les fonctionnalités étendues
          de l'en-tête système. Cela est suffisant pour construire glibc,
          mais l'en-tête interne complet sera requis plus tard. Créez une
          version complète de l'en-tête interne avec une commande identique à
          ce que le système de construction de GCC fait dans des
          circonstances normales&nbsp;:
        </p>
        <pre class="userinput"><kbd class="command">cd ..
cat gcc/limitx.h gcc/glimits.h gcc/limity.h &gt; \
  `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/install-tools/include/limits.h</kbd></pre>
      </div>
      <div class="content" lang="fr" xml:lang="fr">
        <p>
          Les détails sur ce paquet sont disponibles dans <a class="xref"
          href="../chapter08/gcc.html#contents-gcc" title=
          "8.26.2.&nbsp;Contenu de GCC">Section&nbsp;8.26.2, «&nbsp;Contenu
          de GCC.&nbsp;»</a>
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="binutils-pass1.html" title=
          "Binutils-2.37 — Passe 1">Précédent</a>
          <p>
            Binutils-2.37 — Passe 1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-5.13.12 API Headers">Suivant</a>
          <p>
            Linux-5.13.12 API Headers
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter05.html" title=
          "Chapitre&nbsp;5.&nbsp;Compilation d'une chaîne d'outils croisée">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version r10.1-212-g6711c+ ">Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
