<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY nss-download-http 
  "http://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_13_3_RTM/src/nss-&nss-version;.tar.gz">
  <!ENTITY nss-download-ftp  
  "ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_13_3_RTM/src/nss-&nss-version;.tar.gz">
  <!ENTITY nss-md5sum        "006cb82fa900e9e664b4b14a9b7810ca">
  <!ENTITY nss-size          "5.8 Mio">
  <!ENTITY nss-buildsize     "70 Mio (plus du double pour exécuter la suite de tests)">
  <!ENTITY nss-time          "1.0 SBU (ajouter au moins 3.5 SBU pour éxécuter la suite de tests)">
]>

<sect1 id="nss" xreflabel="NSS-&nss-version;">
  <?dbhtml filename="nss.html"?>

  <sect1info>
    <othername>$LastChangedBy&nbsp;: andy $</othername>
    <date>$Date&nbsp;: 2012-03-06 17:54:55 +0100 (mar. 06 mars 2012) $</date>
  </sect1info>

  <title>NSS-&nss-version;</title>

  <indexterm zone="nss">
    <primary sortas="a-NSS">NSS</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à NSS</title>

    <para>Le paquet <foreignphrase>Network Security Services</foreignphrase> (services
    de sécurité réseau) (<application>NSS</application>) est un ensemble de
    bibliothèques conçues pour supporter le développement en plateforme croisée 
    d'applications et de serveurs sécurisés. Les applications construites avec
    NSS peuvent supporter SSL v2 et v3, TLS, les certificats PKCS #5,
    PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 et d'autres 
    standards de sécurité. C'est utile pour implémenter SSL et S/MIME ou d'autres
    standards de sécurité sur Internet dans une application.</para>

    &lfs71_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&nss-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&nss-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &nss-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &nss-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &nss-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &nss-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="&patch-root;/nss-&nss-version;-standalone-1.patch"/></para>
      </listitem>
    </itemizedlist>
    
    <bridgehead renderas="sect3">Dépendances de NSS</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="nspr"/></para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended"><xref linkend="sqlite"/> (Le <application>sqlite</application> interne est incompatible
    avec une installation existante ou future)</para>


    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/nss"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de NSS</title>

    <para>Installez <application>NSS</application> en lançant les commandes
    suivantes&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../nss-&nss-version;-standalone-1.patch &amp;&amp;
cd mozilla/security/nss &amp;&amp;
make nss_build_all $([ $(uname -m) = x86_64 ] &amp;&amp; echo USE_64=1) BUILD_OPT=1 \
  NSPR_INCLUDE_DIR=/usr/include/nspr USE_SYSTEM_ZLIB=1 ZLIB_LIBS=-lz \
  $(cat /usr/include/sqlite3.h &amp;&gt; /dev/null &amp;&amp; echo NSS_USE_SYSTEM_SQLITE=1)</userinput></screen>

    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>

<!--    <para>Si vous souhaitez tester les résultats, vous devez initialiser le nom de domaine de
    votre systeme dans la variable d'environnement <envar>DOMSUF</envar>. La plupart des tests
    échoueront si vous ne mettez pas le nom de domaine correct. La sortie volumineuse
    indiquera combien des milliers de tests seront réussi, et si quelques uns echoue.
    Pour revoir le détail des echecs, vous pouvez rediriger stdout et stderr dans un fichier.</para>

    <para>To run the tests, ensure you change the
    <command>export DOMSUF</command> ci-dessous avec la valeur adéquate, 
    par exemple <parameter>mydomain.com</parameter> ou si vous n'avez aucun domaine dans
    votre <filename>/etc/hosts</filename> remplacez le selon la recommandation des developpeurs
    par <command>"export HOST=localhost DOMSUF=localdomain"</command> et lancez les commandes
    suivantes&nbsp;:</para>

<screen><userinput>bash

export NSS_LINUXDIR=$(basename `ls -d $PWD/mozilla/dist/Linux*`) &amp;&amp;
export DOMSUF=<replaceable>&lt;validdomain.name&gt;</replaceable> &amp;&amp;
export PATH=$PATH:$PWD/mozilla/dist/$NSS_LINUXDIR/bin &amp;&amp;
export TEST_RESULTSDIR=$PWD/mozilla/tests_results/security &amp;&amp;

cd mozilla/security/nss/tests &amp;&amp;
sed -i 's/gmake/make/' common/init.sh &amp;&amp;
./all.sh &amp;&amp;

grep Passed $TEST_RESULTSDIR/$(hostname).1/results.html | wc -l &amp;&amp;

exit</userinput></screen>
-->

   <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>cd ../../dist &amp;&amp;
install -v -m755 Linux*/lib/*.so /usr/lib &amp;&amp;
install -v -m644 Linux*/lib/{*.chk,libcrmf.a} /usr/lib &amp;&amp;
install -v -m755 -d /usr/include/nss &amp;&amp;
cp -v -RL {public,private}/nss/* /usr/include/nss &amp;&amp;
chmod 644 /usr/include/nss/* &amp;&amp;
install -v -m755 Linux*/bin/{certutil,nss-config,pk12util} /usr/bin &amp;&amp;
install -v -m644 Linux*/lib/pkgconfig/nss.pc /usr/lib/pkgconfig</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><parameter>[ $(uname -m) = x86_64 ] &amp;&amp; echo USE_64=1</parameter>&nbsp;:
    Cette option est <emphasis>exigée sur x86_64</emphasis>, sinon <command>make</command>
    va essayer de créer un objet 32 bits et échouer sur un système
    non multilib. Le test [ $(arch) = x86_64 ] garantit que cela n'aura aucun
    effet sur un système 32 bits.</para> 
 
    <para><command>cat /usr/include/sqlite3.h ... </command>&nbsp;: teste si
    <application>sqlite</application> est installé et si oui, <command>echo</command> l'option
    NSS_USE_SYSTEM_SQLITE=1 pour <command>make</command> pour que
    <filename class="libraryfile">libsoftokn3.so</filename> se lie à
    la version de sqlite du système.</para>
    
    <para>
      <parameter>BUILD_OPT=1</parameter>&nbsp;: Cette variable est passée à
      <command>make</command> pour que la construction
    s'effectue sans les symboles de débogage intégré dans les binaires et que les
    optimisations du compilateur par défaut soient utilisées.</para>
    
    <para><parameter>NSPR_INCLUDE_DIR=/usr/include/nspr</parameter>&nbsp;: Cette comande
    initialise l'emplacement des entêtes de nspr.</para>
    
    <para><parameter>USE_SYSTEM_ZLIB=1</parameter>&nbsp;: Cette option est passée
    à <command>make</command> pour garantir que la bibliothèque <filename class="libraryfile">libssl3.so</filename>
    est liée au système installé <application>zlib</application> au lieu de
    la version incluse dans l'arborescence.</para>

    <para><parameter>ZLIB_LIBS=-lz</parameter>&nbsp;: Cette commande fournit le drapeau nécessaire pour
    lier au système <application>zlib</application>.</para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>certutil, nss-config et pk12util</seg>
        <seg>
          libcrmf.a, libfreebl3.so, libnss3.so, libnssckbi.so, libnssdbm3.so,
          libnssutil3.so, libsmime3.so, libsoftokn3.so et libssl3.so
        </seg>
        <seg>/usr/include/nss</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="certutil">
        <term><command>certutil</command></term>
        <listitem>
          <para>
            est l'outil de base de données de certificats de Mozilla. C'est un
            outil en ligne de commande qui peut modifier les fichiers de base
            de données cert8.db et key3.db de Netscape Communicator. Il peut
            aussi lister, générer, modifier ou effacer les certificats d'un
            fichier cert8.db et créer ou modifier le mot de passe, générer de
            nouveaux trousseaux de clés publiques et privées, afficher le
            contenu de la base de données des clés ou effacer des trousseaux
            de clés du fichier key3.db.
          </para>
          <indexterm zone="nss certutil">
            <primary sortas="b-certutil">certutil</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="nss-config">
        <term><command>nss-config</command></term>
        <listitem>
          <para>est utilisé pour déterminer les paramètres de la bibliothèque
          NSS et des bibliothèques NSS installées.</para>
          <indexterm zone="nss nss-config">
            <primary sortas="b-nss-config">nss-config</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pk12util">
        <term><command>pk12util</command></term>
        <listitem>
          <para>
            est un outil pour importer des certificats et des clés depuis des
            fichiers pkcs #12 en NSS ou pour les exporter. Il peut aussi lister
            les certificats et les clés dans de tels fichiers. 
          </para>
          <indexterm zone="nss pk12util">
            <primary sortas="b-pk12util">pk12util</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>

  </sect2>

</sect1>
