<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-adjusting">
  <?dbhtml filename="adjusting.html"?>

  <title>Adjusting the Toolchain</title>

  <para os="a">Maintenant, on modifie le fichier de specs de GCC pour qu'il pointe vers le nouvel éditeur de liens dynamique. 
  Une commande <command>perl</command> s'en charge&nbsp;:</para>

<screen os="c"><userinput>gcc -dumpspecs | \
perl -p -e 's@/tools/lib/ld@/lib/ld@g;' \
     -e 's@\*startfile_prefix_spec:\n@$_/usr/lib/ @g;' &gt; \
     $(dirname $(gcc --print-libgcc-file-name))/specs</userinput></screen>

  <para os="d">C'est une bonne idée d'examiner visuellement le fichier de specs 
  pour vérifier que le changement voulu a bien été effectué en fin de compte.</para>

  <para os="e">Remarquez que <filename class="directory">/lib</filename> est à présent le préfixe de notre nouvel éditeur de 
  liens dynamique.</para>

  <caution>

  <para os="f">Il est impératif à ce moment d'arrêter et de vous assurer que les
  fonctions basiques (compilation et édition des liens) de l'ensemble des
  outils ajusté fonctionnent comme prévu. Pour cela, effectuez une vérification
  d'intégrité&nbsp;:</para>

<screen os="g"><userinput>echo 'main(){}' &gt; dummy.c
gcc dummy.c
readelf -l a.out | grep ': /lib'</userinput></screen>

    <para os="h">Si tout fonctionne correctement, il ne devrait pas y avoir d'erreurs et
  la sortie de la commande sera (avec des différences spécifiques aux plateformes
  dans le nom de l'éditeur de liens)&nbsp;:</para>

<screen os="i"><computeroutput>[Requesting program interpreter: /lib/ld-linux.so.2]</computeroutput></screen>

  <para os="j">Remarquez que <filename class="directory">/lib</filename> est maintenant le
  préfixe de notre nouvel éditeur de liens dynamique.</para>

  <para os="k">Si la sortie n'apparaît pas comme montré ci-dessus ou 
  qu'elle n'apparaît pas du tout, alors quelque chose ne va vraiment pas.
  Enquêtez et retracez les étapes pour savoir d'où vient le problème et comment le
  corriger. La raison la plus probable est que quelque chose s'est mal passé lors
  de la modification du fichier specs ci-dessus. Tout problème devra être résolu
  avant de continuer le processus.</para>

  <para os="l">Une fois que tout fonctionne correctement, nettoyez les fichiers
  de tests&nbsp;:</para>

<screen os="m"><userinput>rm -v dummy.c a.out</userinput></screen>
</caution>

</sect1>

