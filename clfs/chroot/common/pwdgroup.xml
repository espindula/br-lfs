<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-chroot-pwdgroup">
  <?dbhtml filename="pwdgroup.html"?>

  <title>Créer le mot de passe, le groupe et les fichiers journal</title>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/etc/passwd">/etc/passwd</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/etc/group">/etc/group</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/var/run/utmp">/var/run/utmp</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/var/log/btmp">/var/log/btmp</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/var/log/lastlog">/var/log/lastlog</primary>
  </indexterm>

  <indexterm zone="ch-chroot-pwdgroup">
    <primary sortas="e-/var/log/wtmp">/var/log/wtmp</primary>
  </indexterm>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../../boot/common/pwdgroup.xml"
  xpointer="xpointer(//*[@os='a'])"/>
  
  <para>Créez le fichier <filename>/etc/passwd</filename> en lançant la commande suivante&nbsp;:</para>

<screen><userinput>cat &gt; /etc/passwd &lt;&lt; "EOF"
<literal>root:x:&uid-root;:&gid-root;:root:/root:/bin/bash</literal>
EOF</userinput></screen>

  <para os="b">Le mot de passe actuel pour <systemitem class="username">root</systemitem> (le <quote>x</quote> utilisé ici 
  n'est qu'un paramètre fictif) sera réglé plus tard.</para>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../../boot/common/pwdgroup.xml"
  xpointer="xpointer(//*[@os='c'])"/>

  <para>Créez le fichier <filename>/etc/group</filename> en lançant la commande suivante&nbsp;:</para>

<screen><userinput>cat &gt; /etc/group &lt;&lt; "EOF"
<literal>root:x:0:
bin:x:&gid-bin;:
sys:x:&gid-sys;:
kmem:x:&gid-kmem;:
tty:x:&gid-tty;:
tape:x:&gid-tape;:
daemon:x:&gid-daemon;:
floppy:x:&gid-floppy;:
disk:x:&gid-disk;:
lp:x:&gid-lp;:
dialout:x:&gid-dialout;:
audio:x:&gid-audio;:
video:x:&gid-video;:
utmp:x:&gid-utmp;:
usb:x:&gid-usb;:
cdrom:x:&gid-cdrom;:</literal>
EOF</userinput></screen>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../../boot/common/pwdgroup.xml"
  xpointer="xpointer(//*[@os='d'])"/>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../../boot/common/pwdgroup.xml"
  xpointer="xpointer(//*[@os='e'])"/>

  <para>Pour supprimer l'invite <quote>I have no name!</quote> démarrez un nouveau shell. Puisqu'on a installé une Glibc 
  complète dans le <xref linkend="chapter-cross-tools"/> et que les répertoires <filename>/etc/passwd</filename>
  et <filename>/etc/group</filename> ont été créés, la résolution des noms d'utilisateur et de groupe va à présent 
  fonctionner.</para>

<screen role="nodump"><userinput>exec /tools/bin/bash --login +h</userinput></screen>

  <para>Remarquez l'utilisation du paramètre <parameter>+h</parameter>.
  Il dit à <command>bash</command> de ne pas utiliser son hachage interne
  des chemins. Sans ce paramètre, <command>bash</command> se rappelerait des
  chemins vers les binaires qu'il a exécutés. Pour s'assurer que les
  binaires nouvellement compilés seront utilisés dès qu'ils seront installés,
  le paramètre <parameter>+h</parameter> sera utilisée durant toute le
  chapitre suivant.</para>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../../boot/common/pwdgroup.xml"
  xpointer="xpointer(//*[@os='f'])"/>

<screen><userinput>touch /var/run/utmp /var/log/{btmp,lastlog,wtmp}
chgrp -v utmp /var/run/utmp /var/log/lastlog
chmod -v 664 /var/run/utmp /var/log/lastlog
chmod -v 600 /var/log/btmp</userinput></screen>


  <para>Le fichier <filename>/var/run/utmp</filename> enregistre les utilisateurs actuellement connectés. Le fichier
  <filename>/var/log/wtmp</filename> enregistre toutes les connexions et les déconnexions. Le fichier
  <filename>/var/log/lastlog</filename> enregistre le moment où chaque utilisateur s'est connecté pour la dernière fois. Le 
  fichier <filename>/var/log/btmp</filename> enregistre les tentatives de connexion erronnées.</para>

</sect1>
