<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-chroot-kernfs">
  <?dbhtml filename="kernfs.html"?>

  <title>Monter les systèmes de fichiers virtuels du noyau</title>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../../boot/common/devices.xml"
    xpointer="xpointer(//*[@os='a'])"/>

    <para>Différents systèmes de fichiers exportés par le noyau sont
    utilisés pour communiquer avec le noyau. Ces systèmes de fichiers
    sont virtuels par le fait qu'aucun espace disque n'est utilisé pour
    eux. Le contenu de ces systèmes de fichiers réside en
    mémoire.</para>

    <para>Commencez en créant les répertoires dans lesquels les systèmes
    de fichiers seront montés&nbsp;:</para>

<screen><userinput>mkdir -pv ${CLFS}/{dev,proc,sys}</userinput></screen>

  <para>Maintenant, montez les systèmes de fichiers&nbsp;:</para>

<screen><userinput>mount -vt proc proc ${CLFS}/proc
mount -vt sysfs sysfs ${CLFS}/sys</userinput></screen>

  <para>Rappelez-vous que si, pour une quelconque raison, vous vous arrêtez de travailler sur le système CLFS et recommencez 
  plus tard, il est important de vérifier que ces systèmes de fichiers sont à nouveau montés avant d'entrer dans 
  l'environnement chroot.</para>

  <para>Deux n&oelig;uds de périphériques, /dev/console et /dev/null, doivent être présents sur le système de fichiers. 
  Ils sont exigés par le noyau même avant le démarrage d'Eudev très tôt dans le processus d'amorçage, donc nous les créons  
  ici&nbsp;:</para>

<screen><userinput>mknod -m 600 ${CLFS}/dev/console c 5 1
mknod -m 666 ${CLFS}/dev/null c 1 3</userinput></screen>

  <para>Une fois que le système est complet et qu'il démarre, le reste des n&oelig;uds de périphériques sont créés par le 
  paquet Eudev. Comme ce paquet n'est pas disponible pour nous maintenant, nous devons prendre en charge ces étapes pour
  fournir les n&oelig;uds de périphérique sur le système de fichiers CLFS. Nous allons utiliser l'option <quote>bind</quote> 
  dans la commande mount pour faire apparaître la structure du /dev de notre système hôte dans le nouveau système de fichiers 
  CLFS&nbsp;:</para>

<screen><userinput>mount -v -o bind /dev ${CLFS}/dev</userinput></screen>

  <para>Des systèmes de fichiers supplémentaires seront bientôt montés à l'intérieur de l'environnement chroot. Pour 
  maintenir l'hôte à jour, efcectuez un <quote>faux montage</quote> pour chacun d'eux maintenant&nbsp;:</para>

<screen><userinput>if [ -h ${CLFS}/dev/shm ]; then
  link=$(readlink ${CLFS}/dev/shm)
  mkdir -p ${CLFS}/$link
  mount -f -vt tmpfs shm ${CLFS}/$link
  unset link
else
  mount -f -vt tmpfs shm ${CLFS}/dev/shm
fi
mount -f -vt devpts -o gid=&gid-tty;,mode=620 devpts ${CLFS}/dev/pts</userinput></screen>

</sect1>
