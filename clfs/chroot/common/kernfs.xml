<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-chroot-kernfs">
  <?dbhtml filename="kernfs.html"?>

  <title>Monter les systèmes de fichiers virtuels du noyau</title>

    <note os="a">
      <para>Les commandes dans le reste du livre doivent être lancée en tant qu'utilisateur
      <systemitem class="username">root</systemitem>. Vérifiez que 
       ${CLFS} est initialisé dans l'environnement de l'utilisateur
      <systemitem class="username">root</systemitem> avant de continuer.</para>
    </note>

    <para>Différents systèmes de fichiers exportés par le noyau sont
    utilisés pour communiquer avec le noyau. Ces systèmes de fichiers
    sont virtuels par le fait qu'aucun espace disque n'est utilisé pour
    eux. Le contenu de ces systèmes de fichiers réside en
    mémoire.</para>

    <para>Commencez en créant les répertoires dans lesquels les systèmes
    de fichiers seront montés&nbsp;:</para>

<screen><userinput>mkdir -pv ${CLFS}/{dev,proc,run,sys}</userinput></screen>

  <para>Deux n&oelig;uds de périphériques, <filename class="devicefile">/dev/console</filename>
  et <filename class="devicefile">/dev/null</filename>, doivent être présents sur le système de fichiers. 
  Ils sont exigés par le noyau même avant le démarrage d'udev très tôt dans le processus d'amorçage, donc nous les créons  
  ici&nbsp;:</para>

<screen><userinput>mknod -m 600 ${CLFS}/dev/console c 5 1
mknod -m 666 ${CLFS}/dev/null c 1 3</userinput></screen>

  <para>Une fois que le système est complet et qu'il démarre, le reste des n&oelig;uds de périphériques sont créés par le 
  système de fichier <systemitem class="filesystem">devtmpfs</systemitem> du noyau. A partir de maintenant, nous utiliserons l'option 
  <quote>bind</quote> dans la commande mount pour faire que la structure  <filename class="directory">/dev</filename>
  de votre système hôte apparaissent dans le le nouveau système de fichiers 
  CLFS&nbsp;:</para>

<screen><userinput>mount -v -o bind /dev ${CLFS}/dev</userinput></screen>

  <para>Maintenant montez les systèmes de fichiers restant:</para>

<screen><userinput>mount -vt devpts -o gid=&gid-tty;,mode=620 devpts ${CLFS}/dev/pts
mount -vt proc proc ${CLFS}/proc
mount -vt tmpfs tmpfs ${CLFS}/run
mount -vt sysfs sysfs ${CLFS}/sys</userinput></screen>

  <para>Sur quelques systèmes hôte, <filename class="directory">/dev/shm</filename>
  est un lien symbolique vers <filename class="directory">/run/shm</filename>.
  Si c'est le cas, créez un répertoire dans <filename class="directory">/run</filename>:</para>

<screen><userinput>[ -h ${CLFS}/dev/shm ] &amp;&amp; mkdir -pv ${CLFS}/$(readlink ${CLFS}/dev/shm)</useri$

  <para>Rappelez vous que si pour n'importe quelle raison, vous arrêtez de travailler sur le système CLFS
  et que vous redémarrez plus tard, il est important de vérifier que ces fichiers systèmes sont montés de nouveau avant
  d'entrer dans l'environnement chroot.
  </para>

</sect1>
