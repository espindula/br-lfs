<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ch-config-symlinks">
  <?dbhtml filename="symlinks.html"?>

  <title>Création des liens symboliques personnalisés pour les périhphériques</title>

  <sect2>

    <title>Liens symboliques des CD-ROM</title>

    <para>Quelques logiciels que vous pouvez vouloir installer plus tard (par exemple, différents lecteurs
    multimédia) considére que les liens symboliques /dev/cdrom et /dev/dvd existent.
    Aussi, il peut être pratique de placer des références à ses liens symboliques dans 
    <filename>/etc/fstab</filename>. Pour chacun de vos périphériques CD-ROM,
    trouvez le répertoire correspondant sous
    <filename class="directory">/sys</filename> (par exemple, cela peut être 
    <filename class="directory">/sys/block/hdd</filename>) et
    lancez une commande similaire à la suivante :</para>

<screen role="nodump"><userinput>udevadm test /sys/block/hdd</userinput></screen>

    <para>Regardez les lignes contenant la sortie de différents programmes *_id.</para>

    <para>Il y a deux approchas pour la création des liens symboliques. La première est d'utiliser le nome du modèle et le 
    numéro de série, la seconde est basée sur l'emplacement du périphérique sur le bus. Si vous voulez utiliser la première
    approche, créez un fichier similaire au suivant:
    </para>

<screen role="nodump"><userinput>cat &gt;/etc/udev/rules.d/82-cdrom.rules &lt;&lt; EOF
<literal>
# Custom CD-ROM symlinks
SUBSYSTEM=="block", ENV{ID_MODEL}=="SAMSUNG_CD-ROM_SC-148F", \
    ENV{ID_REVISION}=="PS05", SYMLINK+="cdrom"
SUBSYSTEM=="block", ENV{ID_MODEL}=="PHILIPS_CDD5301", \
    ENV{ID_SERIAL}=="5VO1306DM00190", SYMLINK+="cdrom1 dvd"
</literal>
EOF</userinput></screen>

    <note>
      <para>Normalement les exemples de ce livre fonctionne correctement, faite attention que 
      Udev ne reconaise par l'antislash de continuation de ligne.
      Si vous modifiez les rêgles Udev avec un éditeur, soyez certain de laisser chaque rêgle
      sur une seule ligne physique.
      </para>
    </note>

    <para>De cette façon, le lien symbolique restera correct même si vous déplacez le périphériuqe
    sur une autre position du bus IDE, mais le lien symbolique
    <filename>/dev/cdrom</filename> ne sera pas créé si vous remplacer l'ancien CD-ROM SAMSUNG par un
    nouveau lecteur.</para>
<!-- The symlinks in the first approach survive even the transition
     to libata for IDE drives, but that is not for the book. -->

    <para>La clé SUBSYSTEM==&quot;block&quot; est nécéssaire pour éviter la correspondance avec les périphériques
    SCSI générique. Sans cela, dans le cas des CD-ROM SCSI, le lien symbolique pointera parfois sur le bon périphérique
    <filename>/dev/srX</filename>, et parfois sur <filename>/dev/sgX</filename>, ce qui est mauvais.</para>

    <para>La seconde approche donne:</para>

<screen role="nodump"><userinput>cat &gt;/etc/udev/rules.d/82-cdrom.rules &lt;&lt; EOF
<literal>
# Custom CD-ROM symlinks
SUBSYSTEM=="block", ENV{ID_TYPE}=="cd", \
    ENV{ID_PATH}=="pci-0000:00:07.1-ide-0:1", SYMLINK+="cdrom"
SUBSYSTEM=="block", ENV{ID_TYPE}=="cd", \
    ENV{ID_PATH}=="pci-0000:00:07.1-ide-1:1", SYMLINK+="cdrom1 dvd"
</literal>
EOF</userinput></screen>

    <para>De cette façon, les liens symboliques resteront correct même si vous remplacer les lecteurs par 
    différents modèles, mais en les plaçant à la même position sur le bus IDE?
    La clé ENV{ID_TYPE}==&quot;cd&quot; fait qu'il est certain que le lien symbolique disparaîtra si vous placez autres
    chose qu'un CD-ROM à cette position du bus
    .</para>

    <para>bien sur, il est possible de mixer les deux approches.</para>

  </sect2>

  <sect2>

    <title>traîter les périphériques dupliqués</title>

    <para>Comme expliqué dans <xref linkend="ch-config-udev"/>, l'ordre dans lequel les périphériques ayant la même
    fonction apparaîssent dans 
    <filename class="directory">/dev</filename> est principalement aléatoire.
    Par exemple, si vous avez une caméra web UST et un tunner TV, parfois
    <filename>/dev/video0</filename> pointera vers la caméra et
    <filename>/dev/video1</filename> pointera vers le tunner, et parfois après un redémarrage l'ordre changera pour être
    opposé. Pour toutes les classes de matériel saus les cartes sons et les cartes réseaux, c'est corrigeable en créant
    des rêgles udev pour des liens symboliques persistants. Le cas des cartes réseaux est couvert séparément dans
    <xref linkend="chapter-network"/>, et la configuration des cartes sons peut être trouvées dans 
    <ulink url="&cblfs-root;">CBLFS</ulink>.</para>

    <para>Pour chacun de vos périphériques qui peut avoir ce problème
    (même si le problème n'existe pas dans votre distribution Linux actuelle), trouver le répertoire
     correspondant sous
    <filename class="directory">/sys/class</filename> ou
    <filename class="directory">/sys/block</filename>.
    Pour les périphériques vidéo, cela peut être
    <filename
    class="directory">/sys/class/video4linux/video<replaceable>X</replaceable></filename>.
    Mettez en évidence les attributs qui identifient le périphériques de façon unique (souvent,
    le vendeur et l'identifiant du produit et/ou le numéro de série fonctionne):</para>

<screen role="nodump"><userinput>udevadm info -a -p /sys/class/video4linux/video0</userinput></screen>

    <para>Ensuite écrivez les rêgles qui crée les liens symboliques, par exemple:</para>

<screen role="nodump"><userinput>cat &gt;/etc/udev/rules.d/83-duplicate_devs.rules &lt;&lt; EOF
<literal>
# Persistent symlinks for webcam and tuner
KERNEL=="video*", SYSFS{idProduct}=="1910", SYSFS{idVendor}=="0d81", \
    SYMLINK+="webcam"
KERNEL=="video*", SYSFS{device}=="0x036f", SYSFS{vendor}=="0x109e", \
    SYMLINK+="tvtuner"
</literal>
EOF</userinput></screen>

    <para>Le résultat est que les périphériques <filename>/dev/video0</filename> et
    <filename>/dev/video1</filename> resteront pointés aléatoirement vers le tunner ou la caméra web (et donc ne pourront
    jamais être utilisé directement), mais il y a les liens symboliques
    <filename>/dev/tvtuner</filename> et
    <filename>/dev/webcam</filename> qui pointeront toujours vers les bons périphériques.</para>

 </sect2>

</sect1>
