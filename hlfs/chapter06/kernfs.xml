<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-kernfs">
  <?dbhtml filename="kernfs.html"?>

  <title>Préparer les systèmes de fichiers virtuels du noyau</title>

  <indexterm zone="ch-system-kernfs">
    <primary sortas="e-/dev/">/dev/*</primary>
  </indexterm>

    <para>Différents systèmes de fichiers exportés par le noyau sont utilisés pour
        communiquer avec le noyau lui-même. Ces systèmes de fichiers sont virtuels
        du fait qu'aucun espace disque n'est utilisé pour eux. Le contenu de ces
        systèmes de fichiers réside en mémoire.</para>

    <para>Commencez en créant les répertoires dans lesquels les systèmes
		de fichiers seront montés&nbsp;:</para>

<screen><userinput>install -vd $HLFS/{dev,proc,sys}</userinput></screen>

  <sect2>
    <title>Création des noeuds initiaux vers les périphériques</title>

    <para>Quand le noyau démarre le système, il a besoin de la présence
		de quelques noeuds de périphériques, en particulier les périphériques
		<filename class="devicefile">console</filename> et
		<filename class="devicefile">null</filename>. Les noeuds de
		périphériques vont être créés sur le disque dur afin d'être
		disponible avant que <command>udevd</command> n'ait été démarré et
		aussi quand Linux est démarré avec
		<parameter>init=/bin/bash</parameter>. Créez les périphériques en
		exécutant les commandes suivantes&nbsp;:</para>

<screen><userinput>mknod -m 600 $HLFS/dev/console c 5 1
mknod -m 666 $HLFS/dev/null c 1 3</userinput></screen>

  </sect2>

  <sect2 id="ch-system-bindmount">
    <title>Monter et peupler /dev</title>

      <para>La méthode recommandée pour peupler le répertoire
			<filename class="directory">/dev</filename> de périphériques est de
			monter un système de fichiers virtuel (comme
			<systemitem class="filesystem">tmpfs</systemitem>) sur le répertoire
			<filename class="directory">/dev</filename> et d'autoriser la
			création dynamique des périphériques sur le système de fichiers virtuel
			une fois qu'ils sont détectés ou que quelque chose tente d'y accéder.
			Ceci est fait généralement lors du démarrage. Comme ce nouveau système
			n'a pas encore été démarré, il est nécessaire de
			monter et de peupler <filename class="directory">/dev</filename> 
			manuellement. Cela se fait en montant en double le répertoire
		  <filename class="directory">/dev</filename>
      du système hôte. Le montage en double est un type spécial de montage qui 
			vous permet de créer le miroir d'un répertoire ou d'un point de montage à
			un autre endroit. Utilisez la commande suivante pour réaliser cela&nbsp;:</para>

<screen><userinput>mount -v --bind /dev $HLFS/dev</userinput></screen>

  </sect2>

  <sect2 id="ch-system-kernfsmount">
    <title>Monter les systèmes de fichiers virtuels du noyau</title>

      <para>Maintenant montez les systèmes de fichiers virtuels du noyau
			qui restent&nbsp;:</para>

<screen><userinput>mount -vt devpts -o mode=620 devpts $HLFS/dev/pts
mount -vt tmpfs shm $HLFS/dev/shm
mount -vt proc proc $HLFS/proc
mount -vt sysfs sysfs $HLFS/sys</userinput></screen>

      <para>Si vous êtes sur un système HLFS existant avec toutes les options
			Grsecurity activées, vous devrez en désactiver certaines pour compiler le
			système dans ce chapitre. Si vous avez compilé un noyau avec le support
			sysctl dans Grsecurity, utilisez ces commandes&nbsp;:</para>

<screen><userinput>sysctl -w kernel.grsecurity.chroot_caps=0
sysctl -w kernel.grsecurity.chroot_deny_mknod=0
sysctl -w kernel.grsecurity.chroot_deny_chmod=0
sysctl -w kernel.grsecurity.chroot_deny_mount=0</userinput></screen>

  </sect2>

</sect1>
