<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-pwdgroup">
  <?dbhtml filename="pwdgroup.html"?>

  <title>Créer des fichiers passwd, group et les journaux de trace</title>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/etc/passwd">/etc/passwd</primary>
  </indexterm>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/etc/group">/etc/group</primary>
  </indexterm>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/var/run/utmp">/var/run/utmp</primary>
  </indexterm>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/var/log/btmp">/var/log/btmp</primary>
  </indexterm>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/var/log/lastlog">/var/log/lastlog</primary>
  </indexterm>

  <indexterm zone="ch-system-pwdgroup">
    <primary sortas="e-/var/log/wtmp">/var/log/wtmp</primary>
  </indexterm>
	
	<para>Pour que l'utilisateur <emphasis>root</emphasis> puisse se connecter et que le nom
	<quote>root</quote> soit reconnu, il doit exister des entrées adéquates dans 
	les fichiers <filename>/etc/passwd</filename> et
  <filename>/etc/group</filename>.</para>

  <para>L'utilisateur <emphasis>nobody</emphasis> est aussi ajouté afin qu'il
	puisse être utilisé par les suites de test qui préfère se lancer en tant 
	qu'utilisateur non privilégié et afin de pouvoir être utilisé plus tard pour
  certains démons.</para>

  <para>Créez le fichier <filename>/etc/passwd</filename> en lançant les
  commandes suivantes&nbsp;:</para>

<screen><userinput>cat &gt; /etc/passwd &lt;&lt; "EOF"
<literal>root:x:0:0:root:/root:/bin/bash
nobody:x:99:99:Unprivileged User:/nonexistent:/sbin/nologin</literal>
EOF</userinput></screen>

  <para>Le mot de passe pour <emphasis>root</emphasis> (le caractère
	<quote>x</quote> ici est seulement pour conserver l'emplacement) sera
	initialisé plus tard.</para>

  <para>Créez le fichier <filename>/etc/group</filename> en lançant les
  commandes suivantes&nbsp;:</para>

<screen><userinput>cat &gt; /etc/group &lt;&lt; "EOF"
<literal>root:x:0:
bin:x:1:
sys:x:2:
kmem:x:3:
tty:x:4:
tape:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
usb:x:14:
cdrom:x:15:
mail:x:34:
nobody:x:99:</literal>
EOF</userinput></screen>

  <para>Les groupes créés ne font pas partie d'un standard&nbsp;: ils ont été
	choisis suite à certains pré-requis de la configuration d'Udev effectuée dans la 
	prochaine section. Pour des informations sur l'ajout de plus de groupe, reportez-vous
	à la Linux Standard Base (LSB, disponible sur
	<ulink url="http://www.linuxbase.org"/>)</para>

  <para>Pour supprimer l'invite <quote>I have no name!</quote>, démarrez un
	nouveau shell. Comme un Glibc complet a été installé dans le
  <xref linkend="chapter-temporary-tools"/> et que les fichiers
  <filename>/etc/passwd</filename> et <filename>/etc/group</filename>
	ont été créés, la résolution des noms d'utilisateur et des noms de groupe 
	devrait fonctionner.</para>

<screen role="nodump"><userinput>exec /tools/bin/bash --login +h</userinput></screen>

  <para>Remarquez l'utilisation de la directive <parameter>+h</parameter>. Ceci
	indique à <command>bash</command> de ne pas utiliser son hachage interne des
	chemins. Sans cette directive, <command>bash</command> se rappelerait le
	chemin vers les binaires qu'il a exécuté. Pour utiliser les binaires dès leur
	installation, l'option <parameter>+h</parameter> sera utilisée pour toute la
	durée de ce chapitre.</para>

  <para>Un système Linux correct maintient une liste des systèmes de fichiers
	montés dans le fichier 
        <filename>/etc/mtab</filename>. Ce fichier est normalement 
	créé lorsqu'on monte un nouveau système de fichiers. Comme on ne montera aucun
  système de fichiers à l'intérieur de notre environnement chroot, créez un
	fichier vide pour pour les outils qui s'attendent à la présence de
	<filename>/etc/mtab</filename>:</para>

<screen><userinput>touch /etc/mtab</userinput></screen>

  <para>Les programmes <command>login</command>, <command>agetty</command> et
	<command>init</command> (ainsi que d'autres) utilisent un certain nombre de
	journaux pour enregistrer les informations comme les personnes connectées au
	système et leur date d'entrée. Néanmoins, ces programmes n'écrivent pas les
	journaux de trace s'ils n'existent pas déjà. Initialisez les journaux et
	donnez-leur les bons droits&nbsp;:</para>

<screen><userinput>touch /var/run/utmp /var/log/{btmp,lastlog,wtmp}
chgrp -v utmp /var/run/utmp /var/log/lastlog
chmod -v 664 /var/run/utmp /var/log/lastlog</userinput></screen>

  <para>Le fichier <filename>/var/run/utmp</filename> enregistre les 
	utilisateurs actuellement connectés. Le fichier
	<filename>/var/log/wtmp</filename> enregistre toutes les connexions et 
	déconnexions. Le fichier <filename>/var/log/lastlog</filename> enregistre pour
	chaque utilisateur quand il ou elle s'est déjà connecté. Le fichier 
  <filename>/var/log/btmp</filename> enregistre les tentatives échouées de connexion.</para>

</sect1>

