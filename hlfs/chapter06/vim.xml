<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-vim" role="wrap">
  <?dbhtml filename="vim.html"?>

  <title>Vim-&vim-version;</title>

  <indexterm zone="ch-system-vim">
    <primary sortas="a-Vim">Vim</primary>
  </indexterm>

  <sect2 role="package">
    <title/>

    <para>Le paquet Vim contient un puissant éditeur de texte.</para>

    <tip>
      <title>Alternatives à  Vim</title>

      <para>Si vous préférez un autre éditeur&mdash;comme Emacs, Joe, ou
      Nano&mdash;merci de vous
      référer à <ulink url="&blfs-root;view/svn/postlfs/editors.html"/> pour
      des instructions d'installation.</para>
    </tip>

    <para>Notes utilisateur&nbsp;: <ulink url="&hlfs-wiki;/vim"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Vim</title>

    <para>Corrigez Vim avec plusieurs correctifs issus des développeurs 
    en amont depuis la version initiale de Vim-&vim-version;&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../&vim-fixes-patch;</userinput></screen>

    <para role="hardened_tmp">Le correctif suivant modifie Vim pour utiliser
    exclusivement mkstemp(3) et <command>mktemp</command>(1)&nbsp;:</para>

<screen role="hardened_tmp"><userinput>patch -Np1 -i ../&vim-hardened_tmp-patch;</userinput></screen>

    <para>Par défaut, Vim utilise les droits du fichier d'origine pour le fichier
    d'échange Vim, sauf le droit d'écriture et d'exécution pour le groupe et
    les autres. Si vous voulez des droits plus stricts, lq commande suivante
    va supprimer ce comportement pour que les droits 0600 soient utilisés avec
    les fichiers d'échange afin qu'ils ne soient lisibles que par leur 
    propriétaire&nbsp;:</para>

<screen><userinput>sed -e 's/(st.st_mode &amp; 0644) | //' -i.orig src/fileio.c</userinput></screen>

    <para>Une des fonctions de Vim est conçue pour déborder la mémoire
    volontairement car la longueur est inconnue. SSP et _FORTIFY_SOURCE ne permettront pas à 
    cette fonction de marcher. Il y a une discussion sur une liste de diffusion
    à ce sujet ici&nbsp;:
    <ulink url="http://www.mail-archive.com/vim-dev%40vim.org/msg03320.html"/>.
    La commande suivante augmente la taille du tableau de 1 à 10, ce qui
    devrait être suffisant&nbsp;:</para>

<screen><userinput>sed 's/di_key\[1\]/di_key\[10\]/' -i.orig src/structs.h</userinput></screen>

    <para>Enfin, modifiez l'emplacement par défaut du fichier de
    configuration <filename>vimrc</filename> en 
    <filename class="directory">/etc</filename>&nbsp;:</para>

<screen><userinput>echo '#define SYS_VIMRC_FILE "/etc/vimrc"' &gt;&gt; src/feature.h</userinput></screen>

    <para>Maintenant, préparez la compilation de Vim&nbsp;:</para>

<screen><userinput>./configure --prefix=/usr --enable-multibyte</userinput></screen>

    <variablelist>
      <title>Voici la signification de l'option de configure&nbsp;:</title>

      <varlistentry>
        <term><parameter>--enable-multibyte</parameter></term>
        <listitem>
        <para>Ce commutateur inclut le
        support pour l'édition de fichiers comprenant des codages de caractères
        multioctets. Ceci est nécessaire dans le cas de l'utilisation d'une
        locale avec un ensemble de caractères multi-octets. Ce commutateur peut aussi
        être utile pour avoir la capacité d'éditer des fichiers créés initialement avec
        des distributions Linux comme Fedora Core qui utilise UTF-8 comme ensemble de
        caractères par défaut.</para>
        </listitem>
      </varlistentry>

    </variablelist>

    <para>Compilez le paquet&nbsp;:</para>

<screen><userinput>make</userinput></screen>

    <para>Pour tester les résultats, lancez&nbsp;:
    <userinput>make test</userinput>. Néanmoins, cette suite de tests affiche à  
    l'écran beaucoup de caractères binaires qui peuvent causer
    des soucis sur votre terminal. Ceci peut se résoudre en redirigeant
    la sortie vers un journal de traces.</para>

    <para>Installez le paquet&nbsp;:</para>

<screen><userinput>make install</userinput></screen>

    <para>Déplacez <command>vim</command> vers <filename class="directory">/bin</filename>
    pour qu'il soit disponible si <filename class="directory">/usr</filename>
    n'est pas monté.</para>

<screen><userinput>mv -v /usr/bin/vim /bin
ln -vs /bin/vim /usr/bin/vim</userinput></screen>

    <para>Dans les locales UTF-8, le programme <command>vimtutor</command> 
    essaie de convertir les tutoriels de l'ISO-8859-1 à l'UTF-8. Comme certains
    tutoriels ne sont pas en ISO-8859-1, le texte qu'ils contiennent est rendu
    rendu illisible. Si vous avez déballé l'archive 
    <filename>vim-&vim-version;-lang.tar.gz</filename> et que vous allez
    utiliser la locale basée sur UTF-8, supprimez les tutoriels non ISO-8859-1.
    Le tutoriel anglais sera utilisé à la place.</para>
    <!-- Removal is used instead of conversion in order for the user to be able to
    painlessly revert his UTF-8 locale choice. -->

<screen><userinput>rm -f /usr/share/vim/vim70/tutor/tutor.{gr,pl,ru,sk}
rm -f /usr/share/vim/vim70/tutor/tutor.??.*</userinput></screen>

    <para>Beaucoup d'utilisateurs sont habitués à utiliser
    <command>vi</command> au lieu de <command>vim</command>. Pour
    permettre l'exécution de <command>vim</command> quand les
    utilisateurs saisissent habituellement <command>vi</command>, créez
    un lien symbolique vers les binaires et vers les pages de man
    dans les langues fournies. Certains paquets cherchent explicitement
    <filename>/usr/bin/vi</filename> (comme visudo), donc on fait aussi un
    lien symbolique&nbsp;:</para>

<screen><userinput>ln -sv vim /usr/bin/vi
ln -vs vim /bin/vi
for L in "" fr it pl; do
    ln -sv vim.1 /usr/share/man/$L/man1/vi.1
done</userinput></screen>

    <para>Par défaut, la documentation de Vim est installée dans
    <filename class="directory">/usr/share/vim</filename>. Le lien
    symbolique suivant permet l'accès à la documentation via <filename
    class="directory">/usr/share/doc/vim-&vim-version;</filename>, le
    rendant cohérent avec l'emplacement de la documentation d'autres
    paquets&nbsp;:</para>

<screen><userinput>ln -vs ../vim/vim71/doc /usr/share/doc/vim-&vim-version;</userinput></screen>

    <para>Si un système X Window va être installé sur votre système LFS,
    il pourrait être nécessaire de recompiler Vim après avoir installé
    X. Vim fournit alors une jolie version GUI de l'éditeur qui requiert
    X et quelques autres bibliothèques pour s'installer. Pour plus
    d'informations sur ce processus, référez-vous à la documentation de
    Vim et à la page d'installation de Vim dans le livre BLFS sur
    <ulink url="&blfs-root;view/svn/postlfs/editors.html#postlfs-editors-vim"/>.</para>

  </sect2>

  <sect2 id="conf-vim" role="configuration">
    <title>Configuration de Vim</title>

    <indexterm zone="conf-vim">
      <primary sortas="e-/etc/vimrc">/etc/vimrc</primary>
    </indexterm>

    <para>Par défaut, <command>vim</command> est lancé en mode
    compatible vi. Ceci pourrait être nouveau pour les personnes qui ont
    utilisé d'autres éditeurs dans le passé. Le paramètre
    <quote>nocompatible</quote> est inclus ci-dessous pour surligner le
    fait qu'un nouveau comportement est en cours d'utilisation. Il
    rappelle aussi à ceux qui voudraient le changer en mode
    <quote>compatible</quote> qu'il devrait être le premier paramètre
    dans le fichier de configuration. Ceci est nécessaire car il modifie
    d'autres paramètres et la surcharge doit survenir après ce
    paramètre. Créez un fichier de configuration <command>vim</command>
    par défaut en lançant ce qui suit&nbsp;:</para>

<screen><userinput>cat &gt; /etc/vimrc &lt;&lt; "EOF"
<literal>" Begin /etc/vimrc

set nocompatible
set backspace=2
if (isdirectory("/usr/share/vim"))
  syntax on
endif
if (&amp;term == "iterm") || (&amp;term == "putty")
  set background=dark
endif

" End /etc/vimrc</literal>
EOF</userinput></screen>

    <para>L'option <parameter>set nocompatible</parameter> change le
    comportement de <command>vim</command> d'une façon plus utile que le
    comportement compatible vi. Supprimez <quote>no</quote> pour
    conserver le comportement de l'ancien <command>vi</command>. Le
    paramètre <parameter>set backspace=2</parameter> permet le retour en
    arrière après des sauts de ligne, l'indentation automatique et le
    début de l'insertion. L'instruction <parameter>syntax on</parameter>
    active la coloration syntaxique. Enfin, l'instruction
    <emphasis>if</emphasis> avec <parameter>set
    background=dark</parameter> corrige l'estimation de
    <command>vim</command> concernant la couleur du fond de certains
    émulateurs de terminaux. Ceci permet d'utiliser de meilleurs gammes
    de couleurs pour la coloration syntaxique, notamment avec les fonds
    noirs de ces programmes.</para>

    <para>Le pqramètre <parameter>set dir=</parameter> dit à  Vim où mettre les
    fichiers d'échange. Par défaut; ces fichiers sont dans le même répertoire 
    que le fichier en cours d'édition, si on peut écrire dedans, puis
    <envar>$HOME</envar>/tmp s'il existe, puis
    <filename class="directory">/var/tmp</filename>. Cela peut aboutir à 
    beacoup de clutters sur le système de fichiers. Il se peut que vous vouliez
    initialiser cela à un répertoire dédié co,,e
    <parameter>set dir=/var/cache/vim</parameter> avec des droits 1777, ou
    <parameter>set dir=~/.vim_tmp</parameter>, dans le fichier de
    configuration global <filename>/etc/vimrc</filename>. Ce répertoire doit 
    exister à l'avance parce que Vim ne le créera pas.</para>

    <para>La documentation des autres options disponibles peut être
    obtenue en lançant la commande suivante&nbsp;:</para>

<screen role="nodump"><userinput>vim -c ':options'</userinput></screen>

    <note>
      <para>Par défaut, Vim installe des fichiers dictionnaire pour 
      l'anglais. Pour installer des fichiers dictionnaires pour votre langue,
      téléchargez les fichiers <filename>*.spl</filename> et, éventuellement,
      <filename>*.sug</filename> pour votre langue et votre encodage sur
      <ulink url="ftp://ftp.vim.org/pub/vim/runtime/spell/"/> et enregistrez-les
      dans <filename class='directory'>/usr/share/vim/vim70/spell/</filename>.</para>

      <para>Pour utiliser ces fichiers dictionnaire, il faut une configuration
      dans <filename>/etc/vimrc</filename>,comme&nbsp;:</para>

<screen><literal>set spelllang=en,ru
set spell</literal></screen>

      <para>Pour plus d'informations, voir le fichier README approprié situé 
      sur la page ci-dessus.</para>
    </note>

  </sect2>

  <sect2 id="contents-vim" role="content">
    <title>Contenu de Vim</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>

      <seglistitem>
        <seg>efm_filter.pl, efm_perl.pl, ex (link to vim), less.sh, mve.awk,
        pltags.pl, ref, rview (lien vers vim), rvim (lien vers vim), shtags.pl,
        tcltags, vi (lien vers vim), view (lien vers vim), vim, vim132, vim2html.pl,
        vimdiff (lien vers vim), vimm, vimspell.sh, vimtutor et xxd</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="efm_filter.pl">
        <term><command>efm_filter.pl</command></term>
        <listitem>
          <para>Un filtre pour créer un fichier d'erreur pouvant être lu par
          <command>vim</command></para>
          <indexterm zone="ch-system-vim efm_filter.pl">
            <primary sortas="b-efm_filter.pl">efm_filter.pl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="efm_perl.pl">
        <term><command>efm_perl.pl</command></term>
        <listitem>
          <para>Reformate les messages d'erreur de l'interpréteur Perl pour 
          utiliser le mode <quote>quickfix</quote> de <command>vim</command></para>
          <indexterm zone="ch-system-vim efm_perl.pl">
            <primary sortas="b-efm_perl.pl">efm_perl.pl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="ex">
        <term><command>ex</command></term>
        <listitem>
          <para>Lance <command>vim</command> en mode ex</para>
          <indexterm zone="ch-system-vim ex">
            <primary sortas="b-ex">ex</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="less.sh">
        <term><command>less.sh</command></term>
        <listitem>
          <para>Un script qui exécute <command>vim</command> avec less.vim</para>
          <indexterm zone="ch-system-vim less.sh">
            <primary sortas="b-less.sh">less.sh</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mve.awk">
        <term><command>mve.awk</command></term>
        <listitem>
          <para>Traite les erreurs de <command>vim</command></para>
          <indexterm zone="ch-system-vim mve.awk">
            <primary sortas="b-mve.awk">mve.awk</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pltags.pl">
        <term><command>pltags.pl</command></term>
        <listitem>
          <para>Crée un fichier de balises pour le code Perl, utilisé par
          <command>vim</command></para>
          <indexterm zone="ch-system-vim pltags.pl">
            <primary sortas="b-pltags.pl">pltags.pl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="ref">
        <term><command>ref</command></term>
        <listitem>
          <para>Vérifie la validité des arguments</para>
          <indexterm zone="ch-system-vim ref">
            <primary sortas="b-ref">ref</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rview">
        <term><command>rview</command></term>
        <listitem>
          <para>Une version restreinte de <command>view</command>&nbsp;: aucune commande
          shell ne peut être lancée et <command>view</command> ne peut pas être
          suspendu</para>
          <indexterm zone="ch-system-vim rview">
            <primary sortas="b-rview">rview</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rvim">
        <term><command>rvim</command></term>
        <listitem>
          <para>Une version restreinte de <command>vim</command>&nbsp;: aucune commande
          shell ne peut être lancée et <command>vim</command> ne peut pas être suspendu</para>
          <indexterm zone="ch-system-vim rvim">
            <primary sortas="b-rvim">rvim</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="shtags.pl">
        <term><command>shtags.pl</command></term>
        <listitem>
          <para>Génère un fichier de balises pour les scripts Perl</para>
          <indexterm zone="ch-system-vim shtags.pl">
            <primary sortas="b-shtags.pl">shtags.pl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="tcltags">
        <term><command>tcltags</command></term>
        <listitem>
          <para>Génère un fichier de balises pour du code TCLTCL</para>
          <indexterm zone="ch-system-vim tcltags">
            <primary sortas="b-tcltags">tcltags</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="view">
        <term><command>view</command></term>
        <listitem>
          <para>Démarre <command>vim</command> en mode lecture seule</para>
          <indexterm zone="ch-system-vim view">
            <primary sortas="b-view">view</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vi">
        <term><command>vi</command></term>
        <listitem>
          <para>Lien vers <command>vim</command></para>
          <indexterm zone="ch-system-vim vi">
            <primary sortas="b-vi">vi</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vim">
        <term><command>vim</command></term>
        <listitem>
          <para>L'éditeur</para>
          <indexterm zone="ch-system-vim vim">
            <primary sortas="b-vim">vim</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vim132">
        <term><command>vim132</command></term>
        <listitem>
          <para>Démarre <command>vim</command> avec le terminal en mode 132 
          colonnes</para>
          <indexterm zone="ch-system-vim vim132">
            <primary sortas="b-vim132">vim132</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vim2html.pl">
        <term><command>vim2html.pl</command></term>
        <listitem>
          <para>Convertit la documentation de Vim en HTML 
          (<foreignphrase>HypterText Markup Language</foreignphrase>)</para>
          <indexterm zone="ch-system-vim vim2html.pl">
            <primary sortas="b-vim2html.pl">vim2html.pl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vimdiff">
        <term><command>vimdiff</command></term>
        <listitem>
          <para>Édite deux ou trois versions d'un fichier avec <command>vim</command> et
          montre les différences</para>
          <indexterm zone="ch-system-vim vimdiff">
            <primary sortas="b-vimdiff">vimdiff</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vimm">
        <term><command>vimm</command></term>
        <listitem>
          <para>Active le modèle d'entrée DEC sur un terminal distant</para>
          <indexterm zone="ch-system-vim vimm">
            <primary sortas="b-vimm">vimm</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vimspell.sh">
        <term><command>vimspell.sh</command></term>
        <listitem>
          <para>Un script qui vérifie un fichier et génère les instructions de syntaxe et
          requiert l'ancienne commande Unix <command>spell</command>, qui n'est
          fournie ni par LFS ni par BLFS</para>
          <indexterm zone="ch-system-vim vimspell.sh">
            <primary sortas="b-vimspell.sh">vimspell.sh</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vimtutor">
        <term><command>vimtutor</command></term>
        <listitem>
          <para>Vous apprend les touches et les commandes basiques de
          <command>vim</command></para>
          <indexterm zone="ch-system-vim vimtutor">
            <primary sortas="b-vimtutor">vimtutor</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="xxd">
        <term><command>xxd</command></term>
        <listitem>
          <para>Fait un affichage hexa du fichier donné. Il peut aussi faire 
              l'inverse, il peut être utilisé pour faire des correctifs de
              binaires</para>
          <indexterm zone="ch-system-vim xxd">
            <primary sortas="b-xxd">xxd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
