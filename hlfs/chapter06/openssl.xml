<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-openssl" role="wrap">
  <?dbhtml filename="openssl.html"?>

  <title>OpenSSL-&openssl-version;</title>

  <indexterm zone="ch-system-openssl">
    <primary sortas="a-OpenSSL">OpenSSL</primary>
  </indexterm>

  <sect2 role="package">
    <title/>

    <para>Le paquet OpenSSL contient des outils de gestion et des bibliothèques
    touchant la cryptographie.</para>

    <para>Notes utilisateur&nbsp;: <ulink url="&hlfs-wiki;/openssl"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de OpenSSL</title>

    <para>Appliquez ce correctif pour corriger des conflits entre les pages 
		de man d'OpenSSL et les pages de manuel d'autres paquets&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../&openssl-fix_manpages-patch;</userinput></screen>

    <para role="misc">Les outils en ligne de commande d'OpenSSL vont essayer
		d'utiliser les fichiers <envar>$RANDFILE</envar>,
		<envar>$HOME</envar><filename>/.rnd</filename>, ou
    <envar>$(pwd)</envar><filename>/.rnd files</filename> pour asseoir au début
    leur générateur de nombres aléatoires. Si aucun n'est trouvé, alors il se
		peut que le message d'erreur <quote>PRNG not seeded</quote> apparaisse.
		Nous pouvons compiler OpenSSL avec un plan en cas d'imprévu pour utiliser
    <filename class="devicefile">/dev/urandom</filename> au lieu d'afficher
    un message d'erreur. Voir
		<ulink url="http://www.openssl.org/support/faq.cgi#USER1"/> pour plus
		de détails. La commande suivante est facultative&nbsp;:</para>

<screen role="misc"><userinput>sed -e 's/__OpenBSD__/__linux__/' -e 's/arandom/urandom/' \
    -i.orig crypto/rand/randfile.c</userinput></screen>

    <para condition="glibc">Utilisez la fonction issetugid() avec laquelle 
		nous avons corrigé Glibc&nbsp;:</para>

<screen condition="glibc"><userinput>sed 's/__OpenBSD__/__linux__/' -i.orig crypto/uid.c</userinput></screen>

    <para>Éventuellement, utilisez arc4random() au lieu de 
		<filename class="devicefile">/dev/urandom</filename>, pour l'entropie
		dans la bibliothèque OpenSSL. arc4random() est plus fiable que 
		<filename class="devicefile">/dev/urandom</filename>, comme à partir d'un
		chroot, au risque d'être moins aléatoire (comme à partir d'un chroot). Si
		vous êtes profondément paranoïaque, vous ne devriez pas entrer la commande
    suivante&nbsp;:</para>

<screen><userinput>sed 's/__OpenBSD__/__linux__/' -i.orig crypto/rand/rand_unix.c</userinput></screen>

    <para>Le programme assembleur <command>as</command> marquera de manière
		incorrecte <filename class="libraryfile">libcrypto.so</filename> comme 
		ayant besoin d'une pile exécutable, si OpenSSL est compilé avec son code 
    assemblée. La commande suivante ajoute une option d'assembleur pour marquer
		la bibliothèque correctement&nbsp;:</para>

<screen><userinput>find crypto/ -name Makefile -exec \
    sed 's/^ASFLAGS=/&amp;-Wa,--noexecstack /' -i.orig {} \;</userinput></screen>

    <para>Il se peut que vous souhaitiez ajouter des définitions
		<option>-D</option> supplémentaires comme NO_IDEA, NO_RC4 et NO_RC2 pour désactiver des
    algorithmes faibles, REF_CHECK pour ajouter des déclarations, CRYPTO_MDEBUG
		et MFUNC pour ajouter du code de contrôle de mémoire supplémentaire. 
		Préparez la compilation d'OpenSSL&nbsp;:</para>

<screen><userinput>./config --openssldir=/etc/ssl --prefix=/usr shared zlib-dynamic \
    -DSSL_FORBID_ENULL</userinput></screen>

    <variablelist>
      <title>Voici la signification des options de configure&nbsp;:</title>

      <varlistentry>
        <term><parameter>--openssldir=/etc/ssl</parameter></term>
        <listitem>
          <para>Cette option dit à OpenSSL d'installer et d'utiliser les 
          fichiers de configuration de
          <filename class="directory">/etc/ssl</filename>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><parameter>shared</parameter></term>
        <listitem>
          <para>Cette option dit à OpenSSL de compiler les bibliothèques
          partagées d'OpenSSL.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><parameter>zlib-dynamic</parameter></term>
        <listitem>
          <para>Cette option dit à OpenSSL d'utiliser la bibliothèque partagée
					Zlib plutôt que la version statique.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><parameter>-DSSL_FORBID_ENULL</parameter></term>
        <listitem>
          <para>Cette option va interdire d'utiliser l'algorithme de chiffrement NULL.</para>
        </listitem>
      </varlistentry>

    </variablelist>

    <para>Compilez le package&nbsp;:</para>

<screen><userinput>make MANDIR=/usr/share/man</userinput></screen>

    <para>Pour tester les résultats&nbsp;:
    <userinput>make test</userinput>.</para>

    <para>Installez le paquet&nbsp;:</para>

<screen><userinput>make MANDIR=/usr/share/man install
cp -v -r certs /etc/ssl</userinput></screen>

    <para>Installez la documentation&nbsp;:</para>

<screen><userinput>install -v -d -m755 /usr/share/doc/openssl-&openssl-version;
cp -v -r doc/{HOWTO,README,*.{txt,html,gif}} \
    /usr/share/doc/openssl-&openssl-version;</userinput></screen>

    <para>Déplacez les bibliothèques statiques&nbsp;:</para>

<screen><userinput>mv -v /usr/lib/{libcrypto,libssl}.a /usr/lib/static</userinput></screen>

  </sect2>

  <sect2 id="contents-openssl" role="content">
    <title>Contenu de OpenSSL</title>

    <segmentedlist>
      <segtitle>Bibliothèques installées</segtitle>

      <seglistitem>
        <seg>FIXME</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="libssl">
        <term><filename class="libraryfile">FIXME</filename></term>
        <listitem>
          <para>FIXME</para>
          <indexterm zone="ch-system-openssl libssl">
            <primary sortas="c-libssl">libssl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
