<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      Problèmes liés aux locales
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-1007+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">systemd)</span> - Version r10.1-1007+
      </h4>
      <h3>
        Chapitre&nbsp;2.&nbsp;Informations importantes
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="libraries.html" title=
          "Bibliothèques&nbsp;: statiques ou partagées&nbsp;?">Précédent</a>
          <p>
            Bibliothèques&nbsp;: statiques ou partagées&nbsp;?
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="beyond.html" title=
          "Aller au-delà de BLFS">Suivant</a>
          <p>
            Aller au-delà de BLFS
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="important.html" title=
          "Chapitre&nbsp;2.&nbsp;Informations importantes">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="locale-issues" name="locale-issues"></a>Problèmes liés aux
        locales
      </h1>
      <p>
        Cette page contient des informations sur les problèmes liés aux
        locales. Dans les paragraphes suivants, vous trouverez un aperçu
        générique de ce qui peut vous arriver lors de la configuration de
        votre système pour diverses locales. Beaucoup (mais pas tous) des
        problèmes existants liés aux locales peuvent être classés et rangés
        sous un des en-têtes ci-dessous. Les niveaux de sévérité indiqués
        ci-dessous utilisent les critères suivants&nbsp;:
      </p>
      <div class="itemizedlist">
        <ul>
          <li class="listitem">
            <p>
              Critique&nbsp;: Le programme ne remplit pas sa fonction
              principale. Une correction serait ennuyeuse, il vaut mieux
              chercher un remplaçant.
            </p>
          </li>
          <li class="listitem">
            <p>
              Haute&nbsp;: Une partie des fonctionnalités fournies par le
              programme n'est pas utilisable. Si cette fonctionnalité est
              exigée, il vaut mieux chercher un remplaçant.
            </p>
          </li>
          <li class="listitem">
            <p>
              Basse&nbsp;: Le programme fonctionne dans tous les cas
              d'utilisation classiques, mais il manque de certaines
              fonctionnalités normalement fournies par ses équivalents.
            </p>
          </li>
        </ul>
      </div>
      <p>
        Si un moyen spécifique de contournement existe pour un paquet
        spécifique, il apparaîtra sur la page de ce paquet. Pour les
        informations les plus récentes sur les problèmes liés aux locales
        pour des paquets individuels, vérifiez les <a class="ulink" href=
        "https://wiki.linuxfromscratch.org/blfs/wiki/BlfsNotes">Notes
        utilisateur</a> sur le Wiki de BLFS.
      </p>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="locale-not-valid-option" name=
          "locale-not-valid-option"></a>L'encodage nécessaire n'est pas une
          option valide du programme
        </h2>
        <p>
          Sévérité&nbsp;: Critique
        </p>
        <p>
          Certains programmes exigent que l'utilisateur spécifie l'encodage
          de caractères pour leurs données d'entrée et de sortie et ils ne
          présentent qu'un choix limité d'encodages. C'est le cas de l'option
          <code class="option">-X</code> d'<a class="xref" href=
          "../pst/enscript.html" title="Enscript-1.6.6">Enscript-1.6.6</a>,
          de l'option <code class="option">-input-charset</code> de <a class=
          "xref" href="../multimedia/cdrtools.html" title=
          "Cdrtools-3.02a09">Cdrtools-3.02a09</a> non corrigé et des
          encodages offerts pour l'affichage du menu de <a class="xref" href=
          "../basicnet/links.html" title="Links-2.23">Links-2.23</a>. Si
          l'encodage requis n'est pas dans la liste, le programme devient en
          général totalement inutilisable. Pour les programmes non
          interactifs, on peut contourner cela en convertissant le document
          dans un encodage d'entrée supporté avant de le soumettre au
          programme.
        </p>
        <p>
          Une solution à ce type de problème consiste à implémenter le
          support nécessaire de l'encodage manquant avec un correctif du
          programme d'origine ou un remplaçant.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="locale-assumed-encoding" name=
          "locale-assumed-encoding"></a>Le programme suppose l'encodage basé
          sur la locale de documents externes
        </h2>
        <p>
          Sévérité&nbsp;: Haute pour des documents non-textes, basse pour des
          documents textes
        </p>
        <p>
          Certains programmes, <a class="xref" href="../postlfs/nano.html"
          title="Nano-5.8">nano-5.8</a> ou <a class="xref" href=
          "../postlfs/joe.html" title="JOE-4.6">JOE-4.6</a> par exemple,
          supposent que les documents sont toujours dans l'encodage impliqué
          par la locale actuelle. Si cette supposition peut être valide pour
          les documents créés par l'utilisateur, ce n'est pas sûr pour ceux
          externes. Quand cette supposition échoue, les caractères non-ASCII
          s'affichent mal et le document peut devenir illisible.
        </p>
        <p>
          Si le document externe est entièrement basé sur du texte, il peut
          être converti dans l'encodage de la locale actuelle en utilisant le
          programme <span class="command"><strong>iconv</strong></span>.
        </p>
        <p>
          Pour les documents non basés sur du texte, ce n'est pas possible.
          En fait, la supposition du programme peut être complètement
          invalide pour les documents où le système d'exploitation Microsoft
          Windows a de facto réglé les standards. Un exemple de ce problème
          réside dans les drapeaux ID3v1 des fichiers MP3 (voir <a class=
          "ulink" href=
          "https://wiki.linuxfromscratch.org/blfs/wiki/ID3v1Coding">la page
          ID3v1Coding du Wiki BLFS</a> pour plus de détails). Dans ces
          cas-là, la seule solution est de trouver un programme remplaçant
          qui n'a pas le problème (comme un qui vous permettra de spécifier
          l'encodage supposé du document).
        </p>
        <p>
          Au sein des paquets BLFS, ce problème s'applique à <a class="xref"
          href="../postlfs/nano.html" title="Nano-5.8">nano-5.8</a>,
          <a class="xref" href="../postlfs/joe.html" title=
          "JOE-4.6">JOE-4.6</a> et à tous les lecteurs multimédias, sauf
          <a class="xref" href="../multimedia/audacious.html" title=
          "Audacious-4.1">Audacious-4.1</a>.
        </p>
        <p>
          Un autre problème dans cette catégorie est quand on ne peut pas
          lire les documents qu'on vous a envoyés car leur système
          d'exploitation a été réglé pour gérer différemment les encodages de
          caractères. Cela peut se produire souvent quand l'autre personne
          utilise Microsoft Windows, qui ne fournit qu'un encodage de
          caractère par pays donné. Par exemple, cela pose des problèmes avec
          les documents TeX encodés en UTF-8 créés sous Linux. Sur Windows,
          la plupart des applications supposeront que ces documents ont été
          créés en utilisant l'encodage 8 bits de Windows par défaut.
        </p>
        <p>
          Dans les cas extrêmes, les problèmes de compatibilité d'encodages
          de Windows ne peuvent être résolus qu'en lançant des programmes
          Windows sous <a class="ulink" href=
          "http://www.winehq.com/">Wine</a>.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="locale-wrong-filename-encoding" name=
          "locale-wrong-filename-encoding"></a>Le programme utilise ou crée
          des noms de fichiers dans un mauvais encodage
        </h2>
        <p>
          Sévérité&nbsp;: Critique
        </p>
        <p>
          Le standard POSIX suppose que l'encodage des noms de fichiers est
          l'encodage impliqué par la catégorie de locale LC_CTYPE actuelle.
          Ces informations sont bien cachées sur la page qui spécifie le
          comportement des programmes <span class="application">Tar</span> et
          <span class="application">Cpio</span>. Certains programmes ne le
          font pas par défaut (ou n'ont tout simplement pas assez
          d'informations pour le faire). Il en résulte qu'ils créent des noms
          de fichiers qui sont ensuite mal affichés par <span class=
          "command"><strong>ls</strong></span>, ou ils refusent d'accepter
          des noms de fichiers affichés correctement par <span class=
          "command"><strong>ls</strong></span>. Pour la bibliothèque
          <a class="xref" href="../general/glib2.html" title=
          "GLib-2.68.4">GLib-2.68.4</a>, on peut corriger le problème en
          réglant la variable d'environnement <code class=
          "envar">G_FILENAME_ENCODING</code> sur la valeur spéciale
          "@locale". Les programmes basés sur <span class=
          "application">Glib2</span> qui ne respectent pas cette variable
          d'environnement sont bogués.
        </p>
        <p>
          <a class="xref" href="../general/zip.html" title=
          "Zip-3.0">Zip-3.0</a>, <a class="xref" href="../general/unzip.html"
          title="UnZip-6.0">UnZip-6.0</a> ont ce problème car ils ont en dur
          l'encodage accepté du nom de fichier. <span class=
          "application">UnZip</span> contient en dur une table de conversion
          entre les encodages CP850 (DOS) et ISO-8859-1 (UNIX) et il utilise
          cette table lorsqu'il extrait des archives créées sous DOS ou
          Microsoft Windows. Cette supposition ne marche cependant que pour
          les États-Unis et pas pour tous ceux qui utilisent une locale
          UTF-8. Les caractères non-ASCII seront rognés dans les noms de
          fichiers extraits.
        </p>
        <p>
          La règle générale pour éviter ce type de problème est d'éviter
          d'installer des programmes cassés. Si c'est impossible, vous pouvez
          utiliser l'outil <a class="ulink" href=
          "http://j3e.de/linux/convmv/">convmv</a> en ligne de commande pour
          corriger les noms de fichiers créés par ces programmes cassés, ou
          rogner volontairement les noms de fichiers existants pour
          satisfaire les présupposés casses de tels programmes.
        </p>
        <p>
          Dans d'autres cas, un problème similaire vient de l'importation de
          noms de fichiers d'un système utilisant une locale différente avec
          un outil non conscient de la locale (comme <a class="xref" href=
          "../postlfs/openssh.html" title="OpenSSH-8.7p1">OpenSSH-8.7p1</a>).
          Pour éviter de rogner les caractères non-ASCII lors du transfert de
          fichiers vers un système ayant une locale différente, vous pouvez
          utiliser une des méthodes suivantes&nbsp;:
        </p>
        <div class="itemizedlist">
          <ul>
            <li class="listitem">
              <p>
                Transférer malgré tout, réparer les dommages avec
                <span class="command"><strong>convmv</strong></span>.
              </p>
            </li>
            <li class="listitem">
              <p>
                Côté expéditeur, créer une archive tar en passant le
                paramètre <em class=
                "parameter"><code>--format=posix</code></em> à <span class=
                "command"><strong>tar</strong></span> (cela sera le réglage
                par défaut dans une version à venir de <span class=
                "command"><strong>tar</strong></span>).
              </p>
            </li>
            <li class="listitem">
              <p>
                Envoyer les fichiers en pièces jointes d'un message
                électronique. Les clients de messagerie spécifient l'encodage
                des noms de fichiers joints.
              </p>
            </li>
            <li class="listitem">
              <p>
                Écrire les fichiers sur un disque amovible formaté avec un
                système de fichiers FAT ou FAT32.
              </p>
            </li>
            <li class="listitem">
              <p>
                Transférer les fichiers en utilisant Samba.
              </p>
            </li>
            <li class="listitem">
              <p>
                Transférer les fichiers par FTP en utilisant un serveur (cela
                signifie actuellement seulement wu-ftpd, qui a une mauvaise
                histoire question sécurité) et un client conscient du RFC2640
                (comme lftp).
              </p>
            </li>
          </ul>
        </div>
        <p>
          Les quatre dernières méthodes fonctionnent car les noms de fichiers
          sont automatiquement convertis de la locale de l'expéditeur en
          UNICODE et stockés ou envoyés sous cette forme. Ils sont alors
          convertis de façon transparente d'UNICODE dans l'encodage de la
          locale du destinataire.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="locale-wrong-multibyte-characters" name=
          "locale-wrong-multibyte-characters"></a>Le programme casse les
          caractères ou ne compte pas bien les cellules de caractères
        </h2>
        <p>
          Sévérité&nbsp;: Haute ou critique
        </p>
        <p>
          De nombreux programmes ont été écrits dans une ère ancienne où les
          locales multi-octets n'étaient pas courantes. De tels programmes
          supposent que les types de données C "char", qui sont un des
          octets, peuvent être utilisés pour stocker des caractères uniques.
          De plus, ils supposent que n'importe quelle séquence de caractères
          est une chaîne valide et que chaque caractère occupe une seule
          cellule de caractère. De telles suppositions échouent complètement
          dans les locales UTF-8. La manifestation visible est que le
          programme tronque les chaînes de façon prématurée (c'est-à-dire aux
          octets 80 au lieu des caractères 80). Les programmes basés sur le
          terminal ne placent pas bien le curseur à l'écran, ils ne
          réagissent pas à la touche «&nbsp;Effacement&nbsp;» en effaçant un
          caractère et ils laissent les mauvais caractères affiché lors du
          rafraîchissement de l'écran, transformant généralement l'écran en
          désordre complet.
        </p>
        <p>
          La correction de ce type de problème est une tâche pénible du point
          de vue d'un programmeur, comme tout cas de modernisation d'un
          design défectueux par de nouveaux concepts. Dans ce cas, il faut
          concevoir de nouveau toutes les structures de données pour
          s’accommoder du fait qu'un caractère complet peut s'étendre sur un
          nombre variable de «&nbsp;char&nbsp;» (ou basculer sur wchar_t et
          convertir comme nécessaire). Pour chaque appel aux fonctions
          «&nbsp;strlen&nbsp;» et équivalent, il faut aussi trouver ce que
          voulait vraiment dire un nombre d'octets, de caractères ou la
          largeur de la chaîne. Il est parfois plus rapide d'écrire depuis
          zéro un programme ayant la même fonctionnalité.
        </p>
        <p>
          Au sein des paquets de BLFS, ce problème s'applique à<a class=
          "xref" href="../multimedia/xine-ui.html" title=
          "xine-ui-0.99.12">xine-ui-0.99.12</a> et tous les shells.
        </p>
      </div>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="locale-wrong-manpage-encoding" name=
          "locale-wrong-manpage-encoding"></a>Le paquet installe des pages de
          manuel dans un mauvais encodage ou dans un non affichable
        </h2>
        <p>
          Sévérité&nbsp;: basse
        </p>
        <p>
          LFS s'attend à ce que les pages de manuel soient dans l'encodage
          spécifique à la langue (en général 8-bit), comme indiqué sur la
          <a class="ulink" href=
          "../../../../lfs/view/development/chapter08/man-db.html">page Man
          DB de LFS</a>. Cependant, certains paquets installent des pages de
          manuel traduites dans l'encodage UTF-8 (comme Shadow, déjà traité),
          ou des pages de manuel dans des langues non présentes dans la
          table. Tous les paquets BLFS n'ont pas fait l'objet d'une
          évaluation de leur respect des exigences de LFS (la grande majorité
          a été vérifiée et des corrections ont été mises dans le livre pour
          les paquets connus pour installer des pages de manuel non
          conformes). Si vous trouvez une page de manuel installée par un
          paquet BLFS qui est dans un mauvais encodage, merci de la supprimer
          ou de la convertir selon vos besoins et de le signaler à l'équipe
          BLFS comme un bogue.
        </p>
        <p>
          Vous pouvez facilement vérifier le respect par toutes les pages de
          man de votre système en copiant le petit script shell suivant à un
          endroit accessible,
        </p>
        <pre class="screen"><code class="literal">#!/bin/sh
# Begin checkman.sh
# Usage: find /usr/share/man -type f | xargs checkman.sh
for a in "$@"
do
    # echo "Checking $a..."
    # Pure-ASCII manual page (possibly except comments) is OK
    grep -v '.\\"' "$a" | iconv -f US-ASCII -t US-ASCII &gt;/dev/null 2&gt;&amp;1 \
        &amp;&amp; continue
    # Non-UTF-8 manual page is OK
    iconv -f UTF-8 -t UTF-8 "$a" &gt;/dev/null 2&gt;&amp;1 || continue
    # Found a UTF-8 manual page, bad.
    echo "UTF-8 manual page: $a" &gt;&amp;2
done
# End checkman.sh
</code></pre>
        <p>
          puis en lançant la commande suivante (modifiez la commande
          ci-dessous si le script <span class=
          "command"><strong>checkman.sh</strong></span> n'est pas dans votre
          variable d'environnement <code class="envar">PATH</code>)&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">find /usr/share/man -type f | xargs checkman.sh</kbd></pre>
        <p>
          Remarquez que si vous avez des pages de manuel installées ailleurs
          que dans <code class="filename">/usr/share/man</code> (comme dans
          <code class="filename">/usr/local/share/man</code>), vous devez
          modifier la commande ci-dessus pour inclure cet emplacement
          supplémentaire.
        </p>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="libraries.html" title=
          "Bibliothèques&nbsp;: statiques ou partagées&nbsp;?">Précédent</a>
          <p>
            Bibliothèques&nbsp;: statiques ou partagées&nbsp;?
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="beyond.html" title=
          "Aller au-delà de BLFS">Suivant</a>
          <p>
            Aller au-delà de BLFS
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="important.html" title=
          "Chapitre&nbsp;2.&nbsp;Informations importantes">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
