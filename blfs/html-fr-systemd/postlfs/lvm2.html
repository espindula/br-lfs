<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      LVM2-2.03.13
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-1007+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">systemd)</span> - Version r10.1-1007+
      </h4>
      <h3>
        Chapitre&nbsp;5.&nbsp;Systèmes de fichiers et gestion de disque
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="jfsutils.html" title=
          "jfsutils-1.1.15">Précédent</a>
          <p>
            jfsutils-1.1.15
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutlvm.html" title=
          "À propos de la gestion des volumes logiques (LVM)">Suivant</a>
          <p>
            À propos de la gestion des volumes logiques (LVM)
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapitre&nbsp;5.&nbsp;Systèmes de fichiers et gestion de disque">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="lvm2" name="lvm2"></a>LVM2-2.03.13
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Introduction à LVM2
        </h2>
        <p>
          Le paquet <span class="application">LVM2</span> gère des partitions
          logiques. Il permet l'extension de systèmes de fichiers sur
          plusieurs disques physiques et plusieurs partitions de disque, il
          permet une navigation dynamique ou le bidouillage de partitions
          logiques.
        </p>
        <p>
          This package is known to build and work properly using an LFS-11.0
          platform.
        </p>
        <h3>
          Informations sur le paquet
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Téléchargement (HTTP)&nbsp;: <a class="ulink" href=
                "https://sourceware.org/ftp/lvm2/LVM2.2.03.13.tgz">https://sourceware.org/ftp/lvm2/LVM2.2.03.13.tgz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Téléchargement (FTP)&nbsp;: <a class="ulink" href=
                "ftp://sourceware.org/pub/lvm2/LVM2.2.03.13.tgz">ftp://sourceware.org/pub/lvm2/LVM2.2.03.13.tgz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Somme de contrôle MD5 du téléchargement&nbsp;:
                c4be18fcb94c84c26f71ff4235917c28
              </p>
            </li>
            <li class="listitem">
              <p>
                Taille du téléchargement&nbsp;: 2.5&nbsp;Mo
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation de l'espace disque requis&nbsp;: 37 Mo (plus 18 Mo
                pour les tests&nbsp;; les fichiers temporaires peuvent
                atteindre environ 800 Mo dans le répertoire /tmp pendant les
                tests)
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation du temps de construction&nbsp;: 0,2 SBU (avec
                parallélisme = 4&nbsp;; plus 9 à 48 SBU pour les tests, en
                fonction de la vitesse de votre disque)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Dépendances de LVM2
        </h3>
        <h4>
          Requises
        </h4>
        <p class="required">
          <a class="xref" href="../general/libaio.html" title=
          "libaio-0.3.112">libaio-0.3.112</a>
        </p>
        <h4>
          Facultatives
        </h4>
        <p class="optional">
          <a class="xref" href="mdadm.html" title="mdadm-4.1">mdadm-4.1</a>,
          <a class="xref" href="reiserfs.html" title=
          "reiserfsprogs-3.6.27">reiserfsprogs-3.6.27</a>, <a class="xref"
          href="../general/valgrind.html" title=
          "Valgrind-3.17.0">Valgrind-3.17.0</a>, <a class="xref" href=
          "../general/which.html" title=
          "Which-2.21 et Alternatives">Which-2.21</a>, <a class="xref" href=
          "xfsprogs.html" title="xfsprogs-5.13.0">xfsprogs-5.13.0</a> (les
          cinq peuvent être utilisés, mais ne sont pas nécessaires, pour les
          tests) et <a class="ulink" href=
          "https://github.com/jthornber/thin-provisioning-tools">thin-provisioning-tools</a>
          et <a class="ulink" href="https://github.com/dm-vdo/vdo">vdo</a>
        </p>
        <p class="usernotes">
          Notes utilisateur&nbsp;: <a class="ulink" href=
          "https://wiki.linuxfromscratch.org/blfs/wiki/lvm2">https://wiki.linuxfromscratch.org/blfs/wiki/lvm2</a>
        </p>
      </div>
      <div class="kernel" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="lvm2-kernel" name="lvm2-kernel"></a>Configuration du noyau
        </h2>
        <p>
          Activez les options suivantes dans la configuration du noyau et
          recompilez le noyau&nbsp;:
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Il y a d'autres options de mappage de périphérique dans le noyau
            après celles listées en dessous. Afin d'avoir des résultats
            raisonnables si les tests de régression sont lancés, tous doivent
            être activé soit en interne, soit en module. Les tests vont tous
            expirer si Magic SysRq key n'est pas activé.
          </p>
        </div>
        <pre class="screen"><code class="literal">Device Drivers ---&gt;
  [*] Multiple devices driver support (RAID and LVM) ---&gt; [CONFIG_MD]
    &lt;*/M&gt;   Device mapper support                         [CONFIG_BLK_DEV_DM]
    &lt;*/M&gt;   Crypt target support                          [CONFIG_DM_CRYPT]
    &lt;*/M&gt;   Snapshot target                               [CONFIG_DM_SNAPSHOT]
    &lt;*/M&gt;   Thin provisioning target                      [CONFIG_DM_THIN_PROVISIONING]
    &lt;*/M&gt;   Cache target (EXPERIMENTAL)                   [CONFIG_DM_CACHE]
    &lt;*/M&gt;   Mirror target                                 [CONFIG_DM_MIRROR]
    &lt;*/M&gt;   Zero target                                   [CONFIG_DM_ZERO]
    &lt;*/M&gt;   I/O delaying target                           [CONFIG_DM_DELAY]
  [*] Block devices ---&gt;
    &lt;*/M&gt;   RAM block device support                      [CONFIG_BLK_DEV_RAM]
Kernel hacking ---&gt;
  Generic Kernel Debugging Instruments ---&gt;
    [*] Magic SysRq key                                   [CONFIG_MAGIC_SYSRQ]</code></pre>
      </div>
      <div class="installation" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Installation de LVM2
        </h2>
        <p>
          Installez <span class="application">LVM2</span> en lançant les
          commandes suivantes&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">PATH+=:/usr/sbin                \
./configure --prefix=/usr       \
            --enable-cmdlib     \
            --enable-pkgconfig  \
            --enable-udev_sync  &amp;&amp;
make</kbd></pre>
        <p>
          Les tests utilisent <span class="application">udev</span> pour la
          synchronisation des volumes logiques, de sorte que les règles LVM
          de udev et que quelques utilitaires doivent être installés avant de
          lancer les tests. Si vous installez <span class=
          "application">LVM2</span> pour la première fois, et que vous ne
          souhaitez pas installer le paquet complet avant de lancer les
          tests, vous pouvez installer l'ensemble minimal d'utilitaires en
          lançant les commandes suivantes en tant que <code class=
          "systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class=
        "command">make -C tools install_tools_dynamic &amp;&amp;
make -C udev  install                 &amp;&amp;
make -C libdm install</kbd></pre>
        <p>
          Pour tester les résultats, lancez, en tant qu'utilisateur
          <code class="systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class=
        "command">make S=shell/thin-flags.sh check_local</kbd></pre>
        <p>
          L'option <span class="command"><strong>S=…</strong></span> permet
          de passer les tests. Le test <span class=
          "command"><strong>shell/thin-flags.sh</strong></span> a été
          rapporté comme freezant l'ordinateur. D'autres cibles sont
          disponibles et peuvent être énumérées avec <span class=
          "command"><strong>make -C test help</strong></span>. Le temps de
          test est très dépendant de la vitesse des disques, et du nombre
          d'options activées dans le noyau.
        </p>
        <p>
          Ces tests n'implémentent pas la possibilité <span class=
          "quote">«&nbsp;<span class="quote">expected
          fail</span>&nbsp;»</span> (échec prévu), et un petit nombre
          d'échecs est prévu en amont. Plus d'échecs peuvent apparaître
          lorsque manquent certaines options du noyau. Par exemple, l'absence
          de la cible du device mapper <span class=
          "emphasis"><em>dm-delay</em></span> explique quelques erreurs.
          Certains tests peuvent échouer s'il n'y a pas assez de place
          disponible sur la partition qui contient le répertoire /tmp. Au
          moins un test échoue si 16 To ne sont pas disponibles. Certains
          tests sont indiqués <span class="quote">«&nbsp;<span class=
          "quote">warned</span>&nbsp;»</span> si <a class="ulink" href=
          "https://github.com/jthornber/thin-provisioning-tools">thin-provisioning-tools</a>
          n'est pas installé. Vous pouvez le contourner en ajoutant les
          options suivantes à <span class=
          "command"><strong>configure</strong></span>&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">     --with-thin-check=    \
     --with-thin-dump=     \
     --with-thin-repair=   \
     --with-thin-restore=  \
     --with-cache-check=   \
     --with-cache-dump=    \
     --with-cache-repair=  \
     --with-cache-restore= \</kbd></pre>
        <p>
          Certains tests peuvent bloquer. Ils peuvent être supprimés si
          nécessaire, par exemple&nbsp;: <span class="command"><strong>rm
          test/shell/lvconvert-raid-reshape.sh</strong></span>. Les tests
          génèrent beaucoup de messages noyau, ce qui peut encombrer votre
          terminal. Vous pouvez les désactiver avec <span class=
          "command"><strong>dmesg -D</strong></span> avant de lancer les
          tests (n'oubliez pas de lancer <span class="command"><strong>dmesg
          -E</strong></span> lorsque les tests sont finis).
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Les tests créez des nœuds de périphériques dans le répertoire
            /tmp. Les tests échoueront si /tmp est monté avec l'option nodev.
          </p>
        </div>
        <p>
          Maintenant, en tant qu'utilisateur <code class=
          "systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class="command">make install
make install_systemd_units</kbd></pre>
      </div>
      <div class="commands" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Explication des commandes
        </h2>
        <p>
          <span class=
          "command"><strong>PATH+=:/usr/sbin</strong></span>&nbsp;: le PATH
          doit contenir <code class="filename">/usr/sbin</code> pour la
          détection correcte des outils système par le script <span class=
          "command"><strong>configure</strong></span>. Cette instruction
          assure que PATH est correctement initialisé si vous construisez
          avec un utilisateur non privilégié.
        </p>
        <p>
          <em class="parameter"><code>--enable-cmdlib</code></em>&nbsp;: Ce
          paramètre construit la bibliothèque de commande partagée. Elle est
          nécessaire lors de la construction du démon d'événements.
        </p>
        <p>
          <em class="parameter"><code>--enable-pkgconfig</code></em>&nbsp;:
          Ce paramètre installe le support de <span class=
          "command"><strong>pkg-config</strong></span>.
        </p>
        <p>
          <em class="parameter"><code>--enable-udev_sync</code></em>&nbsp;:
          Ce paramètre active la synchronisation avec <span class=
          "application">Udev</span>.
        </p>
        <p>
          <code class="option">--enable-dmeventd</code>: Cette option
          construit le démon d'événement <span class="application">Device
          Mapper</span>.
        </p>
        <p>
          <span class="command"><strong>make
          install_systemd_units</strong></span>&nbsp;: cela est nécessaire
          pour installer une unité et activer les volumes logiques au
          démarrage. Elle n'est pas installée par défaut.
        </p>
      </div>
      <div class="content" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Contenu
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Programmes installés:</strong>
              <span class="segbody">blkdeactivate, dmeventd (facultatif),
              dmsetup, fsadm, lvm et lvmdump. Il y a également de nombreux
              liens symboliques vers lvm qui implémentent des fonctionnalités
              spécifiques</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Bibliothèques installées:</strong>
              <span class="segbody">libdevmapper.so and liblvm2cmd.so;
              optional: libdevmapper-event.so, libdevmapper-event-lvm2.so,
              libdevmapper-event-lvm2mirror.so,
              libdevmapper-event-lvm2raid.so,
              libdevmapper-event-lvm2snapshot.so et
              libdevmapper-event-lvm2thin.so</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Répertoires installés:</strong>
              <span class="segbody">/etc/lvm et /lib/device-mapper
              (facultatif)</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Descriptions courtes
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="blkdeactivate" name=
                    "blkdeactivate"></a><span class="term"><span class=
                    "command"><strong>blkdeactivate</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est un utilitaire pour désactiver les périphériques blocs
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="dmeventd" name="dmeventd"></a><span class=
                    "term"><span class=
                    "command"><strong>dmeventd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    (facultatif) est le démon d'événement de Device Mapper
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="dmsetup" name="dmsetup"></a><span class=
                    "term"><span class=
                    "command"><strong>dmsetup</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est un outil de gestion de bas niveau de volumes logiques
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="fsadm" name="fsadm"></a><span class=
                    "term"><span class=
                    "command"><strong>fsadm</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est un outil pour redimensionner ou vérifier le système
                    de fichiers d'un périphérique
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="lvm" name="lvm"></a><span class=
                    "term"><span class="command"><strong>lvm</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    fournit les outils en ligne de commande pour <span class=
                    "application">LVM2</span>. Les commandes sont
                    implémentées via des liens symboliques vers ce programme
                    pour gérer des périphériques physiques (pv*), des groupes
                    de volume (vg*), et de volumes logiques (lv*)
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="lvmdump" name="lvmdump"></a><span class=
                    "term"><span class=
                    "command"><strong>lvmdump</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est un outil pour envoyer diverses informations
                    concernant <span class="application">LVM2</span>
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="vgimportclone" name=
                    "vgimportclone"></a><span class="term"><span class=
                    "command"><strong>vgimportclone</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour importer un VG dupliqué (comme un dépôt
                    matériel)
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="libdevmapper" name="libdevmapper"></a><span class=
                    "term"><code class=
                    "filename">libdevmapper.so</code></span>
                  </p>
                </td>
                <td>
                  <p>
                    contient les fonctions de l'API de <span class=
                    "application">Device Mapper</span>
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="jfsutils.html" title=
          "jfsutils-1.1.15">Précédent</a>
          <p>
            jfsutils-1.1.15
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutlvm.html" title=
          "À propos de la gestion des volumes logiques (LVM)">Suivant</a>
          <p>
            À propos de la gestion des volumes logiques (LVM)
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapitre&nbsp;5.&nbsp;Systèmes de fichiers et gestion de disque">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
