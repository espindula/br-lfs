<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      iptables-1.8.7
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-1007+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">systemd)</span> - Version r10.1-1007+
      </h4>
      <h3>
        Chapitre&nbsp;4.&nbsp;Sécurité
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="haveged.html" title=
          "Haveged-1.9.14">Précédent</a>
          <p>
            Haveged-1.9.14
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="firewall.html" title=
          "Paramétrer un pare-feu réseau">Suivant</a>
          <p>
            Paramétrer un pare-feu réseau
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="security.html" title=
          "Chapitre&nbsp;4.&nbsp;Sécurité">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="iptables" name="iptables"></a>iptables-1.8.7
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Introduction à iptables
        </h2>
        <p>
          <span class="application">iptables</span> est un programme en ligne
          de commande et en espace utilisateur utilisé pour configurer
          l'ensemble de règles de filtrage de paquets des noyaux Linux 2.4 et
          supérieurs
        </p>
        <p>
          This package is known to build and work properly using an LFS-11.0
          platform.
        </p>
        <h3>
          Informations sur le paquet
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Téléchargement (HTTP)&nbsp;: <a class="ulink" href=
                "http://www.netfilter.org/projects/iptables/files/iptables-1.8.7.tar.bz2">
                http://www.netfilter.org/projects/iptables/files/iptables-1.8.7.tar.bz2</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Téléchargement (FTP)&nbsp;: <a class="ulink" href=
                "ftp://ftp.netfilter.org/pub/iptables/iptables-1.8.7.tar.bz2">
                ftp://ftp.netfilter.org/pub/iptables/iptables-1.8.7.tar.bz2</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Somme de contrôle MD5 du téléchargement&nbsp;:
                602ba7e937c72fbb7b1c2b71c3b0004b
              </p>
            </li>
            <li class="listitem">
              <p>
                Taille du téléchargement&nbsp;: 704&nbsp;Ko
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation de l'espace disque requis&nbsp;: 22&nbsp;Mo
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation du temps de construction&nbsp;: 0.1&nbsp;SBU
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Dépendances de iptables
        </h3>
        <h4>
          Facultatives
        </h4>
        <p class="optional">
          <a class="xref" href="../basicnet/libpcap.html" title=
          "libpcap-1.10.1">libpcap-1.10.1</a> (requis pour la prise en charge
          de nfsypproxy), <a class="ulink" href=
          "https://github.com/tadamdam/bpf-utils">bpf-utils</a> (requis pour
          la prise en charge de Berkely Packet Filter), <a class="ulink"
          href="https://netfilter.org/projects/libnfnetlink/">libnfnetlink</a>
          (requis pour la prise en charge de connlabel), <a class="ulink"
          href=
          "https://netfilter.org/projects/libnetfilter_conntrack/">libnetfilter_conntrack"</a>
          (requis pour la prise en charge de connlabel) et <a class="ulink"
          href="https://netfilter.org/projects/nftables/">nftables</a>
        </p>
        <p class="usernotes">
          Notes utilisateur&nbsp;: <a class="ulink" href=
          "https://wiki.linuxfromscratch.org/blfs/wiki/iptables">https://wiki.linuxfromscratch.org/blfs/wiki/iptables</a>
        </p>
      </div>
      <div class="kernel" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="iptables-kernel" name="iptables-kernel"></a>Configuration du
          noyau
        </h2>
        <p>
          Sur Linux, on a un pare-feu via l'interface netfilter. Pour
          utiliser <span class="application">iptables</span> pour configurer
          netfilter, les paramètres du noyau suivants sont requis&nbsp;:
        </p>
        <pre class="screen"><code class=
        "literal">[*] Networking support  ---&gt;                                          [CONFIG_NET]
      Networking Options  ---&gt;
        [*] Network packet filtering framework (Netfilter) ---&gt;       [CONFIG_NETFILTER]
          [*] Advanced netfilter configuration                        [CONFIG_NETFILTER_ADVANCED]
          Core Netfilter Configuration ---&gt;
            &lt;*/M&gt; Netfilter connection tracking support               [CONFIG_NF_CONNTRACK]
            &lt;*/M&gt; Netfilter Xtables support (required for ip_tables)  [CONFIG_NETFILTER_XTABLES]
            &lt;*/M&gt; LOG target support                                  [CONFIG_NETFILTER_XT_TARGET_LOG]
          IP: Netfilter Configuration ---&gt;
            &lt;*/M&gt; IP tables support (required for filtering/masq/NAT) [CONFIG_IP_NF_IPTABLES]</code></pre>
        <p>
          Ajoutez tous les protocoles de suivi de connexion que vous
          utiliserez, ainsi que tous les protocoles que vous voulez utiliser
          pour la prise en charge de leur détection dans la section
          «&nbsp;Core Netfilter Configuration&nbsp;». Les options ci-dessus
          sont suffisantes pour lancer <a class="xref" href=
          "iptables.html#fw-persFw-ipt" title="Pare-feu personnel">Creating a
          Personal Firewall With iptables</a>.
        </p>
      </div>
      <div class="installation" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Installation de iptables
        </h2>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            L'installation ci-dessous n'inclut pas la construction de
            quelques bibliothèques d'extension spécialisées qui exigent les
            en-têtes raw dans le code source de <span class=
            "application">Linux</span>. Si vous souhaitez construire des
            extensions supplémentaires (si vous n'êtes pas sûr, vous n'en
            avez probablement pas besoin), vous pouvez regarder le fichier
            <code class="filename">INSTALL</code> pour voir un exemple de la
            façon de modifier le paramètre <em class=
            "parameter"><code>KERNEL_DIR=</code></em> pour pointer vers le
            code source de <span class="application">Linux</span>. Remarquez
            que si vous mettez à jour la version du noyau, il se peut que
            vous deviez aussi recompiler <span class=
            "application">iptables</span> et que l'équipe BLFS n'a pas testé
            l'utilisation des en-têtes du noyau raw.
          </p>
        </div>
        <p>
          Installez <span class="application">iptables</span> en lançant les
          commandes suivantes&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">./configure --prefix=/usr      \
            --disable-nftables \
            --enable-libipq    &amp;&amp;
make</kbd></pre>
        <p>
          Ce paquet n'est pas fourni avec une suite de tests.
        </p>
        <p>
          Maintenant, en tant qu'utilisateur <code class=
          "systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class="command">make install</kbd></pre>
      </div>
      <div class="commands" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Explication des commandes
        </h2>
        <p>
          <em class="parameter"><code>--disable-nftables</code></em>&nbsp;:
          ce paramètre désactive la construction de la compatibilité
          nftables.
        </p>
        <p>
          <em class="parameter"><code>--enable-libipq</code></em>&nbsp;: Ce
          paramètre active la construction de <code class=
          "filename">libipq.so</code> qui peut être utilisé par certains
          paquets extérieurs à BLFS.
        </p>
        <p>
          <code class="option">--enable-nfsynproxy</code>&nbsp;: Ce paramètre
          active l'installation de l'outil de configuration SYNPROXY de
          <span class="application">nfsynproxy</span>.
        </p>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Configuration de iptables
        </h2>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Dans les exemples de configuration suivants, <span class=
            "strong"><strong>LAN1</strong></span> est utilisé pour
            l'interface interne au réseau local et <span class=
            "strong"><strong>WAN1</strong></span> pour l'interface externe
            connectée à Internet. Vous devrez remplacer ces valeurs avec les
            noms d'interfaces correspondants à votre système.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="fw-persFw-ipt" name="fw-persFw-ipt"></a>Pare-feu personnel
          </h3>
          <p>
            Un pare-feu personnel est conçu pour vous permettre d'accéder à
            tous les services offerts sur internet, mais de garder votre
            ordinateur sécurisé et vos données privées.
          </p>
          <p>
            Voici une version légèrement modifiée de la recommandation de
            Rusty Russell sur <a class="ulink" href=
            "http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO.html">
            le guide de Packet Filter de Linux 2.4</a>. Elle est toujours
            d'actualité pour les noyaux 5.x.
          </p>
          <pre class="root"><kbd class=
          "command">install -v -dm755 /etc/systemd/scripts

cat &gt; /etc/systemd/scripts/iptables &lt;&lt; "EOF"
<code class="literal">#!/bin/sh

# Begin /etc/systemd/scripts/iptables

# Insert connection-tracking modules
# (not needed if built into the kernel)
modprobe nf_conntrack
modprobe xt_LOG

# Enable broadcast echo Protection
echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts

# Disable Source Routed Packets
echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route
echo 0 &gt; /proc/sys/net/ipv4/conf/default/accept_source_route

# Enable TCP SYN Cookie Protection
echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies

# Disable ICMP Redirect Acceptance
echo 0 &gt; /proc/sys/net/ipv4/conf/default/accept_redirects

# Do not send Redirect Messages
echo 0 &gt; /proc/sys/net/ipv4/conf/all/send_redirects
echo 0 &gt; /proc/sys/net/ipv4/conf/default/send_redirects

# Drop Spoofed Packets coming in on an interface, where responses
# would result in the reply going out a different interface.
echo 1 &gt; /proc/sys/net/ipv4/conf/all/rp_filter
echo 1 &gt; /proc/sys/net/ipv4/conf/default/rp_filter

# Log packets with impossible addresses.
echo 1 &gt; /proc/sys/net/ipv4/conf/all/log_martians
echo 1 &gt; /proc/sys/net/ipv4/conf/default/log_martians

# be verbose on dynamic ip-addresses  (not needed in case of static IP)
echo 2 &gt; /proc/sys/net/ipv4/ip_dynaddr

# disable Explicit Congestion Notification
# too many routers are still ignorant
echo 0 &gt; /proc/sys/net/ipv4/tcp_ecn

# Set a known state
iptables -P INPUT   DROP
iptables -P FORWARD DROP
iptables -P OUTPUT  DROP

# These lines are here in case rules are already in place and the
# script is ever rerun on the fly. We want to remove all rules and
# pre-existing user defined chains before we implement new rules.
iptables -F
iptables -X
iptables -Z

iptables -t nat -F

# Allow local-only connections
iptables -A INPUT  -i lo -j ACCEPT

# Free output on any interface to any ip for any service
# (equal to -P ACCEPT)
iptables -A OUTPUT -j ACCEPT

# Permit answers on already established connections
# and permit new connections related to established ones
# (e.g. port mode ftp)
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Log everything else.
iptables -A INPUT -j LOG --log-prefix "FIREWALL:INPUT "

# End /etc/systemd/scripts/iptables</code>
EOF
chmod 700 /etc/systemd/scripts/iptables</kbd></pre>
          <p>
            Ce script est assez simple, il jette tout le trafic entrant dans
            votre ordinateur s'il n'a pas été initié par votre ordinateur,
            mais tant que vous vous contentez de surfer sur internet, vous ne
            dépasserez pas les limites.
          </p>
          <p>
            Si vous rencontrez régulièrement des délais lors de l'accès à des
            serveurs FTP, regardez <a class="xref" href=
            "iptables.html#fw-BB-4-ipt">BusyBox with iptables example number
            4</a>.
          </p>
          <p>
            Même si vous avez des démons ou des services qui tournent sur
            votre système, ils seront inaccessibles de n'importe où en dehors
            de l'ordinateur lui-même. Si vous voulez permettre l'accès aux
            services sur votre machine, comme <span class=
            "command"><strong>ssh</strong></span> ou <span class=
            "command"><strong>ping</strong></span>, regardez <a class="xref"
            href="iptables.html#fw-busybox-ipt" title="BusyBox">Creating a
            BusyBox With iptables</a>.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="fw-masqRouter-ipt" name="fw-masqRouter-ipt"></a>Routeur
            masquant
          </h3>
          <p>
            Un pare-feu réseau a deux interface, l'une connectée à un
            intranet, dans cet exemple <span class=
            "strong"><strong>LAN1</strong></span> et l'autre connectée à
            internet, ici <span class="strong"><strong>WAN1</strong></span>.
            Pour fournir le plus de sécurité au pare-feu lui-même,
            assurez-vous qu'il n'y a pas de serveurs inutiles dessus comme
            <span class="application">X11</span> et compagnie. En général, le
            pare-feu lui-même ne devrait pas accéder à des services qui ne
            sont pas de confiance (pensez à un serveur distant qui donne des
            réponses qui font crasher un démon de votre système, ou pire, qui
            implémente un vers via un dépassement de tampon).
          </p>
          <pre class="root"><kbd class=
          "command">install -v -dm755 /etc/systemd/scripts

cat &gt; /etc/systemd/scripts/iptables &lt;&lt; "EOF"
<code class="literal">#!/bin/sh

# Begin /etc/systemd/scripts/iptables

echo
echo "You're using the example configuration for a setup of a firewall"
echo "from Beyond Linux From Scratch."
echo "This example is far from being complete, it is only meant"
echo "to be a reference."
echo "Firewall security is a complex issue, that exceeds the scope"
echo "of the configuration rules below."

echo "You can find additional information"
echo "about firewalls in Chapter 4 of the BLFS book."
echo "http://www.linuxfromscratch.org/blfs"
echo

# Insert iptables modules (not needed if built into the kernel).

modprobe nf_conntrack
modprobe nf_conntrack_ftp
modprobe xt_conntrack
modprobe xt_LOG
modprobe xt_state

# Enable broadcast echo Protection
echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts

# Disable Source Routed Packets
echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route

# Enable TCP SYN Cookie Protection
echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies

# Disable ICMP Redirect Acceptance
echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_redirects

# Don't send Redirect Messages
echo 0 &gt; /proc/sys/net/ipv4/conf/default/send_redirects

# Drop Spoofed Packets coming in on an interface where responses
# would result in the reply going out a different interface.
echo 1 &gt; /proc/sys/net/ipv4/conf/default/rp_filter

# Log packets with impossible addresses.
echo 1 &gt; /proc/sys/net/ipv4/conf/all/log_martians

# Be verbose on dynamic ip-addresses  (not needed in case of static IP)
echo 2 &gt; /proc/sys/net/ipv4/ip_dynaddr

# Disable Explicit Congestion Notification
# Too many routers are still ignorant
echo 0 &gt; /proc/sys/net/ipv4/tcp_ecn

# Set a known state
iptables -P INPUT   DROP
iptables -P FORWARD DROP
iptables -P OUTPUT  DROP

# These lines are here in case rules are already in place and the
# script is ever rerun on the fly. We want to remove all rules and
# pre-existing user defined chains before we implement new rules.
iptables -F
iptables -X
iptables -Z

iptables -t nat -F

# Allow local connections
iptables -A INPUT  -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# Allow forwarding if the initiated on the intranet
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD ! -i WAN1 -m conntrack --ctstate NEW       -j ACCEPT

# Do masquerading
# (not needed if intranet is not using private ip-addresses)
iptables -t nat -A POSTROUTING -o WAN1 -j MASQUERADE

# Log everything for debugging
# (last of all rules, but before policy rules)
iptables -A INPUT   -j LOG --log-prefix "FIREWALL:INPUT "
iptables -A FORWARD -j LOG --log-prefix "FIREWALL:FORWARD "
iptables -A OUTPUT  -j LOG --log-prefix "FIREWALL:OUTPUT "

# Enable IP Forwarding
echo 1 &gt; /proc/sys/net/ipv4/ip_forward

# The following sections allow inbound packets for specific examples
# Uncomment the example lines and adjust as necessary

# Allow ping on the external interface
#iptables -A INPUT  -p icmp -m icmp --icmp-type echo-request -j ACCEPT
#iptables -A OUTPUT -p icmp -m icmp --icmp-type echo-reply   -j ACCEPT

# Reject ident packets with TCP reset to avoid delays with FTP or IRC
#iptables -A INPUT  -p tcp --dport 113 -j REJECT --reject-with tcp-reset

# Allow HTTP and HTTPS to 192.168.0.2
#iptables -A PREROUTING -t nat -i WAN1 -p tcp --dport 80 -j DNAT --to 192.168.0.2
#iptables -A PREROUTING -t nat -i WAN1 -p tcp --dport 443 -j DNAT --to 192.168.0.2
#iptables -A FORWARD -p tcp -d 192.168.0.2 --dport 80 -j ACCEPT
#iptables -A FORWARD -p tcp -d 192.168.0.2 --dport 443 -j ACCEPT

# End /etc/systemd/scripts/iptables</code>
EOF
chmod 700 /etc/systemd/scripts/iptables</kbd></pre>
          <p>
            Avec ce script votre intranet devrait être raisonnablement
            sécurisé contre les attaques externes. Personne ne devrait être
            capable d'initialiser une nouvelle connexion vers un service
            interne et, s'il est masquant, le pare-feu rend votre intranet
            invisible depuis internet. En plus, votre pare-feu devrait être
            relativement sécurisé parce qu'aucun service attaquable ne tourne
            dessus.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="fw-busybox-ipt" name="fw-busybox-ipt"></a>BusyBox
          </h3>
          <p>
            Ce scénario n'est pas très différent de <a class="xref" href=
            "iptables.html#fw-masqRouter-ipt" title=
            "Routeur masquant">Creating a Masquerading Router With
            iptables</a>, mais en plus fournit des services à votre intranet.
            C'est le cas par exemple si vous voulez administrer votre
            pare-feu depuis un autre hôte sur votre intranet ou si vous
            voulez l'utiliser comme proxy ou serveur de nom.
          </p>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Expliquer comment protéger un serveur qui offre des services
              sur internet n'est pas du ressort de ce document. Consultez les
              références dans <a class="xref" href=
              "firewall.html#fw-extra-info" title=
              "Informations supplémentaires">la section intitulée
              «&nbsp;Informations supplémentaires&nbsp;»</a> pour plus
              d'informations.
            </p>
          </div>
          <p>
            Soyez prudent. Chaque service activé rend votre configuration
            plus complexe et votre pare-feu moins sécurisé. Vous vous exposez
            au risque d'avoir un service mal configuré ou de lancer un
            service avec un bogue exploitable. Un pare-feu ne devrait en
            général faire tourner aucun service supplémentaire. Consultez
            l'introduction de <a class="xref" href=
            "iptables.html#fw-masqRouter-ipt" title=
            "Routeur masquant">Creating a Masquerading Router With
            iptables</a> pour plus de détails.
          </p>
          <p>
            Si vous voulez ajouter un service interne comme un serveur Samba
            ou un serveur de nom qui n'ont pas eux-même besoin d'accéder à
            internet, les règles supplémentaires sont assez simples et
            devraient toujours être acceptables du point de vue de la
            sécurité. Ajoutez simplement les lignes suivantes au script
            <span class="emphasis"><em>avant</em></span> les règles de
            journalisation.
          </p>
          <pre class="screen"><code class=
          "literal">iptables -A INPUT  -i ! WAN1  -j ACCEPT
iptables -A OUTPUT -o ! WAN1  -j ACCEPT</code></pre>
          <p>
            Si des démons, comme squid, doivent accéder à internet, vous
            pouvez ouvrir OUTPUT par défaut et restreindre INPUT.
          </p>
          <pre class="screen"><code class=
          "literal">iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -j ACCEPT</code></pre>
          <p>
            Cependant, il n'est généralement pas recommandé de laisser OUTPUT
            sans restriction. Vous perdez le contrôle sur les chevaux de
            Troie qui aiment «&nbsp;appeler la maison&nbsp;» et une
            redondance dans la sécurité au cas où vous auriez mal configuré
            un service qui annoncerait sa présence au monde entier.
          </p>
          <p>
            Pour cela, vous devriez restreindre INPUT et OUTPUT sur tous les
            ports sauf ceux qui sont absolument nécessaires. Les ports à
            ouvrir dépendent de vos besoins&nbsp;: vous les trouverez surtout
            en regardant les accès échoués dans vos journaux.
          </p>
          <div class="itemizedlist">
            <p class="title">
              <strong>Consultez les exemples suivants&nbsp;:</strong>
            </p>
            <ul class="compact">
              <li class="listitem">
                <p>
                  Squad crée un cache du web&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT  -p tcp --sport 80 -m conntrack --ctstate ESTABLISHED \
  -j ACCEPT</code></pre>
              </li>
              <li class="listitem">
                <p>
                  Votre serveur de cache de noms de domaines (p. ex. named)
                  lance ses requêtes en UDP&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A OUTPUT -p udp --dport 53 -j ACCEPT</code></pre>
              </li>
              <li class="listitem">
                <p>
                  Si vous voulez pouvoir envoyer un ping à votre ordinateur
                  pour vous assurer qu'il est toujours lancé&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A INPUT  -p icmp -m icmp --icmp-type echo-request -j ACCEPT
iptables -A OUTPUT -p icmp -m icmp --icmp-type echo-reply   -j ACCEPT</code></pre>
              </li>
              <li class="listitem">
                <p>
                  <a id="fw-BB-4-ipt" name="fw-BB-4-ipt"></a> Si vous accéder
                  souvent à des serveurs FTP ou que vous tchattez en ligne,
                  vous pourriez remarquer des délais à cause
                  d'implémentations de ces démons qui tentent d'accéder à un
                  démon identd sur votre système pour obtenir des noms
                  d'utilisateur. Bien que se soit plutôt bénin, de nombreux
                  experts en sécurité recommandent de ne pas avoir un identd
                  sur sa machine parce qu'ils ont l'impression qu'il donne
                  trop d'information.
                </p>
                <p>
                  Pour éviter ces délais vous pouvez rejeter les requêtes
                  avec une réponse «&nbsp;tcp-reset&nbsp;»&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A INPUT  -p tcp --dport 113 -j REJECT --reject-with tcp-reset</code></pre>
              </li>
              <li class="listitem">
                <p>
                  Pour enregistrer et jeter les paquets invalides (des
                  paquets qui arrivent après le délai d'attente de netfilter
                  ou certains types de scan réseau) ajoutez ces règles au
                  début de la chaîne&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -I INPUT 0 -p tcp -m conntrack --ctstate INVALID \
  -j LOG --log-prefix "FIREWALL:INVALID "
iptables -I INPUT 1 -p tcp -m conntrack --ctstate INVALID -j DROP</code></pre>
              </li>
              <li class="listitem">
                <p>
                  Tout ce qui vient de l'extérieur ne devrait pas avoir une
                  adresse privée, c'est une attaque courante par usurpation
                  d'IP&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A INPUT -i WAN1 -s 10.0.0.0/8     -j DROP
iptables -A INPUT -i WAN1 -s 172.16.0.0/12  -j DROP
iptables -A INPUT -i WAN1 -s 192.168.0.0/16 -j DROP</code></pre>
                <p>
                  Il y a d'autres adresses que vous pourriez vouloir
                  jeter&nbsp;: 0.0.0.0/8, 127.0.0.0/8,224.0.0.0/3 (multicast
                  et expérimental), 169.254.0.0/16 (réseaux lien-local) et
                  192.0.2.0/24 (réseau de test défini par l'IANA).
                </p>
              </li>
              <li class="listitem">
                <p>
                  Si votre pare-feu est un client DHCP, vous devez autoriser
                  ces paquets&nbsp;:
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A INPUT  -i WAN1 -p udp -s 0.0.0.0 --sport 67 \
   -d 255.255.255.255 --dport 68 -j ACCEPT</code></pre>
              </li>
              <li class="listitem">
                <p>
                  Pour simplifier le débogage et être honnête avec ceux qui
                  voudraient accéder à un service que vous avez désactivé, à
                  dessein ou par erreur, vous pouvez utiliser REJECT pour les
                  paquet qui sont jetés.
                </p>
                <p>
                  Évidemment, vous devez faire cela directement après
                  l'enregistrement dans les journaux sur les toutes dernières
                  lignes avant que les paquets ne soient jetés par la
                  politique.
                </p>
                <pre class="screen"><code class=
                "literal">iptables -A INPUT -j REJECT</code></pre>
              </li>
            </ul>
          </div>
          <p>
            Ce ne sont que des exemples pour vous montrer certaines
            possibilités du pare-feu sur Linux. Consultez la page de manuel
            d'iptables. Vous y trouverez bien plus d'informations. Les
            numéros de port requis pour cela se trouvent dans <code class=
            "filename">/etc/services</code> au cas où vous ne les trouviez
            pas dans vos journaux par essai et erreur.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="iptables-init" name="iptables-init"></a> Unité Systemd
          </h3>
          <p>
            Pour paramétrer le pare-feu d'iptables au démarrage, installez
            l'unité <code class="filename">iptables.service</code> fournie
            dans le paquet <a class="xref" href=
            "../introduction/systemd-units.html" title=
            "Unités Systemd de BLFS">blfs-systemd-units-20210819</a>.
          </p>
          <pre class="root"><kbd class=
          "command">make install-iptables</kbd></pre>
        </div>
      </div>
      <div class="content" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Contenu
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Programmes installés:</strong>
              <span class="segbody">ip6tables, ip6tables-apply,
              ip6tables-legacy, ip6tables-legacy-restore,
              ip6tables-legacy-save, ip6tables-restore, ip6tables-save,
              iptables, iptables-apply, iptables-legacy,
              iptables-legacy-restore, iptables-legacy-apply,
              iptables-restore, iptables-save, iptables-xml, nfsynproxy
              (facultatif) et xtables-multi</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Bibliothèques installées:</strong>
              <span class="segbody">libip4tc.so, libip6tc.so, libipq.so,
              libiptc.so et libxtables.so</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Répertoires installés:</strong>
              <span class="segbody">/lib/xtables et
              /usr/include/libiptc</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Descriptions courtes
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="iptables-prog" name=
                    "iptables-prog"></a><span class="term"><span class=
                    "command"><strong>iptables</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour paramétrer, maintenir et inspecter les
                    tables de règles de filtrage de paquets IP du noyau Linux
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-apply" name=
                    "iptables-apply"></a><span class="term"><span class=
                    "command"><strong>iptables-apply</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est une manière plus sure de mettre à jour iptables à
                    distance
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-legacy" name=
                    "iptables-legacy"></a><span class="term"><span class=
                    "command"><strong>iptables-legacy</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour interagir avec iptables par l'ensemble
                    de commandes obsolète
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-legacy-restore" name=
                    "iptables-legacy-restore"></a><span class=
                    "term"><span class=
                    "command"><strong>iptables-legacy-restore</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour restaurer un ensemble de règles iptables
                    obsolètes
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-legacy-save" name=
                    "iptables-legacy-save"></a><span class=
                    "term"><span class="command"><strong>iptables-legacy-save</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour sauvegarder un ensemble de règles
                    iptables obsolètes
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-restore" name=
                    "iptables-restore"></a><span class="term"><span class=
                    "command"><strong>iptables-restore</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour restaurer des tables IP à partir de
                    données spécifiées sur STDIN. Utilise la redirection E/S
                    fournie par votre shell pour lire un fichier
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-save" name=
                    "iptables-save"></a><span class="term"><span class=
                    "command"><strong>iptables-save</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour envoyer le contenu d'une table IP dans
                    un format facilement analysable vers STDOUT. Utilisez la
                    redirection E/S fournie par votre shell pour écrire dans
                    un fichier
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="iptables-xml" name="iptables-xml"></a><span class=
                    "term"><span class=
                    "command"><strong>iptables-xml</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est utilisé pour convertir la sortie de <span class=
                    "command"><strong>iptables-save</strong></span> au format
                    XML. L'utilisation de la feuille de style <code class=
                    "filename">iptables.xslt</code> convertit le fond XML au
                    format <span class=
                    "command"><strong>iptables-restore</strong></span>
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ip6tables" name="ip6tables"></a><span class=
                    "term"><span class=
                    "command"><strong>ip6tables*</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    sont un ensemble de commandes pour IPV6 qui sont
                    similaires aux commandes iptables vu précédemment
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="nfsynproxy" name="nfsynproxy"></a><span class=
                    "term"><span class=
                    "command"><strong>nfsynproxy</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    (facultatif) outil de configuration. La cible synproxy
                    facilite la manipulation des grands afflux de SYN sans
                    les lourdes pertes de performance imposées par le suivi
                    des connexions dans de tels cas
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="xtables-multi" name=
                    "xtables-multi"></a><span class="term"><span class=
                    "command"><strong>xtables-multi</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    est un binaire qui se comporte en fonction du nom par
                    lequel il est appelé
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="haveged.html" title=
          "Haveged-1.9.14">Précédent</a>
          <p>
            Haveged-1.9.14
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="firewall.html" title=
          "Paramétrer un pare-feu réseau">Suivant</a>
          <p>
            Paramétrer un pare-feu réseau
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="security.html" title=
          "Chapitre&nbsp;4.&nbsp;Sécurité">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
