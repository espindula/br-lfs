<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      Logrotate-3.18.1
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-914+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">systemd)</span> - Version r10.1-914+
      </h4>
      <h3>
        Chapitre&nbsp;12.&nbsp;Outils systèmes
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="lm_sensors.html" title=
          "lm-sensors-3-6-0">Précédent</a>
          <p>
            lm-sensors-3-6-0
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="mc.html" title="MC-4.8.27">Suivant</a>
          <p>
            MC-4.8.27
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="sysutils.html" title=
          "Chapitre&nbsp;12.&nbsp;Outils systèmes">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-914+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="logrotate" name="logrotate"></a>Logrotate-3.18.1
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Introduction à Logrotate
        </h2>
        <p>
          Le paquet <span class="application">logrotate</span> permet la
          rotation automatique, la compression, la suppression et l'envoi par
          mail des fichiers de log.
        </p>
        <p>
          This package still needs to be checked.
        </p>
        <h3>
          Informations sur le paquet
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Téléchargement (HTTP)&nbsp;: <a class="ulink" href=
                "https://github.com/logrotate/logrotate/releases/download/3.18.1/logrotate-3.18.1.tar.xz">
                https://github.com/logrotate/logrotate/releases/download/3.18.1/logrotate-3.18.1.tar.xz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Téléchargement (FTP)&nbsp;: <a class="ulink" href=""></a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Somme de contrôle MD5 du téléchargement&nbsp;:
                07d5aba26c350f9ab5730c25a7277751
              </p>
            </li>
            <li class="listitem">
              <p>
                Taille du téléchargement&nbsp;: 160&nbsp;Ko
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation de l'espace disque requis&nbsp;: 39&nbsp;Mo (avec
                les tests)
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimation du temps de construction&nbsp;: 0.1&nbsp;SBU (avec
                les tests)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Dépendances de Logrotate
        </h3>
        <h4>
          Requises
        </h4>
        <p class="required">
          <a class="xref" href="popt.html" title="Popt-1.18">popt-1.18</a>
        </p>
        <h4>
          Facultatives
        </h4>
        <p class="optional">
          Un <a class="xref" href="../server/mail.html" title=
          "Chapitre&nbsp;21.&nbsp;Serveurs de messagerie électronique">MTA</a>
          (à l'exécution)
        </p>
        <p class="usernotes">
          Notes utilisateur&nbsp;: <a class="ulink" href=
          "https://wiki.linuxfromscratch.org/blfs/wiki/logrotate">https://wiki.linuxfromscratch.org/blfs/wiki/logrotate</a>
        </p>
      </div>
      <div class="installation" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Installation de Logrotate
        </h2>
        <p>
          Installez <span class="application">logrotate</span> en lançant les
          commandes suivantes&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">./configure --prefix=/usr &amp;&amp;
make</kbd></pre>
        <p>
          Pour tester les résultats, lancez&nbsp;: <span class=
          "command"><strong>make test</strong></span>. Un test échoue parce
          que la vieille commande <span class=
          "command"><strong>compress</strong></span> n'est pas présente et
          deux tests échouent si un MTA n'est pas installé.
        </p>
        <p>
          Maintenant, en tant qu'utilisateur <code class=
          "systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class="command">make install</kbd></pre>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Configuration de Logrotate
        </h2>
        <p>
          <span class="application">Logrotate</span> nécessite un fichier de
          configuration, qui peut être passé en argument à la commande quand
          elle est lancée. Créez le fichier en tant qu'utilisateur
          <code class="systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class=
        "command">cat &gt; /etc/logrotate.conf &lt;&lt; EOF
<code class="literal"># Begin /etc/logrotate.conf

# Rotate log files weekly
weekly

# Don't mail logs to anybody
nomail

# If the log file is empty, it will not be rotated
notifempty

# Number of backups that will be kept
# This will keep the 2 newest backups only
rotate 2

# Create new empty files after rotating old ones
# This will create empty log files, with owner
# set to root, group set to sys, and permissions 664
create 0664 root sys

# Compress the backups with gzip
compress

# No packages own lastlog or wtmp -- rotate them here
/var/log/wtmp {
    monthly
    create 0664 root utmp
    rotate 1
}

/var/log/lastlog {
    monthly
    rotate 1
}

# Some packages drop log rotation info in this directory
# so we include any file in it.
include /etc/logrotate.d

# End /etc/logrotate.conf</code>
EOF

chmod -v 0644 /etc/logrotate.conf</kbd></pre>
        <p>
          Maintenant créez le répertoire <code class=
          "filename">/etc/logrotate.d</code> en tant qu'utilisateur
          <code class="systemitem">root</code>&nbsp;:
        </p>
        <pre class="root"><kbd class=
        "command">mkdir -p /etc/logrotate.d</kbd></pre>
        <p>
          Maintenant des commandes de rotation de log supplémentaires peuvent
          être entrées, typiquement dans le répertoire <code class=
          "filename">/etc/logrotate.d</code>. Par exemple&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">cat &gt; /etc/logrotate.d/sys.log &lt;&lt; EOF
<code class="literal">/var/log/sys.log {
   # If the log file is larger than 100kb, rotate it
   size   100k
   rotate 5
   weekly
   postrotate
      /bin/killall -HUP syslogd
   endscript
}</code>
EOF

chmod -v 0644 /etc/logrotate.d/sys.log</kbd></pre>
        <p>
          Vous pouvez indiquer des fichiers multiples dans une seule
          entrée&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">cat &gt; /etc/logrotate.d/example.log &lt;&lt; EOF
<code class="literal">file1
file2
file3 {
   ...
   postrotate
    ...
   endscript
}</code>
EOF

chmod -v 0644 /etc/logrotate.d/example.log</kbd></pre>
        <p>
          Vous pouvez utiliser dans la même ligne la liste de fichiers: file1
          file2 file3. Regardez la page de man de logrotate ou <a class=
          "ulink" href=
          "http://www.techrepublic.com/article/manage-linux-log-files-with-logrotate/">
          http://www.techrepublic.com/article/manage-linux-log-files-with-logrotate/</a>
          pour plus d'exemples.
        </p>
        <p>
          La commande <span class="command"><strong>logrotate
          /etc/logrotate.conf</strong></span> peut être lancée manuellement,
          cependant, la commande devrait être lancée quotidiennement.
          D'autres commandes utiles sont <span class=
          "command"><strong>logrotate -d /etc/logrotate.conf</strong></span>
          pour le débogage et <span class="command"><strong>logrotate -f
          /etc/logrotate.conf</strong></span> pour forcer les commandes à
          être lancée immédiatement. En combinant les options <code class=
          "option">-df</code>, vous pouvez déboguer les effets des commandes
          forcées. Pendant le débogage, la commande est seulement simulée,
          pas vraiment lancée, donc, éventuellement des erreurs qui
          n'existent pas apparaissent, quand des fichiers intermédiaires sont
          attendus, car ils ne sont pas réellement créés.
        </p>
        <p>
          Pour lancer <span class="command"><strong>logrotate</strong></span>
          quotidiennement, <span class="phrase">exécutez</span> les commandes
          suivantes en tant qu'utilisateur <code class=
          "systemitem">root</code> pour créer <span class="phrase">un timer
          systemd qui sera lancé tous les jours à 3 heures du matin (heure
          locale)&nbsp;:</span>
        </p>
        <pre class="root"><kbd class=
        "command">cat &gt; /usr/lib/systemd/system/logrotate.service &lt;&lt; "EOF" &amp;&amp;
<code class="literal">[Unit]
Description=Runs the logrotate command
Documentation=man:logrotate(8)
DefaultDependencies=no
After=local-fs.target
Before=shutdown.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/sbin/logrotate /etc/logrotate.conf</code>
EOF
cat &gt; /usr/lib/systemd/system/logrotate.timer &lt;&lt; "EOF" &amp;&amp;
<code class="literal">[Unit]
Description=Runs the logrotate command daily at 3:00 AM

[Timer]
OnCalendar=*-*-* 3:00:00
Persistent=true

[Install]
WantedBy=timers.target</code>
EOF
systemctl enable logrotate.timer</kbd></pre>
      </div>
      <div class="content" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Contenu
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Programmes installés:</strong>
              <span class="segbody">logrotate</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Bibliothèque installée:</strong>
              <span class="segbody">Aucune</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Répertoires installés:</strong>
              <span class="segbody">Aucun</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Descriptions courtes
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="logrotate-prog" name=
                    "logrotate-prog"></a><span class="term"><span class=
                    "command"><strong>logrotate</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    fournit des fonctions de maintenance de log défini dans
                    les fichiers de configuration
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="lm_sensors.html" title=
          "lm-sensors-3-6-0">Précédent</a>
          <p>
            lm-sensors-3-6-0
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="mc.html" title="MC-4.8.27">Suivant</a>
          <p>
            MC-4.8.27
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="sysutils.html" title=
          "Chapitre&nbsp;12.&nbsp;Outils systèmes">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition systemd) - Version r10.1-914+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
