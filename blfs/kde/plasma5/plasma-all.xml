<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
 <!ENTITY % general-entities SYSTEM "../../general.ent">
 %general-entities;
  <!ENTITY plasma5-download-http "http://download.kde.org/stable/plasma/&plasma5-version;">
  <!ENTITY plasma5-download-ftp  " ">
  <!ENTITY plasma5-md5sum        "See Below">
  <!ENTITY plasma5-size          "129 Mo">
  <!ENTITY plasma5-buildsize     "933 Go">
  <!ENTITY plasma5-time          "15 SBU (using parallelism=6)">
]>
<sect1 id="plasma5-build" xreflabel="Plasma-&plasma5-version;">
  <?dbhtml filename="plasma-all.html"?>
  <sect1info>
     <othername>$LastChangedBy: bdubbs $</othername>
     <date>$Date: 2015-09-24 16:44:04 -0500 (Thu, 24 Sep 2015) $</date>
  </sect1info>
  <title>Construction de Plasma 5</title>
  <indexterm zone="plasma5-build">
     <primary sortas="a-kf5">KDE Plasma 5</primary>
  </indexterm>
  <para>KDE Plasma 5 est une collection de paquets basés sur KDE Frameworks
  5 et QML. Il est dérivé du bureau monolithique KDE 4. Ils implémentent l'environnement d'affichage KDE
  (Plasma 5).</para>

  &lfs78_checked;


  <para>Les instructions suivantes construisent tous les paquets Plasma 5 en une étape en utilisant un script
  bash.  </para>
  <bridgehead renderas="sect3">Information sur le paquet </bridgehead>
  <itemizedlist spacing="compact">
    <listitem>
      <para>Téléchargement (HTTP) : <ulink url="&plasma5-download-http;"/></para>
    </listitem>
    <listitem>
      <para>Téléchargement (FTP) : <ulink url="&plasma5-download-ftp;"/></para>
    </listitem>
    <listitem>
      <para>Somme de contrôle MD5 du téléchargement : &plasma5-md5sum;</para>
    </listitem>
    <listitem>
      <para>Taille du téléchargement : &plasma5-size;</para>
    </listitem>
    <listitem>
      <para>Estimation de l'espace disque requis : &plasma5-buildsize;</para>
    </listitem>
    <listitem>
      <para>Estimation du temps de construction : &plasma5-time;</para>
    </listitem>
  </itemizedlist>
  <bridgehead renderas="sect3">Dépendances de Plasma 5</bridgehead>
  <bridgehead renderas="sect4">Requises</bridgehead>
  <para role="required">
    <xref linkend="fontforge"/>,
    <xref linkend="gtk2"/>,
    <xref linkend="gtk3"/>,
    <xref linkend="kf5-frameworks"/>
    <xref linkend="libpwquality"/>,
    <xref linkend="libxkbcommon"/>,
    <xref linkend="mesa"/> construit avec <xref linkend="wayland"/>,
    <xref linkend="NetworkManager"/>,
    <xref linkend="pulseaudio"/>,
    <xref linkend="python2"/>,
    <xref linkend="taglib"/>, et
    <xref linkend="xcb-util-cursor"/>

  </para>
   <bridgehead renderas="sect4">Recommandées</bridgehead>
   <para role="recommended">
    <xref linkend="libdbusmenu-qt"/>,
    <xref linkend="libcanberra"/>,
    <xref linkend="libinput"/>,
    <xref linkend="linux-pam"/>,
    <xref linkend="lm_sensors"/>,
    <xref linkend="oxygen-icons"/>, et
    <xref linkend="pciutils"/>
   </para>
   <bridgehead renderas="sect4">Facultatives</bridgehead>
   <para role="optional">
    <xref linkend="glu"/>,
    <xref linkend="xorg-synaptics-driver"/>,
    <ulink url="https://github.com/ibus/ibus/wiki">IBUS</ulink>,
    <ulink url="http://gpsd.berlios.de">libgps</ulink>,
    <ulink url="https://github.com/libhybris/libhybris">libhybris</ulink>,
    <ulink url="http://sourceforge.net/projects/libraw1394/">libraw1394</ulink>,
    <ulink url="https://bitbucket.org/godsme/mockcpp">mockcpp</ulink>,
   <ulink url="http://qalculate.sourceforge.net">Qalculate</ulink>,
    <ulink url="https://launchpad.net/qapt">Qapt</ulink>, et
    <ulink url="https://github.com/osiam/osiam">SCIM</ulink>
   </para>


  <para condition="html" role="usernotes">Notes utilisateur :
  <ulink url="&blfs-wiki;/kf5"/></para>
  <sect2>
    <title>Téléchargement de KDE Plasma5</title>
    <para>
      La meilleure façon d'avoir les paquets de KDE Plasma5 est d'utiliser un seul
      <command>wget</command> pour les avoir tous en meme temps :
    </para>

<screen>
<userinput>url=http://download.kde.org/stable/plasma/&plasma5-version;/
wget -r -nH --cut-dirs=3 -A '*.xz' -np $url
<literal>
The options used here are:
  -r            recurse through child directories
  -nH           disable generation of host-prefixed directories
  --cut-dirs=3  remove three levels of directories when saving
  -A '*.xz'     just get the *.xz files
  -np           don't get parent directories</literal></userinput>
</screen>
   </sect2>
  <sect2>
    <title>Initialisation de l'ordre des paquets</title>
    <para>
      L'ordre de construction des fichiers est important à cause des dépendances internes.
      Créez la liste des fichiers dans le bon ordre comme suivant:
    </para>
<screen>
<userinput>cat &gt; plasma-&kf5-version;.md5 &lt;&lt; "EOF"
<literal>cfff87d002b42b2487b522f94f157cb7  kwayland-5.4.1.tar.xz
bc8fd24c6ecd0948fc5adb3bda096f88  libkscreen-5.4.1.tar.xz
c48b9030d7f5e86dc1f07091c3695758  libksysguard-5.4.1.tar.xz
bd5a8def665759beab8170acd80ca53f  breeze-5.4.1.tar.xz
91e85616bd899d2a610311b2ca1de622  kwin-5.4.1.tar.xz
a56031b9600712eabcc0f6baeb8a2947  oxygen-5.4.1.tar.xz
88522f2478fdff511e02102861dab620  oxygen-fonts-5.4.1.tar.xz
99df60a8b2cc2b5c0f924a7c36cd9ad3  khelpcenter-5.4.1.tar.xz
2aab5a329f2b4b196cd3e130bdf00bc6  kinfocenter-5.4.1.tar.xz
68a6ffc478a63002cb183e64d1630d80  ksysguard-5.4.1.tar.xz
2701f56228b6b45155b35a98a4a25df7  systemsettings-5.4.1.tar.xz
0675ac84f739218cd1a17cfdc3d91e22  plasma-workspace-5.4.1.tar.xz
33eb66bcec1c7f27b1a6a7629042de8e  bluedevil-5.4.1.tar.xz
56a3a65f21fe1b78c409129dfdc48d9e  khotkeys-5.4.1.tar.xz
5533875aea1883ce0d59cd72f1b05c24  kmenuedit-5.4.1.tar.xz
2d656cd96b0910129890973c4ee01d01  kscreen-5.4.1.tar.xz
6064bd41f2a7cdbe97a5be84e1a87fe3  kwrited-5.4.1.tar.xz
030248d066c81093a954de64e51d31bf  milou-5.4.1.tar.xz
528b5d70f64450a7d6e31f55dde2b155  plasma-nm-5.4.1.tar.xz
ff82dd9fdbaaf96a25f6a23f96bce5f7  plasma-workspace-wallpapers-5.4.1.tar.xz
0e27d8c01b108aa709a130466bc56a9a  polkit-kde-agent-1-5.4.1.tar.xz
cb6b2663a3fdac63561b87a340aa91df  powerdevil-5.4.1.tar.xz
823180ad53fafca7a6be56ab3f9ec2df  plasma-desktop-5.4.1.tar.xz
d91c7633eca6bad228003a168d6789b1  kdeplasma-addons-5.4.1.tar.xz
161710cb26d5fb123be4062656124934  kwayland-integration-5.4.1.tar.xz</literal>
EOF</userinput>
</screen>
  <para>Dans cette liste, notez que trois fichiers sont commentés avec #. L'entrée
  extra-cmake-modules est commentée car elle est construite précédement dans
  <xref linkend="kde-prereq"/>. Les autres peuvent être construit si les dépendances facultatives
  sont installées.</para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de Plasma5</title>
    &as_root;
    <caution>
      <para>Pour une installation dans /opt et qu'il y a un /opt/kf5 existant, soit comme répertoire ou lien
      symbolique, il peut être supprimé (en tant que root):</para>

<screen>
<userinput>bash -e</userinput>
</screen>
    </caution>
    <para>
      Commencez par démarrer un sosu-shell qui sortira s'il y a une erreur:
    </para>
<screen>
<userinput>while read -r line; do
    # Get the file name, ignoring comments and blank lines
    if $(echo $line | grep -E -q '^ *$|^#' ); then continue; fi
    file=$(echo $line | cut -d" " -f2)

    pkg=$(echo $file|sed 's|^.*/||')          # Remove directory
    packagedir=$(echo $pkg|sed 's|.tar.*||') # Package directory
    tar -xf $file
    pushd $packagedir
       mkdir build
       cd    build
       cmake -DCMAKE_INSTALL_PREFIX=$KF5_PREFIX                   -DCMAKE_BUILD_TYPE=Debug                             -DLIB_INSTALL_DIR=lib                                -DBUILD_TESTING=OFF                                  -DQML_INSTALL_DIR=lib/qt5/qml                        -DQT_PLUGIN_INSTALL_DIR=lib/qt5/plugins              -DECM_MKSPECS_INSTALL_DIR=$KF5_PREFIX/share/qt5/mkspecs/modules              -DOXYGEN_FONT_INSTALL_DIR=/usr/share/fonts/truetype/oxygen                   -Wno-dev ..  &amp;&amp;
        make
        as_root make install
    popd
    rm -rf $packagedir
    as_root /sbin/ldconfig
done &lt; plasma-&kf5-version;.md5
exit</userinput>
</screen>
    <para>
      Installez tous les paquets en lançant la suite

    </para>
    <note><para>Tous les modules qui ont été oubliés peuvent être installés plus tard en utilisant la même
    procédure mkdir build; cd build; cmake; make; make install que précédement.</para></note>
    <para>Parfois les chemins d'installation sont codés en dure dans les fichiers installés.
    Si le répertoire installé n'est pas /usr, renomez le répertoire ou créez un lien symbolique:</para>


  </sect2>
    <sect2 role="commands">
    <title>Explications des commandes</title>

     <para>
      <command>ln -sfv ../code/$(basename $j) $(dirname $j)/../ui/</command>:
      Crée des liens symboliques pour que les fichiers qml puissent trouver les modules javascript nécéssaire.
     </para>

  </sect2>
  <sect2 role="starting">
    <title>Démarrage de Plasma5</title>
    <para>
      Vous pouvez démarrer <application>Plasma5</application> depuis le runlevel 3, en utilisant
      <xref linkend="xinit"/>, ou depuis le runlevel 5, en utilisant un gestionnaire d'affichage,
      comme <xref linkend="sddm"/>.
    </para>
    <para>
      Pour démarrer <application>Plasma5</application> en utilisant <xref linkend="xinit"/>,
      lancez les commandes suivantes:
    </para>
<screen><userinput>cat &gt; ~/.xinitrc &lt;&lt; "EOF"
<literal>ck-launch-session dbus-launch --exit-with-session $KF5_PREFIX/bin/startkde</literal>
EOF
startx</userinput></screen>
    <para>
      La session X démarrer dans le premier terminal virtuel inutilisé, normallement vt7.
      VOus pouvez passer à un autre vt<emphasis>n</emphasis> en appuyant simultanément les touches
      Ctrl-Alt-F<emphasis>n</emphasis>
      (<emphasis>n</emphasis>=1, 2, ...).  Pour aller sur la session X, normallement démarrée sur vt7, utilisez
      Ctrl-Alt-F7. Le vt ou la commande
      <command>startx</command> est exacuté affichera beaucoup de messages, incluant les messages de demarrage de X,
      les applications automatiquement démarrées avec la session, et eventuellement, quelques avertissements et
      messages d'erreur. Vous pouvez préférer rediriger ces messages dans un fichier de log, qui non seulement
      laissera le vt initial propre, mais pourra aussi être utilisé pour des questions de deboguage. Cela peut être
      fait en démarrant X avec:
    </para>
    <screen><userinput>startx &amp;&gt; ~/.x-session-errors</userinput></screen>
    <note>
      <para>
        Vous pouvez souhaiter éviter consolekit et/ou dbus-launch, e.g., en utilisant juste
        startkde dans ~/.xinitrc. Cependant quelques fonctionnalités comme le montage ou le démontage
        des systèmes de fichiers depuis un gestionnaire de fichiers ne seront pas possible, ou l'option de
        redémarrage peut être absente ou inopérant, en plus d'autres problèmes.
      </para>
    </note>
    <para>
      Au redémarrage ou à l'arret, les messages d'arrêt apparaissent sur le vt ou X était lancé. si vous voulez voir
      ces messages, appuyez simultanément sur Alt-F7 (en considérant que X était lancé sur vt7).
    </para>
  </sect2>

  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
         <seg>
           Il y a trop de programmes plasma (50 dans /opt/kf5/bin) pour les lister séparément ici.
         </seg>
         <seg>
           Il y a trop de bibliothèques plasma (39 dans /opt/kf5/lib) pour les lister séparément ici.
         </seg>
         <seg>
           Il y a trop de répertoires plasma (plus de 1000 dans /opt/kf5) pour les lister séparément ici.
         </seg>
      </seglistitem>
    </segmentedlist>
  </sect2>
</sect1>
