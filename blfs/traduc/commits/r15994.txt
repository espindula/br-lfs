Révision 15994

fichiers modifiés :
M       scripts/blfs-include.php
M       scripts/blfs-chapter20.php
M       scripts/blfs-chapter04.php
M       scripts/blfs-chapter40.php
M       scripts/blfs-chapter05.php
M       scripts/blfs-chapter24.php
M       scripts/blfs-chapter06.php
M       scripts/blfs-chapter25.php
M       scripts/blfs-chapter43.php
M       scripts/blfs-chapter26.php
M       scripts/blfs-chapter27.php
M       scripts/blfs-chapter09.php
M       scripts/blfs-chapter29.php
M       scripts/blfs-chapter10.php
M       scripts/blfs-chapter11.php
M       scripts/blfs-chapter30.php
M       scripts/blfs-chapter12.php
M       scripts/blfs-chapter31.php
M       scripts/blfs-chapter13.php
M       scripts/blfs-chapter32.php
M       scripts/blfs-chapter14.php
M       scripts/blfs-chapter34.php
M       scripts/blfs-chapter17.php
M       scripts/blfs-chapter36.php
M       scripts/blfs-chapter39.php

Log :
Finish updates to currency scripts

Le robot a traité 11 % du commit anglais
Index: scripts/blfs-chapter04.php
===================================================================
--- scripts/blfs-chapter04.php	(révision 15993)
+++ scripts/blfs-chapter04.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = "4";
+$CHAPTERS      = "Chapters 2-4";
 $START_PACKAGE = "blfs-bootscripts";
 $STOP_PACKAGE  = "tripwire";
 

Index: scripts/blfs-chapter05.php
===================================================================
--- scripts/blfs-chapter05.php	(révision 15993)
+++ scripts/blfs-chapter05.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '5';
+$CHAPTERS      = 'Chapter 5';
 $START_PACKAGE = 'fuse';
 $STOP_PACKAGE  = 'xfsprogs';
 

Index: scripts/blfs-chapter06.php
===================================================================
--- scripts/blfs-chapter06.php	(révision 15993)
+++ scripts/blfs-chapter06.php	(révision 15994)
@@ -3,9 +3,10 @@
 
 include 'blfs-include.php';
 
-$CHAPTER=6;
-$START_PACKAGE='bluefish';
-$STOP_PACKAGE='qemu';
+$CHAPTER       = '6';
+$CHAPTERS      = 'Chapters 6-8';
+$START_PACKAGE = 'bluefish';
+$STOP_PACKAGE  = 'qemu';
 
 $renames = array();
 $renames[ 'zsh1' ] = 'zsh-doc';

Index: scripts/blfs-chapter09.php
===================================================================
--- scripts/blfs-chapter09.php	(révision 15993)
+++ scripts/blfs-chapter09.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '9';
+$CHAPTERS      = 'Chapter 9';
 $START_PACKAGE = 'apr';
 $STOP_PACKAGE  = 'xapian-core';
 

Index: scripts/blfs-chapter10.php
===================================================================
--- scripts/blfs-chapter10.php	(révision 15993)
+++ scripts/blfs-chapter10.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '10';
+$CHAPTERS      = 'Chapter 10';
 $START_PACKAGE = 'aalib';
 $STOP_PACKAGE  = 'qpdf';
 

Index: scripts/blfs-chapter11.php
===================================================================
--- scripts/blfs-chapter11.php	(révision 15993)
+++ scripts/blfs-chapter11.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '11';
+$CHAPTERS      = 'Chapter 11';
 $START_PACKAGE = 'compface';
 $STOP_PACKAGE  = 'unixODBC';
 

Index: scripts/blfs-chapter12.php
===================================================================
--- scripts/blfs-chapter12.php	(révision 15993)
+++ scripts/blfs-chapter12.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '12';
+$CHAPTERS      = 'Chapter 12';
 $START_PACKAGE = 'acpid';
 $STOP_PACKAGE  = 'zip';
 

Index: scripts/blfs-chapter13.php
===================================================================
--- scripts/blfs-chapter13.php	(révision 15993)
+++ scripts/blfs-chapter13.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '13';
+$CHAPTERS      = 'Chapter 13';
 $START_PACKAGE = 'check';
 $STOP_PACKAGE  = 'junit';
 

Index: scripts/blfs-chapter14.php
===================================================================
--- scripts/blfs-chapter14.php	(révision 15993)
+++ scripts/blfs-chapter14.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '14';
+$CHAPTERS      = 'Chapters 14-16';
 $START_PACKAGE = 'dhcpcd';
 $STOP_PACKAGE  = 'wireshark';
 

Index: scripts/blfs-chapter17.php
===================================================================
--- scripts/blfs-chapter17.php	(révision 15993)
+++ scripts/blfs-chapter17.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '17';
+$CHAPTERS      = 'Chapters 17-19';
 $START_PACKAGE = 'curl';
 $STOP_PACKAGE  = 're-alpine';
 

Index: scripts/blfs-chapter20.php
===================================================================
--- scripts/blfs-chapter20.php	(révision 15993)
+++ scripts/blfs-chapter20.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '20';
+$CHAPTERS      = 'Chapters 20-23';
 $START_PACKAGE = 'httpd';
 $STOP_PACKAGE  = 'xinetd';
 

Index: scripts/blfs-chapter24.php
===================================================================
--- scripts/blfs-chapter24.php	(révision 15993)
+++ scripts/blfs-chapter24.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '24';
+$CHAPTERS      = 'Chapter 24';
 $START_PACKAGE = 'util-macros';
 $STOP_PACKAGE  = 'xinit';
 

Index: scripts/blfs-chapter25.php
===================================================================
--- scripts/blfs-chapter25.php	(révision 15993)
+++ scripts/blfs-chapter25.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '25';
+$CHAPTERS      = 'Chapter 25';
 $START_PACKAGE = 'atk';
 $STOP_PACKAGE  = 'webkitgtk-2.8';
 

Index: scripts/blfs-chapter26.php
===================================================================
--- scripts/blfs-chapter26.php	(révision 15993)
+++ scripts/blfs-chapter26.php	(révision 15994)
@@ -4,8 +4,9 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '26';
-$START_PACKAGE ='fluxbox';
-$STOP_PACKAGE  ='sawfish';
+$CHAPTERS      = 'Chapter 26';
+$START_PACKAGE = 'fluxbox';
+$STOP_PACKAGE  = 'sawfish';
 
 $renames = array();
 $renames[ 'sawfish_' ] = 'sawfish';

Index: scripts/blfs-chapter27.php
===================================================================
--- scripts/blfs-chapter27.php	(révision 15993)
+++ scripts/blfs-chapter27.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '27';
+$CHAPTERS      = 'Chapters 27-28';
 $START_PACKAGE = 'automoc4';
 $STOP_PACKAGE  = 'kde-workspace';
 

Index: scripts/blfs-chapter29.php
===================================================================
--- scripts/blfs-chapter29.php	(révision 15993)
+++ scripts/blfs-chapter29.php	(révision 15994)
@@ -4,8 +4,9 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '29';
-$START_PACKAGE ='konsole';
-$STOP_PACKAGE  ='gwenview';
+$CHAPTERS      = 'Chapter 29';
+$START_PACKAGE = 'konsole';
+$STOP_PACKAGE  = 'gwenview';
 
 $renames = array();
 $ignores = array();

Index: scripts/blfs-chapter30.php
===================================================================
--- scripts/blfs-chapter30.php	(révision 15993)
+++ scripts/blfs-chapter30.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '30';
+$CHAPTERS      = 'Chapter 30';
 $START_PACKAGE = 'gsettings-desktop-schemas';
 $STOP_PACKAGE  = 'yelp';
 

Index: scripts/blfs-chapter31.php
===================================================================
--- scripts/blfs-chapter31.php	(révision 15993)
+++ scripts/blfs-chapter31.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '31';
+$CHAPTERS      = 'Chapter 31';
 $START_PACKAGE ='baobab';
 $STOP_PACKAGE  ='seahorse';
 

Index: scripts/blfs-chapter32.php
===================================================================
--- scripts/blfs-chapter32.php	(révision 15993)
+++ scripts/blfs-chapter32.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '32';
+$CHAPTERS      = 'Chapters 32-33';
 $START_PACKAGE = 'libxfce4util';
 $STOP_PACKAGE  = 'xfce4-notifyd';
 

Index: scripts/blfs-chapter34.php
===================================================================
--- scripts/blfs-chapter34.php	(révision 15993)
+++ scripts/blfs-chapter34.php	(révision 15994)
@@ -4,6 +4,7 @@
 include 'blfs-include.php';
 
 $CHAPTER       = '34';
+$CHAPTERS      = 'Chapters 34-35';
 $START_PACKAGE = 'lxmenu-data';
 $STOP_PACKAGE  = 'lxterminal';
 

Index: scripts/blfs-chapter36.php
===================================================================
--- scripts/blfs-chapter36.php	(révision 15993)
+++ scripts/blfs-chapter36.php	(révision 15994)
@@ -1,25 +1,20 @@
 #! /usr/bin/php
 <?php
 
-$CHAPTER       = 36;
-$START_PACKAGE ='abiword';
-$STOP_PACKAGE  ='xscreensaver';
-$start         = false;
+include 'blfs-include.php';
 
-$freedesk = "http://xorg.freedesktop.org/releases/individual";
-$sf       = 'sourceforge.net';
+$CHAPTER       = '36';
+$CHAPTERS      = 'Chapters 36-38';
+$START_PACKAGE = 'abiword';
+$STOP_PACKAGE  = 'xscreensaver';
 
-$book = array();
-$book_index = 0;
+$renames = array();
+$ignores = array();
 
-$vers = array();
+$libreoffice = array();
 
-date_default_timezone_set( "GMT" );
-$date = date( "Y-m-d (D) H:i:s" );
+//$current="fontforge";
 
-// Special cases
-$exceptions = array();
 $regex = array();
 $regex[ 'inkscape'     ] = "/^.*Latest.*(\d[\d\.]+\d).*$/";
 $regex[ 'gnucash'      ] = "/^.*Download gnucash-(\d[\d\.]+\d).tar.*$/";
@@ -30,22 +25,19 @@
 $regex[ 'tigervnc'     ] = "/^.*TigerVNC (\d[\d\.]+\d).*$/";
 $regex[ 'transmission' ] = "/^.*release version.*(\d[\d\.]+\d).*$/";
 
-//$current="fontforge";
-$libreoffice = array();
 $url_fix = array (
 
    array( 'pkg'     => 'gnucash',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gnucash/files" ),
+          'replace' => "http://sourceforge.net/projects/gnucash/files" ),
 
    array( 'pkg'     => 'gnucash-docs',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gnucash/files/gnucash-docs" ),
+          'replace' => "http://sourceforge.net/projects/gnucash/files/gnucash-docs" ),
 
    array( 'pkg'     => 'asymptote',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/asymptote/files" ),
+          'replace' => "http://sourceforge.net/projects/asymptote/files" ),
 
    array( 'pkg'     => 'libreoffice',
           'match'   => '^.*$', 
@@ -66,7 +58,6 @@
    array( 'pkg'     => 'gimp',
           'match'   => '^.*$', 
           'replace' => "http://download.gimp.org/pub/gimp" ),
-//'replace' => "ftp://mirrors.xmission.com/gimp/gimp" ),
 
    array( 'pkg'     => 'gimp-help',
           'match'   => '^.*$', 
@@ -78,7 +69,7 @@
 
    array( 'pkg'     => 'gparted',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gparted/files/gparted" ),
+          'replace' => "http://sourceforge.net/projects/gparted/files/gparted" ),
 
    array( 'pkg'     => 'inkscape',
           'match'   => '^.*$', 
@@ -86,11 +77,11 @@
 
    array( 'pkg'     => 'pidgin',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/pidgin/files" ),
+          'replace' => "http://sourceforge.net/projects/pidgin/files" ),
 
    array( 'pkg'     => 'rox-filer',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/rox/files/rox" ),
+          'replace' => "http://sourceforge.net/projects/rox/files/rox" ),
 
    array( 'pkg'     => 'tigervnc',
           'match'   => '^.*$', 
@@ -113,98 +104,9 @@
           'replace' => "https://www.transmissionbt.com/download" ),
 
 );
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-function find_max( $lines, $regex_match, $regex_replace )
-{
-global $book_index;
-$a = array();
 
-foreach ( $lines as $line )
-{
-// Ensure we skip verbosity of NcFTP
-if ( ! preg_match( $regex_match,   $line ) ) continue; 
-if (   preg_match( "/NcFTP/",      $line ) ) continue;
-if (   preg_match( "/Connecting/", $line ) ) continue;
-if (   preg_match( "/Current/",    $line ) ) continue;
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-// Numbers and whitespace
-if ( "x$slice" == "x$line" && ! preg_match( "/^\d[\d\.P-]*$/", $slice ) ) continue; 
-// Skip minor versions in the 90s (most of the time)
-list( $major, $minor, $micro, $rest ) = explode( ".", $slice . ".0.0.0.0" );
-if ( $micro >= 80  &&  $book_index != "automoc4" ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//----------------------------------------------------------
-function find_even_max( $lines, $regex_match, $regex_replace )
-{
-$a = array();
-foreach ( $lines as $line )
-{
-if ( ! preg_match( $regex_match, $line ) ) continue; 
-
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-if ( "x$slice" == "x$line" && ! preg_match( "/^[\d\.]+/", $slice ) ) continue; 
-
-// Skip odd numbered minor versions
-list( $major, $minor, $rest ) = explode( ".", $slice . ".0" );
-if ( $minor % 2 == 1  ) continue;
-if ( $minor     >= 90 ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//===========================================
-function http_get_file( $url )
-{
-//exec( "curl -L -s -m30 -A Firefox $url", $dir );
-if (  ! preg_match( '/hexchat/', $url )  && 
-! preg_match( '/tigervnc/', $url ) )
-exec( "curl -L -s -tlsv1 -m30 -A Firefox $url", $dir );
-else
-exec( "wget -q --no-check-certificate -O - $url", $dir );
-$s   = implode( "\n", $dir );
-$dir = strip_tags( $s );
-return explode( "\n", $dir );
-}
-//=====================================================
-function max_parent( $dirpath, $prefix )
-{
-// First, remove a directory
-$dirpath  = rtrim  ( $dirpath, "/" );    // Trim any trailing slash
-$position = strrpos( $dirpath, "/" );
-$dirpath  = substr ( $dirpath, 0, $position );
-$lines = http_get_file( $dirpath );
-$regex_match   = "#${prefix}[\d\.]+/#";
-$regex_replace = "#^(${prefix}[\d\.]+)/.*$#";
-$max           = find_max( $lines, $regex_match, $regex_replace );
-return "$dirpath/$max"; 
-}
-/////////////////////////////////////////////////////////////////
 function get_packages( $package, $dirpath )
 {
-global $exceptions;
   global $regex;
   global $book_index;
   global $url_fix;
@@ -303,13 +205,12 @@
         $dir      = find_max( $dirs, "/v\d\./", "/^.*(v\d\.[\d\.]+).*$/" );
          $dirpath .= "/$dir/";
      }
-//echo "dirpath=$dirpath\n";
      $lines = http_get_file( $dirpath );
-//print_r($lines);
      if ( ! is_array( $lines ) ) return $lines;
   } // End fetch
 
@@ -354,14 +255,9 @@
   $max = find_max( $lines, "/$package/", "/^.*$package-([\d\.]*\d)\.tar.*$/" );
   return $max;
 }
-//********************************************************
-Function get_pattern( $line )
+function get_pattern( $line )
 {
-global $start;
-// Set up specific patter matches for extracting book versions
-$match = array();
    $match = array(
      //array( 'pkg'   => 'gimp-help', 
      //       'regex' => "/^.*gimp-help-(\d[\d\.]+).*$/" ),
@@ -378,111 +274,6 @@
    return "/\D*(\d.*\d)\D*$/";
 }
 
-function get_current()
-{
-global $vers;
-global $book;
-global $freedesk;
-global $START_PACKAGE;
-global $STOP_PACKAGE;
-global $start;
-$wget_file = "/home/bdubbs/public_html/blfs-book-xsl/wget-list";
-$contents = file_get_contents( $wget_file );
-$wget  = explode( "\n", $contents );
-foreach ( $wget as $line )
-{
-if ( $line == "" ) continue;
-$file = basename( $line );
-$url  = dirname ( $line );
-$file = preg_replace( "/\.tar\..z.*$/", "", $file ); // Remove .tar.?z*$
-$file = preg_replace( "/\.tar$/",       "", $file ); // Remove .tar$
-$file = preg_replace( "/\..z$/",        "", $file ); // Remove .gz$/xz$
-$file = preg_replace( "/\.orig$/",      "", $file ); // Remove .orig$
-$file = preg_replace( "/\.src$/",       "", $file ); // Remove .src$
-$file = preg_replace( "/\.tgz$/",       "", $file ); // Remove .tgz$
-if ( preg_match( "/patch$/", $file         ) ) continue; // Skip patches
-$pattern = get_pattern( $line );
-
-$version = preg_replace( $pattern, "$1", $file );   // Isolate version
-$version = preg_replace( "/^-/", "", $version );    // Remove leading #-
-$basename = strstr( $file, $version, true );
-
-$basename = rtrim( $basename, "-" );
-if ( $basename == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-if ( $basename == "v" ) $basename = 'tigervnc';
-$index = $basename;
-while ( isset( $book[ $index ] ) ) $index .= "1";
-
-$book[ $index ] = array( 'basename' => $basename,
-'url'      => $url, 
-'version'  => $version );
-if ( preg_match( "/$STOP_PACKAGE$/", $line ) ) break;
-}
-}
-function html()
-{
-global $CHAPTER;
-global $book;
-global $date;
-global $vers;
-$leftnav = file_get_contents( 'leftnav.html' );
-$f = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
-'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
-<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
-<head>
-<title>BLFS Chapters $CHAPTER-38 Package Currency Check - $date</title>
-<link rel='stylesheet' href='currency.css' type='text/css' />
-</head>
-<body>
-$leftnav
-<h1>BLFS Chapters $CHAPTER-38 Package Currency Check</h1>
-<h2>As of $date GMT</h2>
-<table>
-<tr><th>BLFS Package</th> <th>BLFS Version</th> <th>Latest</th> <th>Flag</th></tr>\n";
-// Get the latest version of each package
-foreach ( $vers as $pkg => $v )
-{
-$v    = $book[ $pkg ][ 'version' ];  // book version
-$cv   = $vers[ $pkg ];               // web version
-$flag = ( "x$cv" != "x$v" ) ? "*" : "";
-if ( $v == "" ) $vers[ $pkg ] = "";
-
-$name = $pkg;
-if ( $pkg == "goffice" ) $name = 'goffice (gtk+2)';
-$classtype = isset( $book[ $pkg ][ 'indent' ] ) ? "indent" : "";
-$f .= "<tr><td class='$classtype'>$name</td>";
-$f .= "<td>$v</td>";
-$f .= "<td>${vers[ $pkg ]}</td>";
-$f .= "<td class='center'>$flag</td></tr>\n";
-}
-$f .= "</table>
-</body>
-</html>\n";
-file_put_contents( "/home/bdubbs/public_html/chapter$CHAPTER.html", $f );
-}
 get_current();  // Get what is in the book
 
 // Get latest version for each package 
@@ -490,23 +281,14 @@
 {
    $book_index = $pkg; 
 
-if ( $book_index == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-// Skip things we don't want
-if ( preg_match( "/xorg-server/", $pkg ) ) continue;
    $base = $data[ 'basename' ];
    $url  = $data[ 'url' ];
    $bver = $data[ 'version' ];
 
-echo "book index: $book_index  bver=$bver url=$url \n";
+   echo "book index: $book_index $bver $url\n";
 
    $v = get_packages( $book_index, $url );
    $vers[ $book_index ] = $v;
-// Stop at the end of the chapter 
-if ( $book_index == $STOP_PACKAGE ) break; 
 }
 
 html();  // Write html output

Index: scripts/blfs-chapter39.php
===================================================================
--- scripts/blfs-chapter39.php	(révision 15993)
+++ scripts/blfs-chapter39.php	(révision 15994)
@@ -1,26 +1,29 @@
 #! /usr/bin/php
 <?php
 
-$CHAPTER       = 39;
-$START_PACKAGE ='alsa-lib';
-$STOP_PACKAGE  ='xvidcore';
-$start         = false;
+include 'blfs-include.php';
 
-$sf            = 'sourceforge.net';
+$CHAPTER       = '39';
+$CHAPTERS      = 'Chapter 39';
+$START_PACKAGE = 'alsa-lib';
+$STOP_PACKAGE  = 'xvidcore';
 
-$vers = array();
-$book = array();
-$book_index = 0;
+$renames = array();
+$renames[ 'libmusicbrainz'  ] = 'libmusicbrainz2';
+$renames[ 'libmusicbrainz1' ] = 'libmusicbrainz5';
+$renames[ 'libvpx-v'        ] = 'libvpx';
+$renames[ 'v'               ] = 'fdk-aac';
+$renames[ 'x'               ] = 'x264';
 
-date_default_timezone_set( "GMT" );
-$date = date( "Y-m-d (D) H:i:s" );
+$ignores = array();
 
+//$current="libvpx";
 $regex = array();
 $regex[ 'faac'             ] = "/^.*Download faac-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'fdk-aac'          ] = "/^.*Download fdk-aac-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'a52dec'           ] = "/^.*a52dec-(\d[\d\.]+\d) is.*$/";
 $regex[ 'libass'           ] = "/^.*Release (\d[\d\.]+\d).*$/";
-//$regex[ 'libcdio-paranoia' ] = "/^.*The current release.*(\d[\d\.]+\d).*$/";
 $regex[ 'libdv'            ] = "/^.*Download libdv-(\d[\d\.]+\d).*$/";
 $regex[ 'libmpeg2'         ] = "/^.*libmpeg2-(\d[\d\.]+\d).*$/";
 $regex[ 'libmusicbrainz1'  ] = "/^.*libmusicbrainz-(5[\d\.]+\d).*$/";
@@ -30,25 +33,24 @@
 $regex[ 'xine-lib'         ] = "/^.*Download xine-lib-([\d\.]+\d).tar.*$/";
 $regex[ 'v'                ] = "/^.*fdk-aac ([\d\.]+) *$/";
 
-//$current="libvpx";
 
 $url_fix = array (
 
    array( 'pkg'     => 'faac',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/faac/files" ),
+          'replace' => "http://sourceforge.net/projects/faac/files" ),
 
    array( 'pkg'     => 'faad2',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/faac/files/faad2-src" ),
+          'replace' => "http://sourceforge.net/projects/faac/files/faad2-src" ),
 
    array( 'pkg'     => 'fdk-aac',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/opencore-amr/files" ),
+          'replace' => "http://sourceforge.net/projects/opencore-amr/files" ),
 
    array( 'pkg'     => 'a52dec',
           'match'   => '^.*$', 
-'replace' => "http://liba52.$sf/" ),
+          'replace' => "http://liba52.sourceforge.net/" ),
 
    array( 'pkg'     => 'libao',
           'match'   => '^.*$', 
@@ -60,11 +62,11 @@
 
    array( 'pkg'     => 'libdv',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/libdv/files" ),
+          'replace' => "http://sourceforge.net/projects/libdv/files" ),
 
    array( 'pkg'     => 'libmpeg2',
           'match'   => '^.*$', 
-'replace' => "http://libmpeg2.$sf/downloads.html" ),
+          'replace' => "http://libmpeg2.sourceforge.net/downloads.html" ),
 
    array( 'pkg'     => 'libmpeg3',
           'match'   => '^.*$', 
@@ -80,7 +82,7 @@
 
    array( 'pkg'     => 'libquicktime',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/libquicktime/files" ),
+          'replace' => "http://sourceforge.net/projects/libquicktime/files" ),
 
    array( 'pkg'     => 'libsamplerate',
           'match'   => '^.*$', 
@@ -100,7 +102,7 @@
 
    array( 'pkg'     => 'xine-lib',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/xine/files" ),
+          'replace' => "http://sourceforge.net/projects/xine/files" ),
 
    array( 'pkg'     => 'xvidcore',
           'match'   => '^.*$', 
@@ -115,90 +117,7 @@
           'replace' => "http://pkgs.fedoraproject.org/repo/pkgs/libcanberra" ),
 
 );
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-function find_max( $lines, $regex_match, $regex_replace )
-{
-global $book_index;
-$a = array();
 
-foreach ( $lines as $line )
-{
-// Ensure we skip verbosity of NcFTP
-if ( ! preg_match( $regex_match,   $line ) ) continue; 
-if (   preg_match( "/NcFTP/",      $line ) ) continue;
-if (   preg_match( "/Connecting/", $line ) ) continue;
-if (   preg_match( "/Current/",    $line ) ) continue;
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-//echo "=====line=$line\n";
-//echo "=====slice=$slice\n";
-// Numbers and whitespace
-if ( "x$slice" == "x$line" && ! preg_match( "/^\d[\d\.P-]*$/", $slice ) ) continue; 
-// Skip minor versions in the 90s (most of the time)
-list( $major, $minor, $micro, $rest ) = explode( ".", $slice . ".0.0.0.0" );
-if ( $micro >= 80  &&  
-$book_index != "automoc4" && 
-$book_index != "libcdio-paranoia" ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//----------------------------------------------------------
-function find_even_max( $lines, $regex_match, $regex_replace )
-{
-$a = array();
-foreach ( $lines as $line )
-{
-if ( ! preg_match( $regex_match, $line ) ) continue; 
-
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-if ( "x$slice" == "x$line" && ! preg_match( "/^[\d\.]+/", $slice ) ) continue; 
-
-// Skip odd numbered minor versions
-list( $major, $minor, $rest ) = explode( ".", $slice . ".0" );
-if ( $minor % 2 == 1  ) continue;
-if ( $minor     >= 90 ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//===========================================
-function http_get_file( $url )
-{
-exec( "curl -L -s -m30 $url", $dir );
-$s   = implode( "\n", $dir );
-$dir = strip_tags( $s );
-return explode( "\n", $dir );
-}
-//=====================================================
-function max_parent( $dirpath, $prefix )
-{
-// First, remove a directory
-$dirpath  = rtrim  ( $dirpath, "/" );    // Trim any trailing slash
-$position = strrpos( $dirpath, "/" );
-$dirpath  = substr ( $dirpath, 0, $position );
-$lines = http_get_file( $dirpath );
-$regex_match   = "#${prefix}[\d\.]+/#";
-$regex_replace = "#^(${prefix}[\d\.]+)/.*$#";
-$max           = find_max( $lines, $regex_match, $regex_replace );
-return "$dirpath/$max"; 
-}
-/////////////////////////////////////////////////////////////////
 function get_packages( $package, $dirpath )
 {
   global $regex;
@@ -207,7 +126,7 @@
   global $current;
 
   if ( isset( $current ) && $book_index != "$current" ) return 0;
-if ( $package == "x" ) return 0; // Daily snapshot for x264
+  if ( $package == "x" ) return 'daily'; // Daily snapshot for x264
 
   // Fix up directory path
   foreach ( $url_fix as $u )
@@ -262,13 +181,13 @@
         $position = strrpos( $dirpath, "/" );
         $dirpath  = substr ( $dirpath, 0, $position );  // Up 1
         $lines    = http_get_file( $dirpath . "/" );
-return find_max( $lines, "/^\d\./", ":^(\d[\d\.]+)/.*$:" );
+        return find_max( $lines, "/^\d\./", ":^(\d[\d\.]+)/.*$:", TRUE );
      }
 
      // Directories are in the form of mmddyy :(
@@ -360,14 +279,9 @@
   $max = find_max( $lines, "/$package/", "/^.*$package-([\d\.]*\d)\.tar.*$/" );
   return $max;
 }
-//********************************************************
 Function get_pattern( $line )
 {
-global $start;
-// Set up specific patter matches for extracting book versions
-$match = array();
    $match = array(
      array( 'pkg'   => 'a52dec', 
             'regex' => "/^.*a52dec-(\d[\d\.]+).*$/" ),
@@ -381,9 +295,6 @@
      array( 'pkg'   => 'libmpeg3', 
             'regex' => "/^.*libmpeg3-(\d[\d\.]+).*$/" ),
      
-//array( 'pkg'   => 'libvpx', 
-//       'regex' => "/^.*libvpx-v(\d[\d\.]+).*$/" ),
-
      array( 'pkg'   => 'libmad', 
             'regex' => "/^.*libmad-(\d[\d\.]+[a-m]{0,1}).*$/" ),
 
@@ -402,116 +313,6 @@
    return "/\D*(\d.*\d)\D*$/";
 }
 
-function get_current()
-{
-global $vers;
-global $book;
-global $START_PACKAGE;
-global $STOP_PACKAGE;
-global $start;
-$wget_file = "/home/bdubbs/public_html/blfs-book-xsl/wget-list";
-$contents = file_get_contents( $wget_file );
-$wget  = explode( "\n", $contents );
-foreach ( $wget as $line )
-{
-if ( $line == "" ) continue;
-$file = basename( $line );
-$url  = dirname ( $line );
-$file = preg_replace( "/\.tar\..z.*$/", "", $file ); // Remove .tar.?z*$
-$file = preg_replace( "/\.tar$/",       "", $file ); // Remove .tar$
-$file = preg_replace( "/\..z$/",        "", $file ); // Remove .gz$/xz$
-$file = preg_replace( "/\.orig$/",      "", $file ); // Remove .orig$
-$file = preg_replace( "/\.src$/",       "", $file ); // Remove .src$
-$file = preg_replace( "/\.tgz$/",       "", $file ); // Remove .tgz$
-if ( preg_match( "/patch$/", $file         ) ) continue; // Skip patches
-$pattern = get_pattern( $line );
-//echo "line=$line; pattern=$pattern\n";      
-$version = preg_replace( $pattern, "$1", $file );   // Isolate version
-$version = preg_replace( "/^-/", "", $version );    // Remove leading #-
-//echo "version=$version\n";
-$basename = strstr( $file, $version, true );
-$basename = rtrim( $basename, "-" );
-if ( $basename == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-$index = $basename;
-while ( isset( $book[ $index ] ) ) $index .= "1";
-
-$book[ $index ] = array( 'basename' => $basename,
-'url'      => $url, 
-'version'  => $version );
-if ( preg_match( "/$STOP_PACKAGE$/", $line ) ) break;
-}
-}
-function html()
-{
-global $CHAPTER;
-global $book;
-global $date;
-global $vers;
-$leftnav = file_get_contents( 'leftnav.html' );
-$f = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
-'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
-<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
-<head>
-<title>BLFS Chapter $CHAPTER Package Currency Check - $date</title>
-<link rel='stylesheet' href='currency.css' type='text/css' />
-</head>
-<body>
-$leftnav
-<div id='top'>
-<h1>BLFS Chapter $CHAPTER Package Currency Check</h1>
-<h2>As of $date GMT</h2>
-</div>
-<table id='table'>>
-<tr><th>BLFS Package</th> <th>BLFS Version</th> <th>Latest</th> <th>Flag</th></tr>\n";
-// Get the latest version of each package
-foreach ( $vers as $pkg => $v )
-{
-$v    = $book[ $pkg ][ 'version' ];  // book version
-$cv   = $vers[ $pkg ];               // web version
-$flag = ( "x$cv" != "x$v" ) ? "*" : "";
-if ( $v == "" ) $vers[ $pkg ] = "";
-
-$name = $pkg;
-if ( $pkg == "libmusicbrainz"    ) $name = 'libmusicbrainz2';
-if ( $pkg == "libmusicbrainz1"   ) $name = 'libmusicbrainz5';
-if ( $pkg == "libvpx-v"          ) $name = 'libvpx';
-if ( $pkg == "v"                 ) $name = 'fdk-aac';
-if ( $pkg == "x"                 ) $name = 'x264';
-if ( $pkg == "x"                 ) $vers[ $pkg ] = 'daily';
-if ( $pkg == "x"                 ) $v = substr( $v, 4);
-$classtype = isset( $book[ $pkg ][ 'indent' ] ) ? "indent" : "";
-$f .= "<tr><td class='$classtype'>$name</td>";
-$f .= "<td>$v</td>";
-$f .= "<td>${vers[ $pkg ]}</td>";
-$f .= "<td class='center'>$flag</td></tr>\n";
-}
-$f .= "</table>
-</body>
-</html>\n";
-file_put_contents( "/home/bdubbs/public_html/chapter$CHAPTER.html", $f );
-}
 get_current();  // Get what is in the book
 
 
@@ -520,24 +321,14 @@
 {
    $book_index = $pkg; 
 
-if ( $book_index == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-// Skip things we don't want
-//if ( preg_match( "/rpcnis-headers/", $pkg ) ) continue;
    $base = $data[ 'basename' ];
    $url  = $data[ 'url' ];
    $bver = $data[ 'version' ];
 
-echo "book index: $book_index url=$url bver=$bver latest=";
+   echo "book index: $book_index $url $bver\n";
 
    $v = get_packages( $book_index, $url );
-echo "$v\n";
    $vers[ $book_index ] = $v;
-// Stop at the end of the chapter 
-if ( $book_index == $STOP_PACKAGE ) break; 
 }
 
 html();  // Write html output

Index: scripts/blfs-chapter40.php
===================================================================
--- scripts/blfs-chapter40.php	(révision 15993)
+++ scripts/blfs-chapter40.php	(révision 15994)
@@ -1,51 +1,40 @@
 #! /usr/bin/php
 <?php
 
-$CHAPTER       = 40;
-$START_PACKAGE ='mpg123';
-$STOP_PACKAGE  ='libisofs';
-$start         = false;
+include 'blfs-include.php';
 
-$freedesk = "http://xorg.freedesktop.org/releases/individual";
-$sf       = 'sourceforge.net';
+$CHAPTER       = '40';
+$CHAPTERS      = 'Chapters 40-42';
+$START_PACKAGE = 'mpg123';
+$STOP_PACKAGE  = 'libisofs';
 
-$book = array();
-$book_index = 0;
+$renames = array();
 
-$vers = array();
+$ignores = array();
+$ignores[ 'freetts1' ] = '';
+$ignores[ 'Clearlooks' ] = '';
 
-date_default_timezone_set( "GMT" );
-$date = date( "Y-m-d (D) H:i:s" );
-// Special cases
-$exceptions = array();
 $regex = array();
 $regex[ 'mpg123'    ] = "/^.*Download mpg123-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'lame'      ] = "/^.*Download (\d[\d\.]+\d) sources.*$/";
 $regex[ 'freetts'   ] = "/^.*Download freetts-(\d[\d\.]+\d)-bin.*$/";
 $regex[ 'gvolwheel' ] = "/^.*Download gvolwheel-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'cdrdao'    ] = "/^.*Download cdrdao-(\d[\d\.]+\d).tar.*$/";
-//$regex[ 'k3b'       ] = "/^.*Download k3b-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'pnmixer'   ] = "/^.*pnmixer-(\d[\d\.]+\d).tar.*$/";
-//$regex[ 'MPlayer'   ] = "/^.*MPlayer (\d[\d\.]+\d) release.*$/";
 
-//$current="vlc";
-$libreoffice = array();
 $url_fix = array (
 
    array( 'pkg'     => 'mpg123',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/mpg123/files" ),
+          'replace' => "http://sourceforge.net/projects/mpg123/files" ),
 
    array( 'pkg'     => 'lame',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/lame/files" ),
+          'replace' => "http://sourceforge.net/projects/lame/files" ),
 
    array( 'pkg'     => 'freetts',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/freetts/files" ),
+          'replace' => "http://sourceforge.net/projects/freetts/files" ),
 
    array( 'pkg'     => 'amarok',
           'match'   => '^.*$', 
@@ -53,7 +42,7 @@
 
    array( 'pkg'     => 'gvolwheel',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gvolwheel/files" ),
+          'replace' => "http://sourceforge.net/projects/gvolwheel/files" ),
 
    array( 'pkg'     => 'transcode',
           'match'   => '^.*$', 
@@ -65,11 +54,11 @@
 
    array( 'pkg'     => 'xine-ui',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/xine/files/xine-ui" ),
+          'replace' => "http://sourceforge.net/projects/xine/files/xine-ui" ),
 
    array( 'pkg'     => 'cdrdao',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/cdrdao/files" ),
+          'replace' => "http://sourceforge.net/projects/cdrdao/files" ),
 
    array( 'pkg'     => 'pnmixer',
           'match'   => '^.*$', 
@@ -80,96 +69,7 @@
           'replace' => "http://download.kde.org/stable/k3b" ),
 
 );
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-function find_max( $lines, $regex_match, $regex_replace )
-{
-global $book_index;
-$a = array();
 
-//echo "regex_match=$regex_match\n";
-//echo "regex_replace=$regex_replace\n";
-foreach ( $lines as $line )
-{
-//echo "line=$line\n";
-// Ensure we skip verbosity of NcFTP
-if ( ! preg_match( $regex_match,   $line ) ) continue; 
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-// Numbers and whitespace
-//if ( "x$slice" == "x$line" && ! preg_match( "/^\d[\d\.]*$/", $slice ) ) continue; 
-if ( "x$slice" == "x$line" ) continue; 
-//echo "slice=$slice\n";
-// Skip minor versions in the 90s (most of the time)
-list( $major, $minor, $micro, $rest ) = explode( ".", $slice . ".0.0.0.0" );
-if ( $micro >= 80  &&  $book_index != "automoc4" ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//----------------------------------------------------------
-function find_even_max( $lines, $regex_match, $regex_replace )
-{
-$a = array();
-foreach ( $lines as $line )
-{
-if ( ! preg_match( $regex_match, $line ) ) continue; 
-
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-if ( "x$slice" == "x$line" && ! preg_match( "/^[\d\.]+/", $slice ) ) continue; 
-
-// Skip odd numbered minor versions
-list( $major, $minor, $rest ) = explode( ".", $slice . ".0" );
-if ( $minor % 2 == 1  ) continue;
-if ( $minor     >= 90 ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//===========================================
-function http_get_file( $url )
-{
-global $book_index;
-exec( "curl -L -s -m30 -A 'Mozilla/5.0 (X11; Linux i686; rv:13.0)' $url", $dir );
-$s   = implode( "\n", $dir );
-if ( $book_index != "transcode" )
-$dir = strip_tags( $s );
-else 
-$dir = $s;
-return explode( "\n", $dir );
-}
-//=====================================================
-function max_parent( $dirpath, $prefix )
-{
-// First, remove a directory
-$dirpath  = rtrim  ( $dirpath, "/" );    // Trim any trailing slash
-$position = strrpos( $dirpath, "/" );
-$dirpath  = substr ( $dirpath, 0, $position );
-$lines = http_get_file( $dirpath );
-$regex_match   = "#${prefix}[\d\.]+/#";
-$regex_replace = "#^(${prefix}[\d\.]+)/.*$#";
-$max           = find_max( $lines, $regex_match, $regex_replace );
-return "$dirpath/$max"; 
-}
-/////////////////////////////////////////////////////////////////
 function get_packages( $package, $dirpath )
 {
   global $exceptions;
@@ -177,7 +77,6 @@
   global $book_index;
   global $url_fix;
   global $current;
-global $libreoffice;
 
   if ( isset( $current ) && $book_index != "$current" ) return 0;
   if ( $book_index == "mplayer" ) return "daily";
@@ -211,8 +110,6 @@
   { 
     // Get listing
     $lines = http_get_file( "$dirpath/" );
-//echo "dirpath=$dirpath\n";
-//print_r($lines);
   }
   else // http
   {
@@ -256,21 +153,15 @@
   $max = find_max( $lines, "/$package/", "/^.*$package-([\d\.]*\d)\.tar.*$/" );
   return $max;
 }
-//********************************************************
-Function get_pattern( $line )
+function get_pattern( $line )
 {
-global $start;
-// Set up specific patter matches for extracting book versions
-$match = array();
    $match = array(
      array( 'pkg'   => 'mpg123', 
             'regex' => "/^.*mpg123-(\d[\d\.]+).*$/" ),
@@ -284,136 +175,21 @@
    return "/\D*(\d.*\d)\D*$/";
 }
 
-function get_current()
-{
-global $vers;
-global $book;
-global $freedesk;
-global $START_PACKAGE;
-global $STOP_PACKAGE;
-global $start;
-$wget_file = "/home/bdubbs/public_html/blfs-book-xsl/wget-list";
-$contents = file_get_contents( $wget_file );
-$wget  = explode( "\n", $contents );
-foreach ( $wget as $line )
-{
-if ( $line == "" ) continue;
-$file = basename( $line );
-$url  = dirname ( $line );
-$file = preg_replace( "/\.tar\..z.*$/", "", $file ); // Remove .tar.?z*$
-$file = preg_replace( "/\.tar$/",       "", $file ); // Remove .tar$
-$file = preg_replace( "/\..z$/",        "", $file ); // Remove .gz$/xz$
-$file = preg_replace( "/\.orig$/",      "", $file ); // Remove .orig$
-$file = preg_replace( "/\.src$/",       "", $file ); // Remove .src$
-$file = preg_replace( "/\.tgz$/",       "", $file ); // Remove .tgz$
-if ( preg_match( "/patch$/", $file         ) ) continue; // Skip patches
-$pattern = get_pattern( $line );
-
-$version = preg_replace( $pattern, "$1", $file );   // Isolate version
-$version = preg_replace( "/^-/", "", $version );    // Remove leading #-
-$basename = strstr( $file, $version, true );
-$basename = rtrim( $basename, "-" );
-if ( $basename == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-$index = $basename;
-while ( isset( $book[ $index ] ) ) $index .= "1";
-
-$book[ $index ] = array( 'basename' => $basename,
-'url'      => $url, 
-'version'  => $version );
-if ( preg_match( "/$STOP_PACKAGE$/", $line ) ) break;
-}
-}
-function html()
-{
-global $CHAPTER;
-global $book;
-global $date;
-global $vers;
-$leftnav = file_get_contents( 'leftnav.html' );
-
-$f = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
-'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
-<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
-<head>
-<title>BLFS Chapters $CHAPTER-42 Package Currency Check - $date</title>
-<link rel='stylesheet' href='currency.css' type='text/css' />
-</head>
-<body>
-$leftnav
-<h1>BLFS Chapters $CHAPTER-42 Package Currency Check</h1>
-<h2>As of $date GMT</h2>
-<table>
-<tr><th>BLFS Package</th> <th>BLFS Version</th> <th>Latest</th> <th>Flag</th></tr>\n";
-// Get the latest version of each package
-foreach ( $vers as $pkg => $v )
-{
-$v    = $book[ $pkg ][ 'version' ];  // book version
-$cv   = $vers[ $pkg ];               // web version
-$flag = ( "x$cv" != "x$v" ) ? "*" : "";
-if ( $v == "" ) $vers[ $pkg ] = "";
-
-$name = $pkg;
-//if ( $pkg == "libmusicbrainz"    ) $name = 'libmusicbrainz2';
-$classtype = isset( $book[ $pkg ][ 'indent' ] ) ? "indent" : "";
-$f .= "<tr><td class='$classtype'>$name</td>";
-$f .= "<td>$v</td>";
-$f .= "<td>${vers[ $pkg ]}</td>";
-$f .= "<td class='center'>$flag</td></tr>\n";
-}
-$f .= "</table>
-</body>
-</html>\n";
-file_put_contents( "/home/bdubbs/public_html/chapter$CHAPTER.html", $f );
-}
 get_current();  // Get what is in the book
 
 // Get latest version for each package 
@@     @@
 {
    $book_index = $pkg; 
 
-if ( $book_index == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-// Skip things we don't want
-if ( $pkg == 'freetts1'   ) continue;
-if ( $pkg == "Clearlooks" ) continue;
    $base = $data[ 'basename' ];
    $url  = $data[ 'url' ];
    $bver = $data[ 'version' ];
 
-echo "book index: $book_index  bver=$bver url=$url \n";
+   echo "book index: $book_index $bver $url \n";
 
    $v = get_packages( $book_index, $url );
    $vers[ $book_index ] = $v;
-// Stop at the end of the chapter 
-if ( $book_index == $STOP_PACKAGE ) break; 
 }
 
 html();  // Write html output

Index: scripts/blfs-chapter43.php
===================================================================
--- scripts/blfs-chapter43.php	(révision 15993)
+++ scripts/blfs-chapter43.php	(révision 15994)
@@ -1,32 +1,28 @@
 #! /usr/bin/php
 <?php
 
-$CHAPTER       = 43;
-$START_PACKAGE ='cups';
-$STOP_PACKAGE  ='xindy';
-$start         = false;
-$sf            = 'sourceforge.net';
+include 'blfs-include.php';
 
-$vers = array();
-$book = array();
-$book_index = 0;
+$CHAPTER       = '43';
+$CHAPTERS      = 'Chapters 43-48';
+$START_PACKAGE = 'cups';
+$STOP_PACKAGE  = 'xindy';
 
-date_default_timezone_set( "GMT" );
-$date = date( "Y-m-d (D) H:i:s" );
+$renames = array();
+$ignores = array();
+$ignores[ 'texlive1' ] = '';
 
+//$current="biblatex-biber";  // For debugging
 $regex = array();
-$regex[ 'ghostscript-fonts-std' ] = 
-"/^.*Download ghostscript-fonts-std-(\d[\d\.]+\d).tar.*$/";
-//$regex[ 'gnu-gs-fonts-other' ] = 
-//    "/^.*(\d[\d\.]+\d).*misc.*GPL.*$/";
 $regex[ 'gutenprint'      ] = "/^.*Download gutenprint-(\d[\d\.]+\d).*$/";
 $regex[ 'OpenSP'          ] = "/^.*Download OpenSP-(\d[\d\.]+\d).*$/";
 $regex[ 'docbook-xsl-doc' ] = "/^.*Download docbook-xsl-(\d[\d\.]+\d).*$/";
 $regex[ 'paps'            ] = "/^.*Download paps-(\d[\d\.]+\d).tar.*$/";
 $regex[ 'biblatex'        ] = "/^.*Download biblatex-(\d[\d\.]+\d).*$/";
+$regex[ 'ghostscript-fonts-std' ] = 
+    "/^.*Download ghostscript-fonts-std-(\d[\d\.]+\d).tar.*$/";
 
-//$current="gnu-gs-fonts-other";
 $url_fix = array (
 
    array( 'pkg'     => 'cups',
@@ -39,23 +35,23 @@
 
    array( 'pkg'     => 'ghostscript-fonts-std',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gs-fonts/files/gs-fonts" ),
+          'replace' => "http://sourceforge.net/projects/gs-fonts/files/gs-fonts" ),
 
    array( 'pkg'     => 'gnu-gs-fonts-other',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gs-fonts/files/gs-fonts" ),
+          'replace' => "http://sourceforge.net/projects/gs-fonts/files/gs-fonts" ),
 
    array( 'pkg'     => 'gutenprint',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/gimp-print/files" ),
+          'replace' => "http://sourceforge.net/projects/gimp-print/files" ),
 
    array( 'pkg'     => 'OpenSP',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/openjade/files" ),
+          'replace' => "http://sourceforge.net/projects/openjade/files" ),
 
    array( 'pkg'     => 'openjade',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/openjade/files/openjade" ),
+          'replace' => "http://sourceforge.net/projects/openjade/files/openjade" ),
 
    array( 'pkg'     => 'docbook-xml',
           'match'   => '^.*$', 
@@ -63,11 +59,11 @@
 
    array( 'pkg'     => 'docbook-xsl',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/docbook/files/docbook-xsl" ),
+          'replace' => "http://sourceforge.net/projects/docbook/files/docbook-xsl" ),
 
    array( 'pkg'     => 'docbook-xsl-doc',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/docbook/files/docbook-xsl-doc" ),
+          'replace' => "http://sourceforge.net/projects/docbook/files/docbook-xsl-doc" ),
 
    array( 'pkg'     => 'enscript',
           'match'   => '^.*$', 
@@ -79,109 +75,16 @@
 
    array( 'pkg'     => 'paps',
           'match'   => '^.*$', 
-'replace' => "http://$sf/projects/paps/files" ),
-#   array( 'pkg'     => 'texlive',
-#          'match'   => '^.*$', 
-#          'replace' => "http://www.ctan.org/tex-archive/systems/texlive/Source" ),
+          'replace' => "http://sourceforge.net/projects/paps/files" ),
 );
-//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-function find_max( $lines, $regex_match, $regex_replace )
-{
-global $book_index;
-$a = array();
 
-foreach ( $lines as $line )
-{
-// Ensure we skip verbosity of NcFTP
-if ( ! preg_match( $regex_match,   $line ) ) continue; 
-if (   preg_match( "/NcFTP/",      $line ) ) continue;
-if (   preg_match( "/Connecting/", $line ) ) continue;
-if (   preg_match( "/Current/",    $line ) ) continue;
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-// Numbers and whitespace
-if ( "x$slice" == "x$line" && ! preg_match( "/^\d[\d\.P-]*$/", $slice ) ) continue; 
-// Skip minor versions in the 90s (most of the time)
-list( $major, $minor, $micro, $rest ) = explode( ".", $slice . ".0.0.0.0" );
-if ( $micro >= 80 ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//----------------------------------------------------------
-function find_even_max( $lines, $regex_match, $regex_replace )
-{
-$a = array();
-foreach ( $lines as $line )
-{
-if ( ! preg_match( $regex_match, $line ) ) continue; 
-
-// Isolate the version and put in an array
-$slice = preg_replace( $regex_replace, "$1", $line );
-if ( "x$slice" == "x$line" && ! preg_match( "/^[\d\.]+/", $slice ) ) continue; 
-
-// Skip odd numbered minor versions
-list( $major, $minor, $rest ) = explode( ".", $slice . ".0" );
-if ( $minor % 2 == 1  ) continue;
-if ( $minor     >= 90 ) continue;
-array_push( $a, $slice );     
-}
-// SORT_NATURAL requires php-5.4.0 or later
-rsort( $a, SORT_NATURAL );  // Max version is at the top
-return ( isset( $a[0] ) ) ? $a[0] : 0;
-}
-//===========================================
-function http_get_file( $url )
-{
-//echo "url=$url\n";
-if (  ! preg_match( '/cups/', $url ) )
-exec( "curl -L -s -tlsv1 -m30 -A Firefox $url", $dir );
-else
-exec( "wget -q --no-check-certificate -O - $url", $dir );
-//exec( "curl -L -s -m30 -1 '$url'", $dir );
-$s   = implode( "\n", $dir );
-$dir = strip_tags( $s );
-return explode( "\n", $dir );
-}
-//=====================================================
-function max_parent( $dirpath, $prefix )
-{
-// First, remove a directory
-$dirpath  = rtrim  ( $dirpath, "/" );    // Trim any trailing slash
-$position = strrpos( $dirpath, "/" );
-$dirpath  = substr ( $dirpath, 0, $position );
-$lines = http_get_file( $dirpath );
-$regex_match   = "#${prefix}[\d\.]+/#";
-$regex_replace = "#^(${prefix}[\d\.]+)/.*$#";
-$max           = find_max( $lines, $regex_match, $regex_replace );
-return "$dirpath/$max"; 
-}
-/////////////////////////////////////////////////////////////////
 function get_packages( $package, $dirpath )
 {
   global $regex;
   global $book_index;
   global $url_fix;
   global $current;
-global $libreoffice;
 
-//if ( $book_index == "psutils" ) return 0;
   if ( isset( $current ) && $book_index != "$current" ) return 0;
 
   // These are constant - have not changed in 10 years
@@ -216,7 +119,7 @@
         }
      }
   }
-//echo "dirpath=$dirpath\n";
   // Check for ftp
   if ( preg_match( "/^ftp/", $dirpath ) ) 
   { 
@@ -226,17 +129,13 @@
          $position = strrpos( $dirpath, "/" );
          $dirpath  = substr ( $dirpath, 0, $position );  // Up 1
          $dirs     = http_get_file( "$dirpath/" );
-//echo "dirpath=$dirpath\n";
-//print_r($dirs);
-$dir = find_max( $dirs, "/20\d\d/", "/^.*(20\d\d).*$/" );
+         $dir      = find_max( $dirs, "/20\d\d/", "/^.*(20\d\d).*$/" );
          $lines    = http_get_file( "$dirpath/$dir/" );
          return find_max( $lines, "/texlive-/", "/^.*texlive-(\d+).*$/" );
      }
 
     // Get listing
-#exec( "echo 'ls -1;bye' | ncftp $dirpath/", $lines );
     $lines = http_get_file( "$dirpath/" );
-//print_r($lines);
   }
   else // http
   {
@@ -295,21 +193,16 @@
       return find_max( $lines, "/mupdf/", "/^.*$package-([\d\.]+)-source.tar.*$/" );
 
   if ( $package == "biblatex-biber" )
-return find_max( $lines, "/\.\d+/", "/^\s*([\d\.]+)$/" );
+      return find_max( $lines, "/$package/", "/^.*$package-([\d\.]+).tar.*$/" );
 
   // Most packages are in the form $package-n.n.n
   // Occasionally there are dashes (e.g. 201-1)
   $max = find_max( $lines, "/$package/", "/^.*$package-([\d\.]*\d)\.tar.*$/" );
   return $max;
 }
-//********************************************************
-Function get_pattern( $line )
+function get_pattern( $line )
 {
-global $start;
-// Set up specific patter matches for extracting book versions
-$match = array();
    $match = array(
      array( 'pkg'   => 'a2ps', 
             'regex' => "/^.*a2ps-(\d[\d\.]+).*$/" ),
@@ -319,9 +212,6 @@
      
      array( 'pkg'   => 'psutils', 
             'regex' => "/^.*psutils-(p\d[\d\.]+).*$/" ),
-array( 'pkg'   => 'install-tl-unx', 
-'regex' => "/(unversioned)/" ),
    );
 
    foreach( $match as $m )
@@ -335,119 +225,6 @@
    return "/\D*(\d.*\d)\D*$/";
 }
 
-function get_current()
-{
-global $vers;
-global $book;
-global $START_PACKAGE;
-global $STOP_PACKAGE;
-global $start;
-$wget_file = "/home/bdubbs/public_html/blfs-book-xsl/wget-list";
-$contents = file_get_contents( $wget_file );
-$wget  = explode( "\n", $contents );
-foreach ( $wget as $line )
-{
-if ( $line == "" ) continue;
-$file = basename( $line );
-$url  = dirname ( $line );
-$file = preg_replace( "/\.tar\..z.*$/", "", $file ); // Remove .tar.?z*$
-$file = preg_replace( "/\.tar$/",       "", $file ); // Remove .tar$
-$file = preg_replace( "/\..z$/",        "", $file ); // Remove .gz$/xz$
-$file = preg_replace( "/\.orig$/",      "", $file ); // Remove .orig$
-$file = preg_replace( "/\.src$/",       "", $file ); // Remove .src$
-$file = preg_replace( "/\.tgz$/",       "", $file ); // Remove .tgz$
-if ( preg_match( "/patch$/", $file         ) ) continue; // Skip patches
-$pattern = get_pattern( $line );
-
-$version = preg_replace( $pattern, "$1", $file );   // Isolate version
-$version = preg_replace( "/^-/", "", $version );    // Remove leading #-
-if ( $version == "install-tl-unx" ) $version = "Unversioned";
-if ( $version == "biblatex-biber" ) 
-{
-$position = strrpos( $url, "/" );
-$version  = substr ( $url, $position + 1 ); 
-$url      = substr ( $url, 0, $position );
-$file    .= $version;
-}
-$basename = strstr( $file, $version, true );
-$basename = rtrim( $basename, "-" );
-if ( $version == "Unversioned" ) $basename = "install-tl-unx";
-if ( $basename == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-$index = $basename;
-while ( isset( $book[ $index ] ) ) $index .= "1";
-
-if ( $index == "texlive1" ) continue;
-$book[ $index ] = array( 'basename' => $basename,
-'url'      => $url, 
-'version'  => $version );
-if ( preg_match( "/$STOP_PACKAGE$/", $line ) ) break;
-}
-}
-function html()
-{
-global $CHAPTER;
-global $book;
-global $date;
-global $vers;
-$leftnav = file_get_contents( 'leftnav.html' );
-$f = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
-'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
-<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
-<head>
-<title>BLFS Chapters $CHAPTER-48 Package Currency Check - $date</title>
-<link rel='stylesheet' href='currency.css' type='text/css' />
-</head>
-<body>
-$leftnav
-<h1>BLFS Chapters $CHAPTER-48 Package Currency Check</h1>
-<h2>As of $date GMT</h2>
-<table>
-<tr><th>BLFS Package</th> <th>BLFS Version</th> <th>Latest</th> <th>Flag</th></tr>\n";
-// Get the latest version of each package
-foreach ( $vers as $pkg => $v )
-{
-$v    = $book[ $pkg ][ 'version' ];  // book version
-$cv   = $vers[ $pkg ];               // web version
-$flag = ( "x$cv" != "x$v" ) ? "*" : "";
-if ( $v == "" ) $vers[ $pkg ] = "";
-
-$name = $pkg;
-$classtype = isset( $book[ $pkg ][ 'indent' ] ) ? "indent" : "";
-$f .= "<tr><td class='$classtype'>$name</td>";
-$f .= "<td>$v</td>";
-$f .= "<td>${vers[ $pkg ]}</td>";
-$f .= "<td class='center'>$flag</td></tr>\n";
-}
-$f .= "</table>
-</body>
-</html>\n";
-file_put_contents( "/home/bdubbs/public_html/chapter$CHAPTER.html", $f );
-}
 get_current();  // Get what is in the book
 
 // Get latest version for each package 
@@ -455,24 +232,14 @@
 {
    $book_index = $pkg; 
 
-if ( $book_index == $START_PACKAGE ) $start = true;
-if ( ! $start ) continue;
-// Skip things we don't want
-//if ( preg_match( "/rpcnis-headers/", $pkg ) ) continue;
    $base = $data[ 'basename' ];
    $url  = $data[ 'url' ];
    $bver = $data[ 'version' ];
 
-echo "book index: $book_index  bver=$bver url=$url \n";
+   echo "book index: $book_index $bver $url\n";
 
    $v = get_packages( $book_index, $url );
    $vers[ $book_index ] = $v;
-// Stop at the end of the chapter 
-if ( $book_index == $STOP_PACKAGE ) break; 
 }
 
 html();  // Write html output

Index: scripts/blfs-include.php
===================================================================
--- scripts/blfs-include.php	(révision 15993)
+++ scripts/blfs-include.php	(révision 15994)
@@ -156,6 +156,13 @@
       if ( $basename == $START_PACKAGE ) $start = true;
       if ( ! $start ) continue;
 
+      // Custom for Chapter 48
+      if ( $version == "install-tl-unx" ) 
+      {
+        $version = "Unversioned";
+        $basename = "install-tl-unx";
+      }
       $index = $basename;
       while ( isset( $book[ $index ] ) ) $index .= "1";
 
@@ -179,6 +186,7 @@
    global $date;
    global $vers;
    global $CHAPTER;
+   global $CHAPTERS;
    global $HTML_DIR;
    global $renames;
    global $ignores;
@@ -194,7 +202,7 @@
 </head>
 <body>
 $leftnav
-<h1>BLFS Chapter $CHAPTER Package Currency Check</h1>
+<h1>BLFS $CHAPTERS Package Currency Check</h1>
 <h2>As of $date GMT</h2>
 
 <table>

