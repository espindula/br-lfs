Révision 16362

fichiers modifiés :
M       scripts/summ-blfs.php
M       scripts/blfs-chapter04.php
M       scripts/blfs-chapter09.php

Log :
Fix currence for cracklib and nspr Fix summary to ignore most of duplicated kde files becasue all of kde is updated as a batch.

Le robot a traité 11 % du commit anglais
Index: scripts/blfs-chapter04.php
===================================================================
--- scripts/blfs-chapter04.php	(révision 16361)
+++ scripts/blfs-chapter04.php	(révision 16362)
@@ -15,15 +15,25 @@
 $ignores = array();
 $ignores[ 'openssh1' ] = "";
 
-//$current="stunnel";   // For debugging
+//$current="cracklib-words";   // For debugging
 
 $regex = array();
$regex[ 'krb5'           ] = "/^.*Kerberos V5 Release ([\d\.]+).*$/";
@@     @@
 
 $url_fix = array(
 
+   array( 'pkg'     => 'cracklib',
+          'match'   => '^.*$', 
+          'replace' => 'https://github.com/cracklib/cracklib/releases' ),
+   array( 'pkg'     => 'cracklib-words',
+          'match'   => '^.*$', 
+          'replace' => 'https://github.com/cracklib/cracklib/releases' ),
    array( 'pkg'     => 'gnupg',
           'match'   => '^.*$', 
           'replace' => 'ftp://ftp.gnupg.org/gcrypt/gnupg/' ),
@@ -107,23 +117,6 @@
   else // http
   {
      // Customize http directories as needed
-if ( $package == 'cracklib' )
-$dirpath = "http://sourceforge.net/projects/cracklib/files/$package";
-// Need to get max directory from here
-if ( $package == 'cracklib-words' )
-{
-$dirpath = "http://sourceforge.net/projects/cracklib/files/$package";
-$lines   = http_get_file( $dirpath );
-$max     = find_max( $lines, "/\d{4}-\d{2}-\d{2}/", "/^.*(\d{4}-\d{2}-\d{2}).*$/" );
-if ( $max == 0 ) return -6;
-
-$dirpath .= "/$max";
-$lines = http_get_file( $dirpath );
-return find_max( $lines, "/$package/", "/^.*$package-([\d\.-]*\d)\.gz.*$/" );
-}
      if ( $book_index == "krb5" )
      {
         // Remove last two dirs from $path

Index: scripts/blfs-chapter09.php
===================================================================
--- scripts/blfs-chapter09.php	(révision 16361)
+++ scripts/blfs-chapter09.php	(révision 16362)
@@ -11,7 +11,7 @@
 $renames = array();
 $ignores = array();
 
-//$current="json-c";
+//$current="nspr"; // For debugging
 
 $regex = array();
 $regex[ 'clucene-core'  ] = "/^.*Download clucene-core-([\d\.]+).tar.*$/";
@@ -180,14 +180,6 @@
       $dirpath .= "/$dir/";
     }
 
-if ( $book_index == "nspr" )
-{
-// Get the max directory and adjust the directory path
-$lines = http_get_file( "$dirpath/" );
-$dir = find_max( $lines, "/v[\d\.]+.*/", "/^.*v([\d\.]+).*/" );
-$dirpath .= "/v$dir/src";
-}
     // Get listing
     $lines = http_get_file( "$dirpath/" );
   }
@@ -226,6 +218,21 @@
       $lines = http_get_file( $dirpath );
       if ( ! is_array( $lines ) ) return $lines;
     }
+    if ( $book_index == "nspr" )
+    {
+      // Up two directory components
+      $dirpath  = rtrim  ( $dirpath, "/" );    // Trim any trailing slash
+      $position = strrpos( $dirpath, "/" );
+      $dirpath  = substr ( $dirpath, 0, $position );
+      $position = strrpos( $dirpath, "/" );
+      $dirpath  = substr ( $dirpath, 0, $position );
+      // Get the max directory and return numerical value
+      $lines = http_get_file( "$dirpath" );
+      $dir = find_max( $lines, "/v\d/", "/^.*v([\d\.]+).*/" );
+      return $dir;
+    }
   } // End fetch
 
   if ( isset( $regex[ $package ] ) )

Index: scripts/summ-blfs.php
===================================================================
--- scripts/summ-blfs.php	(révision 16361)
+++ scripts/summ-blfs.php	(révision 16362)
@@ -58,15 +58,27 @@
 
 $msg = "            BLFS Package        BLFS Version             Latest      Ticket\n";
 
-//echo $msg;
 foreach ( $a as $l )
 {
   $c = preg_split( "/ /", $l );
   if ( $c[0] == "" ) continue;
   $pkg  = $c[1];
 
+  if ( preg_match( "/libreoffice-/", $pkg ) ) continue;
+  if ( $pkg == "baloo"            ||
+       $pkg == "baloo-widgets"    ||
+       $pkg == "kactivities"      ||
+       $pkg == "kfilemetadata"    ||
+       $pkg == "kdeplasma-addons" ||
+       $pkg == "konsole"          ||
+       $pkg == "kate"             ||
+       $pkg == "gwenview"         ||
+       $pkg == "oxygen-icons"     ||
+       $pkg == "kde-base-artwork" ||
+       $pkg == "kde-baseapps"     ||
+       $pkg == "kdepimlibs" ) continue;
   if ( $pkg == "goffice" ) 
   {
     $c[1] .= $c[2];
@@ -96,7 +108,7 @@
   $msg .= $x;
 }
 
-//echo $x;
+//echo $msg;  // For debugging
 //exit;
 
 $from    = "bdubbs@linuxfromscratch.org";

