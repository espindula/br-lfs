Révision 15381

fichiers modifiés :
   server/major/apache.xml
   general/prog/lua.xml
   introduction/welcome/changelog.xml
   networking/netutils/wireshark.xml
   networking/netutils/nmap.xml
   postlfs/editors/vim.xml
   multimedia/videoutils/vlc.xml
   xsoft/other/feh.xml
   packages.ent

Log :
Update to lua-5.3.0 and required fixes of other packages.

Le robot a traité 21 % du commit anglais
Index: general/prog/lua.xml
===================================================================
--- general/prog/lua.xml	(révision 15380)
+++ general/prog/lua.xml	(révision 15381)
@@ -111,7 +111,7 @@
       Now, as the <systemitem class="username">root</systemitem> user:
     </para>
 
-<screen role="root"><userinput>make INSTALL_TOP=/usr TO_LIB="liblua.so liblua.so.5.2 liblua.so.&lua-version;" \
+<screen role="root"><userinput>make INSTALL_TOP=/usr TO_LIB="liblua.so liblua.so.5.3 liblua.so.&lua-version;" \
      INSTALL_DATA="cp -d" INSTALL_MAN=/usr/share/man/man1 install &amp;&amp;
 mkdir -pv /usr/share/doc/lua-&lua-version; &amp;&amp;
 cp -v doc/*.{html,css,gif,png} /usr/share/doc/lua-&lua-version;</userinput></screen>
@@ -121,7 +121,7 @@
     <systemitem class="username">root</systemitem> user:</para>
 
 <screen role="root"><userinput>cat &gt; /usr/lib/pkgconfig/lua.pc &lt;&lt; "EOF"
-<literal>V=5.2
+<literal>V=5.3
 R=&lua-version;
 
 prefix=/usr

Index: introduction/welcome/changelog.xml
===================================================================
--- introduction/welcome/changelog.xml	(révision 15380)
+++ introduction/welcome/changelog.xml	(révision 15381)
@@ -48,6 +48,11 @@
       <para>January 24th, 2015</para>
       <itemizedlist>
         <listitem>
+          <para>[fernando] - Update to lua-5.3.0 and required fixes of other
+          packages. Fixes
+          <ulink url="&blfs-ticket-root;6031">#6031</ulink>.</para>
+        </listitem>
+        <listitem>
           <para>[fernando] - Update to xf86-video-vmware-13.1.0 (Xorg driver).
           Fixes <ulink url="&blfs-ticket-root;6051">#6051</ulink>.</para>
         </listitem>

Index: multimedia/videoutils/vlc.xml
===================================================================
--- multimedia/videoutils/vlc.xml	(révision 15380)
+++ multimedia/videoutils/vlc.xml	(révision 15381)
@@ -215,7 +215,14 @@
 ./bootstrap                                                 &amp;&amp;
 sed "s:&lt; 56:&lt; 57:g" -i configure                            &amp;&amp;
 ./configure --prefix=/usr                                   &amp;&amp;
+sed -i 's/luaL_optint/(int)&amp;eger/' \
+       modules/lua/libs/{net,osd,volume}.c &amp;&amp;
+sed -i 's/luaL_checkint(/(int)luaL_checkinteger(/' \
+       modules/lua/{demux,libs/{configuration,net,osd,playlist,stream,variables,volume}}.c &amp;&amp;
 make</userinput></screen>
 
     <para>
@@ -260,6 +267,16 @@
     </para>
 
     <para>
+      <command>sed -i ... {net,osd,volume}.c</command>: This command fixes
+      building with lua-5.3.0.
+    </para>
+    <para>
+      <command>sed -i ... variables,volume}}.c</command>: This command fixes
+      building with lua-5.3.0.
+    </para>
+    <para>
       <option>--disable-lua</option>: Use this switch if you don't have
       <application>Lua</application> installed.
     </para>

Index: networking/netutils/nmap.xml
===================================================================
--- networking/netutils/nmap.xml	(révision 15380)
+++ networking/netutils/nmap.xml	(révision 15381)
@@ -71,8 +71,8 @@
 
     <para role="recommended">
       <xref linkend="libpcap"/>,
-<xref linkend="lua"/>,
-<xref linkend="pcre"/>, and
+<!--  <xref linkend="lua"/>,-->
+      <xref linkend="pcre"/> and
       <xref linkend="liblinear"/>
 <!-- This is not recommended, see: http://nmap.org/svn/libdnet-stripped/NMAP_MODIFICATIONS
       <ulink url="http://code.google.com/p/libdnet/">libdnet</ulink>
@@ -104,7 +104,7 @@
     <para>Install <application>Nmap</application> by running the following
     commands:</para>
 
-<screen><userinput>./configure --prefix=/usr &amp;&amp;
+<screen><userinput>./configure --prefix=/usr --with-liblua=included &amp;&amp;
 make -j1</userinput></screen>
 
     <para>If you wish to run the test suite, run the following command:</para>
@@ -121,6 +121,14 @@
 
   </sect2>
 
+  <sect2 role="commands">
+    <title>Command Explanations</title>
+    <para><parameter>--with-liblua=included</parameter>: This witch is
+    recommended because building with system lua-5.3.0 fails.</para>
+  </sect2>
   <sect2 role="content">
     <title>Contents</title>
 

Index: networking/netutils/wireshark.xml
===================================================================
--- networking/netutils/wireshark.xml	(révision 15380)
+++ networking/netutils/wireshark.xml	(révision 15381)
@@ -65,6 +65,12 @@
     <bridgehead renderas="sect3">Additional Downloads</bridgehead>
     <itemizedlist spacing="compact">
       <listitem>
+        <para>
+          Required patch:
+          <ulink url="&patch-root;/wireshark-&wireshark-version;-lua_5_3_0-1.patch"/>
+        </para>
+      </listitem>
+      <listitem>
         <para>Additional Documentation:
            <ulink url="https://www.wireshark.org/download/docs/"/>
          </para>
@@ -194,7 +200,9 @@
     <para>Continue to install <application>Wireshark</application> by running
     the following commands:</para>
 
-<screen><userinput>./configure --prefix=/usr     \
+<screen><userinput>patch -Np1 -i wireshark-&wireshark-version;-lua_5_3_0-1.patch  &amp;&amp;
+./configure --prefix=/usr     \
             --with-gtk3=yes   \
             --with-qt=no      \
             --sysconfdir=/etc &amp;&amp;

Index: postlfs/editors/vim.xml
===================================================================
--- postlfs/editors/vim.xml	(révision 15380)
+++ postlfs/editors/vim.xml	(révision 15381)
@@ -77,11 +77,12 @@
 
     <bridgehead renderas="sect4">Optional</bridgehead>
     <para role="optional">
-<ulink url="http://sourceforge.net/projects/lesstif/">LessTif</ulink>,
+      <xref linkend="gpm"/>,
+      <xref linkend="lua"/>,
       <xref linkend="python2"/>,
-<xref linkend="tcl"/>,
-<xref linkend="ruby"/>, and
-<xref linkend="gpm"/>
+      <xref linkend="ruby"/>,
+      <xref linkend="tcl"/>, and
+      <ulink url="http://sourceforge.net/projects/lesstif/">LessTif</ulink>
     </para>
 
     <para condition="html" role="usernotes">User Notes:
@@ -108,6 +109,9 @@
 
 <screen><userinput>echo '#define SYS_VIMRC_FILE  "/etc/vimrc"' &gt;&gt;  src/feature.h &amp;&amp;
 echo '#define SYS_GVIMRC_FILE "/etc/gvimrc"' &gt;&gt; src/feature.h &amp;&amp;
+sed -i 's/luaL_optlong/(long)luaL_optinteger/' src/if_lua.c &amp;&amp;
 ./configure --prefix=/usr --with-features=huge                &amp;&amp;
 make</userinput></screen>
 
@@ -156,6 +160,9 @@
   <sect2 role="commands">
     <title>Command Explanations</title>
 
+    <para><command>sed -i ... src/if_lua.c</command>: This command fixes
+    building with lua-5.3.0.</para>
     <para><parameter>--with-features=huge</parameter>: This switch enables all
     the additional features available in <application>Vim</application>,
     including support for multibyte characters.</para>

Index: server/major/apache.xml
===================================================================
--- server/major/apache.xml	(révision 15380)
+++ server/major/apache.xml	(révision 15381)
@@ -134,7 +134,10 @@
     </para>
 
 <screen><userinput>patch -Np1 -i ../httpd-&apache-version;-blfs_layout-1.patch &amp;&amp;
+sed -i 's/ldump_writer, &amp;b/&amp;, NULL/' modules/lua/mod_lua.c &amp;&amp;
 sed '/dir.*CFG_PREFIX/s@^@#@' -i support/apxs.in &amp;&amp;
 ./configure --enable-authnz-fcgi                            \
             --enable-layout=BLFS                            \
@@ -173,6 +176,11 @@
     <title>Command Explanations</title>
 
     <para>
+      <command>sed -i ... modules/lua/mod_lua.c</command>: This command fixes
+      building with lua-5.3.0.
+    </para>
+    <para>
       <command>sed '/dir.*CFG_PREFIX/s@^@#@'...</command>: Forces the
       <application>apxs</application> utility to use absolute pathnames for
       modules, when instructed to do so.

Index: xsoft/other/feh.xml
===================================================================
--- xsoft/other/feh.xml	(révision 15380)
+++ xsoft/other/feh.xml	(révision 15381)
@@ -99,17 +99,8 @@
       <xref linkend="imagemagick"/> (to load unsupported formats)
     </para>
 
-<warning><para>Following this warning, we refer to <ulink
-url="http://mdocml.bsd.lv/snapshots/">mdocml</ulink>. This package should
-not be installed, because it will overwrite many files and programs of
-<application>Man-DB</application>, installed in LFS. If you really wish to
-install it, be sure to know exactly how to modify file and binary names
-that it installs.</para></warning>
     <bridgehead renderas="sect4">Optional (test suite)</bridgehead>
     <para role="optional">
-<ulink url="http://mdocml.bsd.lv/snapshots/">mdocml</ulink>
-(test error treated as warning, in Linux), and
       <ulink url="https://cpan.metacpan.org/authors/id/D/DA/DANBOO/">Test::Command</ulink>
       (required)
     </para>

