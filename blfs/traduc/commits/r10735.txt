Révision 10735

fichiers modifiés :
   introduction/welcome/changelog.xml
   postlfs/security/iptables.xml
   postlfs/security/firewalling.xml
   general.ent

Log :
Update to iptables-1.4.16.2. Fix firewall scripts to be compatible with current iptables.

Le robot a traité 15 % du commit anglais
Index: introduction/welcome/changelog.xml
===================================================================
--- introduction/welcome/changelog.xml	(revision 10734)
+++ introduction/welcome/changelog.xml	(revision 10735)
@@ -45,6 +45,21 @@
 -->
     
     <listitem>
+      <para>October 16th, 2012</para>
+      <itemizedlist>
+        <listitem>
+          <para>[bdubbs] - Update to iptables-1.4.16.2. Fixes
+          <ulink url="&blfs-ticket-root;3595">#3595</ulink>.</para>
+        </listitem>
+        <listitem>
+          <para>[bdubbs] - Fixed firewall scripts to be compatible with
+          current iptables. Fixes
+          <ulink url="&blfs-ticket-root;3626">#3626</ulink>.</para>
+        </listitem>
+      </itemizedlist>
+    </listitem>
+    <listitem>
       <para>October 15th, 2012</para>
       <itemizedlist>
         <listitem>

Index: postlfs/security/firewalling.xml
===================================================================
--- postlfs/security/firewalling.xml	(revision 10734)
+++ postlfs/security/firewalling.xml	(revision 10735)
@@ -180,16 +180,12 @@
 <screen role="root"><?dbfo keep-together="auto"?><userinput>cat &gt; /etc/rc.d/rc.iptables &lt;&lt; "EOF"
 <literal>#!/bin/sh
 
-# Begin $rc_base/rc.iptables
+# Begin rc.iptables
 
 # Insert connection-tracking modules
 # (not needed if built into the kernel)
-modprobe ip_tables
-modprobe iptable_filter
-modprobe ip_conntrack
-modprobe ip_conntrack_ftp
-modprobe ipt_state
-modprobe ipt_LOG
+modprobe nf_conntrack
+modprobe xt_LOG
 
 # Enable broadcast echo Protection
 echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
@@ -248,7 +244,7 @@
 # Permit answers on already established connections
 # and permit new connections related to established ones
 # (e.g. port mode ftp)
-iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
+iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
 # Log everything else. What's Windows' latest exploitable vulnerability?
 iptables -A INPUT -j LOG --log-prefix "FIREWALL:INPUT "
@@ -290,7 +286,7 @@
 <screen role="root"><?dbfo keep-together="auto"?><userinput>cat &gt; /etc/rc.d/rc.iptables &lt;&lt; "EOF"
 <literal>#!/bin/sh
 
-# Begin $rc_base/rc.iptables
+# Begin rc.iptables
 
 echo
 echo "You're using the example configuration for a setup of a firewall"
@@ -306,16 +302,11 @@
 
 # Insert iptables modules (not needed if built into the kernel).
 
-modprobe ip_tables
-modprobe iptable_filter
-modprobe ip_conntrack
-modprobe ip_conntrack_ftp
-modprobe ipt_state
-modprobe iptable_nat
-modprobe ip_nat_ftp
-modprobe ipt_MASQUERADE
-modprobe ipt_LOG
-modprobe ipt_REJECT
+modprobe nf_conntrack
+modprobe nf_conntrack_ftp
+modprobe xt_conntrack
+modprobe xt_LOG
+modprobe xt_state
 
 # Enable broadcast echo Protection
 echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
@@ -365,8 +356,8 @@
 iptables -A OUTPUT -o lo -j ACCEPT
 
 # Allow forwarding if the initiated on the intranet
-iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
-iptables -A FORWARD  -i ! ppp+ -m state --state NEW      -j ACCEPT
+iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
+iptables -A FORWARD  -i ! ppp+ -m conntrack --ctstate NEW      -j ACCEPT
 
 # Do masquerading
 # (not needed if intranet is not using private ip-addresses)
@@ -436,7 +427,7 @@
       themselves, you could open OUTPUT generally and restrict
       INPUT.</para>
 
-<screen><literal>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
+<screen><literal>iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 iptables -A OUTPUT -j ACCEPT</literal></screen>
 
       <para>However, it is generally not advisable to leave OUTPUT
@@ -457,7 +448,7 @@
           <para>Squid is caching the web:</para>
 
 <screen><literal>iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
-iptables -A INPUT  -p tcp --sport 80 -m state --state ESTABLISHED \
+iptables -A INPUT  -p tcp --sport 80 -m conntrack --ctstate ESTABLISHED \
   -j ACCEPT</literal></screen>
 
         </listitem>
@@ -496,9 +487,9 @@
           that came in after netfilter's timeout or some types of
           network scans) insert these rules at the top of the chain:</para>
 
-<screen><literal>iptables -I INPUT 0 -p tcp -m state --state INVALID \
+<screen><literal>iptables -I INPUT 0 -p tcp -m conntrack --ctstate INVALID \
   -j LOG --log-prefix "FIREWALL:INVALID "
-iptables -I INPUT 1 -p tcp -m state --state INVALID -j DROP</literal></screen>
+iptables -I INPUT 1 -p tcp -m conntrack --ctstate INVALID -j DROP</literal></screen>
 
         </listitem>
         <listitem>

Index: postlfs/security/iptables.xml
===================================================================
--- postlfs/security/iptables.xml	(revision 10734)
+++ postlfs/security/iptables.xml	(revision 10735)
@@ -71,7 +71,7 @@
         </para>
       </listitem>
     </itemizedlist>
+<!--
     <bridgehead renderas="sect3">Additional Downloads</bridgehead>
     <itemizedlist spacing="compact">
       <listitem>
@@ -81,7 +81,7 @@
         </para>
       </listitem>
     </itemizedlist>
+-->
     <para condition="html" role="usernotes">User Notes:
       <ulink url="&blfs-wiki;/iptables"/>
     </para>
@@ -134,8 +134,7 @@
       commands:
     </para>
 
-<screen><userinput>patch -Np1 -i ../iptables-&iptables-version;-missing-includes-1.patch &amp;&amp;
-./configure --prefix=/usr                          \
+<screen><userinput>./configure --prefix=/usr                          \
             --exec-prefix=                         \
             --bindir=/sbin                         \
             --with-xtlibdir=/lib/xtables           \

