Révision 16022

fichiers modifiés :
   packages.ent
   general/prog/prog.xml
   general/prog/gcc-ada.xml
   general/prog/gcc.xml
   general/prog/gcc-java.xml
   introduction/welcome/changelog.xml

Log :
Update to GCC-5.1.0: + a lot of indentation redone + change to the order of gcc-java and ada: Ada must be built last.

Le robot a traité 71 % du commit anglais
Index: general/prog/gcc-ada.xml
===================================================================
--- general/prog/gcc-ada.xml	(révision 16021)
+++ general/prog/gcc-ada.xml	(révision 16022)

     <title>Installation of GCC Ada</title>
 
-<screen><userinput>sed -i 's/if \((code.*))\)/if (\1 \&amp;\&amp; \!DEBUG_INSN_P (insn))/' gcc/sched-deps.c</userinput></screen>
--->
+    <para>
+      As in LFS, fix a problem identified upstream with the libgomp library:
+    </para>
 
-<para>Install <application>GCC Ada</application> by running the
-following commands:</para>
+<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-upstream_libgomp_fix-1.patch</userinput></screen>
 
-<screen><userinput><!--
-patch -Np1 -i ../gcc-&gcc-version;-upstream_fixes-1.patch &amp;&amp;
--->mkdir ../gcc-build &amp;&amp;
+    <para>
+      Install <application>GCC Ada</application> by running the
+      following commands:
+    </para>
+<screen><userinput>mkdir ../gcc-build &amp;&amp;
 cd    ../gcc-build &amp;&amp;
 
 ../gcc-&gcc-version;/configure          \
     --prefix=/usr               \
---libdir=/usr/lib           \
---enable-shared             \
---enable-threads=posix      \
---enable-__cxa_atexit       \
---enable-clocale=gnu        \
     --disable-multilib          \
     --with-system-zlib          \
     --enable-languages=ada &amp;&amp;
@@ -239,39 +283,37 @@
     /usr/lib/gcc/*linux-gnu/&gcc-version;/include{,-fixed} \
     /usr/lib/gcc/*linux-gnu/&gcc-version;/ada{lib,include}</userinput></screen>
 
-<para>You should now remove the <application>GNAT</application>
-installation and perform other cleanups:</para>
+    <para>
+      You should now remove the <application>GNAT</application>
+      installation and perform other cleanups. First, as the <systemitem
+      class="username">root</systemitem> user:
+    </para>
 
-<screen><userinput>rm -rf /opt/gnat &amp;&amp;
-export PATH=$PATH_HOLD &amp;&amp;
+<screen role="root"><userinput>rm -rf /opt/gnat</userinput></screen>
+    <para>
+      Then, as a normal user:
+    </para>
+<screen><userinput>export PATH=$PATH_HOLD &amp;&amp;
 unset PATH_HOLD</userinput></screen>
 
   </sect2>
@@     @@
   <sect2 role="commands">
     <title>Command Explanations</title>
     <para>
-<command>patch ... gcc-&gcc-version;-upstream_fixes-1.patch</command>:
-This patch corrects bugs in the C++ compiler, which lead to
-segmentation faults in some cases.
+      <command>mkdir ../gcc-build; cd ../gcc-build</command>: The
+      <application>GCC</application> documentation recommends
+      building the package in a dedicated build directory.
     </para>
--->
 
-<para><command>mkdir ../gcc-build; cd ../gcc-build</command>: The
-<application>GCC</application> documentation recommends
-building the package in a dedicated build directory.</para>
+    <para>
+      <parameter>--disable-multilib</parameter>: This parameter ensures
+      that files are created for the specific architecture of your computer.
+    </para>
 
-<para><parameter>--enable-shared --enable-threads=posix
---enable-__cxa_atexit</parameter>: These parameters are required to build
-the <application>C++</application> libraries to published standards.</para>
-<para><parameter>--enable-clocale=gnu</parameter>: This parameter is a
-failsafe for incomplete locale data.</para>
-<para><parameter>--disable-multilib</parameter>: This parameter ensures
-that files are created for the specific architecture of your computer.</para>
     <para>
       <parameter>--with-system-zlib</parameter>: Uses the system
       <application>zlib</application> instead of the bundled one.
@@ -287,25 +329,40 @@
       compilers be built too.
     </para>
 
-<para><command>ulimit -s 32768</command>: This command prevents several
-tests from running out of stack space.</para>
+    <para>
+      <option>--with-default-libstdcxx-abi=c++98</option>: Use this switch if you
+      are building <application>GNAT</application> tools using a
+      <application>GCC</application> version prior to 5.1.0,
+      and you do not want to recompile all the libraries written in C++.
+    </para>
 
-<para><command>make -k check</command>: This command runs the test suite
-without stopping if any errors are encountered.</para>
+    <para>
+      <command>ulimit -s 32768</command>: This command prevents several
+      tests from running out of stack space.
+    </para>
 
-<para><command>../gcc-&gcc-version;/contrib/test_summary</command>: This
-command will produce a summary of the test suite results. You can append
-<command>| grep -A7 Summ</command> to the command to produce an even more
-condensed version of the summary. You may also wish to redirect the output
-to a file for review and comparison later on.</para>
+    <para>
+      <command>make -k check</command>: This command runs the test suite
+      without stopping if any errors are encountered.
+    </para>
 
-<para><command>chown -v -R root:root /usr/lib/gcc/*linux-gnu/...</command>:
-If the package is built by a user other than root, the ownership of the
-installed <filename class="directory">include</filename> and
-<filename class="directory">adalib</filename> directories (and their
-contents) will be incorrect. These commands change the ownership to the
-<systemitem class="username">root</systemitem> user and group.</para>
+    <para>
+      <command>../gcc-&gcc-version;/contrib/test_summary</command>: This
+      command will produce a summary of the test suite results. You can append
+      <command>| grep -A7 Summ</command> to the command to produce an even more
+      condensed version of the summary. You may also wish to redirect the output
+      to a file for review and comparison later on.
+    </para>
 
+    <para>
+      <command>chown -v -R root:root /usr/lib/gcc/*linux-gnu/...</command>:
+      If the package is built by a user other than root, the ownership of the
+      installed <filename class="directory">include</filename> and
+      <filename class="directory">adalib</filename> directories (and their
+      contents) will be incorrect. These commands change the ownership to the
+      <systemitem class="username">root</systemitem> user and group.
+    </para>
   </sect2>
 
   <sect2 role="content">

Index: general/prog/gcc-java.xml
===================================================================
--- general/prog/gcc-java.xml	(révision 16021)
+++ general/prog/gcc-java.xml	(révision 16022)
@@ -28,51 +28,65 @@
   <title>GCC-Java-&gcc-version;</title>
 
   <indexterm zone="gcc">
-<primary sortas="a-gcc-java-4-0">GCC-Java-&gcc-version;</primary>
+    <primary sortas="a-gcc-java-5-0">GCC-Java-&gcc-version;</primary>
   </indexterm>
 
   <sect2 role="package">
     <title>Introduction to GCC-Java</title>
 
-<para>See the introduction to the Java language and system at
-<xref linkend="java"/>. The GNU Compiler Collection (GCC) contains
-a Java compiler to native code. Together with the
-<application>ecj</application> Java compiler from Eclipse (to bytecode),
-it provides a way to build an acceptable JVM from source. However, since
-the release of <application>OpenJDK</application>, the development
-of GCC-Java has almost stopped, and the built JVM is an old version.
-One reason to build
-this system is that it can be used to bootstrap <xref linkend="openjdk"/>,
-without the need for downloading a Java binary.</para>
+    <para>
+      See the introduction to the Java language and system at
+      <xref linkend="java"/>. The GNU Compiler Collection (GCC) contains
+      a Java compiler to native code. Together with the
+      <application>ecj</application> Java compiler from Eclipse (to bytecode),
+      it provides a way to build an acceptable JVM from source. However, since
+      the release of <application>OpenJDK</application>, the development
+      of GCC-Java has almost stopped, and the built JVM is an old version,
+      which cannot be used for building <xref linkend="openjdk"/>.
+    </para>
 
     &lfs77_checked;
 
@@ -90,21 +103,21 @@
           <ulink url="&antlr-download-http;"/>
         </para>
       </listitem>
+      <listitem>
         <para>
           Required patch:
-<ulink url="&patch-root;/gcc-&gcc-version;-upstream_fixes-1.patch"/>
+          <ulink url="&patch-root;/gcc-&gcc-version;-upstream_libgomp_fix-1.patch"/>
         </para>
      </listitem>
     </itemizedlist>
 
-<bridgehead renderas="sect3">GCC Dependencies</bridgehead>
+    <bridgehead renderas="sect3">GCC Java Dependencies</bridgehead>
 
     <bridgehead renderas="sect4">Required</bridgehead>
     <para role="required">
-<xref linkend="zip"/>,
-<xref linkend="unzip"/>, and
-<xref linkend="which"/>
+      <xref linkend="unzip"/>,
+      <xref linkend="which"/>, and
+      <xref linkend="zip"/>
     </para>
 
     <bridgehead renderas="sect4">Recommended</bridgehead>
@@ -128,25 +141,27 @@
      the <command>./configure</command> options below.
    </para>
 
-<screen><userinput>sed -i 's/if \((code.*))\)/if (\1 \&amp;\&amp; \!DEBUG_INSN_P (insn))/' gcc/sched-deps.c</userinput></screen>
--->
+    <para>
+      As in LFS, fix a problem identified upstream with the libgomp library:
+    </para>
 
-<para>Install <application>GCC Java</application> by running the
-following commands:</para>
+<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-upstream_libgomp_fix-1.patch</userinput></screen>
 
+    <para>
+      Install <application>GCC Java</application> by running the
+      following commands:
+    </para>
 <screen><userinput>sed -i 's/\(install.*:\) install-.*recursive/\1/' libffi/Makefile.in         &amp;&amp;
 sed -i 's/\(install-data-am:\).*/\1/'             libffi/include/Makefile.in &amp;&amp;
 
@@ -155,11 +170,6 @@
 
 ../gcc-&gcc-version;/configure           \
     --prefix=/usr                \
---libdir=/usr/lib            \
---enable-shared              \
---enable-threads=posix       \
---enable-__cxa_atexit        \
---enable-clocale=gnu         \
     --disable-multilib           \
     --with-system-zlib           \
     --disable-bootstrap          \
@@ -206,32 +222,24 @@
   <sect2 role="commands">
     <title>Command Explanations</title>
 
-<para>The two <command>sed</command> commands prevent the
-installation of the <application>libffi</application> library bundled
-with <application>GCC</application>, since it is outdated compared to
-<xref linkend="libffi"/>.</para>
-<!--
     <para>
-<command>patch ... gcc-&gcc-version;-upstream_fixes-1.patch</command>:
-This patch corrects bugs in the C++ compiler, which lead to
-segmentation faults in some cases.
+      The two <command>sed</command> commands prevent the
+      installation of the <application>libffi</application> library bundled
+      with <application>GCC</application>, since it is outdated compared to
+      <xref linkend="libffi"/>.
     </para>
--->
 
    <para>
      <command>mkdir ../gcc-build; cd ../gcc-build</command>: The
@@     @@
      building the package in a dedicated build directory.
    </para>
 
-<para><parameter>--enable-shared --enable-threads=posix
---enable-__cxa_atexit</parameter>: These parameters are required to build
-the <application>C++</application> libraries to published standards.</para>
+    <para>
+      <parameter>--disable-multilib</parameter>: This parameter ensures
+      that files are created for the specific architecture of your computer.
+    </para>
 
-<para><parameter>--enable-clocale=gnu</parameter>: This parameter is a
-failsafe for incomplete locale data.</para>
-<para><parameter>--disable-multilib</parameter>: This parameter ensures
-that files are created for the specific architecture of your computer.</para>
     <para>
       <parameter>--with-system-zlib</parameter>: Uses the system
       <application>zlib</application> instead of the bundled one.
@@ -306,7 +323,7 @@
       <title>Configuration Information</title>
 
       <para>
-The configuration is the same as for <xref linkend="openjdk"/>,
+        The configuration is the same as <xref linkend="ojdk-conf"/>,
         replacing <filename class="directory">/opt/jdk</filename> with
         <filename class="directory">/opt/gcj</filename>.
       </para>
@@ -340,17 +357,18 @@
         </seg>
         <seg>
           /usr/include/c++/&gcc-version;/{gcj,gnu,java,javax,org,sun},
-/usr/lib/gcj-&gcc-version;-15,
-/usr/lib/security, /opt/gcj/{bin,jre,include,lib} and
-/usr/share/java
+          /usr/lib/gcj-&gcc-version;-16, /usr/lib/jvm-exports,
+          /usr/lib/security, /opt/gcj and /usr/share/java
         </seg>
       </seglistitem>
     </segmentedlist>

Index: general/prog/gcc.xml
===================================================================
--- general/prog/gcc.xml	(révision 16021)
+++ general/prog/gcc.xml	(révision 16022)
@@ -23,71 +23,99 @@
   <title>GCC-&gcc-version;</title>
 
   <indexterm zone="gcc">
-<primary sortas="a-gcc-4-0">GCC-&gcc-version;</primary>
+    <primary sortas="a-gcc-5-0">GCC-&gcc-version;</primary>
   </indexterm>
 
   <sect2 role="package">
@@     @@
       <listitem>
         <para>
           Required patch:
-<ulink url="&patch-root;/gcc-&gcc-version;-upstream_fixes-1.patch"/>
+          <ulink url="&patch-root;/gcc-&gcc-version;-upstream_libgomp_fix-1.patch"/>
         </para>
       </listitem>
     </itemizedlist>
--->
 
     <bridgehead renderas="sect3">GCC Dependencies</bridgehead>
 
@@ -104,73 +133,81 @@
      <command>./configure</command> options below.
    </para>
 
-<screen><userinput>sed -i 's/if \((code.*))\)/if (\1 \&amp;\&amp; \!DEBUG_INSN_P (insn))/' gcc/sched-deps.c</userinput></screen>
--->
+    <para>
+      As in LFS, fix a problem identified upstream with the libgomp library:
+    </para>
 
-<para>Install <application>GCC</application> by running the
-following commands:</para>
+<screen><userinput>patch -Np1 -i ../gcc-5.1.0-upstream_libgomp_fix-1.patch</userinput></screen>
 
-<screen><userinput><!--
-patch -Np1 -i ../gcc-&gcc-version;-upstream_fixes-1.patch    &amp;&amp;
--->mkdir ../gcc-build                                   &amp;&amp;
+    <para>
+      Install <application>GCC</application> by running the following commands:
+    </para>
+<screen><userinput>mkdir ../gcc-build                                   &amp;&amp;
 cd    ../gcc-build                                   &amp;&amp;
 
 ../gcc-&gcc-version;/configure                               \
     --prefix=/usr                                    \
---libdir=/usr/lib                                \
---enable-shared                                  \
---enable-threads=posix                           \
---enable-__cxa_atexit                            \
---enable-clocale=gnu                             \
     --disable-multilib                               \
     --with-system-zlib                               \
     --enable-languages=c,c++,fortran,go,objc,obj-c++ &amp;&amp;
@@ -180,27 +217,24 @@
      as the <systemitem class="username">root</systemitem> user:
    </para>
 
-<screen role="root"><userinput>ln -v -sf ../usr/bin/cpp /lib &amp;&amp;
-ln -v -sf gcc /usr/bin/cc</userinput></screen>
+<screen role="root"><userinput>ln -v -sf ../usr/bin/cpp /lib          &amp;&amp;
+ln -v -sf gcc /usr/bin/cc              &amp;&amp;
+install -v -dm755 /usr/lib/bfd-plugins &amp;&amp;
+ln -sfv ../../libexec/gcc/$(gcc -dumpmachine)/&gcc-version;/liblto_plugin.so /usr/lib/bfd-plugins/</userinput></screen>
 
   </sect2>
 
@@ -209,16 +243,6 @@
     </para>
 
     <para>
-<parameter>--enable-shared --enable-threads=posix
---enable-__cxa_atexit</parameter>: These parameters are required to build
-the <application>C++</application> libraries to published standards.
-</para>
-<para>
-<parameter>--enable-clocale=gnu</parameter>: This parameter is a
-failsafe for incomplete locale data.</para>
-<para>
       <parameter>--disable-multilib</parameter>: This parameter ensures
       that files are created for the specific architecture of your computer.
     </para>
@@ -238,6 +262,12 @@
     </para>
 
     <para>
+      <option>--with-default-libstdcxx-abi=c++98</option>: Use this switch if you
+      are upgrading from a <application>GCC</application> version prior to 5.1.0,
+      and you do not want to recompile all the libraries written in C++.
+    </para>
+    <para>
       <command>ulimit -s 32768</command>: This command prevents several
       tests from running out of stack space.
     </para>
@@ -288,13 +320,12 @@
         </seg>
         <seg>
           libgfortran.{so,a},
-libgo.{so,a}, libgobegin.a, libobjc.{so,a}, and numerous other
-run-time libraries and executables in <filename class="directory">
+          libgo.{so,a}, libgobegin.a, libnetgo.a, libobjc.{so,a}, and numerous
+          other run-time libraries and executables in <filename class="directory">
           /usr/lib/gcc</filename>, <filename class="directory">
           /usr/libexec/gcc</filename>, and <filename class="directory">
           /usr/lib/go</filename>

Index: general/prog/prog.xml
===================================================================
--- general/prog/prog.xml	(révision 16021)
+++ general/prog/prog.xml	(révision 16022)
@@ -33,8 +33,8 @@
   <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gcc.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gcc-java.xml"/>
   <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gcc-ada.xml"/>
-<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gcc-java.xml"/>
   <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gc.xml"/>
   <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="gdb.xml"/>
   <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="git.xml"/>

Index: introduction/welcome/changelog.xml
===================================================================
--- introduction/welcome/changelog.xml	(révision 16021)
+++ introduction/welcome/changelog.xml	(révision 16022)
@@ -47,6 +47,10 @@
       <para>May 24th, 2015 </para>
       <itemizedlist>
         <listitem>
+          <para>[pierre] - Update to GCC-5.1.0. Fixes
+          <ulink url="&blfs-ticket-root;6430">#6430</ulink>.</para>
+        </listitem>
+        <listitem>
           <para>[renodr] - Add a sed to fix a compilation issue with Valgrind
           on systems that have a linux-4.x based kernel. Thanks to Armin K.
           for sending me that sed.</para>      

