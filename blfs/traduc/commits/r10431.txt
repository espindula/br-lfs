Révision 10431

fichiers modifiés :
   introduction/welcome/changelog.xml
   postlfs/security/consolekit.xml
   general.ent
   gnome/core/gnome-bluetooth.xml

Log :
Update to ConsoleKit 0.4.6 git snapshot in order to get udev-acl tool which was removed from udev 182+ and really fix it's behaviour.

Le robot a traité 44 % du commit anglais
Index: gnome/core/gnome-bluetooth.xml
===================================================================
--- gnome/core/gnome-bluetooth.xml	(revision 10430)
+++ gnome/core/gnome-bluetooth.xml	(revision 10431)
@@ -127,6 +127,27 @@
 
 <screen role="root"><userinput>make install</userinput></screen>
 
+    <para>
+      Create <application>Udev</application> rule that will allow
+      normal users to write to <filename>/dev/rfkill</filename>
+      with the following command as the
+      <systemitem class="username">root</systemitem> user:
+    </para>
+<screen role="root"><userinput>cat &gt; /lib/udev/rules.d/61-gnome-bluetooth.rules &lt;&lt; "EOF"
+# Get access to /dev/rfkill for users
+# See https://bugzilla.redhat.com/show_bug.cgi?id=514798
+#
+# Updated for udev &gt;= 154
+# http://bugs.debian.org/582188
+# https://bugzilla.redhat.com/show_bug.cgi?id=588660
+ENV{ACL_MANAGE}=="0", GOTO="gnome_bluetooth_end"
+ACTION!="add|change", GOTO="gnome_bluetooth_end"
+KERNEL=="rfkill", TAG+="udev-acl"
+LABEL="gnome_bluetooth_end"
+EOF</userinput></screen>
   </sect2>
 
   <sect2 role="commands">

Index: introduction/welcome/changelog.xml
===================================================================
--- introduction/welcome/changelog.xml	(revision 10430)
+++ introduction/welcome/changelog.xml	(revision 10431)
@@ -42,6 +42,15 @@
 
 -->
     <listitem>
+      <para>July 20th, 2012</para>
+      <itemizedlist>
+        <listitem>
+          <para>[krejzi] - Upgraded ConsoleKit to 0.4.6 (git snapshot).</para>
+        </listitem>
+      </itemizedlist>
+    </listitem>
+    <listitem>
       <para>July 19th, 2012</para>
       <itemizedlist>
         <listitem>

Index: postlfs/security/consolekit.xml
===================================================================
--- postlfs/security/consolekit.xml	(revision 10430)
+++ postlfs/security/consolekit.xml	(revision 10431)
@@ -85,24 +101,33 @@
      commands:
    </para>
 
-<screen><userinput>./configure --prefix=/usr --sysconfdir=/etc \
-            --localstatedir=/var --libexecdir=/usr/lib/ConsoleKit \
+<screen><userinput>./configure --prefix=/usr \
+            --sysconfdir=/etc \
+            --localstatedir=/var \
+            --libexecdir=/usr/lib/ConsoleKit \
+            --enable-udev-acl \
             --enable-pam-module &amp;&amp;
 make</userinput></screen>
 
@@ -111,37 +136,43 @@
   <sect2 role="commands">
     <title>Command Explanations</title>
 
-    <para><parameter>--enable-pam-module</parameter>: This switch enables
-    <application>ConsoleKit</application> to use
-    <application>Linux-PAM</application> authentication. Remove this option if
-    <application>Linux-PAM</application> is
-    <emphasis role="strong">NOT</emphasis> installed.</para>
+    <para>
+      <option>--enable-udev-acl</option>: This switch enables building of the
+      <command>udev-acl</command> tool which is used to allow normal users
+      to access device nodes which can be accessed by
+      <systemitem class="username">root</systemitem> user only.
+    </para>
 
-    <para><option>--enable-docbook-docs</option>: Use this parameter if
-    <application>xmlto</application> is installed and you wish to build the API
-    documentation.</para>
+    <para>
+      <option>--enable-pam-module</option>: This switch enables building of the
+      <application>ConsoleKit</application> <application>PAM</application>
+      module which is needed for <application>ConsoleKit</application> to
+      work correctly. Remove if <application>Linux PAM</application> is
+      <emphasis role="strong">NOT</emphasis> installed.
+    </para>
 
+    <para>
+      <option>--enable-docbook-docs</option>: Use this parameter if
+      <application>xmlto</application> is installed and you wish to
+      build the API documentation.
+    </para>
   </sect2>
 
   <sect2 role="configuration">
     <title>Configuring ConsoleKit</title>
 
-    <sect3 id="ConsoleKit-config">
-      <title>Config Files</title>
-      <para><filename>/etc/dbus-1/system.d/ConsoleKit.conf</filename></para>
-      <indexterm zone="consolekit ConsoleKit-config">
-        <primary sortas="e-etc-ConsoleKit-ConsoleKit.conf">/etc/dbus-1/system.d/ConsoleKit.conf</primary>
-      </indexterm>
-    </sect3>
-    <sect3><title>Configuration Information</title>
+    <sect3>
+      <title>PAM Module Configuration</title>
     
-      <para>If you use <application>PAM</application> you need to configure 
-      <application>PAM</application> to activate <application>ConsoleKit
-      </application> upon user login. This can be achieved by editing the 
-      <filename>/etc/pam.d/system-session</filename> file as the 
-      <systemitem class="username">root</systemitem> user:</para>
+      <para>
+        If you use <application>Linux PAM</application> you need to
+        configure <application>Linux PAM</application> to activate
+        <application>ConsoleKit</application> upon user login.
+        This can be achieved by editing the 
+        <filename>/etc/pam.d/system-session</filename> file as the 
+        <systemitem class="username">root</systemitem> user:
+      </para>
    
 <screen role="root"><userinput>cat &gt;&gt; /etc/pam.d/system-session &lt;&lt; "EOF"
 # Begin ConsoleKit addition
@@ -151,10 +182,42 @@
 
 # End ConsoleKit addition
 EOF</userinput></screen>
-   
-      <para>See /usr/share/doc/ConsoleKit/spec/ConsoleKit.html for more
-      configuration.</para>
 
+      <para>
+        You will also need a helper script that will create a file in
+        <filename class="directory">/var/run/console</filename>
+        named as username that is logged in that contains
+        <application>D-Bus</application> address of the session. Create
+        such script by running the following commands as the
+        <systemitem class="username">root</systemitem> user:
+      </para>
+<screen role="root"><userinput>cat &gt; /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck &lt;&lt; "EOF"
+#!/bin/sh
+TAGDIR=/var/run/console
+[ -n "$CK_SESSION_USER_UID" ] || exit 1
+[ "$CK_SESSION_IS_LOCAL" = "true" ] || exit 0
+TAGFILE="$TAGDIR/`getent passwd $CK_SESSION_USER_UID | cut -f 1 -d:`"
+if [ "$1" = "session_added" ]; then
+    mkdir -p "$TAGDIR"
+    echo "$CK_SESSION_ID" &gt;&gt; "$TAGFILE"
+fi
+if [ "$1" = "session_removed" ] &amp;&amp; [ -e "$TAGFILE" ]; then
+    sed -i "\%^$CK_SESSION_ID\$%d" "$TAGFILE"
+    [ -s "$TAGFILE" ] || rm -f "$TAGFILE"
+fi
+EOF
+chmod 0755 /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck</userinput></screen>
+      <para>
+        See /usr/share/doc/ConsoleKit/spec/ConsoleKit.html for more
+        configuration.
+      </para>
     </sect3>
 
   </sect2>
@@ -168,14 +231,21 @@
       <segtitle>Installed Directories</segtitle>
 
       <seglistitem>
-        <seg>ck-history, ck-launch-session, ck-list-sessions,
-        ck-log-system-restart, ck-log-system-start, ck-log-system-stop,
-        console-kit-daemon, ck-collect-session-info, ck-get-x11-display-device,
-        ck-get-x11-server-pid, ck-system-restart, and ck-system-stop</seg>
-        <seg>libck-connector.so and pam_ck_connector.so</seg>
-        <seg>/etc/ConsoleKit/{run-seat.d,run-session.d,seats.d},
-        /usr/{include/ConsoleKit/ck-connector,lib/ConsoleKit/{run-seat.d,
-        run-session.d,scripts},share/doc/ConsoleKit/spec}</seg>
+        <seg>
+          ck-history, ck-launch-session, ck-list-sessions,
+          ck-log-system-restart, ck-log-system-start,
+          ck-log-system-stop and console-kit-daemon
+        </seg>
+        <seg>
+          libck-connector.so and pam_ck_connector.so
+        </seg>
+        <seg>
+          /etc/ConsoleKit,
+          /usr/include/ConsoleKit,
+          /usr/lib/ConsoleKit,
+          /usr/share/doc/ConsoleKit and
+          /var/log/ConsoleKit
+        </seg>
       </seglistitem>
     </segmentedlist>
 

