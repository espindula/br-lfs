msgid ""
"<?dbfo keep-together=\"auto\"?><userinput>install -v -dm755 /etc/systemd/scripts\n"
"\n"
"cat &gt; /etc/systemd/scripts/iptables &lt;&lt; \"EOF\"\n"
"<literal>#!/bin/sh\n"
"\n"
"# Begin /etc/systemd/scripts/iptables\n"
"\n"
"echo\n"
"echo \"You're using the example configuration for a setup of a firewall\"\n"
"echo \"from Beyond Linux From Scratch.\"\n"
"echo \"This example is far from being complete, it is only meant\"\n"
"echo \"to be a reference.\"\n"
"echo \"Firewall security is a complex issue, that exceeds the scope\"\n"
"echo \"of the configuration rules below.\"\n"
"\n"
"echo \"You can find additional information\"\n"
"echo \"about firewalls in Chapter 4 of the BLFS book.\"\n"
"echo \"https://www.&lfs-domainname;/blfs\"\n"
"echo\n"
"\n"
"# Insert iptables modules (not needed if built into the kernel).\n"
"\n"
"modprobe nf_conntrack\n"
"modprobe nf_conntrack_ftp\n"
"modprobe xt_conntrack\n"
"modprobe xt_LOG\n"
"modprobe xt_state\n"
"\n"
"# Enable broadcast echo Protection\n"
"echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts\n"
"\n"
"# Disable Source Routed Packets\n"
"echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route\n"
"\n"
"# Enable TCP SYN Cookie Protection\n"
"echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies\n"
"\n"
"# Disable ICMP Redirect Acceptance\n"
"echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_redirects\n"
"\n"
"# Don't send Redirect Messages\n"
"echo 0 &gt; /proc/sys/net/ipv4/conf/default/send_redirects\n"
"\n"
"# Drop Spoofed Packets coming in on an interface where responses\n"
"# would result in the reply going out a different interface.\n"
"echo 1 &gt; /proc/sys/net/ipv4/conf/default/rp_filter\n"
"\n"
"# Log packets with impossible addresses.\n"
"echo 1 &gt; /proc/sys/net/ipv4/conf/all/log_martians\n"
"\n"
"# Be verbose on dynamic ip-addresses  (not needed in case of static IP)\n"
"echo 2 &gt; /proc/sys/net/ipv4/ip_dynaddr\n"
"\n"
"# Disable Explicit Congestion Notification\n"
"# Too many routers are still ignorant\n"
"echo 0 &gt; /proc/sys/net/ipv4/tcp_ecn\n"
"\n"
"# Set a known state\n"
"iptables -P INPUT   DROP\n"
"iptables -P FORWARD DROP\n"
"iptables -P OUTPUT  DROP\n"
"\n"
"# These lines are here in case rules are already in place and the\n"
"# script is ever rerun on the fly. We want to remove all rules and\n"
"# pre-existing user defined chains before we implement new rules.\n"
"iptables -F\n"
"iptables -X\n"
"iptables -Z\n"
"\n"
"iptables -t nat -F\n"
"\n"
"# Allow local connections\n"
"iptables -A INPUT  -i lo -j ACCEPT\n"
"iptables -A OUTPUT -o lo -j ACCEPT\n"
"\n"
"# Allow forwarding if the initiated on the intranet\n"
"iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT\n"
"iptables -A FORWARD ! -i WAN1 -m conntrack --ctstate NEW       -j ACCEPT\n"
"\n"
"# Do masquerading\n"
"# (not needed if intranet is not using private ip-addresses)\n"
"iptables -t nat -A POSTROUTING -o WAN1 -j MASQUERADE\n"
"\n"
"# Log everything for debugging\n"
"# (last of all rules, but before policy rules)\n"
"iptables -A INPUT   -j LOG --log-prefix \"FIREWALL:INPUT \"\n"
"iptables -A FORWARD -j LOG --log-prefix \"FIREWALL:FORWARD \"\n"
"iptables -A OUTPUT  -j LOG --log-prefix \"FIREWALL:OUTPUT \"\n"
"\n"
"# Enable IP Forwarding\n"
"echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n"
"\n"
"# The following sections allow inbound packets for specific examples\n"
"# Uncomment the example lines and adjust as necessary\n"
"\n"
"# Allow ping on the external interface\n"
"#iptables -A INPUT  -p icmp -m icmp --icmp-type echo-request -j ACCEPT\n"
"#iptables -A OUTPUT -p icmp -m icmp --icmp-type echo-reply   -j ACCEPT\n"
"\n"
"# Reject ident packets with TCP reset to avoid delays with FTP or IRC\n"
"#iptables -A INPUT  -p tcp --dport 113 -j REJECT --reject-with tcp-reset\n"
"\n"
"# Allow HTTP and HTTPS to 192.168.0.2\n"
"#iptables -A PREROUTING -t nat -i WAN1 -p tcp --dport 80 -j DNAT --to 192.168.0.2\n"
"#iptables -A PREROUTING -t nat -i WAN1 -p tcp --dport 443 -j DNAT --to 192.168.0.2\n"
"#iptables -A FORWARD -p tcp -d 192.168.0.2 --dport 80 -j ACCEPT\n"
"#iptables -A FORWARD -p tcp -d 192.168.0.2 --dport 443 -j ACCEPT\n"
"\n"
"# End /etc/systemd/scripts/iptables</literal>\n"
"EOF\n"
"chmod 700 /etc/systemd/scripts/iptables</userinput>"
