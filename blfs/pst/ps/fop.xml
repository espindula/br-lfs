<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY fop-download-http "http://archive.apache.org/dist/xmlgraphics/fop/source/fop-&fop-version;-src.tar.gz">
  <!-- <!ENTITY fop-download-ftp  "ftp://apache.mirrors.pair.com/xmlgraphics/fop/fop-&fop-version;-src.tar.gz"> -->
  <!ENTITY fop-download-ftp  "&sources-anduin-ftp;/f/fop-&fop-version;-src.tar.gz">
  <!ENTITY fop-md5sum        "95dcc4c2dd08b4bc88ce9ce1ee88c439">
  <!ENTITY fop-size          "16.1 Mio">
  <!ENTITY fop-buildsize     "360 Mio">
  <!ENTITY fop-time          "2.8 SBU">

  <!ENTITY jai-version       "1_1_3">
  <!ENTITY jai-download      "http://download.java.net/media/jai/builds/release/&jai-version;/jai-&jai-version;-lib-linux-i586-jdk.bin">
  <!ENTITY jai-md5sum        "a63b661c4940582aa1679233e5f518b2">
  <!ENTITY jai-size          "3.4 Mio">

  <!ENTITY offo-download     "&sourceforge-repo;/offo/offo-hyphenation_v2.0.zip">
  <!ENTITY offo-md5sum       "a78171d47c9af223c51bbd42df36f26d">
  <!ENTITY offo-size         "858 Kio">
]>

<sect1 id="fop" xreflabel="FOP-&fop-version;">
  <?dbhtml filename="fop.html"?>

  <sect1info>
    <othername>$LastChangedBy: randy $</othername>
    <date>$Date: 2010-11-12 15:13:51 +0100 (ven. 12 nov. 2010) $</date>
  </sect1info>

  <title>FOP-&fop-version;</title>

  <indexterm zone="fop">
    <primary sortas="a-FOP">FOP</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à FOP</title>

    <para>Le paquet <application>FOP</application> (Formatting Objects Processor)
    contient un formateur d'impression guidé par le formatage XSL d'objets
    (XSL-FO). C'est une application <application>Java</application> qui lit
    une arborescence d'objets de formatage et qui produit les pages qui en résulte
    vers une sortie spécifique. Les formats de sortie actuellement supportés 
    comprennent le PDF, PCL, PostScript, SVG, XML (représentation en arborescence
    de zone), print, AWT, MIF et texte ASCII. La cible sortie primaire est le
    PDF.</para>

    <para>&lfssvn_checked;20101029&lfssvn_checked2;</para>

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&fop-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&fop-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &fop-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &fop-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &fop-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &fop-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>

    <itemizedlist spacing="compact">
      <title>Requises packages</title>
      <listitem>
        <para>Modèles de césure <foreignphrase>Objects for Formatting Objects</foreignphrase>
        (OFFO)&nbsp;: 
          <simplelist>
            <member><ulink url="&offo-download;"/></member>
            <member>&offo-md5sum;</member>
            <member>&offo-size;</member>
          </simplelist>
        </para>
      </listitem>
      <listitem>
        <para>Composants de l'API <foreignphrase>Java Advanced Imaging</foreignphrase>
        (JAI)&nbsp;:
          <simplelist>
            <member><ulink url="&jai-download;"/></member>
            <member>&jai-md5sum;</member>
            <member>&jai-size;</member>
          </simplelist>
        </para>
      </listitem>
    </itemizedlist>

    <!-- <itemizedlist spacing='compact'>
      <title>Correctif requis&nbsp;</title>
      <listitem>
        <para><ulink
        url="&patch-root;/fop-&fop-version;-jdk_1.5.0-1.patch"/></para>
      </listitem>
    </itemizedlist> -->

    <bridgehead renderas="sect3">Dépendances de FOP</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="xorg7"/>,
    <xref linkend="apache-ant"/>, et
    <ulink url="http://java.sun.com/javase/technologies/desktop/media/jai/">Java
    Advanced Imaging (JAI) API components</ulink></para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><ulink url="http://java.sun.com/products/jimi/">JIMI SDK</ulink>,
    <ulink url="http://xmlunit.sourceforge.net/">XMLUnit</ulink>,
    <ulink url="https://jai-imageio.dev.java.net/">JAI Image I/O Tools</ulink>,
    <ulink url="http://jeuclid.sourceforge.net/">JEuclid</ulink>,
    <ulink url="http://pmd.sourceforge.net">PMD</ulink>
    (requires <ulink url="http://jaxen.codehaus.org/">Jaxen</ulink>), et
    <ulink url="http://forrest.apache.org/">Forrest</ulink> (Forrest est utilisé seulement
    pour reconstruire la documentation)</para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/fop"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de FOP</title>

    <important>
      <para>Vous devez lancer cette installation depuis une fenetre X utilisant un server
	  GL-aware <application>Xorg</application> ou les tests <application>JUnit</application>
	  se bloqueront. Utiliser une fenètre X depuis une console est la bonne methode.</para>
    </important>

    <para>Assurez-vous que <envar>$JAVA_HOME</envar> est correctement paramétré
    avant de commencer la construction. Pour construire les classes d'extension
    <application>JIMI SDK</application> et/u
    <application>XMLUnit</application>, assurez-vous que les fichiers
    <filename class='extension'>.jar</filename> correspondant sont 
    identifiés dans la variable d'environnement in the <envar>CLASSPATH</envar>.</para>

    <sect3>
      <title>Installer les modèles de césure OFFO</title>

      <para>Avant de commencer la construction, déballez l'archive tar du
      source de <application>FOP</application> et le fichier zip de césure
      à partir du même répertoire, puis allez dans les répertoires dans la racine
      de l'arborescence du source de <application>FOP</application>. Copier les
      modèles de césure XML dans l'arborescence du source de <application>FOP</application> en
      lançant les commandes suivantes&nbsp;:</para>

<screen><userinput>cp ../offo-hyphenation/hyph/* hyph &amp;&amp;
rm -rf ../offo-hyphenation</userinput></screen>

    </sect3>

    <sect3>
      <title>Installer JAI</title>

      <tip>
        <para>La commande
        <command>$FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin</command>
        ci-dessous installe les composants JAI dans l'arborescence JDK. Vous
        devrez lire et accepter (en appuyant sur la touche <keycap>y</keycap>),
        un contrat de licence avant que l'installation ne continue. Si vous
        faites un script (pour automatiser) pour la construction, vous devrez
        en tenir compte. Il y a des informations sur l'automatisation des
        commandes de construction dans la section
        <xref linkend="automating-builds"/> du chapitre 2. Vers la fin de cette
        section, des informations spécifiques sur l'automatisation de ce type
        d'installation sont données.</para>
      </tip>

      <para>Installez les composants JAI en lançant les commandes suivantes
      en tant qu'utilisateur <systemitem class="username">root</systemitem>
      tout en étant à la racine de l'arborescence du source de
      <application>FOP</application>&nbsp;:</para>

<!-- JAI make tail +nnn only for SunOS now
<screen role="root"><userinput>install -m755 ../jai-&jai-version;-lib-linux-i586-jdk.bin JAI.bin &amp;&amp;
sed -i 's/tail +122/tail -n +122/' JAI.bin &amp;&amp;
-->
<screen role="root"><userinput>FOP_PKG_DIR=$(pwd)/.. &amp;&amp;
pushd $JAVA_HOME &amp;&amp;
sh $FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin &amp;&amp;
popd</userinput></screen>

    </sect3>

    <sect3>
      <title>Installer les composants FOP</title>

      <para>Si <application>forrest</application> n'est pas installé,
      supprimez une référence à lui dans le build.xml&nbsp;:</para>

<screen><userinput>sed -i -e "s/all,javadocs,docs/all,javadocs/" \
       -e '\#${dist.bin.result.dir}/docs#,\#&lt;/copy&gt;#d' build.xml</userinput></screen>

      <para>Compilez <application>FOP</application> en lançant les 
      commandes suivantes&nbsp;:</para>

<screen><userinput>ant dist</userinput></screen>

      <para>Les tests de régression d'unité ont été faits à l'étape de la
      construction ci-dessus.</para>

      <para>Maintenant en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>install -v -d -m755      /opt/fop-&fop-version; &amp;&amp;
mv -v dist-bin/fop-&fop-version;/* /opt/fop-&fop-version; &amp;&amp;
ln -v -sf fop-&fop-version; /opt/fop</userinput></screen>

    </sect3>

   </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>FOP_PKG_DIR=$(pwd)/..</command>&nbsp;: Cela suppose que 
    les paquets sources sont stockés un niveau au-dessus du répertoire de travail actuel,
    C'est toujours le cas par défaut, mais cela peut être différent en fonction
    des goûts personnels. Si nécessaire, modifiez cela pour correspondre au répertoire où on trouve
    l'archive tar <application>FOP</application>.</para>

    <para><command>sh
    $FOP_PKG_DIR/jai-&jai-version;-lib-linux-i586-jdk.bin</command>:
	Cette commande installe les composants <application>JAI</application> dans
    la structure de fichiers <application>JDK</application>.
    <envar>$FOP_PKG_DIR</envar> est utilisé comme point de référence vers l'exécutable
    du source.</para>

    <para><command>ant dist</command>&nbsp;: Ceci lit la cible <option>dist</option>
	du fichier <filename>build.xml</filename>,construit le paquet et lance les tests
	de régression d'unité. Il crée aussi la documentation de l'API Java et un répertoire
	où sont mis les binaires nouvellement créés. Ce répertoire est utilisé pour installer
    <application>FOP</application> à sa place définitive.</para>

    <para><command>ln -v -sf fop-&fop-version; /opt/fop</command>&nbsp;: C'est
    facultatif et cela crée un lien symbolique commode pour qu'on n'ait pas
    besoin de modifier <envar>$FOP_HOME</envar> à chaque fois qu'il y a un 
    changement de version de paquet.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de FOP</title>

    <sect3 id="fop-config">
      <title>Fichiers de configuration</title>

      <para><filename>~/.foprc</filename></para>

      <indexterm zone="fop fop-config">
        <primary sortas="e-AA.foprc">~/.foprc</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>L'utilisationn de <application>FOP</application> pour traiter
      certains gros FO's (y compris les FO dérivés des sources XML de BLFS), 
      peut conduire à des erreurs de mémoire. Sauf si vous ajoutez un paramètre
      à la commande <command>java</command>, utilisé dans le script
      <command>fop</command>, il se peut que vous receviez des messages similaires
      à celui décrit ci-dessous&nbsp;:</para>

      <para><computeroutput>Exception in thread "main" java.lang.OutOfMemoryError:
      Java heap space</computeroutput></para>

      <para>Pour éviter des erreurs comme ça, vous avez besoin de passer un
      paramètre supplémentaire à la commande <command>java</command> utilisé
      dans le script <command>fop</command>. On peut faire cela en créant un
      <filename>~/.foprc</filename> (dont la soupee est dans le script
      <command>fop</command>) et en ajoutant le paramètre à la variable
      d'environnement <envar>FOP_OPTS</envar>.</para>

      <para>Le script <command>fop</command> cherche une variable d'environement
      <envar>FOP_HOME</envar> pour localiser les bibliothèques de la classe
      <application>FOP</application>. Vous pouvez créer cette variable en utilisant
      aussi le fichier <filename>~/.foprc</filename>. Créez un fichier
      <filename>~/.foprc</filename> en utilisant les commandes suivantes&nbsp;:</para>

<screen><userinput>cat &gt; ~/.foprc &lt;&lt; "EOF"
<literal>FOP_OPTS="-Xmx<replaceable>&lt;RAM_Installée&gt;</replaceable>m"
FOP_HOME="/opt/fop"</literal>

EOF</userinput></screen>

      <para>Remplacez <replaceable>&lt;RAM_Installée&gt;</replaceable> par un
      nombre représentant la quantité de RAM installée sur votre ordinateur
      (en mégaoctets). Un exemple serait 
      <userinput>FOP_OPTS="-Xmx768m"</userinput>. Pour plus d'informations sur
      les problèmes de mémoire en utilisant <application>FOP</application>, voir
      <ulink url="http://xml.apache.org/fop/running.html#memory"/>.</para>

      <para>Pour inclure le script <command>fop</command> dans votre path, mettez
      à jour votre profil personnel ou pour tout le système avec ce qui 
      suit&nbsp;:</para>

<screen><literal>PATH=$PATH:/opt/fop</literal></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoire installé</segtitle>

      <seglistitem>
        <seg>fop</seg>
        <seg>fop.jar et numerous support library classes located in
        <filename class='directory'>/opt/fop/{build,lib}</filename>; JAI
        components include libmlib_jai.so, jai_codec.jar, jai_core.jar, et
        mlibwrapper_jai.jar</seg>
        <seg>/opt/fop-&fop-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="fop-prog">
        <term><command>fop</command></term>
        <listitem>
          <para>est un script enveloppe pour la commande <command>java</command> 
          qui paramètre l'environnement <application>FOP</application> et passe 
          les paramètres requis.</para>
          <indexterm zone="fop fop-prog">
            <primary sortas="b-fop">fop</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="fop.jar">
        <term><filename class='libraryfile'>fop.jar</filename></term>
        <listitem>
          <para>contient toutes les classes <application>Java</application> de
           <application>FOP</application>.</para>
          <indexterm zone="fop fop.jar">
            <primary sortas="c-fop.jar">fop.jar</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
