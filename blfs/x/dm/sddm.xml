<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY sddm-download-http "https://github.com/sddm/sddm/releases/download/v0.12.0/sddm-&sddm-version;.tar.xz">
  <!ENTITY sddm-download-ftp  " ">
  <!ENTITY sddm-md5sum        "520aab2b0ec3f9c253a7391133e2b1a9">
  <!ENTITY sddm-size          "3.7 Ko">
  <!ENTITY sddm-buildsize     "11.4 Mo">
  <!ENTITY sddm-time          "0.7 SBU ">
]>
<sect1 id="sddm" xreflabel="sddm-&sddm-version;">
  <?dbhtml filename="sddm.html"?>
  <sect1info>
    <othername>$LastChangedBy: fernando $</othername>
    <date>$Date: 2015-08-01 21:49:50 +0200 (sam. 01 août 2015) $</date>
  </sect1info>
  <title>sddm-&sddm-version;</title>
  <indexterm zone="sddm">
    <primary sortas="a-SDDM">SDDM</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à SDDM</title>
    <para>
      Le paquet <application>SDDM</application> contient un gestionnaire d'affichage léger
      écrit en <application>Qt</application> et QML.
    </para>
    &lfs78_checked;
    <bridgehead renderas="sect3">Information sur le paquet </bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP) : <ulink url="&sddm-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP) : <ulink url="&sddm-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement : &sddm-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement : &sddm-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis : &sddm-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction : &sddm-time;
        </para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de SDDM</bridgehead>
    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="cmake"/> et
      <xref linkend="qt5"/>
    </para>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="linux-pam"/> et
     <xref linkend="qt5"/>
    </para>
    <bridgehead renderas="sect4">Facultative</bridgehead>
    <para role="optional">
      <ulink url="http://sourceforge.net/projects/docutils/">Docutils</ulink>
     ( pour les pages de manuel)
    </para>
    <bridgehead renderas="sect4">Dépendances de Runtime</bridgehead>
    <para role="required">
      <xref linkend="consolekit"/>
    </para>
    <para condition="html" role="usernotes">Notes utilisateur :
      <ulink url="&blfs-wiki;/sddm"/>
    </para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de SDDM</title>
    <para>
      Pour commencer, créez un utilisateur et un groupe dédié pour prendre le controle du démon
      <command>sddm</command> après son démarrage. Tapez les commandes suivantes en tant qu'utilisateur
      <systemitem class="username">root</systemitem>:
    </para>
<screen role="root">
<userinput>groupadd -g 64 sddm &amp;&amp;
useradd  -c "SDDM Daemon" \
         -d /var/lib/sddm \
         -u 64 -g sddm    \
         -s /bin/false sddm</userinput>
</screen>
     <para>
      Commencez par corriger le démarrage de l'application <command>upowerd</command>,
      si nécessaire, et après le login, démarrez la session avec
      <command>ck-launch-session</command>:
    </para>
<screen>
<userinput>sed -e '/UPOWER_SERVICE)/ s:^://:' \
    -i src/daemon/PowerManager.cpp &amp;&amp;
sed -e 's/eval exec/&amp; ck-launch-session /' \
    -i data/scripts/Xsession</userinput>
</screen>
    <para>
      Installez <application>SDDM</application> en lançant les commandes suivantes :

    </para>
<screen>
<userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;
cmake -DCMAKE_INSTALL_PREFIX=/usr \
      -DCMAKE_BUILD_TYPE=Release  \
      -DENABLE_JOURNALD=OFF       \
      -DDBUS_CONFIG_FILENAME=sddm_org.freedesktop.DisplayManager.conf \
      -Wno-dev .. &amp;&amp;
make</userinput>
</screen>
    <para>
       Ce paquet n'a pas de suite de tests.
    </para>
    <para>
      Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> :
    </para>
<screen role="root">
<userinput>make install &amp;&amp;
install -v -dm755 -o sddm -g sddm /var/lib/sddm</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explications des commandes</title>
    <para>
      <parameter>-DCMAKE_BUILD_TYPE=Release</parameter> : Ce paramètre est utilisé pour appliquer le plus haut
     niveau d'optimisation de compilation.
    </para>
    <para>
      <parameter>-DENABLE_JOURNALD=OFF</parameter> : Ce paramètre est utilisé car
      BLFS ne supporte pas <application>systemd</application>.
    </para>
     <para>
      <parameter>-DDBUS_CONFIG_FILENAME=sddm_org.freedesktop.DisplayManager.conf</parameter>:
      CE paramètre est utilisé pour des raisons de sécurité: d'autres DM utilise déjà
      <filename>org.freedesktop.DisplayManager.conf</filename>. Vérifiez sur votre système que ce n'est pas le cas,
      si vous souhaitez le supprimer.
    </para>
    <para>
      <option>-DBUILD_MAN_PAGES=ON</option>: Ce paramètre peut être utilisé si vous voulez que les pages
      de manuel soient installées. Notez que vous devez avoir
      <ulink url="http://sourceforge.net/projects/docutils/">Docutils</ulink>
      pour les construire.
    </para>
  </sect2>
  <sect2 role="configuration">
    <title>Configuration de SDDM</title>
    <sect3 id="sddm-config">
      <title>Fichier de configuration</title>
      <para>
        /etc/sddm.conf
      </para>
      <indexterm zone="sddm sddm-config">
        <primary sortas="e-sddm.conf">/etc/sddm.conf</primary>
      </indexterm>
      <para>
        Ce fichier n'est pas installé avec les instructions de construction, et des valeurs par défaut sont
        utilisées par sddm. Afin de générer le fichier
        <filename>sddm.example.conf</filename>, tapez
      </para>
<screen>
<userinput>sddm --example-config > sddm.example.conf</userinput>
</screen>
     <note>
      <para>
        Cette commande génère un fichier de config <emphasis>example</emphasis>, qui dépend
        de plusieurs conditions systèmes ou il est généré. Quelques options sont par <emphasis>défauts</emphasis>.
         S'il y a déjà un fichier
        <filename>/etc/sddm.conf</filename> installé, il y aura génération d'un doublon.
        Quand il est généré pendant une session X, certaines configurations de session sont repliquées, c'est à dire si
        le curseur du thème Adwaita est déjà configuré, vous obtiendrez  <emphasis>CursorTheme=Adwaita</emphasis>
        dans le fichier exemple généré.
        </para>
      </note>
      <para>
      S'il n'y a pas
        encore le fichier <filename>/etc/sddm.conf</filename>, en tant qu'utilisateur
        <systemitem class="username">root</systemitem>, copiez le fichier d'exemple dans <filename>/etc/sddm.conf</filename>:
    </para>
<screen role="root">
<userinput>cp -v sddm.example.conf /etc/sddm.conf</userinput>
</screen>
       <para>
        Normalement, vous voudrez éditer ce fichier.
        Par exemple, si Xorg est installé dans /opt, utilisez votre éditeur préféré en tant
        qu'utilisateur <systemitem class="username">root</systemitem>
        pour remplacer les valeurs par défaut <emphasis>XauthPath</emphasis> par
        <emphasis>/opt/xorg/bin/xauth</emphasis>. Ou, en tant qu'utilisateur <systemitem
        class="username">root</systemitem>, tapez
      </para>
<screen role="root">
<userinput>sed -e '/ServerPath/ s|usr|opt/xorg|' \
    -i.orig /etc/sddm.conf</userinput>
</screen>
      <para>
        Cette commande fera la substitution et créera une copie du fichier original avec le nom
        <filename>/etc/sddm.conf.orig</filename>.
      </para>
      <para>
        A partir de maintenant, nous décrirons comment modifier les configurations en utilisant sed, mais
        biensur vous pouvez bien utiliser à la place votre éditeur préféré en tant que
        <systemitem class="username">root</systemitem>.
      </para>
       <para>
         Pour des raisons de sécurité, normalement vous voudrez
        <emphasis>ServerArguments=-nolisten tcp</emphasis>, sauf si vous voulez qu'une machine distante
         utilise le serveur X local. Dans ce cas, en tant qu'utilisateur <systemitem class="username">root</systemitem>
        tapez:
      </para>
<screen role="root">
<userinput>sed -e 's/-nolisten tcp//'\
    -i /etc/sddm.conf</userinput>
</screen>
      <para>
        Les utilisateurs de PC de bureau (portables), normallement souhaite la touche Num Lock activée (désactivée). Pour cela,
        en tant qu'utilisateur <systemitem
        class="username">root</systemitem>, tapez:
      </para>
<screen role="root">
<userinput>sed -e 's/\"none\"/\"on\"/' \
    -i /etc/sddm.conf</userinput>
</screen>
      <para>
        pour les utilisateurs de bureau. Pour les utilisateurs de portable remplacez
        \"on\" par \"off\", dans la commande précédente.
      </para>
   </sect3>
    <sect3 id="sddm-bootscript">
      <title>Script de démarrage</title>
      <para>
        Installez le fichier d'init <filename>/etc/rc.d/init.d/sddm</filename> depuis le paquet
        <xref linkend="bootscripts"/>.
      </para>
      <indexterm zone="sddm sddm-bootscript">
        <primary sortas="f-sddm">sddm</primary>
      </indexterm>
<screen role="root">
<userinput>make install-sddm</userinput>
</screen>
    </sect3>
    <sect3>
      <title>Configuration de Linux PAM</title>
      <para>
        Si vous avez construit <application>SDDM</application>
        avec le support <application>Linux PAM</application>,
        créez les fichiers de configuration nécessaire en lançant les commandes suivantes en tant qu'utilisateur
        <systemitem class="username">root</systemitem>:
      </para>
<screen role="root">
<userinput>cat &gt; /etc/pam.d/sddm &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/sddm
auth     requisite      pam_nologin.so
auth     required       pam_env.so
auth     required       pam_succeed_if.so uid &gt;= 1000 quiet
auth     include        system-auth
account  include        system-account
password include        system-password
session  required       pam_limits.so
session  include        system-session
# End /etc/pam.d/sddm</literal>
EOF
cat &gt; /etc/pam.d/sddm-autologin &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/sddm-autologin
auth     requisite      pam_nologin.so
auth     required       pam_env.so
auth     required       pam_succeed_if.so uid &gt;= 1000 quiet
auth     required       pam_permit.so
account  include        system-account
password required       pam_deny.so
session  required       pam_limits.so
session  include        system-session
# End /etc/pam.d/sddm-autologin</literal>
EOF
cat &gt; /etc/pam.d/sddm-greeter &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/sddm-greeter
auth     required       pam_env.so
auth     required       pam_permit.so
account  required       pam_permit.so
password required       pam_deny.so
session  required       pam_unix.so
-session optional       pam_systemd.so
# End /etc/pam.d/sddm-greeter</literal>
EOF</userinput>
</screen>
    </sect3>
    <sect3 id="sddm-init">
      <title>Démarrage de sddm</title>
      <para>
        Si le script de démarrage à été installé, démarrez sddm en lançant
        en tant qu'utilisateur <systemitem
        class="username">root</systemitem>:
      </para>
<screen role="root">
<userinput>/etc/rc.d/init.d/sddm start</userinput>
</screen>
      <para>
        Par convention, X doit être éxécuté avec le niveau de lancement 5, par conséquence, c'est vrai pour
        <application>sddm</application>. Cependant, le niveau de lancement par défaut de LFS est 3.
        Pour changer au niveau de lancement 5, depuis le terminal, en tant qu'utilisateur
        <systemitem class="username">root</systemitem>, faite que le script de démarrage de
        <command>sddm</command> soit éxécuté, pour obtenir l'affichage du greeter:
      </para>
<screen role="root">
<userinput>init 5</userinput>
</screen>
      <para>
        Afin d'initialisé en permanence par défaut le niveau 5, et obtenir automatiquement l'affichage du greeter de
        <command>sddm</command>, vous pouvez modifier
        <filename>/etc/inittab</filename>, en tant qu'utilisateur <systemitem
        class="username">root</systemitem> (les instructions suivantes font aussi une sauvegarde, donc vous pouvez
        facilement annuler les modifications):
      </para>
<screen role="root">
<userinput>cp -v /etc/inittab{,-orig} &amp;&amp;
sed -i '/initdefault/ s/3/5/' /etc/inittab</userinput>
</screen>
    </sect3>
    <sect3 id="sddm-sessions">
      <title>Sessions disponibles</title>
      <para>
        L'écran de bienvenue offre une liste des sessions disponibles,
        en fonction des gestionnaires de fenêtre et des environnements de bureau installés. La liste inclu les sessions
        qui correspondent au fichier
        <filename>.desktop</filename> installé sous
        <filename class="directory">/usr/share/xsessions</filename>. La plupart des gestionnaires de fenêtres
        et des environnements de bureau fournissent automatiquement ces fichiers, mais si nécessaire, vous pouvez en mettre
        un personnalisé.
      </para>
    </sect3>
    <sect3 id="sddm-themes">
      <title>Themes</title>
      <para>
        Quate thèmes sont installés dans <filename class="directory">
        /usr/share/sddm/themes</filename>:
        circles,
        elarun,
        maldives, et
        maui.
        Le thème par défaut est <quote>maui</quote>. Vous pouvez installer d'autres thèmes dans ce répertoire.
        Afin de changer le thème, vous devez éditer
        <filename>/etc/sddm.conf</filename>, en utilisant votre éditeur de textes préféré, changez le thème par défaut
        <quote>maui</quote>, en remplaçant <quote>Current=maui</quote> par
        <quote>Current=<replaceable>&lt;le nom de votre thème ici&gt;</replaceable></quote>,
        par exemple <quote>Current=maldives</quote>.
      </para>
      <para>
        Afin de voir le thème sans quiter la session, tapez:
      </para>
<screen>
<userinput>sddm-greeter --test-mode --theme <replaceable>&lt;theme path&gt;</replaceable></userinput>
</screen>
    </sect3>
    <sect3 id="sddm-Issues">
      <title>Problèmes connus</title>
      <para>
        Cette application fonctionne bien, mais il y a des problèmes. Vous trouvez les problèmes connus par les
        développeur sur
        <ulink url="https://github.com/sddm/sddm/issues">Issues</ulink>. L'équipe de développement de BLFS
        a trouvé quelques problèmes.
      </para>
      <note>
        <para>
          Dans les paragraphes suivants, à cause de problèmes avec sddm-greeter,
          nous mentionnons comment définir le clavier utilisé ici. Notez que c'est aussi le clavier qui sera utilisé dans
          la sessions X, seulement il y a une configuration dans l'environnement de bureau ou dans le gestionnaire
          de fenêtre qui l'écrasera après.
        </para>
      </note>
      <para>
       Sélection du clavier : l'écran de bienvenue montre une double case de question ou le mauvais clavier.
        Quand vous commencez à taper le mot de passe ou le nom de l'utilisateur (en fonction du thème, seulement
        le mot de passe), la bonne sélection de clavier apparaît magiquement. Facultativement, un contournement
        est d'inclure la liste des clavier dans le script
        <command>/usr/share/sddm/scripts/Xsetup</command>, en tant qu'utilisateur
        <systemitem class="username">root</systemitem>:
      </para>
<screen role="root">
<userinput>echo 'setxkbmap <replaceable>"&lt;your keyboard comma separated list&gt;"</replaceable>' &gt;&gt; \
     /usr/share/sddm/scripts/Xsetup</userinput>
</screen>
      <para>
        Par exemple <command>echo 'setxkbmap "fr,gb,br,us"' &gt;&gt;
        /usr/share/sddm/scripts/Xsetup</command>. Une définition très précise de(s) clavier(s) est possible,
        par exemple: <command>echo 'setxkbmap -model pc105
        -layout br,us -variant abnt2,dvorak -keycodes evdev' &gt;&gt;
        /usr/share/sddm/scripts/Xsetup</command>. Voir le man de setxkbmap.
      </para>

<para>
        Dircolors: le fichier <filename>/etc/dircolors</filename> n'est pas considéré. En particulier, les fichiers
        compressés ne sont pas affichés en rouge. Si cela arrive, un contournement est de taper, en tant qu'utilisateur
        <systemitem class="username">root</systemitem>:
      </para>
<screen role="root">
<userinput>echo "source /etc/profile.d/dircolors.sh" &gt;&gt; /etc/bashrc</userinput>
</screen>
      <para>
        Il a été signalé que des problèmes peuvent survenir avec ce paquet, si Xorg est installé
        avec un préfixe autre que <filename class="directory">/usr</filename>. Cependant, l'équipe de développement
        de BLFS n'a pas eu de problème dans ce cas.
      </para>
    </sect3>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          sddm et sddm-greeter
        </seg>
        <seg>
          Aucun
        </seg>
        <seg>
          $QT5DIR/qml/SddmComponents,
          /usr/share/sddm et
          /var/lib/sddm
        </seg>
      </seglistitem>
    </segmentedlist>
    <variablelist>
      <bridgehead renderas="sect3">Description courte</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="sddm-prog">
        <term><command>sddm</command></term>
        <listitem>
          <para>
            est un gestionnaire d'affichage et de connexion basé sur les biblothèques
            <application>Qt</application>.
          </para>
          <indexterm zone="sddm sddm-prog">
            <primary sortas="b-sddm">sddm</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="sddm-greeter">
        <term><command>sddm-greeter</command></term>
        <listitem>
          <para>
            est un processus auxiliaire qui affiche le greeter,
            une interface utilisateur graphique pour permettre l'identification et initialiser le gestionnaire
            de fenêtres ou l'environnement de bureau sélectionnés.
          </para>
          <indexterm zone="sddm sddm-greeter">
            <primary sortas="b-sddm-greeter">sddm-greeter</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
