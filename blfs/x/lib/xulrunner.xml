<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY xulrunner-download-http
           "http:///ftp.mozilla.org/pub/mozilla.org/firefox/releases/&firefox-version;/source/firefox-&firefox-version;.source.tar.bz2">
  <!ENTITY xulrunner-download-ftp
           "ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/&firefox-version;/source/firefox-&firefox-version;.source.tar.bz2">
  <!ENTITY xulrunner-md5sum        "ac7e8c801ded4e6195182bf54c81acb6">
  <!ENTITY xulrunner-size          "137 Mo">
  <!ENTITY xulrunner-buildsize     "3.5 Go (137 Mo installé)">
  <!ENTITY xulrunner-time          "42 SBU">
]>
<sect1 id="xulrunner" xreflabel="Xulrunner-&xulrunner-version;">
  <?dbhtml filename="xulrunner.html" ?>
  <sect1info>
    <othername>$LastChangedBy&nbsp;: krejzi $</othername>
    <date>$Date&nbsp;: 2013-04-06 00:01:58 +0200 (Sat, 06 Apr 2013) $</date>
  </sect1info>
  <title>Xulrunner-&xulrunner-version;</title>
  <indexterm zone="xulrunner">
    <primary sortas="a-Xulrunner">Xulrunner</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à Xulrunner</title>
    <para><application>Xulrunner</application> est un environnement d'exécution
    pour les applications XUL, et il constitue la majeure partie de la base de
    code de <application>Mozilla</application>. En particulier, il offre 
    le moteur gecko et les fichiers pkgconfig pour que des applications
    puissent l'utiliser.
    </para>
   &lfs75_checked;
    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&xulrunner-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&xulrunner-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &xulrunner-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &xulrunner-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &xulrunner-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &xulrunner-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de Xulrunner</bridgehead>
    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="alsa-lib"/>,
      <xref linkend="gtk2"/>,
      <xref linkend="zip"/> et
      <xref linkend="unzip"/>.
    </para>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="icu"/>,
      <xref linkend="libevent"/>,
      <xref linkend="libvpx"/>,
      <xref linkend="nspr"/>,
      <xref linkend="nss"/>,
      <xref linkend="sqlite"/> et
      <xref linkend="yasm"/>
    </para>
    <note>
      <para>
        Si vous n'installez pas les dépendances recommandées, alors les versions
        internes de ces paquets seront utilisés.
        Ils peuvent être testé pour fonctionner, mais ils peuvent être
        dépassé ou contenir des trous de sécurité.
      </para>
    </note>
    
    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="curl"/>,
      <xref linkend="dbus-glib"/>,
      <xref linkend="doxygen"/>,
      <xref linkend="gst-plugins-base"/> (avec
       <xref linkend="gst-plugins-good"/> et
       <xref linkend="gst-ffmpeg"/>,
       <ulink url="http://hunspell.sourceforge.net/">Hunspell</ulink>,
      <xref linkend="libnotify"/>,
      <xref linkend="openjdk"/>,
      <xref linkend="pulseaudio"/>,
      <xref linkend="startup-notification"/>,
      <xref linkend="wget"/> et
      <xref linkend="wireless_tools"/>
    </para>
    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/xulrunner"/></para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de Xulrunner</title>
    <para>La configuration de <application>Xulrunner</application> se fait en
    créant un fichier <filename>mozconfig</filename> contenant les options de
    configuration désirées. Un <filename>mozconfig</filename> par défaut est
    créé ci-dessous. Pour voir toute la liste des options de configuration 
    disponibles (et une description abrégée de chacune), exécutez
    <command>./configure --help</command>. Vosu devez éditer entièrement le fichier
    et commenter ou décommenter les options il faut.</para>
<screen>
<userinput>cat &gt; mozconfig &lt;&lt; "EOF"
# If you have a multicore machine, firefox will now use all the cores by
# default. Exceptionally, you can reduce the number of cores, e.g. to 1,
# by uncommenting the next line and setting a valid number of CPU cores.
#mk_add_options MOZ_MAKE_FLAGS="-j1"
# If you have installed DBus-Glib comment out this line:
ac_add_options --disable-dbus
# If you have installed dbus-glib, and you have installed (or will install)
# wireless-tools, and you wish to use geolocation web services, comment out
# this line
ac_add_options --disable-necko-wifi
# If you have installed libnotify comment out this line:
ac_add_options --disable-libnotify
# GStreamer is necessary for H.264 video playback in HTML5 Video Player;
# to be enabled, also remember to set "media.gstreamer.enabled" to "true"
# in about:config. If you have GStreamer 0.x.y, uncomment this line:
#ac_add_options --enable-gstreamer
# or uncomment this line, if you have GStreamer 1.x.y
#ac_add_options --enable-gstreamer=1.0
# Uncomment these lines if you have installed optional dependencies:
#ac_add_options --enable-system-hunspell
#ac_add_options --enable-startup-notification
# Comment out following option if you have PulseAudio installed
ac_add_options --disable-pulseaudio
# If you have not installed Yasm then uncomment this line:
#ac_add_options --disable-webm
# Comment out following options if you have not installed
# recommended dependencies:
ac_add_options --enable-system-sqlite
ac_add_options --with-system-libevent
ac_add_options --with-system-libvpx
ac_add_options --with-system-nspr
ac_add_options --with-system-nss
ac_add_options --with-system-icu
# The BLFS editors recommend not changing anything below this line:
ac_add_options --prefix=/usr
ac_add_options --enable-application=xulrunner
ac_add_options --disable-crashreporter
ac_add_options --disable-updater
ac_add_options --disable-tests
ac_add_options --enable-optimize
ac_add_options --enable-strip
ac_add_options --enable-install-strip
ac_add_options --enable-system-cairo
ac_add_options --enable-system-ffi
ac_add_options --enable-system-pixman
# shared-js broken by WeakMapPtr visibility
#ac_add_options --enable-shared-js
ac_add_options --with-pthreads
ac_add_options --with-system-bz2
ac_add_options --with-system-jpeg
ac_add_options --with-system-png
ac_add_options --with-system-zlib
mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/xulrunner-build-dir
EOF</userinput>
</screen>
    <note>
      <para>
        La construction de <application>Xulrunner</application> utilise
	beaucoup de mémoire. Sur certain système, La combinaison RAM/Swap
	utilisable doit être de 6 Go.
      </para>
    </note>
        <para>Construisez <application>Xulrunner</application> en tapant les
    commandes suivantes&nbsp;:</para>
    <note><para>
      Si vous avez compilé <application>Xulrunner</application> en chroot,
      passez <envar>SHELL=/bin/bash</envar> à la première commande make dessous.
    </para></note>
<screen>
<userinput>make -f client.mk</userinput>
</screen>
    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>
    <para>Installez, en tant qu'utilisateur <systemitem class="username">root</systemitem>>&nbsp;:nbsp;:</para>
<screen role="root">
<userinput>make -C xulrunner-build-dir install &amp;&amp;
mkdir -pv /usr/lib/mozilla/plugins &amp;&amp;
rm -rf /usr/lib/xulrunner-&xulrunner-version;/plugins &amp;&amp;
ln -sv ../mozilla/plugins /usr/lib/xulrunner-&xulrunner-version; &amp;&amp;
chmod -v 755 /usr/lib/xulrunner-devel-&xulrunner-version;/sdk/bin/xpcshell &amp;&amp;
for library in libmozalloc.so libmozjs.so libxul.so; do
    ln -sfv ../../../xulrunner-&xulrunner-version;/$library \
            /usr/lib/xulrunner-devel-&xulrunner-version;/sdk/lib/$library
    ln -sfv xulrunner-&xulrunner-version;/$library /usr/lib/$library
done
ln -sfv ../xulrunner-devel-&xulrunner-version;/sdk/bin/run-mozilla.sh \
        /usr/lib/xulrunner-&xulrunner-version;
ln -sfv ../xulrunner-devel-&xulrunner-version;/sdk/bin/xpcshell \
        /usr/lib/xulrunner-&xulrunner-version;</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explication des commandes</title>
     <para>
      <command>ac_add_options --disable-necko-wifi</command>: Si vous enlevez cette commande,
      vous activerez le suppeort "opt-in" pour la géolocalication des services web quand vous
      utilisez une connexion wifi.
    </para>
    <para>
      <command>sed -i ... js/src/vm/WeakMapPtr.cpp</command>: corrige la construction avec
      <command>ac_add_options --enable-shared-js</command>.
    </para>
   <para>
  <command>make -f client.mk ...</command>&nbsp;: Les produits Mozilla
    sont empaquetées pour permettre l'utilisation d'un fichier de configuration
    qu'on peut utiliser pour passer les paramètres de configuration à la
    commande <command>configure</command>. <command>make</command> utilise
    le fichier <filename>client.mk</filename> pour obtenir la configuration de
    départ et paramétrer les réglages.</para>
    <para><command>ln -sfv ../mozilla/plugins ...</command>&nbsp;: Certains
    paquets installeront des greffons de navigateur dans
    <filename class="directory">/usr/lib/mozilla/plugins</filename>. La création
    du lien symbolique <application>Xulrunner</application> conserve les greffons
    supplémentaires gans le répertoire habituel.</para>
    <para>
      <command>for library in libmozalloc.so libmozjs.so libxul.so ...
      </command>&nbsp;: Ces bibliothèques fournies avec ce paquet sont
      installées dans
      <filename class="directory">/usr/lib/xulrunner-&xulrunner-version;</filename>
      ce qui veut dire qu'elles ne sont pas trouvées à l'exécution. Ces commandes font des liens
      symboliques relatifs vers les bibliothèques partagées de 
      <filename class="directory">/usr/lib</filename>. Cela remplacera aussi les bibliothèques en doubles qui sont installées
      dans
      <filename class="directory">/usr/lib/xulrunner-devel-&xulrunner-version;/sdk/lib</filename>
      avec des liens symboliques pour économiser un peu d'espace.
    </para>
    <para>
     <command>ln -sv -f ../xulrunner-devel-&xulrunner-version;/sdk/bin/run-mozilla.sh</command>
     Les fichiers <filename>run-mozilla.sh</filename> et <filename>xpcshell</filename> 
     ont été déplacés dans cette version, mais le code qui installe <application>Firefox</application>
     (lorsqu'il est lié à xulrunner) n'a pas été mis à jour. Ces liens symboliques permettent à
        <application>Firefox</application> de s'installer quand il est construit contre
        <application>Xulrunner</application>.
    </para>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          xulrunner
        </seg>
        <seg>
          De nombreuses bibliothèques, des composants du navigateur, plugins, des extensions
        et des modules d'aide installés dans <filename
          class="directory">/usr/lib/xulrunner-&xulrunner-version;</filename>
        </seg>
        <seg>
          /usr/include/xulrunner-&xulrunner-version;,
          /usr/lib/xulrunner-&xulrunner-version;,
          /usr/lib/xulrunner-devel-&xulrunner-version; and
          /usr/share/idl/xulrunner-&xulrunner-version;
        </seg>
      </seglistitem>
    </segmentedlist>
    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="xulrunner-prog">
        <term><command>xulrunner</command></term>
        <listitem>
          <para>est un script shell, utile pour identifier la version
          installée et lancée de l'application <application>Xulrunner</application>.</para>
          <indexterm zone="xulrunner xulrunner-prog">
            <primary sortas="b-xulrunner">xulrunner</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
