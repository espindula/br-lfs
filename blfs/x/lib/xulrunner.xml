<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY xulrunner-download-http "http://releases.mozilla.org/pub/mozilla.org/firefox/releases/&firefox-version;/source/firefox-&firefox-version;.source.tar.bz2">
  <!ENTITY xulrunner-download-ftp  "ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/&firefox-version;/source/firefox-&firefox-version;.source.tar.bz2">
  <!-- md5sum et size should match firefox, but the buildsize and time will differ -->
  <!ENTITY xulrunner-md5sum        "d7c90aed8209beefa74badf02e8eeae1">
  <!ENTITY xulrunner-size          "51 Mio">
  <!ENTITY xulrunner-buildsize     "820 Mio">
  <!ENTITY xulrunner-time          "20 SBU">
]>

<sect1 id="xulrunner" xreflabel="Xulrunner-&xulrunner-version;">
  <?dbhtml filename="xulrunner.html" ?>

  <sect1info>
    <othername>$LastChangedBy: randy $</othername>
    <date>$Date: 2011-01-09 17:51:09 +0100 (dim 09 jan 2011) $</date>
  </sect1info>

  <title>Xulrunner-&xulrunner-version;</title>

  <indexterm zone="xulrunner">
    <primary sortas="a-Xulrunner">Xulrunner</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Xulrunner</title>

    <para><application>Xulrunner</application> est un environnement d'exécution
    pour les applications XUL, et il constitue la majeure partie de la base de
    code de <application>Mozilla</application>. En particulier, il offre 
    le moteur gecko et les fichiers pkgconfig pour que des applications telles que
    <application>Yelp</application> puissent l'utiliser. Toutefois, sachez que les 
	applications Gnome sont en transition vers <application> Webkit </application>,
	au lieu de gecko</para>

    &lfs67_checked;
    <para>&lfssvn_checked;20101029&lfssvn_checked2;</para>

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&xulrunner-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&xulrunner-download-ftp;"/></para>
	<tip><para>Quand une nouvelle version de <application>Firefox</application> 
	est publiée, une nouvelle version correspondante de <application>Xulrunner</application> 
	apparaît parfois en même temps. D'autres fois, elle apparaît plusieurs jours
	plus tard ou pas du tout. Jusque-là, dans la série
	<application>Firefox-3.0</application>, toute nouvelle version a des
	bibliothèques Xulrunner créées avec une nouvelle version correspondante. Chaque
	fois qu'une archive tar Xulrunner séparée est publiée, elle est bit à bit
		identique à l'archive tar correspondante de Firefox. Nous utiliserons donc
	l'archive tar de <application>Firefox</application> pour éviter de télécharger
	ce gros paquet deux fois.</para></tip>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &xulrunner-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &xulrunner-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &xulrunner-buildsize; (en utilisant 
		toutes les dépendances)</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &xulrunner-time; (en utilisant 
		toutes les dépendances)</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Chargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif optionnel>&nbsp;: <ulink
        url="&patch-root;/firefox-&firefox-version;-provide_system_nspr_nss-1.patch"/>
        (Requis si vous utilisez les bibliothèques NSPR et NSS fournies comme version du
		système pour d'autres paquets)</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Xulrunner</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="alsa-lib"/>,
    <xref linkend="gtk2"/>,
    <xref linkend="libidl"/>,
    <xref linkend="pango"/>,
    <xref linkend="python"/> et
    <xref linkend="zip"/></para>

    <para>Remarque&nbsp;: Vous devriez avoir installé <application>libjpeg</application> 
    avant <application>GTK+</application> et elle devrait exister sur votre 
    système. Si pour une raison quelconque, vous n'avez pas installé
    <application>libjpeg</application>, vous devriez supprimer l'option
    <option>--with-system-jpeg</option> du fichier
    <filename>mozconfig</filename> créé ci-dessous.</para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended"><xref linkend="sqlite"/> (le sqlite interne est
    incompatible avec des installations esistantes ou futures)</para>
	
    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="dbus-glib"/>,
    <xref linkend="doxygen"/>,
    <xref linkend="curl"/> (only for crash-reporter),
    <xref linkend="gnome-vfs"/> et <xref linkend="libgnomeui"/> (pour l'intégration dans gnome),
    <xref linkend="libnotify"/>,
    <xref linkend="libpng"/> (patched for apng support),
    <xref linkend="nss"/> (recommendé si vous construisez d'autres paquets de Mozilla.org),
    <xref linkend="startup-notification"/>,
    <xref linkend="unzip"/>,
    <ulink url="http://sourceforge.net/projects/hunspell/">Hunspell</ulink>,
    <ulink url="http://www.valgrind.org/">Valgrind</ulink> (seulement pour tester le code jemalloc), et
 
    <xref linkend="wget"/></para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/xulrunner"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Xulrunner</title>

    <para>La configuration de <application>Xulrunner</application> se fait en
    créant un fichier <filename>mozconfig</filename> contenant les options de
    configuration désirées. Un <filename>mozconfig</filename> par défaut est
    créé ci-dessous. Pour voir toute la liste des options de configuration 
    disponibles (et une description abrégée de chacune), exécutez
    <command>./configure --help</command>. Vosu devez éditer entièrement le fichier
    et commenter ou décommenter les options nécessaires. Si vous préférez télécharger
    le fichier au lieu de le créer en le tapant ou par couper-coller, vous pouvez le trouver
	à l'adresse <ulink url="&files-anduin;/xulrunner-&xulrunner-version;-mozconfig"/>
    (il faut mettre le fichier à la racine de l'arborescence, et l'appeler
    <filename>mozconfig</filename>) ou <filename>.mozconfig</filename>).</para>

<screen><?dbfo keep-together="auto"?><userinput>cat &gt; mozconfig &lt;&lt; "EOF"
<literal># Ce fichier contient les options utilisées dans la construction de Xulrunner
# Il se peut que vous deviez spécifier des options supplémentaires pour vos
# besoins spécifiques de construction.
# Utilisez les informations fournies par l'exécution de './configure --help' 
# pour vous aider à déterminer si vous avez besoin d'ajouter des options
# supplémentaires.
# On peut ajouter des options supplémentaires en décommentant les exemples dans
# ce fichier ou en ajoutant des options en insérant une ligne contenant 
# 'ac_add_options --une-option-dont-vous-avez-besoin'.  Sachez que certaines
# options acceptées, comme '--with-system-bz2', ne touchent pas la construction.

# Specifie que l'on souahite construire Xulrunner. Notez que cette ligne est commentée
# car elle est redondante avec la prochaine ligne d'initialisation.
#ac_add_options --enable-application=xulrunner

# Utiliser l'initialisation par défaut spécifier dans l'arborescence racine. Le
# --enable-application=xulrunner est initialisé dans ce fichier.
. $topsrcdir/xulrunner/config/mozconfig

# Crée un répertoire objet et spécifie de construire le paquet dans ce
# répertoire. Si désiré, modifiez l'emplacement du répertoire objet pour un 
# répertoire à l'intérieur de l'arborescence des sources en supprimant '../' 
# de la ligne ci-dessous.
mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/../xulrunner-build

# Spécifie le préfixe d'installation. Si vous préférez installer Xulrunner dans
# un autre préfixe, modifiez la ligne ci-dessous pour l'adapter à vos besoins
# (le fichier de configuration system.conf sera toujours écrit dans /etc/gre.d)
ac_add_options --prefix=/usr

# Applique un niveau minimal d'optimisation (-O)
ac_add_options --enable-optimize

# Ces options sont utilisées pour que les binaires de Xulrunner soient
# liés aux copies installées du système des bibliothèques spécifiées et non au
# code source qui peut ne pas être les versions les plus récentes.
# Avec une exception pour libsqlite3, la bibliothèque est lièe statiquement

# (Options pour utiliser les bibliothèques installées sur le système)
# L'utilisation de la version légère de libsqlite3 est connue pour causer
# des problemes avec les autres applications qui utilisent sqlite3.
# Commentez cette ligne seuelent si vous savez exactement ce que vous faite!
ac_add_options --enable-system-sqlite

# commentez seulement cela si vous voulez utiliser une autre version corrigée de cairo que
# celle incluse dans l'arborescence de mozilla et les en-têtes du système
ac_add_options --enable-system-cairo

# commentez cela si vous n'avez pas installé lcms
ac_add_options --enable-system-lcms

# décommentez cela si vous avez installé Hunspell
#ac_add_options --enable-system-hunspell

# Décommentez cela si vous avez installé startup-notification
#ac_add_options --enable-startup-notification

# commentez cela si vous n'avez pas construit libjpeg avant gtk+-2
ac_add_options --with-system-jpeg

# Ces deux options activent le support pour la construction de Xulrunner avec
# les versions installées sur le système des bibliothèques du
# Network Security Services (NSS) et Netscape Portable Runtime (NSPR).
# Commentez les si vous souhaitez utiliser les copies incluses (pas recommandé)
ac_add_options --with-system-nspr
ac_add_options --with-system-nss

# commentez cela si vous n'avez pas construit png avec le correctif apng
ac_add_options --with-system-png

# L'option pthreads n'est utilisé que lors de la construction de nspr
# décommentez cela si vous avez consttrui  le nspr inclus
#ac_add_options --with-pthreads

# zlib est inclus dans LFS. Ne pas commenter cette ligne
ac_add_options --with-system-zlib

# (Options pour désactiver des bouts du paquet)
# Cette option est utilisée pour désactiver le support d'accessibilité dans les
# binaires de Xulrunner. Commentez cette option si vous voulez le support 
# d'accessibilité.
ac_add_options --disable-accessibility

# Décommentez cela si vous n'avez pas construit curl
#ac_add_options --disable-crashreporter

# Commentez cela si vous n'avez pas construit Dbus-Glib
ac_add_options --disable-dbus

# commentez cela si vous avez Gnome-VFS et libgnomeui, et si vous souhaitez
# intégrer Xulrunner sur votre bureau Gnome
ac_add_options --disable-gnomevfs

# Commentez cela si vous avez installé wireless-tools installed et souhaitez utiliser le nouveau new
# scanner Necko WiFi.
ac_add_options --disable-necko-wifi

# Commentez cela si vous avez installé libnotify.
ac_add_options --disable-libnotify

# Cette option est ajoutée pour que le programme d'installation de Mozilla 
# ne soit pas construit ou installé. Le programme n'est pas nécessaire pour une
# installation BLFS de Xulrunner.
ac_add_options --disable-installer

# Si vous activez javaxpcom, vous devez avoir installé un compilateur java.
ac_add_options --disable-javaxpcom

# Cette option est ajoutée pour que les bibliothèques et les programmes de test
# ne se construisent pas. Ils ne serviraient que pour du débogage.
ac_add_options --disable-tests

# Désactive le metteur à jour, qui n'est pas adapté si vous construisez à partir
# des sources 
ac_add_options --disable-updater

# Cette option fait que les bianires de Firefox installés ont le nom officiel Firefox
# embarqué en eux. A cause de restriction de la licence, vous ne 
# pouvez pas distribuer de binaires créés en utilisant cette option. Cela signifie
# que vous aurez un popup EULA quand vous lancerez la première fois une application
# fonctionnant sous Xulrunner.
ac_add_options --enable-official-branding

# Utilisez les mesures anti-phishing (une liste noire des sites)
ac_add_options --enable-safe-browsing

# Cette option est utilisé pour que les symboles de débogage soient supprimés
# des binaires installés lors du processus d'installation. Commentez cette
# option s'il se peut que vous ayez besoin de garder les symboles de débogage
# dans les binaires installés (les binaires qui en résultent seront alourdis
# d'environ 7Mio).
ac_add_options --enable-strip

# Décommentez cette option si vous désirez le support de l'affichage sur deux
# écrans en même temps en utilisant les bibliothèques Xinerama de X-Window.
#ac_add_options --enable-xinerama

# Cette option identifie le répertoire par défaut des binaires de l'installation
# de Xulrunner et utilisé pour localiser les fichiers installés de Xulrunner.
# Cette option n'est utilisée que pour du développement.
#ac_add_options --with-default-mozilla-five-home=/usr/lib/xulrunner-&xulrunner-version;</literal>

EOF</userinput></screen>

    <para>Si vous n'avez pas installé <xref linkend="nspr"/> et
    <xref linkend="nss"/>, alors appliquez le correctif avec la commande suivante:</para>

<screen><userinput>patch -Np1 -i ../firefox-&firefox-version;-provide_system_nss_nspr-1.patch</userinput></screen>

    <para>Installez <application>Xulrunner</application> en tapant les
    commandes suivantes&nbsp;:</para>

<screen><userinput>echo "Requires: nspr" >>xulrunner/installer/libxul-embedding.pc.in &amp;&amp;
make -f client.mk build</userinput></screen>

    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>>:nbsp;:</para>

  <!-- I really don't think we need the last command to installl symlinks to the
     Xul libraries. Any package using Xul is going to use the pkgconfig file to
     find the things it needs -->
<screen role="root"><userinput>make -f client.mk install &amp;&amp;

install -v -m755 -d /usr/lib/mozilla &amp;&amp;
ln -sv              /usr/lib/xulrunner-&xulrunner-version;/plugins \
                    /usr/lib/mozilla &amp;&amp;

chown -Rv root:root /usr/lib/xulrunner-* \
                    /usr/share/idl/xulrunner-&xulrunner-version; \
                    /usr/include/xulrunner-&xulrunner-version;</userinput></screen>
                    
<!-- commented out per discussion on BLFS-Dev
ln -sfv             xulrunner-devel-&xulrunner-version;/lib/lib{xul,xpcom,mozjs}.so \
                    /usr/lib</userinput></screen> -->

    <para>Si vous voulez utiliser les NSPR et NSS inclus, en tant que 
    <systemitem class="username">root</systemitem>&nbsp;, completez l'instalaltion avec
    les commandes suivantes&nbsp;:</para>>

<screen role="root"><userinput>for DL in \
    libnss3.so libnssutil3.so libsmime3.so libssl3.so libsoftokn3.so \
    libplds4.so libplc4.so libnspr4.so
do
    ln -sv xulrunner-&xulrunner-version;/$DL /usr/lib
done &amp;&amp;
unset DL</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>echo "Requires: nspr"
	>>xulrunner/installer/libxul-embedding.pc.in</command>>:nbsp;: Si vous essayez de construire <application>Yelp</application> sans
    cela, l'en-tête prtypes de nspr ne sera pas installée. On peut discuter
    pour savoir si c'est un problème (le code fonctionne en principe sur les 
    geckos récents), mais cette correction est peu vraisemblablement à l'origine
    de problèmes dans d'autres paquets.</para>

    <para><command>make -f client.mk ...</command>&nbsp;: Les produits Mozilla 
    sont empaquetées pour permettre l'utilisation d'un fichier de configuration
    qu'on peut utiliser pour passer les paramètres de configuration à la
    commande <command>configure</command>. <command>make</command> utilise
    le fichier <filename>client.mk</filename> pour obtenir la configuration de
    départ et paramétrer les réglages, puis selon le paramètre cible
    (<parameter>build</parameter> ou <parameter>install</parameter>), soit lance
    le script <command>configure</command>, soit compile le paquet oru
    installe le paquet.</para>

    <para><command>for DL in ...</command>&nbsp;: Les bibliothèques NSPR et NSS
    inclus avec ce paquet sont installés dans /usr/lib/xulrunner-&xulrunner-version;,
    ce qui signifie qu'elles ne seront pas trouvées au moment de l'exécution. En
    utilisant des liens symboliques issus de
    <filename class="directory">/usr/lib</filename> les bibliothèques seront trouvées 
	et les liens pourront être modifiés facilement pour pointer vers une version plus
    récente quand nous mettrons à jour.</para>

    <para><command>ln -sv /usr/lib/xulrunner-&xulrunner-version;/plugins
    /usr/lib/mozilla</command>&nbsp;: Certains paquets installeront des 
    plugins de navigateur dans <filename class='directory'>/usr/lib/mozilla/plugins</filename>.
	En le créant sous forme de lien symbolique vers les plugins <application>Xulrunner</application>
	nous les laissons tous dans un répertoire commun.</para>

   <note>
    <para>Quand vous mettez à jour Xulrunner, rappelez-vous de mettre à jour les
    liens symboliques et de copier les plugins supplémentaires compilés contre
    cette série de Xulrunner dans le nouveau répertoire de plugins.</para>
   </note>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>xulrunner, et optionally nspr-config</seg>
        <seg>Numerous libraries, browser components, plugins, extensions, et
        helper modules installed in <filename
        class='directory'>/usr/lib/xulrunner-&xulrunner-version;</filename></seg>
        <seg>/etc/gre.d, /usr/include/xulrunner-&xulrunner-version;,
        /usr/lib/xulrunner-&xulrunner-version;,
        /usr/lib/xulrunner-devel-&xulrunner-version;, et
        /usr/share/idl/xulrunner-&xulrunner-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="xulrunner-prog">
        <term><command>xulrunner</command></term>
        <listitem>
          <para>est un script shell, utile pour identifier la version
          installée.</para>
          <indexterm zone="xulrunner xulrunner-prog">
            <primary sortas="b-xulrunner">xulrunner</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
