<?xml version="1.0" encoding="ISO-8859-1"?>
<sect2>
<title>Installation de <application>XFree86</application></title>

<sect3>
<title>Paramétrages de compilation du noyau</title>
<para>Si vous avez un Intel P6 (Pentium Pro, Pentium II et suivants), il est
recommandé de compiler le support de <acronym>MTRR</acronym> (acronyme
de <foreignphrase>Memory Type Range Registers</foreignphrase>) dans le
noyau. Le noyau peut interfacer les <acronym>CPU</acronym> Cyrix et AMD avec
l'interface <acronym>MTRR</acronym>, donc la sélection de cette option est
aussi utile pour ces processeurs. Cette option se trouve dans le menu
<foreignphrase>Processor type and features</foreignphrase>. Il peut améliorer
la performance des opérations d'écriture d'images, de la 2,5 fois à plus sur les
cartes vidéo <acronym>PCI</acronym> et <acronym>AGP</acronym>.</para>

<para>Dans la section "Character Devices", activez le support de
l'<acronym>AGP</acronym> et
sélectionnez le support du chipset de votre carte mère. Si vous ne connaissez
pas le chipset, vous pouvez sélectionner tous les types de composants, ce qui
va agrandir la taille de votre noyau. Vous pouve déterminer habituellement le
chipset de votre carte mère en lançant:</para>
<screen><userinput><command>cat /proc/pci</command></userinput></screen>

<para>Dans la section "Character Devices", <emphasis>désactivez</emphasis> le
'Direct Rendering Manager' sauf si vous avez une carte vidéo disposant de
l'infrastructure 'Direct Rendering Infrastructure' (<acronym>DRI</acronym>).
Une liste complète de cartes vidéo <acronym>DRI</acronym> supportées est disponible
sur <ulink url="http://dri.sourceforge.net" /> dans la section Status.
Actuellement, les cartes supportés incluent celles de 3dfx (Voodoo, Banshee),
3Dlabs, ATI (Rage Pro, Rage 128, Radeon 7X00, Radeon 2), Intel (i810, i815) et
Matrox (G200, G400, G450). Si vous activez <acronym>DRI</acronym> ici, assurez-vous
de sélectionner le(s) carte(s) vidéo que vous voulez supporter comme
<emphasis>module</emphasis>.</para>

<para>De plus, NVidia fournit ses propres pilotes par un binaire (sources fermés)
qui n'utilise pas le <acronym>DRI</acronym>. Si vous comptez utiliser ces pilotes,
n'activez pas le <acronym>DRI</acronym>.</para>

<para>Si vous avez effectué des modifications à la configuration du noyau,
recompilez-le.</para>

<para>Copiez <filename>/usr/src/linux/arch/i386/boot/bzImage</filename> et
<filename>/usr/src/linux/System.map</filename> dans
<filename>/boot</filename>, éditez <filename>/etc/lilo.conf</filename>
de manière appropriée et lancez <userinput>lilo</userinput>.</para>

<note><para>Si vous construisez <application>XFree86</application> dans un environnement chroot,
assurez-vous que la version du noyau du système de base et du système cible sont
les mêmes. Ceci est tout spécialement important si vous avec activé le support
de <acronym>DRI</acronym> en tant que module en suivant les instructions ci-dessus.</para></note>

</sect3>

<sect3><title>Créer <filename>host.def</filename></title>

<para>Bien que <application>XFree86</application> compilera sans fichier
<filename>host.def</filename>, le fichier suivant est
recommandé pour personnalisation de l'installation. Commencez à partir du
répertoire <filename class="directory">xc</filename>.</para>

<note><para>Le fichier <filename>host.def</filename> est un fichier
<application>C</application>, pas le
fichier de configuration habituel. Si vous effectuez des changements,
assurez-vous que les caractères de commentaire (<userinput>/*</userinput> et
<userinput>*/</userinput>) sont corrects. La plupart des entrées dans le fichier
ci-dessous ne sont plus en commentaires avec les paramètrages par défaut.
</para></note>

<screen><userinput><command>cat &gt; config/cf/host.def &lt;&lt; "EOF"</command>
/* Begin XFree86 host.def file */

/* System Related Information.  If you read and configure only one
 * section then it should be this one.  The Intel architecture defaults are 
 * set for a i686 and higher.  Axp is for the Alpha architecture and Ppc is  
 * for the Power PC.  Note that there have been reports that the Ppc 
 * optimization line causes segmentation faults during build.  If that 
 * happens, try building without the DefaultGcc2PpcOpt line.  **************/

/* #define DefaultGcc2i386Opt  -O2 -fomit-frame-pointer -march=i686 */
/* #define DefaultGcc2AxpOpt   -O2 -mcpu=ev6 */
/* #define DefaultGcc2PpcOpt   -O2 -mcpu=750 */

/* The following definitions are normally set properly by XFree86's scripts.
 * You can uncomment them if you want to make sure. ************************/
 
/* #define HasMTRRSupport      YES  */ /* Enabled in kernel see kernel docs*/
/* #define HasMMXSupport        NO  */ /* Any i586 or above */
/* #define HasKatmaiSupport     NO  */ /* PIII SSE instructions */
/* #define Has3DNowSupport      NO  */ /* AMD instructions */


/* This setting reduces compile time a little by omitting rarely used input 
 * devices.  You can find the complete list in config/cf/xfree86.cf ********/
 
#define XInputDrivers                 mouse void

/* VIDEO DRIVERS ***********************************************************/

/* If you are sure you only want the drivers for one or a few video cards,
 * you can delete the drivers you do not want. *****************************/ 


#define XF86CardDrivers  mga glint nv tga s3 s3virge sis rendition \
                         neomagic i740 tdfx savage \
                         cirrus vmware tseng trident chips apm \
                         GlideDriver fbdev i128 nsc \
                         ati i810 AgpGartDrivers DevelDrivers ark \
                         cyrix siliconmotion \
                         vesa vga \
                         dummy XF86OSCardDrivers XF86ExtraCardDrivers


/* USER AND SYSTEM DEFAULT PATHS *******************************************/

/* These settings set the PATH variables used by xdm. See README for *******/
/* detailed description and modify the following as per your need. *********/

/* #define DefaultSystemPath /usr/bin:/bin:/usr/sbin:/sbin:/usr/X11R6/bin */
/* #define DefaultUserPath /usr/bin:/bin:/usr/X11R6/bin */

/* FONT SERVER AND LIBRARY SETTINGS ****************************************/

/* These settings are the defaults   ***************************************/

/* #define BuildFontServer          YES  */ /* For Ghostscript Print Server*/
/* #define SharedLibFont            YES  */
/* #define CompressAllFonts         YES  */
/* #define GzipFontCompression      YES  */

/* These settings ensure we use our libraries ******************************/
#define HasFreetype2             YES
#define HasFontconfig            YES
#define HasExpat                 YES
#define HasLibpng                YES
#define HasZlib                  YES

/* The font path can be redefined in the XF86Config file *******************/

/*
#define DefaultFontPath                $(FONTDIR)/misc/,$(FONTDIR)/75dpi/,\
$(FONTDIR)/100dpi/,$(FONTDIR)/Type1,$(FONTDIR)/local,\
$(FONTDIR)/TrueType,$(FONTDIR)/CID,$(FONTDIR)/Speedo
*/


/* INTERNATIONAL FONTS.  Change to YES if you need any of them.  These  are
 * the defaults. ***********************************************************/

/* #define BuildCyrillicFonts            NO  */
/* #define BuildArabicFonts              NO  */
/* #define BuildISO8859_6Fonts           NO  */
/* #define BuildGreekFonts               NO  */
/* #define BuildISO8859_7Fonts           NO  */
/* #define BuildHebrewFonts              NO  */
/* #define BuildISO8859_8Fonts           NO  */
/* #define BuildKOI8_RFonts              NO  */
/* #define BuildJapaneseFonts            NO  */
/* #define BuildJISX0201Fonts            NO  */
/* #define BuildKoreanFonts              NO  */
/* #define BuildChineseFonts             NO  */

/* DOCUMENTATION SETTINGS **************************************************/

/* These setting are the defaults. *****************************************/

/* #define BuildLinuxDocHtml             NO  */  /* X Docs in Html format */
/* #define BuildLinuxDocPS               NO  */  /* PostScript format */
/* #define BuildAllSpecsDocs             NO  */  /* Various docs */
/* #define BuildHtmlManPages             NO  */

/* GENERAL SETTINGS: You generally want to leave these alone when
 * building X on an LFS system *********************************************/

#define GccWarningOptions         -pipe /* Speed up compiles */
#define TermcapLibrary            -lncurses
#define XprtServer                YES /* Needed by realplayer */
#define XnestServer               YES
#define XAppLoadDir               EtcX11Directory/app-defaults
#define VarLibDir                 /var/lib
#define XFree86Devel               NO
#define FSUseSyslog               YES
#define ThreadedX                 YES
#define HasPam                     NO        
#define SystemManDirectory        /usr/share/man  /* Instead of /usr/man */
#define HasLibCrypt               YES
#define InstallXinitConfig        YES
#define InstallXdmConfig          YES
#define ForceNormalLib            YES
#define BuildSpecsDocs             NO

/* End XFree86 host.def file */
<command>EOF</command></userinput></screen>

<para>Editiez le fichier suivant votre matériel et vos désirs.</para>

</sect3>

<sect3>
<title>Commandes de construction</title>
<para>Installez <application>XFree86</application> en lançant les commandes suivantes:</para>

<screen><userinput><command>( make WORLDOPTS="" World 2&gt;&amp;1 | tee xfree-compile.log &amp;&amp; exit $PIPESTATUS ) &amp;&amp;
make install &amp;&amp;
make install.man &amp;&amp;
ln -sf ../X11R6/bin /usr/bin/X11 &amp;&amp;
ln -sf ../X11R6/lib/{X11,libGL.so{,.1}} /usr/lib &amp;&amp;
ln -sf ../X11R6/include/{X11,GL} /usr/include</command></userinput></screen>

</sect3>

<sect3>
<title>Mettre à jour le moteur de rendu <acronym>DRI</acronym> (Direct Rendering Infrastructure)</title>

<para>Si vous possédez une des cartes <acronym>DRI</acronym> supportées et que vous avez activé le
support de <acronym>DRI</acronym> dans les modules du noyau comme expliqué ci-dessus, vous avez
maintenant besoin de mettre à jour les modules du noyau pour vous assurer qu'ils
sont compatibles avec la version actuelle d'<application>XFree86</application>. Pour cela, réalisez ce qui
suit:</para>

<screen><userinput><command>cd programs/Xserver/hw/xfree86/os-support/linux/drm/kernel &amp;&amp; 
make  CC=/opt/gcc-2.95.3/bin/gcc -f Makefile.linux  &amp;&amp; 
mkdir -p /lib/modules/`uname -r`/kernel/drivers/char/drm/  &amp;&amp; 
cp gamma.o radeon.o sis.o r128.o i810.o i830.o mga.o tdfx.o \
    /lib/modules/`uname -r`/kernel/drivers/char/drm/  &amp;&amp; 
depmod -a</command></userinput></screen>

<warning><para>Si vous recompilez ou mettez à jour votre noyau, vous aurez
besoin de recopier les modules du pilotes dans la bibliothèque des modules du
noyau et de relancer <command>depmod -a</command>.</para></warning>

<note><para>Si vous avez ajouté le support de l'<acronym>AGP</acronym> en module
lors de la compilation du noyau, vous pouvez ajouter une ligne dans
<filename>/etc/modules.conf</filename> pour vous assurer que le module agpgart
est bien chargé. Par exemple, la version <acronym>AGP</acronym> de la carte
vidéo Radeon utilisera le pilote <filename>radeon.o</filename>. Il aura besoin
de cette ligne <screen>en dessous de radeon agpgart</screen> dans
<filename>/etc/modules.conf</filename> pour activer le support <acronym>DRI</acronym>.</para></note>

</sect3>

</sect2>

