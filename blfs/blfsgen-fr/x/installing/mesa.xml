<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY mesa-download-http "https://mesa.freedesktop.org/archive/mesa-&mesa-version;.tar.xz">
  <!ENTITY mesa-download-ftp  "ftp://ftp.freedesktop.org/pub/mesa/mesa-&mesa-version;.tar.xz">
  <!ENTITY mesa-md5sum        "5dd176e3f283143cc193b5a8264a206e">
  <!ENTITY mesa-size          "18&nbsp;Mo">
  <!ENTITY mesa-buildsize     "462&nbsp;Mo (avec la doc, plus 221&nbsp;Mo pour les tests)">
  <!ENTITY mesa-time          "2,6&nbsp;SBU (avec la doc, plus 0,6&nbsp;SBU pour les tests, tous deux avec
parallélisme = 4)">
]>

<sect1 id="mesa" xreflabel="Mesa-&mesa-version;">
  <?dbhtml filename="mesa.html"?>


  <title>Mesa-&mesa-version;</title>

  <indexterm zone="mesa">
    <primary sortas="a-Mesa">Mesa</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Mesa</title>

    <para>
      <application>Mesa</application> est une bibliothèque graphique 3D compatible
avec OpenGL.
    </para>

    <note>
      <para>
        <application>Mesa</application> est mis à jour régulièrement. Vous pourriez
vouloir utiliser la dernière version &mesa-major-minor;.x disponible.
      </para>
    </note>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&mesa-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&mesa-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &mesa-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &mesa-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &mesa-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &mesa-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
    
      <!-- 9 Apr 23.  Change to unversioned patch since it never changes. -->
<listitem>
        <para>
          Correctif recommandé&nbsp;: <ulink
url="&patch-root;/mesa-add_xdemos-2.patch"/> (installe 2 programmes de démo
pour tester Mesa - pas nécessaire si vous installez le paquet <ulink
url="https://archive.mesa3d.org/demos/">mesa-demos</ulink>)
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Mesa</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="xorg7-lib"/>, <xref linkend="libdrm"/> et <xref
linkend="Mako"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">

      <xref role="first" linkend="libva"/> (pour construire les pilotes VA-API
pour certains pilotes gallium, remarquez qu'il y a une dépendance
circulaire. Vous devez construire <application>libva</application> d'abord
sans la prise en charge d'EGL et GLX, installer ce paquet puis reconstruire
<application>libva</application>), <xref linkend="libvdpau"/> (pour
construire les pilotes VDPAU), <xref linkend="llvm"/> (requis pour les
pilotes Gallium3D, nouveau et radeonsi et pour swrast, le rasteriseur
logiciel souvent appelé llvmpipe. Voir <ulink role="nodep"
url="https://docs.mesa3d.org/systems.html"/> pour plus d'information) et
<xref linkend="wayland-protocols"/> (requis pour <xref role="nodep"
linkend='plasma5-build'/>, GNOME et recommandé pour <xref role="nodep"
linkend='gtk3'/>)
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <!-- for libsensors according to Meson -->
<xref linkend="libgcrypt"/>, <xref linkend="libunwind"/>, <xref
linkend="lm_sensors"/>, <xref linkend="nettle"/>, <xref
linkend="valgrind"/>, <ulink
url="https://archive.mesa3d.org/demos/">mesa-demos</ulink> (fournit plus de
300 démos supplémentaires pour tester <application>Mesa</application>&nbsp;;
ceci inclut les même programmes que ceux ajoutés par le correctif
ci-dessus), <ulink url="https://omxil.sourceforge.net/">Bellagio OpenMAX
Integration Layer</ulink> (pour les plateformes mobiles), <ulink
url="https://github.com/KhronosGroup/glslang">glslang</ulink> (pour les
pilotes vulkan), <ulink
url="https://github.com/tizonia/tizonia-openmax-il/wiki/Tizonia-OpenMAX-IL/">libtizonia</ulink>
et <ulink
url="https://github.com/KhronosGroup/Vulkan-Loader">Vulkan-Loader</ulink>
    </para>

  <!--
    <note>

      <para>
        The instructions below assume that
        <application>LLVM</application> with the r600/amdgpu and host backends
        and run-time type information (RTTI - needed for nouveau) are installed.
        You will need to modify the instructions if you
        choose not to install all of these. For an explanation of Gallium3D see
        <ulink url="https://en.wikipedia.org/wiki/Gallium3D"/>.
      </para>
    </note>
-->
</sect2>

  <sect2 role="kernel" id="mesa-kernel"
         xreflabel='Configuration du noyau pour Mesa'>
    <title>Configuration du noyau</title>

    <para>
      Activez les options suivantes dans la configuration du noyau et recompilez
le noyau si nécessaire&nbsp;:
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="mesa-kernel.xml"/>

    <note>
      <para>
        Le nom du pilote Mesa Gallium3D correspondant est fournit en commentaire
dans les entrées de configuration. Si vous ne connaissez pas le nom du
pilote Mesa Gallium3D pour votre GPU, consultez <xref
linkend="mesa-gallium-drivers"/> plus bas.
      </para>

      <para>
        <option>CONFIG_DRM_RADEON</option>, <option>CONFIG_DRM_AMDGPU</option>,
<option>CONFIG_DRM_NOUVEAU</option> et <option>CONFIG_DRM_I915</option>
peuvent nécessiter un micrologiciel. Consultez <xref
linkend='postlfs-firmware'/> pour plus de détails.
      </para>

      <para>
        Il n'est pas recommandé de choisir <option>CONFIG_DRM_RADEON</option> ou
<option>CONFIG_DRM_AMDGPU</option> avec
<quote><literal>y</literal></quote>. Si c'est le cas, les micrologiciels
requis doivent être intégrés à l'image du noyau ou à l'initramfs pour que le
pilote fonctionne correctement.
      </para>

      <para>
        Les sous-entrées dans <option>CONFIG_DRM_AMDGPU</option> sont utilisées pour
s'assurer que le pilote noyau AMDGPU prenne en charge tous les GPU qui
utilisent le pilote <literal>radeonsi</literal>. Elles ne sont pas requises
si vous n'avez pas besoin de <option>CONFIG_DRM_AMDGPU</option>. Elles
peuvent ne pas être requises pour certains modèles de GPU.
      </para>

      <para>
        Pour <literal>swrast</literal>, <option>CONFIG_DRM_VGEM</option> n'est pas
strictement nécessaire mais recommandé comme optimisation.
      </para>
    </note>
    <indexterm zone="mesa mesa-kernel">
      <primary sortas="d-mesa">mesa</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Mesa</title>

    <para>
      Si vous avez téléchargé le correctif xdemos (nécessaire pour tester
l'installation de Xorg par les instructions de BLFS), appliquez-le en
exécutant la commande suivante&nbsp;:
    </para>


<!-- Note that freedreno, vc4, and virgl all need special support from
        libdrm - renodr
        For me, libdrm does not mention virgl, but mesa accepts it. AFAICS
        freedreno is for qualcom hardware, libdrm will build for it on suitable
        systems. VC4 is for the Broadcom VC4 used in the raspberry pi - ken -->
<!--
    <note>

      <para>
        The measurements above, and the Contents below, are for a full build.
        Many people will not wish to install drivers they cannot use, so the
        following paragraphs explain how to limit the drivers, and give an
        example which can be be reduced or amended as necessary.
      </para>
    </note>

-->
<!--
    <para>

      The (non-gallium) DRI drivers available in X86 are auto, <emphasis>or
      alternatively a choice from</emphasis> i915, i965, nouveau, r100, r200,
      and swrast. Use 'auto' to build all available DRI drivers, or use an
      empty string (DRI_DRIVERS="") if you wish to only build gallium drivers.
    </para>

    <para>
      The platforms ("window systems") available for X86 linux are x11, wayland,
     drm, and surfaceless. By not specifying anything, the meson
      build-system will build for all these platforms if you have the
      dependencies, identical to if you had specified '-Dplatforms=auto'.
    </para>

    <para>
      Modify the commands below for your desired drivers.  The drivers listed
      below will cover most modern video cards and virtual machines.  For help in
      selecting drivers see <ulink url="https://docs.mesa3d.org/systems.html"/>.
-->
<!-- these two don't seem to be mentioned in that mesa link -->
<!--
      For intel drivers, specify crocus for i965 gen 4 through to haswell, iris
      for broadwell and later.
    </para>


    <note>
      <para>
        Although the nouveau drivers can be built for both gallium and dri, the
        i915 driver can only be built for one or the other.
      </para>
    </note>

<screen><userinput>GALLIUM_DRV="crocus,i915,iris,nouveau,r600,radeonsi,svga,swrast,virgl"
DRI_DRIVERS="i965,nouveau"</userinput></screen>
-->
<screen><!--<screen>
<userinput>patch -Np1 -i ../mesa-&mesa-version;-add_xdemos-1.patch</userinput></screen>-->
<userinput>patch -Np1 -i ../mesa-add_xdemos-2.patch</userinput></screen>

   


      


    <para>
      Installez <application>Mesa</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup                   \
      --prefix=$XORG_PREFIX   \
      --buildtype=release     \
      -Dplatforms=x11,wayland \
      -Dgallium-drivers=auto  \
      -Dvulkan-drivers=""     \
      -Dvalgrind=disabled     \
      -Dlibunwind=disabled    \
      ..                      &amp;&amp;

ninja</userinput></screen>

    <para>
      Pour tester les résultats lancez&nbsp;: <command>meson configure
-Dbuild-tests=true &amp;&amp; ninja test</command>. Trois tests liés à
mesa:intel sont connus pour échouer.
    </para>


    <!-- All 88 tests passed for me for 22.3.3 [pierre]
     All 90 tests passed for me for 23.1.0 [bdubbs]
-->
<para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ninja install</userinput></screen>

    <para>
      Si vous le désirez, installez la documentation facultative en exécutant les
commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"
        remap="doc"><userinput>install -v -dm755 /usr/share/doc/mesa-&mesa-version; &amp;&amp;
cp -rfv ../docs/* /usr/share/doc/mesa-&mesa-version;</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--buildtype=release</parameter>&nbsp;: ce paramètre s'assure que
la construction est complètement optimisée et désactive les assertions de
débogage qui ralentiraient sévèrement les bibliothèques pour certains
usages. Sans ce paramètre, la construction peut prendre dans les 2 Go.
    </para>

    <para>
      <anchor id='mesa-gallium-drivers' xreflabel='Mesa Gallium3D Drivers'/>
<parameter>-Dgallium-drivers=auto</parameter>&nbsp;: ce paramètre contrôle
les pilotes Gallium3D à construire. <literal>auto</literal> choisit tous les
pilotes Gallium3D disponibles pour x86&nbsp;: <literal>r300</literal> (pour
les séries ATI Radeon 9000 ou Radeon X), <literal>r600</literal> (pour les
séries AMD/ATI Radeon HD 2000-6000), <literal>radeonsi</literal> (pour les
modèles de GPU AMD Radeon HD 7000 et plus récents),
<literal>nouveau</literal> (pour les GPU NVIDIA pris en charge, ils sont
listés avec toutes les <quote>fonctionnalités 3D</quote> en
<quote>DONE</quote> ou <quote>N/A</quote> sur <ulink
url='https://nouveau.freedesktop.org/FeatureMatrix.html'>la page de statut
de Nouveau</ulink>), <literal>virgl</literal> (pour le GPU virtuel de QEMU
avec la prise en charge de <application>virglrender</application>&nbsp;;
remarquez que le <xref linkend='qemu'/> de BLFS n'est pas construit avec
<application>virglrender</application>), <literal>svga</literal> (pour le
GPU virtuel de VMWare), <literal>swrast</literal> (pour utiliser le CPU pour
la rastérisation 3D&nbsp;; remarquez que c'est bien plus lent que les GPU 3D
modernes, donc cette option ne devrait être utilisée que si le GPU n'est pas
pris en charge par un autre pilote), <literal>iris</literal> (pour les GPU
Intel intégrés à Broadwell et aux CPU plus récents),
<literal>crocus</literal> (pour les séries Intel GMA 3000, X3000, 4000 ou
X4000 des GPU intégrés avec un chipset, ou les GPU Intel HD fournis avec les
CPU avant Broadwell), <literal>i915</literal> (pour les GPU Intel GMA 900,
950, 3100 ou 3150 fournis avec les chipsets ou les CPU Atom D/N
4xx/5xx). Vous pouvez remplacer <literal>auto</literal> par une liste
d'éléments séparés par des virgules pour ne construire qu'un sous-ensemble
de ces pilotes si vous savez précisément de quelles pilotes vous aurez
besoin, par exemple <option>-Dgallium-drivers=radeonsi,iris,swrast</option>.
    </para>


    <!--
    <para>

      <parameter>-Dosmesa=true</parameter>: This switch enables building
      the <filename class="libraryfile">libOSMesa</filename> library and
      provides Gallium3D support in it. It requires the swrast gallium driver.
    </para>
-->
<para>
      <parameter>-Dplatforms="..."</parameter>&nbsp;: ce paramètre contrôle les
systèmes de fenêtrage pris en charge. Les plate-formes linux disponibles
sont x11 et wayland.
    </para>

    <para>
      <parameter>-Dvulkan-drivers=""</parameter>&nbsp;: ce paramètre vous permet
de choisir les pilotes Vulkan à construire. La valeur par défaut est auto,
mais cela nécessite les dépendances facultatives
<filename>glslang</filename> et
<application>Vulkan-Loader</application>. Vulkan est la nouvelle API conçue
pour utiliser les GPU avec une meilleure performance qu'OpenGL, mais rien
dans BLFS n'en bénéficie actuellement. Nous passons donc une liste vide pour
supprimer ces dépendances.
    </para>

    <para>
      <parameter>-Dvalgrind=disabled</parameter>&nbsp;: Ce paramètre désactive
l'utilisation de Valgrind pendant le processus de construction. Supprimez ce
paramètre si vous avez installé Valgrind et souhaitez vérifier les fuites
mémoire.
    </para>

    <para>
      <parameter>-Dlibunwind=disabled</parameter>&nbsp;: ce paramètre désactive
l'utilisation de libunwind.
    </para>

    <para>
      <command>meson configure -Dbuild-tests=true</command>&nbsp;: cette commande
reconfigurera la construction pour utiliser
<option>-Dbuild-tests=true</option>, sans changer les autres options
spécifiées dans la commande <command>meson setup</command>. Cela permet à
<command>ninja test</command> de construire et lancer les tests unitaires.
    </para>

    <para>
      <option>-Degl-native-platform="..."</option>&nbsp;: ce paramètre contrôle la
prise en charge <foreignphrase>Embedded Graphics Library</foreignphrase> qui
sera construite. Les options disponibles pour linux sont auto (par défaut),
x11, wayland, surfaceless et drm.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <!-- in /usr/lib -->
<segtitle>Pilotes installés</segtitle>
      <!-- in /usr/lib/<subdir>
 -->
<segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          glxgears et glxinfo
        </seg>
        <seg>
          libEGL.so, libGL.so, libGLESv1_CM.so, libGLESv2.so, libgbm.so, libglapi.so
et libxatracker.so
        </seg>
        <seg>
          
          
          <!-- d3dadapter9.so (optional)
               I guess this is useless today, Wine applications use Vulkan
               through libvkd3d, and new games with native Linux support
               likely uses Vulkan directly.  -->
<!-- Begin gallium DRI drivers (*_dri.so) and VA-API drivers
               (*_drv_video.so): this is the full set -->
<!-- End DRI Drivers -->
<!-- Begin VDPAU drivers -->
<!-- End VDPAU drivers -->
crocus_dri.so, i915_dri.so, iris_dri.so, kms_swrast_dri.so, nouveau_dri.so,
nouveau_drv_video.so, r300_dri.so, r600_dri.so, r600_drv_video.so,
radeonsi_dri.so, radeonsi_drv_video.so, swrast_dri.so, virtio_gpu_dri.so,
virtio_gpu_drv_video.so, vmwgfx_dri.so, libvdpau_nouveau.so,
libvdpau_r300.so libvdpau_r600.so et libvdpau_radeonsi.so
libvdpau_virtio_gpu.so (nombre de ces pilotes sont liés en dur).
        </seg>
        <seg>
          
          <!-- $XORG_PREFIX/include/GL is installed by xorg-protos -->
$XORG_PREFIX/{include/{EGL,GLES,GLES2,GLES3,KHR},
$XORG_PREFIX/lib/{dri,vdpau}}, $XORG_PREFIX/share/drirc.d (contient des
contournements pour diverses applications, en particulier les navigateurs et
les jeux) et /usr/share/doc/mesa-&mesa-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="glxgears">
        <term><command>glxgears</command></term>
        <listitem>
          <para>
            est une démo GL utile pour dépanner des problèmes graphiques
          </para>
          <indexterm zone="mesa glxgears">
            <primary sortas="b-glxgears">glxgears</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="glxinfo">
        <term><command>glxinfo</command></term>
        <listitem>
          <para>
            est un programme de diagnostic affichant des informations sur le matériel
graphique et les bibliothèques GL installées
          </para>
          <indexterm zone="mesa glxinfo">
            <primary sortas="b-glxinfo">glxinfo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libEGL">
        <term><filename class="libraryfile">libEGL.so</filename></term>
        <listitem>
          <para>
            fournit nativement une interface de plate-forme graphique qui est définie
avec les spécifications EGL-1.4
          </para>
          <indexterm zone="mesa libEGL">
            <primary sortas="c-libGL">libEGL.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libgbm">
        <term><filename class="libraryfile">libgbm.so</filename></term>
        <listitem>
          <para>
            est la bibliothèque de gestion du tampon graphique de
<application>Mesa</application>
          </para>
          <indexterm zone="mesa libgbm">
            <primary sortas="c-libgbm">libgbm.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libGLESv1_CM">
        <term><filename class="libraryfile">libGLESv1_CM.so</filename></term>
        <listitem>
          <para>
            est la bibliothèque OpenGL ES 1.1 de <application>Mesa</application>
          </para>
          <indexterm zone="mesa libGLESv1_CM">
            <primary sortas="c-libGLESv1_CM">libGLESv1_CM.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libGLES2">
        <term><filename class="libraryfile">libGLES2.so</filename></term>
        <listitem>
          <para>
            est la bibliothèque OpenGL ES 2.0 de <application>Mesa</application>
          </para>
          <indexterm zone="mesa libGLES2">
            <primary sortas="c-libGLES2">libGLES2.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libGL">
        <term><filename class="libraryfile">libGL.so</filename></term>
        <listitem>
          <para>
            est la bibliothèque OpenGL principale de <application>Mesa</application>
          </para>
          <indexterm zone="mesa libGL">
            <primary sortas="c-libGL">libGL.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
