<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY xorg-server-download-http "&xorg-download-http;/xserver/xorg-server-&xorg-server-version;.tar.xz">
  <!ENTITY xorg-server-download-ftp  "&xorg-download-ftp;/xserver/xorg-server-&xorg-server-version;.tar.xz">
  <!ENTITY xorg-server-md5sum        "79a6eb04b1b17ad6c7aab46da73944e8">
  <!ENTITY xorg-server-size          "4,8&nbsp;Mo">
  <!ENTITY xorg-server-buildsize     "188&nbsp;Mo (avec les tests)">
  <!ENTITY xorg-server-time          "0,6&nbsp;SBU (avec parallélisme = 4&nbsp;; avec les tests)">
  <!ENTITY modesetting_drv
           "<filename class='libraryfile'>modesetting_drv</filename>">
  <!ENTITY BLFS113 "https://www.linuxfromscratch.org/blfs/view/11.3/x/x7driver.html">
  <!ENTITY BLFS76 "https://www.linuxfromscratch.org/blfs/view/7.6/x/x7driver.html">
]>

<sect1 id="xorg-server" xreflabel="Xorg-Server-&xorg-server-version;">
  <?dbhtml filename="xorg-server.html"?>


  <title>Xorg-Server-&xorg-server-version;</title>

  <indexterm zone="xorg-server">
    <primary sortas="a-xorg-server">xorg-server</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Xorg Server</title>

    <para>
      Le serveur <application>Xorg</application> est le cœur du système X Window.
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&xorg-server-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&xorg-server-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &xorg-server-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &xorg-server-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &xorg-server-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &xorg-server-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Avec la suppression des pilotes xf86-video-*, l'option TearFree ne
fonctionne plus. Pour contourner cela, les développeurs en amont ont ajouté
l'option TearFree au pilote de gestion des modes par défaut. Ce correctif
récupère cette fonctionnalité. Appliquez ce correctif si vous allez utiliser
Xorg dans un environnement sans compositeur (comme TWM, IceWM, Openbox,
Fluxbox ou Sawfish).
        </para>
        <para>
          Correctif facultatif&nbsp;: <ulink
url="&patch-root;/xorg-server-&xorg-server-version;-tearfree_backport-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Xorg Server</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="libxcvt"/>, <xref linkend="pixman"/>, <xref
linkend="xorg7-font"/> (seulement font-util) et à l'exécution&nbsp;: <xref
role="runtime" linkend="xkeyboard-config"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <phrase revision="sysv"><xref role="runtime" linkend="elogind"/> (à
l'exécution),</phrase> <xref linkend="libepoxy"/> (requis pour glamor),
<xref linkend="libtirpc"/><phrase revision="systemd">, <xref role="runtime"
linkend="systemd"/> (à l'exécution)</phrase> et <xref role='runtime'
linkend='xorg-libinput-driver'/> (à l'exécution)
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref role="runtime" linkend="acpid"/> (exécution), <xref
linkend="doxygen"/> (pour construire la documentation de l'API), <xref
linkend="fop"/> (pour construire la documentation), <xref
linkend="libunwind"/>, <xref linkend="nettle"/>, <xref
linkend="libgcrypt"/>, <xref linkend="xcb-util-keysyms"/>, <xref
linkend="xcb-util-image"/>, <xref linkend="xcb-util-renderutil"/>, <xref
linkend="xcb-util-wm"/> (tous les quatre pour construire Xephyr), <xref
linkend="xmlto"/> (pour construire la documentation), <xref
linkend="xkeyboard-config"/> (pour les tests), <ulink
url="https://gitlab.freedesktop.org/xorg/test/rendercheck">rendercheck</ulink>
(pour les tests) et <ulink
url="https://www.x.org/archive/individual/doc/">xorg-sgml-doctools</ulink>
(pour construire la documentation)
    </para>
  </sect2>

  <sect2 role="kernel" id="xorg-server-kernel">
    <title>Configuration du noyau</title>

    <para>
      Les pilotes X dépendant des périphériques traditionnels ont été supprimés de
BLFS en faveur du pilote &modesetting_drv; qui sera construit dans ce
paquet. Pour utiliser le pilote &modesetting_drv;, le noyau doit fournir un
pilote DRM (gestionnaire de rendu direct) pour votre GPU.
    </para>

    <para>
      Si votre GPU prend en charge l'accélération 3D et que <xref linkend='mesa'/>
fournit un pilote Gallium3D pour utiliser ses capacités 3D, vous deviez déjà
avoir activé les options de configuration du noyau nécessaires dans <xref
linkend='mesa-kernel'/>. Sinon, vous devrez trouver l'option de
configuration du noyau du pilote DRM pour votre GPU et l'activer. En
particulier, les GPU virtuels fournis par certains gestionnaires de machines
virtuelles&nbsp;:
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="xorg-server-kernel.xml"/>

    <para>
      Si le noyau ne fournit pas de pilote DRM pour votre GPU, sur la plupart des
systèmes x86, le pilote DRM <quote>simple frame buffer</quote> qui utilise
le frame buffer VESA ou UEFI peut être utilisé comme solution de
repli. Activez les options suivantes dans la configuration du noyau si vous
n'avez pas de pilote DRM dédié pour votre GPU ou si vous voulez le pilote
simple frame buffer comme solution de repli en cas d'échec du pilote
dédié&nbsp;:
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="xorg-server-simpledrm-kernel.xml"/>

    <para>
      Pour permettre au noyau d'afficher les messages de débogage très tôt au
démarrage, <option>CONFIG_DRM</option> et
<option>CONFIG_DRM_SIMPLEDRM</option> ne doivent pas être construits comme
des modules du noyau à moins d'utiliser un initramfs.
    </para>

    <para>
      Si vous voulez utiliser le pilote de simple frame buffer sur un système
démarré via le BIOS (et pas un UEFI), ajoutez la ligne suivante avant le
premier bloc <literal>menuentry</literal> dans le fichier
<filename>/boot/grub/grub.cfg</filename> pour initialiser le frame buffer
VESA&nbsp;:
    </para>

<screen><literal>set gfxpayload=<replaceable>1024x768x32</replaceable></literal></screen>

    <para>
      Vous pouvez remplacer <literal>1024</literal>, <literal>768</literal> et
<literal>32</literal> par une résolution et une profondeur de couleur qui
correspondent à votre écran.
    </para>

    <para>
      Si aucun de ces pilotes DRM ne correspond à votre situation et que vous
devez utiliser un pilote DDX avec un noyau sans pilote GPU DRM
(habituellement nommé <option>CONFIG_FB_*</option> dans la configuration du
noyau ou existant en tant que modules en dehors des sources du noyau) ou que
vous avez besoin d'une fonctionnalité spécifique à un périphérique qui
nécessite un pilote DDX, consuiltez <ulink url="&BLFS113;">une version
précédente de BLFS</ulink> ou <ulink url="&BLFS76;">un version encore plus
ancienne</ulink> pour en savoir plus sur les pilotes DDX.
    </para>

    <indexterm zone="xorg-server xorg-server-kernel">
      <primary sortas="d-xorg-server">xorg-server</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Xorg Server</title>

    <para>
      Tout d'abord, si vous avez besoin des options TearFree pour contourner un
problème de screen tearing, appliquez les correctifs portés&nbsp;:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../xorg-server-&xorg-server-version;-tearfree_backport-1.patch</userinput></screen>

    <para>
      Installez the server en exécutant les commandes suivantes&nbsp;:
    </para>

<screen><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup ..              \
      --prefix=$XORG_PREFIX \
      --localstatedir=/var  \
      -Dglamor=true         \
      -Dxkb_output_dir=/var/lib/xkb &amp;&amp;
ninja</userinput></screen>

    <para>
      Pour tester les résultats, lancez&nbsp;: <command>ninja test</command> Vous
devrez lancer <command>ldconfig</command> en tant qu'utilisateur <systemitem
class="username">root</systemitem> avant ou certains tests pourraient
échouer.
    </para>

    <para>
      Maintenant en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root" revision="sysv"><userinput>ninja install &amp;&amp;
mkdir -pv /etc/X11/xorg.conf.d &amp;&amp;
install -v -d -m1777 /tmp/.{ICE,X11}-unix &amp;&amp;
cat &gt;&gt; /etc/sysconfig/createfiles &lt;&lt; "EOF"
<literal>/tmp/.ICE-unix dir 1777 root root
/tmp/.X11-unix dir 1777 root root</literal>
EOF</userinput></screen>

<screen role="root" revision="systemd"><userinput>ninja install &amp;&amp;
mkdir -pv /etc/X11/xorg.conf.d</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>-Dglamor=true</parameter>&nbsp;: s'assure de construire le module
Glamor. Il est requis pour construire le pilote &modesetting_drv; qui
remplace les pilote DDX (pilote X dépendant du périphérique).
    </para>

    <para>
      <option>-Dsuid_wrapper=true</option>&nbsp;: construit l'enveloppe suid-root
pour la prise en charge des anciens pilotes DDX sur les systèmes xserver
sans utilisateur root.
    </para>

    <para>
      <option>-Dsystemd_logind=false</option>&nbsp;: ce paramètre désactive
l'intégration à <phrase revision="systemd">systemd-logind</phrase><phrase
revision="sysv">elogind</phrase>, permettant au serveur Xorg de fonctionner
sans avoir à configurer le module PAM <phrase
revision="systemd">systemd</phrase><phrase
revision="elogind">elogind</phrase> et à le configurer.
    </para>

    <para revision="sysv">
      <command>cat &gt;&gt; /etc/sysconfig/createfiles...</command>&nbsp;: Cette
commande crée les répertoires <filename
class="directory">/tmp/.ICE-unix</filename> et <filename
class="directory">/tmp/.X11-unix</filename> au démarrage et garantit que les
droits et l'appartenance soient conformes aux exigences du serveur
    </para>

    <para>
      <option>-Dxephyr=true</option>&nbsp;: cette option permet de construire
Xephyr si ses dépendances sont présentes.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          gtf, X, Xnest, Xorg, Xvfb et éventuellement Xephyr
        </seg>
        <seg>
          plusieurs dans $XORG_PREFIX/lib/xorg/modules dont le pilote
&modesetting_drv;
        </seg>
        <seg>
          /etc/X11/xorg.conf.d, $XORG_PREFIX/include/xorg, $XORG_PREFIX/lib/xorg et
$XORG_PREFIX/share/X11/xorg.conf.d
        </seg>

      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="gtf-x7">
        <term><command>gtf</command></term>
        <listitem>
          <para>
            calcule les lignes du mode VESA GTF
          </para>
          <indexterm zone="xorg-server gtf-x7">
            <primary sortas="b-gtf">gtf</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="X-x7">
        <term><command>X</command></term>
        <listitem>
          <para>
            est un lien symbolique vers Xorg
          </para>
          <indexterm zone="xorg-server X-x7">
            <primary sortas="b-X">X</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="Xephyr-x7">
        <term><command>Xephyr</command></term>
        <listitem>
          <para>
            est un sous-serveur X avec un support des extensions X modernes
          </para>
          <indexterm zone="xorg-server Xephyr-x7">
            <primary sortas="b-Xephyr">Xephyr</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="Xnest-x7">
        <term><command>Xnest</command></term>
        <listitem>
          <para>
            est un sous-serveur X
          </para>
          <indexterm zone="xorg-server Xnest-x7">
            <primary sortas="b-Xnest">Xnest</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="Xorg-x7">
        <term><command>Xorg</command></term>
        <listitem>
          <para>
            est le serveur X X11R7
          </para>
          <indexterm zone="xorg-server Xorg-x7">
            <primary sortas="b-Xorg">Xorg</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="Xvfb-x7">
        <term><command>Xvfb</command></term>
        <listitem>
          <para>
            est le framebuffer virtuel du serveur X pour X Version 11
          </para>
          <indexterm zone="xorg-server Xvfb-x7">
            <primary sortas="b-Xvfb">Xvfb</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="modesetting_drv-x7">
        <term><filename class="libraryfile">modesetting_drv.so</filename></term>
        <listitem>
          <para>
            fournit un pilote vidéo pour les machines utilisant le "Kernel Mode Setting"
(KMS). Cela utilisera glamor s'il a été activé et que le matériel permet
l'accélération
          </para>
          <indexterm zone="xorg-server modesetting_drv-x7">
            <primary sortas="c-modesetting_drv">modesetting_drv.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
