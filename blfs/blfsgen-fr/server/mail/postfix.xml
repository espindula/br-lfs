<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY postfix-download-http "">
  <!ENTITY postfix-download-ftp  "ftp://ftp.porcupine.org/mirrors/postfix-release/official/postfix-&postfix-version;.tar.gz">
  <!ENTITY postfix-md5sum        "85d1c2b06a469ba6cc61946c7042e40e">
  <!ENTITY postfix-size          "4.5&nbsp;Mo">
  <!ENTITY postfix-buildsize     "203&nbsp;Mo">
  <!ENTITY postfix-time          "0,2 SBU (avec parallélisme = 4)">
]>

<sect1 id="postfix" xreflabel="Postfix-&postfix-version;">
  <?dbhtml filename="postfix.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Postfix-&postfix-version;</title>

  <indexterm zone="postfix">
    <primary sortas="a-Postfix">Postfix</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Postfix</title>

    <para>
      Le paquet <application>Postfix</application> contient un agent de transport
de courriers électroniques (MTA). C'est utile pour envoyer des courriers
électroniques à d'autres utilisateurs de votre machine hôte. On peut aussi
le configurer pour être un serveur central de messagerie électronique pour
votre domaine ou un agent de relai de courriers électroniques avec votre
fournisseur d'accès à Internet (FAI).
    </para>

    &lfs101_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&postfix-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&postfix-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &postfix-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &postfix-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &postfix-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &postfix-time;
        </para>
      </listitem>
    </itemizedlist>

    <!--
    <bridgehead renderas="sect3">
Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/postfix-&postfix-version;-glibc230_fix-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
-->
<bridgehead renderas="sect3">Dépendances de Postfix</bridgehead>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="db"/>, <xref linkend="cyrus-sasl"/> et <xref
linkend="libnsl"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="icu"/> pour le support d'internationalisation des adresses de
courriel (SMTPUTF8), <xref linkend="mariadb"/> ou <ulink
url="http://www.mysql.com/">MySQL</ulink>, <xref linkend="openldap"/>, <xref
linkend="pcre"/>, <xref linkend="postgresql"/>, <xref linkend="sqlite"/> et
<ulink url="http://cr.yp.to/cdb.html">CDB</ulink> ou <ulink
url="http://www.corpit.ru/mjt/tinycdb.html">TinyCDB</ulink>
    </para>

    <para>
      Remarquez que <application>SQLite</application>,
<application>MySQL</application>, <application>PostgreSQL</application> et
<application>CDB</application> ne sont utiles que s'il y a un besoin connu.
    </para>

    <para condition="html" role="usernotes">
      Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/postfix"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Postfix</title>

    <sect3>
      <title>Ajout des utilisateurs et des groupes</title>

      <para>
        Avant de compiler le programme, vous devez créer des utilisateurs et des
groupes qui doivent être opérationnels pendant l'installation. Ajoutez les
utilisateurs et les groupes avec les commandes suivantes lancées depuis
l'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>groupadd -g 32 postfix &amp;&amp;
groupadd -g 33 postdrop &amp;&amp;
useradd -c "Postfix Daemon User" -d /var/spool/postfix -g postfix \
        -s /bin/false -u 32 postfix &amp;&amp;
chown -v postfix:postfix /var/mail</userinput></screen>
    </sect3>

    <sect3>
      <title>Configuration de la construction</title>

      <para>
        Les fichiers README sont formatés pour être lus avec un pageur comme
<application>Less</application> ou <application>More</application>. Si vous
voulez les lire dans un éditeur de texte, rendez-les lisibles avec le sed
suivant&nbsp;:
      </para>

<!--
      <para>

        Apply a patch to allow <application>Postfix</application> to compile
        on <application>Glibc-2.30</application> where some macros were
        dropped:
      </para>

<screen><userinput>patch -Np1 -i ../postfix-&postfix-version;-glibc230_fix-1.patch</userinput></screen>
-->
<screen><userinput>sed -i 's/.\x08//g' README_FILES/*</userinput></screen>

      <para>
        L'arborescence des sources de <application>Postfix</application> ne contient
pas de script <filename>configure</filename>, mais le makefile du répertoire
tout en haut de la hiérarchie contient une cible <option>makefiles</option>
qui régénère tous les autres makefiles de l'arborescence de construction. Si
vous souhaitez utiliser des logiciels supplémentaires tels qu'une base de
données back-end pour des utilisateurs virtuels ou une authentification
TLS/SSL, vous devrez régénérer les makefiles en utilisant un ou plusieurs
paramètres <envar>CCARGS</envar> et <envar>AUXLIBS</envar> adéquats listés
ci-dessous.
      </para>

      <para>
        Pour plus de détails lisez les fichiers readme.
      </para>

      <!-- We reverted to Berkeley DB-5.3.28 and that is handled
       <para>

         The current version of	<xref linkend="db"/> is not recognised by a
         hard-coded test for known versions. To build with this version use the
         following sed:
      </para>

<screen><userinput>sed -i 's/DB_VERSION_MAJOR == 6 .*||/DB_VERSION_MAJOR &gt; 4 ||/' \
  src/util/dict_db.c</userinput></screen>
-->
<sect4>
        <title>Cyrus-SASL</title>

        <para>
          Pour utiliser <application>Cyrus-SASL</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DUSE_SASL_AUTH -DUSE_CYRUS_SASL -I/usr/include/sasl'
AUXLIBS='-lsasl2'</literal></screen>

      </sect4>

      <sect4>
        <title>OpenLDAP</title>

        <para>
          Pour utiliser <application>OpenLDAP</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DHAS_LDAP'
AUXLIBS='-lldap -llber'</literal></screen>

      </sect4>

      <sect4>
        <title>Sqlite</title>

        <para>
          Pour utiliser <application>Sqlite</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DHAS_SQLITE'
AUXLIBS='-lsqlite3 -lpthread'</literal></screen>

      </sect4>

      <sect4>
        <title>MySQL</title>

        <para>
          Pour utiliser <application>MySQL</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DHAS_MYSQL -I/usr/include/mysql'
AUXLIBS='-lmysqlclient -lz -lm'</literal></screen>

      </sect4>

      <sect4>
        <title>PostgreSQL</title>

        <para>
          Pour utiliser <application>PostgreSQL</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DHAS_PGSQL -I/usr/include/postgresql'
AUXLIBS='-lpq -lz -lm'</literal></screen>

      </sect4>

      <sect4>
        <title>CDB/TinyCDB</title>

        <para>
          Pour utiliser <application>CDB</application> ou
<application>TinyCDB</application> avec <application>Postfix</application>,
utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DHAS_CDB'
AUXLIBS='<replaceable>&lt;/path/to/CDB&gt;</replaceable>/libcdb.a'</literal></screen>

      </sect4>

      <sect4>
        <title>Authentification StartTLS</title>

        <para>
          Pour utiliser <application>OpenSSL</application> avec
<application>Postfix</application>, utilisez les arguments suivants&nbsp;:
        </para>

<screen><literal>CCARGS='-DUSE_TLS -I/usr/include/openssl/'
AUXLIBS='-lssl -lcrypto'</literal></screen>
      </sect4>

    </sect3>

    <sect3>
      <title>Installation de Postfix</title>

      <para>
        Si vous avez installé <application>Cyrus SASL</application> et
<application>OpenSSL</application>, installez
<application>Postfix</application> en lançant les commandes suivantes&nbsp;:
      </para>

<!-- There is a testsuite, but it fails a lot. It seems to need
         the host to be specifically setup for the tests.
         Run with `make tests' and `make root_tests' -->
<screen><userinput>make CCARGS="-DUSE_TLS -I/usr/include/openssl/                     \
             -DUSE_SASL_AUTH -DUSE_CYRUS_SASL -I/usr/include/sasl" \
     AUXLIBS="-lssl -lcrypto -lsasl2"                              \
     makefiles &amp;&amp;
make</userinput></screen>

    
    <para>
      Ce paquet ne contient pas de suite de tests exploitable.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>



<screen role="root"><!-- dev note: sh postfix-install -non-interactive install_root=<DESTDIR>
 ... -->
<userinput>sh postfix-install -non-interactive \
   daemon_directory=/usr/lib/postfix \
   manpage_directory=/usr/share/man \
   html_directory=/usr/share/doc/postfix-&postfix-version;/html \
   readme_directory=/usr/share/doc/postfix-&postfix-version;/readme</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>make makefiles</command>&nbsp;: Cette commande reconstruit les
makefiles de l'arborescence des sources pour utiliser les options contenues
dans les variables <envar>CCARGS</envar> and <envar>AUXLIBS</envar>.
    </para>

    <para>
      <command>sh postfix-install -non-interactive</command>&nbsp;: Ceci empêche
le script d'installation de poser des questions, acceptant les répertoires
de destination par défaut dans quelques cas. Si les options
<option>html_directory</option> et <option>readme_directory</option> ne sont
pas définies, la documentation ne sera pas installée.
    </para>

    <para>
      <option>CCARGS="-DNO_EAI ..."</option>&nbsp;: cela désactivera le support
SMTPUTF8 , par exemple si le reste de votre infrastructure d'adresse de
courriel ne gère pas les adresses de courriel en UTF8 et les valeurs
d'en-tête de message
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Postfix</title>

    <sect3 id="postfix-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/aliases</filename>, <filename>/etc/postfix/main.cf</filename>
et <filename>/etc/postfix/master.cf</filename>
      </para>

      <indexterm zone="postfix postfix-config">
        <primary sortas="e-etc-aliases">/etc/aliases</primary>
      </indexterm>

      <indexterm zone="postfix postfix-config">
        <primary sortas="e-etc-postfix-star">/etc/postfix/*</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        Create (or append to an existing) <filename>/etc/aliases</filename> with the
following command. Change <replaceable>&lt;LOGIN&gt;</replaceable> to your
non-root login identity so mail addressed to <systemitem
class="username">root</systemitem> can be forwarded to you.  As the
<systemitem class="username">root</systemitem> user:
      </para>

<screen role="root"><userinput>cat &gt;&gt; /etc/aliases &lt;&lt; "EOF"
<literal># Begin /etc/aliases

MAILER-DAEMON:    postmaster
postmaster:       root

root:             <replaceable>&lt;LOGIN&gt;</replaceable>
# End /etc/aliases</literal>
EOF</userinput></screen>

      <para>
        Pour protéger un fichier <filename>/etc/aliases</filename> existant, la
commande ci-dessus y ajoute ces alias. Vous devriez vérifier ce fichier et
recopier les alias supprimés s'il y en a.
      </para>

      <note>
        <para>
          Le fichier <filename>/etc/postfix/main.cf</filename> et
<filename>/etc/postfix/master.cf</filename> doivent être personnalisés selon
votre système. Le fichier <filename>main.cf</filename> a besoin de votre nom
d'hôte pleinement qualifié. Vous trouverez que le fichier
<filename>main.cf</filename> est auto-documenté donc chargez-le dans votre
éditeur pour effectuer les modifications dont vous avez besoin dans votre
situation.
        </para>
      </note>

      <note>
        <para>
          <application>Postfix</application> peut aussi être configuré pour être lancé
dans un environnement chroot. Voir le fichier dans les sources
<filename>examples/chroot-setup/LINUX2</filename> pour les détails.
        </para>
      </note>

      <para>
        Si vous avez une configuration existante, vous pouvez lancer l'outil
<command>postfix</command> pour ajouter les définitions nécessaires à vos
fichiers existants. En tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>/usr/sbin/postfix upgrade-configuration</userinput></screen>

      <para>
        Avant de démarrer <application>Postfix</application>, vous devriez vérifier
que votre configuration et les droits de votre fichier fonctionneront
correctement. Lancez les commandes suivantes en tant qu'utilisateur
<systemitem class="username">root</systemitem> pour vérifier et démarrer
votre serveur <application>Postfix</application>&nbsp;:
      </para>

<screen role="root"><userinput>/usr/sbin/postfix check &amp;&amp;
/usr/sbin/postfix start</userinput></screen>

    </sect3>

    <sect3 id="postfix-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Unité Systemd</phrase></title>

      <para>
        Pour automatiser le lancement de Postfix au démarrage, installez <phrase
revision="sysv">le script de démarrage
<filename>/etc/rc.d/init.d/postfix</filename> inclus</phrase><phrase
revision="systemd">l'unité <filename>postfix.service</filename>
incluse</phrase> dans le paquet <xref linkend="bootscripts"
revision="sysv"/><xref linkend="systemd-units" revision="systemd"/>&nbsp;:
      </para>

      <indexterm zone="postfix postfix-init">
        <primary sortas="f-postfix">postfix</primary>
      </indexterm>

<screen role="root"><userinput>make install-postfix</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          mailq (lien symbolique), newaliases (lien symbolique), postalias, postcat,
postconf, postdrop, postfix, postkick, postlock, postlog, postmap,
postmulti, postqueue, postsuper et sendmail
        </seg>
        <seg>
          Aucune
        </seg>
        <seg>
          /{etc,usr/lib}/postfix, /usr/share/doc/postfix-&postfix-version; et
/var/{lib,spool}/postfix
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="mailq">
        <term><command>mailq</command></term>
        <listitem>
          <para>
            Un lien symbolique vers <filename>sendmail</filename>
          </para>
          <indexterm zone="postfix mailq">
            <primary sortas="b-mailq">mailq</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="newaliases">
        <term><command>newaliases</command></term>
        <listitem>
          <para>
            Un lien symbolique vers <filename>sendmail</filename>
          </para>
          <indexterm zone="postfix newaliases">
            <primary sortas="b-newaliases">newaliases</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postalias">
        <term><command>postalias</command></term>
        <listitem>
          <para>
            est un outil <application>Postfix</application> de maintenance de bases de
données d'alias.
          </para>
          <indexterm zone="postfix postalias">
            <primary sortas="b-postalias">postalias</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postcat">
        <term><command>postcat</command></term>
        <listitem>
          <para>
            Affiche le contenu de fichiers de la queue
<application>Postfix</application> sous une forme lisible par un humain
          </para>
          <indexterm zone="postfix postcat">
            <primary sortas="b-postcat">postcat</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postconf">
        <term><command>postconf</command></term>
        <listitem>
          <para>
            Affiche ou modifie la valeur des paramètres de configuration de
<application>Postfix</application>
          </para>
          <indexterm zone="postfix postconf">
            <primary sortas="b-postconf">postconf</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postdrop">
        <term><command>postdrop</command></term>
        <listitem>
          <para>
            Crée un fichier et un répertoire maildrop et copie son entrée standard dans
le fichier
          </para>
          <indexterm zone="postfix postdrop">
            <primary sortas="b-postdrop">postdrop</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postfix-bin">
        <term><command>postfix</command></term>
        <listitem>
          <para>
            est le programme de contrôle de <application>Postfix</application>
          </para>
          <indexterm zone="postfix postfix-bin">
            <primary sortas="b-postfix">postfix</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postkick">
        <term><command>postkick</command></term>
        <listitem>
          <para>
            Envoie des requêtes au service spécifié via le canal local de transport
          </para>
          <indexterm zone="postfix postkick">
            <primary sortas="b-postkick">postkick</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postlock">
        <term><command>postlock</command></term>
        <listitem>
          <para>
            Verrouille un dossier de messages pour un usage exclusif et exécute les
commandes qui lui sont passées
          </para>
          <indexterm zone="postfix postlock">
            <primary sortas="b-postlock">postlock</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postlog">
        <term><command>postlog</command></term>
        <listitem>
          <para>
            Une interface de journalisation compatible avec
<application>Postfix</application> qui peut être utilisée, par exemple, dans
des scripts shell
          </para>
          <indexterm zone="postfix postlog">
            <primary sortas="b-postlog">postlog</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postmap">
        <term><command>postmap</command></term>
        <listitem>
          <para>
            Crée ou interroge une ou plusieurs tables de recherche Postfix ou met à jour
une existante
          </para>
          <indexterm zone="postfix postmap">
            <primary sortas="b-postmap">postmap</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postmulti">
        <term><command>postmulti</command></term>
        <listitem>
          <para>
            est le gestionnaire multi-instances de
<application>Postfix</application>. Il permet à un administrateur système de
gérer plusieurs sessions <application>Postfix</application> sur un seul hôte
          </para>
          <indexterm zone="postfix postmulti">
            <primary sortas="b-postmulti">postmulti</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postqueue">
        <term><command>postqueue</command></term>
        <listitem>
          <para>
            L'interface utilisateur <application>Postfix</application> pour gérer la
queue
          </para>
          <indexterm zone="postfix postqueue">
            <primary sortas="b-postqueue">postqueue</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="postsuper">
        <term><command>postsuper</command></term>
        <listitem>
          <para>
            L'interface utilisateur <application>Postfix</application> pour gérer la
queue du super-utilisateur
          </para>
          <indexterm zone="postfix postsuper">
            <primary sortas="b-postsuper">postsuper</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sendmail-postfix">
        <term><command>sendmail</command></term>
        <listitem>
          <para>
            est l'interface de compatibilité <application>Postfix</application> avec
<application>Sendmail</application>
          </para>
          <indexterm zone="postfix sendmail-postfix">
            <primary sortas="b-sendmail">sendmail</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
