<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY acpid-download-http "&sourceforge-dl;/acpid2/acpid-&acpid-version;.tar.xz">
  <!ENTITY acpid-download-ftp  "">
  <!ENTITY acpid-md5sum        "988c2e3fd5ba0ea4492d3ba7273af295">
  <!ENTITY acpid-size          "160&nbsp;Ko">
  <!ENTITY acpid-buildsize     "1.9 Mo">
  <!ENTITY acpid-time          "moins de 0,1&nbsp;SBU">
]>

<sect1 id="acpid" xreflabel="acpid-&acpid-version;">
  <?dbhtml filename="acpid.html"?>


  <title>acpid-&acpid-version;</title>

  <indexterm zone="acpid">
    <primary sortas="a-acpid">acpid</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à acpid</title>

    <para>
      Le paquet <application>acpid</application> (Advanced Configuration and Power
Interface event Daemon) est un démon complètement flexible, totalement
extensible pour délivrer les événements ACPI. Il écoute sur les interfaces
et quand un événement arrive, exécute des programmes pour gérer
l'événement. Les programmes qui sont exécutés sont configurés au travers une
collection de fichiers de configuration, ils peuvent être mis en place par
les paquets ou par l'utilisateur.
    </para>

    <note>
      <para>
        Some other packages may handle some ACPI events as well and they may
conflict with this package.  For example, &logind; (read the documentation
for <option>Handle*=</option> in <filename>logind.conf(5)</filename> for
details) and <xref linkend='upower'/> (used by many desktop environments
such as GNOME, KDE, and XFCE for handling ACPI events).  If you've installed
such a package and it's enough for your use case, this package is probably
not needed.  If you really need this package, you must be careful
configuring it and the other packages handling ACPI events to avoid
conflicts.  Notably, &logind; handles some ACPI events by default, so the
handling of these events by &logind; should be disabled first if handling
these events with acpid (again, read <filename>logind.conf(5)</filename> for
details).
      </para>
    </note>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&acpid-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&acpid-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &acpid-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &acpid-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &acpid-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &acpid-time;
        </para>
      </listitem>
    </itemizedlist>

  </sect2>

  <sect2 role="installation">
    <title>Installation de acpid</title>

    <para>
      Installez <application>acpid</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./configure --prefix=/usr \
            --docdir=/usr/share/doc/acpid-&acpid-version; &amp;&amp;
make</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install                         &amp;&amp;
install -v -m755 -d /etc/acpi/events &amp;&amp;
cp -r samples /usr/share/doc/acpid-&acpid-version;</userinput></screen>

  </sect2>

  <sect2 role="configuration">
    <title>Configurer acpid</title>

    <para>
      <application>acpid</application> est configuré par des événements définis
par l'utilisateur. Placez les fichiers événements dans le répertoire
<filename class="directory">/etc/acpi/events</filename>. Si un événement
arrive, <command>acpid</command> parcourt récursivement les fichiers
d'événements dans l'ordre pour voir si la "regex" définie après "event"
correspond. Si c'est le cas, l'action est exécutée.
    </para>

    <para>
      The following brief example will suspend the system when the laptop lid is
closed<phrase revision='sysv'> (it requires <xref
linkend="pm-utils"/>)</phrase>.  The example also disables the default
handling of the lid close event by &logind; when the system is on battery
and not connected to any external monitor, in order to avoid a conflict:
    </para>

<screen revision='sysv' role="nodump"><userinput>cat &gt; /etc/acpi/events/lid &lt;&lt; "EOF"
<literal>event=button/lid
action=/etc/acpi/lid.sh</literal>
EOF

cat &gt; /etc/acpi/lid.sh &lt;&lt; "EOF"
<literal>#!/bin/sh
/bin/grep -q open /proc/acpi/button/lid/LID/state &amp;&amp; exit 0
/usr/sbin/pm-suspend</literal>
EOF
chmod +x /etc/acpi/lid.sh

mkdir -pv /etc/elogind/logind.conf.d
echo <literal>HandleLidSwitch=ignore</literal> &gt; /etc/elogind/logind.conf.d/acpi.conf</userinput></screen>

<screen revision='systemd' role="nodump"><userinput>cat &gt; /etc/acpi/events/lid &lt;&lt; "EOF"
<literal>event=button/lid
action=/etc/acpi/lid.sh</literal>
EOF

cat &gt; /etc/acpi/lid.sh &lt;&lt; "EOF"
<literal>#!/bin/sh
/bin/grep -q open /proc/acpi/button/lid/LID/state &amp;&amp; exit 0
/usr/bin/systemctl suspend</literal>
EOF
chmod +x /etc/acpi/lid.sh

mkdir -pv /etc/systemd/logind.conf.d
echo <literal>HandleLidSwitch=ignore</literal> &gt; /etc/systemd/logind.conf.d/acpi.conf</userinput></screen>

    <para>
      Unfortunately, not every computer labels ACPI events in the same way (for
example, the lid may be recognized as <filename>LID0</filename> instead of
<filename>LID</filename>).  To determine how your buttons are recognized,
use the <command>acpi_listen</command> tool. Also, look in the <filename
class="directory">samples</filename> directory under <filename
class="directory">/usr/share/doc/acpid-&acpid-version;</filename> for more
examples.
    </para>

    <sect3  id="acpid-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Socket Systemd</phrase></title>

      <para revision="sysv">
        Pour démarrer <command>acpid</command> automatiquement quand le système est
redémarré, installez le script de démarrage
<filename>/etc/rc.d/init.d/acpid</filename> du paquet <xref
linkend="bootscripts"/>.
      </para>

      <para revision="systemd">
        Pour démarrer le démon <command>acpid</command> au démarrage, installez
l'unité depuis le paquet <xref linkend="systemd-units"/> en exécutant la
commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

      <indexterm zone="acpid acpid-init">
        <primary sortas="f-acpid">acpid</primary>
      </indexterm>

<screen role="root"><userinput>make install-acpid</userinput></screen>

      <note revision="systemd">
        <para>
          Ce paquet utilise l'activation par socket et sera démarré lorsque quelque
chose en aura besoin. Aucun fichier d'unité seul n'est fournit avec ce
paquet.
        </para>
      </note>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          acpid, acpi_listen et kacpimon
        </seg>
        <seg>
          Aucune
        </seg>
        <seg>
          /etc/acpi et /usr/share/doc/acpid-&acpid-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="acpid-prog">
        <term><command>acpid</command></term>
        <listitem>
          <para>
            est un programme qui écoute les événements ACPI et exécute les règles qui
correspondent à l'événement reçu
          </para>
          <indexterm zone="acpid acpid-prog">
            <primary sortas="b-acpid">acpid</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="acpi_listen">
        <term><command>acpi_listen</command></term>
        <listitem>
          <para>
            est un simple outil qui se connecte à <command>acpid</command> et écoute les
événements
          </para>
          <indexterm zone="acpid acpi_listen">
            <primary sortas="b-acpi_listen">acpi_listen</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="kacpimon">
        <term><command>kacpimon</command></term>
        <listitem>
          <para>
            est un programme de surveillance qui se connecte à 3 sources d'événements
ACPI (fichiers événements, couche réseau et d'entrée) et qui montre ce qu'il
voit tant qu'il est connecté
          </para>
          <indexterm zone="acpid kacpimon">
            <primary sortas="b-kacpimon">kacpimon</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
