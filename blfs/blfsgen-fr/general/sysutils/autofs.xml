<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY autofs-download-http "&kernel-dl;/linux/daemons/autofs/v5/autofs-&autofs-version;.tar.xz">
  <!ENTITY autofs-download-ftp  "">
  <!ENTITY autofs-md5sum        "6bd1ea8a9e5dc3a7dc95119e3bbaf52c">
  <!ENTITY autofs-size          "324&nbsp;Ko">
  <!ENTITY autofs-buildsize     "6.7&nbsp;Mo">
  <!ENTITY autofs-time          "0.1 SBU">
]>

<sect1 id="autofs" xreflabel="Autofs-&autofs-version;">
  <?dbhtml filename="autofs.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>autofs-&autofs-version;</title>

  <indexterm zone="autofs">
    <primary sortas="a-Autofs">Autofs</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Autofs</title>

    <para>
      <application>Autofs</application> contrôle les opérations du démon
d'automontage.  Le démon d'automontage monte automatiquement les systèmes de
fichier quand ils sont accessibles et les démonte après une période
d'inactivité. C'est fait sur la base d'un ensemble de règles
pré-configurées.
    </para>

    &lfs101_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&autofs-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&autofs-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &autofs-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &autofs-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &autofs-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &autofs-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Autofs</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="libtirpc"/> et <xref linkend="rpcsvc-proto"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="nfs-utils"/>, <xref linkend="libnsl"/>, <xref
linkend="libxml2"/>, <xref linkend="mitkrb"/>, <xref linkend="openldap"/>
(client uniquement) et <xref linkend="cyrus-sasl"/>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/autofs"/></para>

  </sect2>

  <sect2 role="kernel" id="autofs-kernel">
    <title>Configuration du noyau</title>

    <indexterm zone="autofs autofs-kernel">
      <primary sortas="d-Automounter">Automounter</primary>
    </indexterm>

    <para>
      Vérifiez que le support d'auto-montage du noyau a été activé&nbsp;:
    </para>

<screen><literal>File systems ---&gt;
  &lt;*/M&gt; Kernel automounter support (supports v3, v4, and v5) [CONFIG_AUTOFS_FS]</literal></screen>

    <para>
      Éventuellement, activez les options suivantes dans la configuration du
noyau&nbsp;:
    </para>

<screen><literal>File systems  ---&gt;
  [*] Network File Systems  ---&gt;                                      [CONFIG_NETWORK_FILESYSTEMS]
    &lt;*/M&gt; NFS client support                                          [CONFIG_NFS_FS]
    &lt;*/M&gt; SMB3 and CIFS support (advanced network filesystem)         [CONFIG_CIFS]</literal></screen>

    <para>
      Recompilez et installez le nouveau noyau si nécessaire.
    </para>

  </sect2>

  <sect2 role="installation">

    <title>Installation de Autofs</title>

    <para>
      Installez <application>Autofs</application> en lançant les commandes
suivantes&nbsp;:
    </para>

<screen revision="sysv"><userinput>./configure --prefix=/         \
            --with-libtirpc    \
            --without-openldap \
            --mandir=/usr/share/man &amp;&amp;
make</userinput></screen>

<screen revision="systemd"><userinput>./configure --prefix=/         \
            --with-libtirpc    \
            --with-systemd     \
            --without-openldap \
            --mandir=/usr/share/man &amp;&amp;
make</userinput></screen>

    <para>
      Ce paquet n'est pas fourni avec une suite de tests.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<!-- As of version 5.1.5, the configuration files are not installed anymore -->
<screen role="root"><userinput>make install</userinput></screen>


    <caution>
      <para>
        Si <application>autofs</application> est déjà installé sur votre système,
assurez-vous de sauvegarder vos fichiers de configuration. Ils seront
écrasés par la commande suivante.
      </para>
    </caution>

    <para>
      Installez les fichiers de configuration par défaut, toujours en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install_samples</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--with-libtirpc</parameter>&nbsp;: Ce paramètre force le paquet à
utiliser libtirpc pour la fonctionnalité RPC plutôt que d'utiliser
l'implémentation de Glibc qui a été supprimée dans LFS 8.1.
    </para>

    <para revision="systemd">
      <parameter>--with-systemd</parameter>&nbsp;: Ce paramètre active
l'installation des unités systemd incluses.
    </para>

    <para>
      <parameter>--without-openldap</parameter>&nbsp;: Ce paramètre désactive
openldap s'il est trouvé. Si openldap est souhaité, supprimez ce
paramètre. Notez que le support de openldap dans autofs nécéssite <xref
linkend="mitkrb"/>.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration d'Autofs</title>

    <sect3 id="autofs-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/sysconfig/autofs.conf</filename>,
<filename>/etc/auto.master</filename>, <filename>/etc/auto.misc</filename>
et <filename>/etc/auto.net</filename>
      </para>

      <indexterm zone="autofs autofs-config" >
        <primary sortas="e-etc-sysconfig-autofs.conf">/etc/sysconfig/autofs.conf</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.master">/etc/auto.master</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.misc">/etc/auto.misc</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.net">/etc/auto.net</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>
        Le processus d'installation crée <filename>auto.master</filename>,
<filename>auto.misc</filename>, <filename>auto.smb</filename> et
<filename>auto.net</filename>. Remplacez le fichier
<filename>auto.master</filename> avec les commandes suivantes en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>mv /etc/auto.master /etc/auto.master.bak &amp;&amp;
cat &gt; /etc/auto.master &lt;&lt; "EOF"
<literal># Begin /etc/auto.master

/media/auto  /etc/auto.misc  --ghost
#/home        /etc/auto.home

# End /etc/auto.master</literal>
EOF</userinput></screen>

      <para>
        Ce fichier crée un nouveau répertoire de médias,
<filename>/media/auto</filename> qui englobera tous les répertoires
existants du même nom. Dans l'exemple, le fichier
<filename>/etc/auto.misc</filename>, contient une ligne&nbsp;:
      </para>

<screen>cd   -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom</screen>

      <para>
        ce qui montera un cdrom en tant que <filename>/media/auto/cd</filename> si
ce répertoire est accessible. L'option <option>--ghost</option> dit à
l'automounteur de créer des versions <quote>fantômes</quote> (c'est-à-dire
des répertoires vides) de tous les points de montage listés dans le fichier
de configuration, que les systèmes de fichiers soient effectivement montés
ou pas. C'est très pratique et fortement recommandé car cela vous affichera
les systèmes de fichiers qu'on peut monter automatiquement comme des
répertoires existants, même quand leur système de fichiers n'est pas
actuellement monté. Sans l'option <option>--ghost</option>, vous devrez vous
souvenir des noms des répertoires. Dès que vous essaierez d'accéder à l'un
d'entre eux, le répertoire sera créé et le système de fichiers sera
monté. Quand le système de fichiers est de nouveau démonté, le répertoire
est lui aussi détruit, sauf si on a donné l'option <option>--ghost</option>.
      </para>

      <note>
        <para>
          Une méthode alternative serait de spécifier un autre emplacement
d'automontage tel que <filename
class='directory'>/var/lib/auto/cdrom</filename> et de créer un lien
symbolique de <filename class='directory'>/media/cdrom</filename> vers
l'emplacement de l'automontage.
        </para>
      </note>

      <para>
        Le fichier <filename>auto.misc</filename> doit être configuré pour votre
matériel. Le fichier de configuration chargé chargerait votre cdrom si
<filename>/dev/cdrom</filename> est actif ou s'il peut être édité pour
s'adapter à votre configuration de périphériques. Des exemples pour les
disquettes sont disponibles dans le fichier et facilement activables. La
documentation de ce fichier est disponible en utilisant la commande
<command>man 5 autofs</command>.
      </para>

      <para>
        Sur la deuxième ligne, s'il est activé, un répertoire home pour
l'utilisateur serait monté via NFS lors de la connexion.  Le
<filename>/etc/home.auto</filename> devrait exister et contenir une entrée
du genre&nbsp;:
      </para>

<screen>joe  example.org:/export/home/joe</screen>

      <para>
        où le répertoire <filename>/export/home/joe</filename> est exporté via NFS à
partir du système example.org. Les partages NFS sont traités à la page
suivante.
      </para>

      <para>
        On pourrait aussi utiliser ce paquet pour monter des partages SMB mais cette
fonctionnalité n'est pas configurée dans ces instructions. Pour des
informations de configuration supplémentaires, voir les pages de man
d'auto.master(5). Il y a aussi des ressources Internet telles que celle
disponible sur <ulink url='http://wiki.gentoo.org/wiki/AutoFS'>AUTOFS
HOWTO</ulink>.
      </para>

    </sect3>

    <sect3  id="autofs-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Unité Systemd</phrase></title>

      <para revision="sysv">
        <application>autofs</application> installe son propre script de démarrage,
mais il n'a pas la capacité d'enregistrement, ni la cohérence visuelle avec
d'autres scripts BLFS.
      </para>

      <para revision="sysv">
        Installez le script de montage <filename>/etc/init.d/autofs</filename>
inclus dans le paquet <xref linkend="bootscripts"/>.
      </para>

      <para revision="systemd">
        Pour démarrer <application>Autofs</application> au démarrage, activez
l'unité systemd précédemment installée en lançant la commande suivante en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

      <indexterm zone="autofs autofs-init">
        <primary sortas="f-autofs-init">autofs</primary>
      </indexterm>

<screen role="root" revision="sysv"><userinput>make install-autofs</userinput></screen>

<screen role="root" revision="systemd"><userinput>systemctl enable autofs</userinput></screen>

      <para revision="sysv">
        La variable time-out est définie dans
<filename>/etc/sysconfig/autofs.conf</filename>. Le fichier installé définit
par défaut 60 secondes d'inactivité avant de démonter le périphérique. Il se
peut qu'un temps bien plus bref soit nécessaire pour protéger l'écriture en
tampon avec une disquette si les utilisateurs ont tendance à enlever le
média dans un délai plus court que celui paramétré.
      </para>

      <note revision="systemd">
        <para>
          Vous pouvez aussi spécifier la variable <envar>OPTIONS</envar> dans le
fichier <filename>/etc/sysconfig/autofs</filename> avec tout paramètre
supplémentaire que vous voudriez donner au démon automount.
        </para>
      </note>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>automount</seg>
        <seg>
          lookup_dir.so, lookup_file.so, lookup_files.so, lookup_hosts.so,
lookup_ldap.so, lookup_multi.so, lookup_nis.so, lookup_nisplus.so,
lookup_program.so, lookup_userhome.so, lookup_yp.so, mount_afs.so,
mount_autofs.so, mount_bind.so, mount_changer.so, mount_ext2.so,
mount_ext3.so, mount_ext4.so, mount_generic.so, mount_nfs.so, mount_nfs4.so,
parse_amd.so et parse_sun.so
           </seg>
        <seg>/lib/autofs</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="automount">
        <term><command>automount</command></term>
        <listitem>
          <para>
            est le démon qui effectue un montage quand on sollicite un périphérique
          </para>
          <indexterm zone="autofs automount">
            <primary sortas="b-automount">automount</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
