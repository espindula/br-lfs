<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY upower-download-http "https://gitlab.freedesktop.org/upower/upower/-/archive/v&upower-version;/upower-v&upower-version;.tar.bz2">
  <!ENTITY upower-download-ftp  "">
  <!ENTITY upower-md5sum        "4fba71838a9ba0db6f140418eddbe2b7">
  <!ENTITY upower-size          "128&nbsp;Ko">
  <!ENTITY upower-buildsize     "4,9&nbsp;Mo (plus 1,3&nbsp;Mo pour les tests)">
  <!ENTITY upower-time          "moins de 0,1&nbsp;SBU (avec parallélisme = 4, plus 0,6&nbsp;SBU pour les
tests)">
]>

<sect1 id="upower" xreflabel="UPower-&upower-version;">
  <?dbhtml filename="upower.html"?>


  <title>UPower-&upower-version;</title>

  <indexterm zone="upower">
    <primary sortas="a-UPower">UPower</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à UPower</title>

    <para>
      Le paquet <application>UPower</application> offre une interface pour
énumérer les périphériques d'énergie, écouter les événements de
périphériques et chercher l'historique et les statistiques. Toute
application ou service du système peut accéder au service
org.freedesktop.UPower via le bus de message du système.
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&upower-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&upower-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &upower-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &upower-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &upower-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &upower-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de UPower</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="libgudev"/>, <xref linkend="libusb"/> et <xref
linkend="polkit"/>
    </para>

    <bridgehead renderas="sect4">Facultative (Requise pour la construction de GNOME)</bridgehead>
    <para role="optional">
      <xref linkend="gobject-introspection"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="gtk-doc"/>, <xref linkend="libxslt"/>, <xref
linkend="docbook-xsl"/>, <xref linkend="pygobject3"/>, <xref
linkend="python-dbusmock"/>, <xref linkend="umockdev"/> (pour une partie de
la suite de tests) et <ulink
url="https://libimobiledevice.org/">libimobiledevice</ulink>
    </para>

  </sect2>

  <sect2 role="kernel" id="upower-kernel" revision="systemd">
    
    <!-- With UPower-0.9.11's hardening of the systemd unit file,
         User Namespace Support (CONFIG_USER_NS) is now required. Without this,
         you will get "ERROR 213/USER" out of a 'systemctl start upower'. -->
<title>Configuration du noyau</title>

    <para>
      Activez les options suivantes dans la configuration du noyau et recompilez
le noyau si nécessaire&nbsp;:
    </para>

 <screen><literal>General Setup ---&gt;
    [*] Namespaces support ---&gt;     [CONFIG_NAMESPACES]
       [*] User namespace           [CONFIG_USER_NS]</literal></screen>

    <indexterm zone="upower upower-kernel">
      <primary sortas="d-upower">upower</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de UPower</title>

    <para>
      Tout d'abord, supprimez une dépendance inutile pour un test&nbsp;:
    </para>

<screen><userinput>sed '/parse_version/d' -i src/linux/integration-test.py</userinput></screen>

    <para>
      Installez <application>UPower</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<!-- On my system with LANG=zh_CN.UTF-8, one test attempted to compare
         Chinese error message with English references and failed.
         LC_ALL=C fixes the problem.  -->
<screen revision="sysv"><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup ..                  \
      --prefix=/usr             \
      --buildtype=release       \
      -Dgtk-doc=false           \
      -Dman=false               \
      -Dsystemdsystemunitdir=no \
      -Dudevrulesdir=/usr/lib/udev/rules.d &amp;&amp;
ninja</userinput></screen>

<screen revision="systemd"><userinput>mkdir build                         &amp;&amp;
cd    build                         &amp;&amp;
meson setup ..            \
      --prefix=/usr       \
      --buildtype=release \
      -Dgtk-doc=false     \
      -Dman=false         &amp;&amp;
ninja</userinput></screen>

    
    <para>
      Pour tester les résultats, lancez&nbsp;: <command>LC_ALL=C ninja
test</command>. Certains tests peuvent ne pas réussir à cause de fichiers
manquants. La suite de tests devrait être lancée depuis une session
graphique locale démarrée avec dbus-launch.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ninja install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>-Dgtk-doc=false</parameter>&nbsp;: empêche la construction de la
documentation. Supprimez-la si vous avez installé
<application>GTK-Doc</application> et souhaitez construire la documentation.
    </para>

    <para>
      <parameter>-Dman=false</parameter>&nbsp;: empêche la construction des pages
de manuel. Supprimez-la si vous avez installé <xref linkend='libxslt'/> et
<xref linkend='docbook-xsl'/> et souhaitez construire les pages de manuel.
    </para>

    <para revision="sysv">
      <parameter>-Dsystemdsystemunitdir=no</parameter>&nbsp;: supprime la
dépendance à <application>systemd</application>.
    </para>

    <para revision="sysv">
      <parameter>-Dudevrulesdir=/usr/lib/udev/rules.d</parameter>&nbsp;: dit au
système de construction où installer les règles
<application>udev</application> car l'information ne se trouve pas dans
<filename>/usr/lib/pkgconfig/libudev.pc</filename>
    </para>

  </sect2>

  <sect2 role="configuration" revision="systemd">

    <title>Configuration de UPower</title>

    <!-- timer statistics have been removed from kernel (since 4.11)
     I do not know if there is a replacement. See
     https://patchwork.kernel.org/patch/9561519
     and https://bugs.freedesktop.org/show_bug.cgi?id=100626

    <para>

      To use the command <command>upower -w</command> for information about
      processor wakeups (this command is used by <phrase revision="sysv">
      <ulink url="&gnome-download-http;/gnome-power-manager/">gnome-power-manager</ulink></phrase><phrase revision="systemd"><xref linkend="gnome-power-manager"/></phrase>)
      you need to enable CONFIG_TIMER_STATS.  This is achieved in
      <command>make menuconfig</command> by going to the &apos;kernel-hacking&apos;
      menu and selecting &apos;Collect kernel timers statistics&apos;.
    </para>
-->
<sect3  id="upower-init">
      <title>Unité systemd</title>

      <para>
        Pour démarrer le démon <command>UPower</command> au démarrage, activez
l'unité systemd précédemment installée en exécutant la commande suivante en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

      <indexterm zone="upower upower-init">
        <primary sortas="f-upower">upower</primary>
      </indexterm>

<screen role="root"><userinput>systemctl enable upower</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle><!--
See below... <phrase revision="systemd">
s</phrase>-->
Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          <!-- <phrase revision="systemd">
 and upowerd</phrase>
Upowerd should not be listed, as it is in /usr/libexec, and is not supposed
to be run by a user. Furthermore, upowerd is also in sysv, and there is no
reason so single out systemd here. -->
upower

        </seg>
        <seg>
          libupower-glib.so
        </seg>
        <seg>
          /etc/UPower, /usr/include/libupower-glib et /var/lib/upower
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="upower-prog">
        <term><command>upower</command></term>
        <listitem>
          <para>
            est l'outil en ligne de commande <application>UPower</application>
          </para>
          <indexterm zone="upower upower-prog">
            <primary sortas="b-upower">upower</primary>
          </indexterm>
        </listitem>
      </varlistentry>


      <!-- See above
      <varlistentry id="upowerd" revision="systemd">

        <term><command>upowerd</command></term>
        <listitem>
          <para>
            is the <application>UPower</application> Daemon. It provides the
            org.freedesktop.UPower service on the system message bus.
          </para>
          <indexterm zone="upower upowerd">
            <primary sortas="b-upowerd">upowerd</primary>
          </indexterm>
        </listitem>
      </varlistentry>-->
<varlistentry id="libupower-glib">
        <term><filename class="libraryfile">libupower-glib.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API de <application>UPower</application>
          </para>
          <indexterm zone="upower libupower-glib">
            <primary sortas="c-libupower-glib">libupower-glib.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
