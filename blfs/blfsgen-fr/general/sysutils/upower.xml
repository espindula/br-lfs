<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY upower-download-http "https://gitlab.freedesktop.org/upower/upower/-/archive/UPOWER_&upower-version;/upower-UPOWER_&upower-version;.tar.bz2">
  <!ENTITY upower-download-ftp  "">
  <!ENTITY upower-md5sum        "d58b028211aee6050c26c99b777ba60f">
  <!ENTITY upower-size          "144&nbsp;Ko">
  <!ENTITY upower-buildsize     "14&nbsp;Mo">
  <!ENTITY upower-time          "0.1&nbsp;SBU (avec parallélisme = 4)">
]>

<sect1 id="upower" xreflabel="UPower-&upower-version;">
  <?dbhtml filename="upower.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>UPower-&upower-version;</title>

  <indexterm zone="upower">
    <primary sortas="a-UPower">UPower</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à UPower</title>

    <para>
      Le paquet <application>UPower</application> offre une interface pour
énumérer les périphériques d'énergie, écouter les événements de
périphériques et chercher l'historique et les statistiques. Toute
application ou service du système peut accéder au service
org.freedesktop.UPower via le bus de message du système.
    </para>

    &lfs110a_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&upower-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&upower-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &upower-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &upower-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &upower-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &upower-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de UPower</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="libgudev"/>, <xref linkend="libusb"/> et <xref
linkend="polkit"/>
    </para>

    <bridgehead renderas="sect4">Facultative (Requise pour la construction de GNOME)</bridgehead>
    <para role="optional">
      <xref linkend="gobject-introspection"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="gtk-doc"/>, <xref linkend="pygobject3"/>, <xref
linkend="python-dbusmock"/>, <xref linkend="umockdev"/> (pour une partie de
la suite de tests) et <ulink
url="https://libimobiledevice.org/">libimobiledevice</ulink>.
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/upower"/>
    </para>
  </sect2>

  <sect2 role="kernel" id="upower-kernel" revision="systemd">
    
    <!-- With UPower-0.9.11's hardening of the systemd unit file,
         User Namespace Support is now required. Without this, you get
         "ERROR 213/USER" out of a 'systemctl start upower'. -->
<title>Configuration du noyau</title>

    <para>
      Activez les options suivantes dans la configuration du noyau et recompilez
le noyau si nécessaire&nbsp;:
    </para>

 <screen><literal>General Setup ---&gt;
    [*] Namespaces support ---&gt;     [CONFIG_NAMESPACES]
       [*] User namespace           [CONFIG_USER_NS]</literal></screen>

    <indexterm zone="upower upower-kernel">
      <primary sortas="d-upower">upower</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de UPower</title>

    <para>
      Installez <application>UPower</application> en lançant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./autogen.sh --prefix=/usr        \
             --sysconfdir=/etc    \
             --localstatedir=/var \
             --enable-deprecated  \
             --disable-static     &amp;&amp;
make</userinput></screen>

    <para>
      Pour tester les résultats, lancez&nbsp;: <command>make
check</command>. Certains tests peuvent ne pas réussir à cause de fichiers
manquants. La suite de tests devrait être lancée depuis une session
graphique locale démarrée avec dbus-launch.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--enable-deprecated</parameter>&nbsp;: Ce paramètre active les
fonctionnalités obsolètes qui restent nécessaire pour quelques applications.
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/static-libraries.xml"/>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/gtk-doc-rebuild.xml"/>

  </sect2>

  <sect2 role="configuration" revision="systemd">

    <title>Configuration de UPower</title>

    <!-- timer statistics have been removed from kernel (since 4.11)
     I do not know if there is a replacement. See
     https://patchwork.kernel.org/patch/9561519
     and https://bugs.freedesktop.org/show_bug.cgi?id=100626

    <para>

      To use the command <command>upower -w</command> for information about
      processor wakeups (this command is used by <phrase revision="sysv">
      <ulink url="&gnome-download-http;/gnome-power-manager/">gnome-power-manager</ulink></phrase><phrase revision="systemd"><xref linkend="gnome-power-manager"/></phrase>)
      you need to enable CONFIG_TIMER_STATS.  This is achieved in
      <command>make menuconfig</command> by going to the &apos;kernel-hacking&apos;
      menu and selecting &apos;Collect kernel timers statistics&apos;.
    </para>
-->
<sect3  id="upower-init" revision="systemd">
      <title>Unité systemd</title>

      <para>
        Pour démarrer le démon <command>UPower</command> au démarrage, activez
l'unité systemd précédemment installée en lançant la commande suivante en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

      <indexterm zone="upower upower-init">
        <primary sortas="f-upower">upower</primary>
      </indexterm>

<screen role="root"><userinput>systemctl enable upower</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle><!--
See below... <phrase revision="systemd">
s</phrase>-->
Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          <!-- <phrase revision="systemd">
 and upowerd</phrase>
Upowerd should not be listed, as it is in /usr/libexec, and is not supposed
to be run by a user. Furthermore, upowerd is also in sysv, and there is no
reason so single out systemd here. -->
upower

        </seg>
        <seg>
          libupower-glib.so
        </seg>
        <seg>
          /etc/UPower, /usr/include/libupower-glib et /var/lib/upower
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="upower-prog">
        <term><command>upower</command></term>
        <listitem>
          <para>
            est l'outil en ligne de commande <application>UPower</application>
          </para>
          <indexterm zone="upower upower-prog">
            <primary sortas="b-upower">upower</primary>
          </indexterm>
        </listitem>
      </varlistentry>


      <!-- See above
      <varlistentry id="upowerd" revision="systemd">

        <term><command>upowerd</command></term>
        <listitem>
          <para>
            is the <application>UPower</application> Daemon. It provides the
            org.freedesktop.UPower service on the system message bus.
          </para>
          <indexterm zone="upower upowerd">
            <primary sortas="b-upowerd">upowerd</primary>
          </indexterm>
        </listitem>
      </varlistentry>-->
<varlistentry id="libupower-glib">
        <term><filename class="libraryfile">libupower-glib.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API de <application>UPower</application>
          </para>
          <indexterm zone="upower libupower-glib">
            <primary sortas="c-libupower-glib">libupower-glib.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
