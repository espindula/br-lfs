<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY bluez-download-http "&kernel-dl;/linux/bluetooth/bluez-&bluez-version;.tar.xz">
  <!ENTITY bluez-download-ftp  "">
  <!ENTITY bluez-md5sum        "d89a1c660eaf33ae360af93e3e2951bd">
  <!ENTITY bluez-size          "2.1&nbsp;Mo">
  <!ENTITY bluez-buildsize     "143&nbsp;Mo (avec les tests)">
  <!ENTITY bluez-time          "0.4&nbsp;SBU (avec parallélisme = 4&nbsp;; avec les tests)">
]>

<sect1 id="bluez" xreflabel="BlueZ-&bluez-version;">
  <?dbhtml filename="bluez.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>BlueZ-&bluez-version;</title>

  <indexterm zone="bluez">
    <primary sortas="a-BlueZ">BlueZ</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à BlueZ</title>

    <para>
      Le paquet <application>BlueZ</application> contient la pile de protocole
Bluetooth pour Linux.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&bluez-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&bluez-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &bluez-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &bluez-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &bluez-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &bluez-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3" revision="sysv">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact" revision="sysv">
      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink
url="&patch-root;/bluez-&bluez-version;-obexd_without_systemd-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de BlueZ</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="dbus"/>, <xref linkend="glib2"/> et <xref linkend="libical"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="docutils"/> (pour générer les pages de manuel)
    </para>

    <para condition="html" role="usernotes">
      Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/bluez"/>
    </para>
  </sect2>


  <sect2 role="kernel" id="bluez-kernel">
    <title>Configuration du noyau</title>

    <para>
      Si vous construisez ce paquet pour utiliser des appareils bluetooth (plutôt
qu'en tant que dépendance), activez les options suivantes dans la
configuration du noyau, ainsi que les options sous le paragraphe suivant si
vous lancerez les tests, et recompilez le noyau si nécessaire&nbsp;:
    </para>

<screen><literal>General Setup ---&gt;
  [*] Configure standard kernel features (expert users)               [CONFIG_EXPERT]
    [*] Enable timerfd() system call               [CONFIG_TIMERFD]
    [*] Enable eventfd() system call               [CONFIG_EVENTFD]

[*] Networking support ---&gt;                [CONFIG_NET]
  &lt;*/M&gt; Bluetooth subsystem support ---&gt;    [CONFIG_BT]
    &lt;*/M&gt; RFCOMM protocol support          [CONFIG_BT_RFCOMM]
    [*]   RFCOMM TTY support               [CONFIG_BT_RFCOMM_TTY]
    &lt;*/M&gt; BNEP protocol support            [CONFIG_BT_BNEP]
    [*]   Multicast filter support         [CONFIG_BT_BNEP_MC_FILTER]
    [*]   Protocol filter support          [CONFIG_BT_BNEP_PROTO_FILTER]
    &lt;*/M&gt; HIDP protocol support            [CONFIG_BT_HIDP]
        Bluetooth device drivers ---&gt;
          (Select the appropriate drivers for your Bluetooth hardware)

   &lt;*/M&gt; RF switch subsystem support ----   [CONFIG_RFKILL]

-*- Cryptographic API ---&gt;
   &lt;*/M*&gt; User-space cryptographic algorithm configuration         [CONFIG_CRYPTO_USER]
   &lt;*/M*&gt; User-space interface for hash algorithms                 [CONFIG_CRYPTO_USER_API_HASH]
   &lt;*/M*&gt; User-space interface for symmetric key cipher algorithms [CONFIG_CRYPTO_USER_API_SKCIPHER]
   &lt;*/M*&gt; MD5 digest algorithm                                     [CONFIG_CRYPTO_MD5]
   &lt;*/M*&gt; SHA1 digest algorithm                                    [CONFIG_CRYPTO_SHA1]

Security Options ---&gt;
  &lt;*/M*&gt; Diffie-Hellman operations on retained keys [CONFIG_KEY_DH_OPERATIONS]</literal></screen>


    <indexterm zone="bluez bluez-kernel">
      <!--
    <para>

      If you wish to run the testsuite (even if treating this package as a build
      dependency), you will need to enable the following options in the kernel
      configuration and recompile the kernel if necessary:
    </para>

<screen><literal>-*- Cryptographic API - - -&gt;                                      [CONFIG_CRYPTO]
  &lt;*/M&gt; User-space interface for hash algorithms                 [CONFIG_CRYPTO_USER_API_HASH]
  &lt;*/M&gt; User-space interface for symmetric key cipher algorithms [CONFIG_CRYPTO_USER_API_SKCIPHER]</literal></screen>
-->
<primary sortas="d-bluez">bluez</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de BlueZ</title>



    <!--
    <para>

      At first, fix an issue building the package with Glibc-2.34 or later:
    </para>

<screen><userinput>sed 's/pause(/bluez_&amp;/' -i profiles/audio/media.c</userinput></screen>
-->
<para revision="sysv">Maintenant, effectuez quelques changements requis pour les systèmes
SystemV&nbsp;:</para>

<screen revision="sysv"><userinput>patch -Np1 -i ../bluez-&bluez-version;-obexd_without_systemd-1.patch</userinput></screen>

    <para>
      Installez <application>BlueZ</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen revision="sysv"><userinput>./configure --prefix=/usr         \
            --sysconfdir=/etc     \
            --localstatedir=/var  \
            --enable-library      \
            --disable-manpages    \
            --disable-systemd     &amp;&amp;
make</userinput></screen>

<screen revision="systemd"><userinput>./configure --prefix=/usr         \
            --sysconfdir=/etc     \
            --localstatedir=/var  \
            --disable-manpages    \
            --enable-library      &amp;&amp;
make</userinput></screen>

    <para>
      Pour tester les résultats, tapez&nbsp;: <userinput>make check</userinput>.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<!-- To editors: this will be unnecessary with bluez-5.65,
         please remove this part when bluez is updated. -->
<screen role="root"><userinput>make install &amp;&amp;
ln -svf ../libexec/bluetooth/bluetoothd /usr/sbin</userinput></screen>

    
    <para revision="systemd">
      Toujours en tant qu'utilisateur &root;, créez le répertoire d'information
sur l'état variable pour ce paquet&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>install -v -dm700 /var/lib/bluetooth</userinput></screen>

    <para>
      Installez le fichier principal de configuration en tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -dm755 /etc/bluetooth &amp;&amp;
install -v -m644 src/main.conf /etc/bluetooth/main.conf</userinput></screen>

    <para>
      Si vous le souhaitez, installez la documentation de l'API en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -dm755 /usr/share/doc/bluez-&bluez-version; &amp;&amp;
install -v -m644 doc/*.txt /usr/share/doc/bluez-&bluez-version;</userinput></screen>

  </sect2>


  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--disable-manpages</parameter>&nbsp;: ce paramètre désactive la
génération des pages de manuel à cause de la dépendance à
«&nbsp;rst2man&nbsp;» de docutils. Supprimez ce paramètre si vous avez
installé <xref role="nodep" linkend="docutils"/> et souhaitez générer les
pages de manuel.
    </para>

    <para>
      <parameter>--enable-library</parameter>&nbsp;:: Ce paramètre active la
construction de la bibliothèque de compatibilité
<application>BlueZ</application> 4 qui est requises par certaines
applications.
    </para>

    <para revision="sysv">
      <parameter>--disable-systemd</parameter>&nbsp;: Ce paramètre est nécessaire
car <application>systemd</application> ne fait pas partie de LFS/BLFS. Si
vous utilisez systemd, enlevez ce paramètre.
    </para>

    <para>
      <command>ln -svf ../libexec/bluetooth/bluetoothd /usr/sbin</command>&nbsp;:
Cette commande donne accès au démon bluetooth de façon plus cohérente.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de BlueZ</title>

    <sect3 id="bluez-config">
      <title>Fichiers de configuration</title>
      <para revision="sysv">
        <filename>/etc/bluetooth/main.conf</filename> est installé automatiquement
pendant l'installation. En supplément, il y a trois fichiers de
configuration en plus.  /etc/sysconfig/bluetooth est installé comme une
partie des scripts de démarrage. De plus, vous pouvez éventuellement
installer la suite en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

      <para revision="systemd">
        <filename>/etc/bluetooth/main.conf</filename> est installé automatiquement
pendant l'installation. En plus, il y a deux fichiers de configuration
complémentaires. Vous pouvez éventuellement installer les fichiers suivants
en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
     </para>

<screen role="root"><userinput>cat > /etc/bluetooth/rfcomm.conf &lt;&lt; "EOF"</userinput>
<literal># Start rfcomm.conf
# Set up the RFCOMM configuration of the Bluetooth subsystem in the Linux kernel.
# Use one line per command
# See the rfcomm man page for options


# End of rfcomm.conf</literal>
EOF</screen>

<screen role="root"><userinput>cat > /etc/bluetooth/uart.conf &lt;&lt; "EOF"</userinput>
<literal># Start uart.conf
# Attach serial devices via UART HCI to BlueZ stack
# Use one line per device
# See the hciattach man page for options

# End of uart.conf</literal>
EOF</screen>

      <indexterm zone="bluez bluez-config">
        <primary
        sortas="e-etc-bluetooth-main.conf">/etc/bluetooth/main.conf</primary>
      </indexterm>

    </sect3>

    <sect3  id="bluez-init">
      <title><phrase revision="sysv">Scripts de démarrage</phrase><phrase
revision="systemd">Service Bluez Systemd</phrase></title>

      <para revision="sysv">
        Pour démarrer automatiquement le démon <command>bluetoothd</command> quand
le système est redémarré, installez le script de démarrage
<filename>/etc/rc.d/init.d/bluetooth</filename> depuis le paquet <xref
linkend="bootscripts"/>.
      </para>

      <para revision="systemd">
        Pour démarrer le démon <command>bluetoothd</command> au démarrage, activez
l'unité systemd précédemment installée en exécutant la commande suivante en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="systemd"><userinput>systemctl enable bluetooth</userinput></screen>

      <para revision="systemd">
         Pour démarrer le démon <command>obexd</command> dans une session utilisateur
(pour supporter certains programmes Bluetooth qui l'utilisent), activez
l'unité systemd précédemment installée en exécutant la commande suivante en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
       </para>

<screen role="root" revision="systemd"><userinput>systemctl enable --global obex</userinput></screen>

      <indexterm zone="bluez bluez-init">
        <primary sortas="f-bluetooth">bluetooth</primary>
      </indexterm>

<screen role="root" revision="sysv"><userinput>make install-bluetooth</userinput></screen>


      <note revision="systemd">
        <para>
          <application>Systemd</application> démarrera le démon Bluetooth seulement si
un périphérique bluetooth est détecté sur le système.
        </para>
      </note>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
      
          <!--bccmd, -->
bluemoon, bluetoothctl, bluetoothd (lien symbolique), btattach, btmon,
hex2hcd, l2ping, l2test, mpris-proxy et rctest
        </seg>
        <seg>
          libbluetooth.so
        </seg>
        <seg>
          /etc/bluetooth, /usr/{include,libexec}/bluetooth et
/usr/share/doc/bluez-&bluez-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <!--
      <varlistentry id="bccmd">

        <term><command>bccmd</command></term>
        <listitem>
          <para>
            is used to issue BlueCore commands to Cambridge Silicon
            Radio devices
          </para>
          <indexterm zone="bluez bccmd">
            <primary sortas="b-bccmd">bccmd</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      -->
<?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      

      <varlistentry id="bluemoon">
        <term><command>bluemoon</command></term>
        <listitem>
          <para>
            est un utilitaire de configuration de Bluemoon
          </para>
          <indexterm zone="bluez bluemoon">
            <primary sortas="b-bluemoon">bluemoon</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="bluetoothctl">
        <term><command>bluetoothctl</command></term>
        <listitem>
          <para>
            est le programme de contrôle interactif de Bluetooth
          </para>
          <indexterm zone="bluez bluetoothctl">
            <primary sortas="b-bluetoothctl">bluetoothctl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="bluetoothd">
        <term><command>bluetoothd</command></term>
        <listitem>
          <para>
            est le démon Bluetooth
          </para>
          <indexterm zone="bluez bluetoothd">
            <primary sortas="b-bluetoothd">bluetoothd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="btmon">
        <term><command>btmon</command></term>
        <listitem>
          <para>
            fournit l'accès à l'infrastructure de surveillance de Bluetooth pour lire
les traces HCI
          </para>
          <indexterm zone="bluez btmon">
            <primary sortas="b-btmon">btmon</primary>
          </indexterm>
        </listitem>
      </varlistentry>


      <varlistentry id="hex2hcd">
        <term><command>hex2hcd</command></term>
        <listitem>
          <para>
            est utilisé pour convertir un fichier utilisé par les périphériques Broadcom
au format hcd (Broadcom bluetooth firmware)
          </para>
          <indexterm zone="bluez hex2hcd">
            <primary sortas="b-hex2hcd">hex2hcd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="l2ping">
        <term><command>l2ping</command></term>
        <listitem>
          <para>
            est utilisé pour envoyer des demandes d'écho L2CAP à l'adresse MAC Bluetooth
donné en notation hexadécimale
          </para>
          <indexterm zone="bluez l2ping">
            <primary sortas="b-l2ping">l2ping</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="l2test">
        <term><command>l2test</command></term>
        <listitem>
          <para>
            est le programme de tests de L2CAP
          </para>
          <indexterm zone="bluez l2test">
            <primary sortas="b-l2test">l2test</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rctest">
        <term><command>rctest</command></term>
        <listitem>
          <para>
            est utilisé pour tester les communications RFCOMM de la pile Bluetooth
          </para>
          <indexterm zone="bluez rctest">
            <primary sortas="b-rctest">rctest</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libbluetooth">
        <term><filename class="libraryfile">libbluetooth.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API de <application>BlueZ</application> 4
          </para>
          <indexterm zone="bluez libbluetooth">
            <primary sortas="c-libbluetooth">libbluetooth.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>

  </sect2>

</sect1>
