<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="ojdk-conf" xreflabel="Configuration de l'environnement JAVA">
  <?dbhtml filename="ojdk-conf.html"?>


  <title>Configuration de l'environnement JAVA</title>

  <sect2 id="java-profile">
    <title>Configuration de l'environnement</title>

    <para>
      Après que l'installation des paquets est terminée, l'étape suivante est
d'être certain que le système peut trouver proprement les fichiers. Si vous
initialisé vos scripts de login comme recommandé dans <xref
linkend="postlfs-config-profile"/>, mettez à jour l'environnement en créant
le script <filename>openjdk.sh</filename>, en tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt; /etc/profile.d/openjdk.sh &lt;&lt; "EOF"
<literal># Begin /etc/profile.d/openjdk.sh

# Set JAVA_HOME directory
JAVA_HOME=/opt/jdk

# Adjust PATH
pathappend $JAVA_HOME/bin

# Add to MANPATH
pathappend $JAVA_HOME/man MANPATH

# Auto Java CLASSPATH: Copy jar files to, or create symlinks in, the
# /usr/share/java directory.

AUTO_CLASSPATH_DIR=/usr/share/java

pathprepend . CLASSPATH

for dir in `find ${AUTO_CLASSPATH_DIR} -type d 2>/dev/null`; do
    pathappend $dir CLASSPATH
done

for jar in `find ${AUTO_CLASSPATH_DIR} -name "*.jar" 2>/dev/null`; do
    pathappend $jar CLASSPATH
done

export JAVA_HOME
unset AUTO_CLASSPATH_DIR dir jar

# End /etc/profile.d/openjdk.sh</literal>
EOF</userinput></screen>

    <para>
      Si vous avez installé <xref linkend="sudo"/>, le super utilisateur devrait
avoir accès aux variables sus-mentionnées. Exécutez les commandes suivantes
en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt; /etc/sudoers.d/java &lt;&lt; "EOF"
<literal>Defaults env_keep += JAVA_HOME
Defaults env_keep += CLASSPATH</literal>
EOF</userinput></screen>

    <para>
      Pour permettre à <command>mandb</command> d'inclure les pages de manuel
d'OpenJDK dans sa base de données, lancez en tant qu'utilisateur <systemitem
class="username">root </systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt;&gt; /etc/man_db.conf &lt;&lt; "EOF" &amp;&amp;
<literal># Begin Java addition
MANDATORY_MANPATH     /opt/jdk/man
MANPATH_MAP           /opt/jdk/bin     /opt/jdk/man
MANDB_MAP             /opt/jdk/man     /var/cache/man/jdk
# End Java addition</literal>
EOF

mkdir -p /var/cache/man &amp;&amp;
mandb -c /opt/jdk/man</userinput></screen>

  </sect2>

  <sect2 id="ojdk-certs" xreflabel="Installation des certificats d'autorités de certification pour la JVM">

    <title>Configuration des certificats d'autorités de certification pour Java</title>

    <para>
      <application>OpenJDK</application> utilise son propre format pour les
certificats de CA. Les modules de sécurité de Java utilisent
<envar>$JAVA_HOME</envar><filename>/lib/security/cacerts</filename> par
défaut. Pour garder les certificats à un seul endroit, nous utilisons
<filename>/etc/ssl/java/cacerts</filename>. Les instruction de la page <xref
linkend="make-ca"/> ont créé le fichier situé dans <filename
class="directory">/etc/ssl/java</filename>. Installez un lien symbolique à
l'emplacement par défaut en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ln -sfv /etc/pki/tls/java/cacerts /opt/jdk/lib/security/cacerts</userinput></screen>

    <para>
      Utilisez les commandes suivantes pour vérifier si le fichier
<filename>cacerts</filename> a bien été installé&nbsp;:
    </para>

<screen role="root"><userinput>/opt/jdk/bin/keytool -list -cacerts</userinput></screen>

    <para>
      Lorsqu'on vous demande <computeroutput>Enter keystore
password:</computeroutput>, entrez <userinput>changeit</userinput> (la
valeur par défaut) ou appuyez simplement sur <quote>entrée</quote>. Si le
fichier <filename>cacerts</filename> est correctement installé, vous verrez
une liste des certificats avec les informations relatives à chacun. Sinon,
vous devez les réinstaller.
    </para>

    <para>
      Si vous installez plus tard une nouvelle JVM, vous devrez seulement créer le
lien symbolique à l'emplacement par défaut pour pouvoir utiliser les
cacerts.
    </para>

  </sect2>

</sect1>
