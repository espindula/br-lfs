<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY lua-download-http "https://www.lua.org/ftp/lua-&lua52-version;.tar.gz">
  <!ENTITY lua-download-ftp  "">
  <!ENTITY lua-md5sum        "913fdb32207046b273fdb17aad70be13">
  <!ENTITY lua-size          "248 Ko">
  <!ENTITY lua-buildsize     "3.6 Mo">
  <!ENTITY lua-time          "moins de 0.1 SBU">
]>

<sect1 id="lua52" xreflabel="Lua-&lua52-version;">
  <?dbhtml filename="lua52.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Lua-&lua52-version;</title>

  <indexterm zone="lua52">
    <primary sortas="a-Lua">Lua</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Lua 5.2</title>

    <para>
      <application>Lua</application> est un langage de programmation puissant et
assez léger conçu pour les extensions d'applications. Il est aussi souvent
utilisé de façon plus générale en langage utilisé
seul. <application>Lua</application> est implémenté comme une petite
bibliothèque de fonction C, écrite en C ANSI, et compilé sans modification
sur toutes les plate-formes connues. Les buts de l'implémentation sont
simplicité, efficacité, portabilité, et coût d'embarquement faible. Le
résultat est un moteur de langage rapide avec de petites empreinte, le
rendant idéal pour les systèmes embarqués.
    </para>

    <para>
      C'est une ancienne version de <application>Lua</application> requise
uniquement pour la compatibilité avec d'autres programmes comme <xref
linkend='wireshark'/>.
    </para>

    &lfs101_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&lua-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&lua-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &lua-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &lua-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &lua-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &lua-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink
url="&patch-root;/lua-&lua52-version;-shared_library-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/lua"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Lua 5.2</title>

    <para>
      Certains paquets cherchent le fichier <application>pkg-config</application>
de <application>Lua</application>, qui est créé avec&nbsp;:
    </para>

<screen><userinput>cat &gt; lua.pc &lt;&lt; "EOF"
<literal>V=5.2
R=&lua52-version;

prefix=/usr
INSTALL_BIN=${prefix}/bin
INSTALL_INC=${prefix}/include/lua5.2
INSTALL_LIB=${prefix}/lib
INSTALL_MAN=${prefix}/share/man/man1
INSTALL_LMOD=${prefix}/share/lua/${V}
INSTALL_CMOD=${prefix}/lib/lua/${V}
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include/lua5.2

Name: Lua
Description: An Extensible Extension Language
Version: ${R}
Requires:
Libs: -L${libdir} -llua -lm -ldl
Cflags: -I${includedir}</literal>
EOF</userinput></screen>

    <para>
      Installez <application>Lua</application> en lançant les commandes
suivantes&nbsp;:
    </para>

<!--
    <para>

      To test the results, issue: <command>make test</command>.
      <quote>This will run the interpreter and print its version.</quote>.
      More comprehensive tests can be performed if you downloaded the "Test
      suite" tarball. Those tests need to be executed after the package is
      installed, thus we defer to the description below.
    </para>
-->
<screen><userinput>patch -Np1 -i ../lua-&lua52-version;-shared_library-1.patch &amp;&amp;

sed -i '/#define LUA_ROOT/s:/usr/local/:/usr/:' src/luaconf.h &amp;&amp;

sed -r -e '/^LUA_(SO|A|T)=/ s/lua/lua5.2/' \
       -e '/^LUAC_T=/ s/luac/luac5.2/'     \
       -i src/Makefile &amp;&amp;

make MYCFLAGS="-fPIC" linux</userinput></screen>

    <para>
      L'installation de ce paquet est complexe, donc nous utiliserons la méthode
d'installation DESTDIR&nbsp;:
    </para>

<screen><userinput>make TO_BIN='lua5.2 luac5.2'                     \
     TO_LIB="liblua5.2.so liblua5.2.so.5.2 liblua5.2.so.&lua52-version;" \
     INSTALL_DATA="cp -d"                        \
     INSTALL_TOP=$PWD/install/usr                \
     INSTALL_INC=$PWD/install/usr/include/lua5.2 \
     INSTALL_MAN=$PWD/install/usr/share/man/man1 \
     install &amp;&amp;

install -Dm644 lua.pc install/usr/lib/pkgconfig/lua52.pc &amp;&amp;

mkdir -pv install/usr/share/doc/lua-&lua52-version; &amp;&amp;
cp -v doc/*.{html,css,gif,png} install/usr/share/doc/lua-&lua52-version; &amp;&amp;

ln -s liblua5.2.so install/usr/lib/liblua.so.5.2   &amp;&amp;
ln -s liblua5.2.so install/usr/lib/liblua.so.&lua52-version; &amp;&amp;

mv install/usr/share/man/man1/{lua.1,lua5.2.1} &amp;&amp;
mv install/usr/share/man/man1/{luac.1,luac5.2.1}</userinput></screen>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>chown -R root:root install  &amp;&amp;
cp -a install/* /</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>sed -i ... src/luaconf.h</command>&nbsp;: Cette commande change le
chemin de recherche de <application>Lua</application> pour correspondre au
répertoire d'installation.
    </para>

    <para>
      <command>sed -i ... src/Makefile</command>&nbsp;: Cette commande supprime le
conflit entre cette installation et la dernière version de lua.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          lua5.2 et luac5.2
        </seg>
        <seg>
          liblua5.2.so
        </seg>
        <seg>
          /usr/include/lua5.2, /usr/lib/lua/5.2, /usr/share/doc/lua-&lua52-version; et
/usr/share/lua/5.2
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="lua52-prog">
        <term><command>lua5.2</command></term>
        <listitem>
          <para>
            est l'interpréteur Lua 5.2 indépendant
          </para>
          <indexterm zone="lua52 lua-prog">
            <primary sortas="b-lua52">lua5.2</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="luac52">
        <term><command>luac5.2</command></term>
        <listitem>
          <para>
            est le compilateur Lua 5.2
          </para>
          <indexterm zone="lua52 luac52">
            <primary sortas="b-luac52">luac5.2</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="liblua52">
        <term><filename class="libraryfile">liblua5.2.so</filename></term>
        <listitem>
          <para>
            contient les fonction de l'API 5.2 de <application>Lua</application>
          </para>
          <indexterm zone="lua52 liblua52">
            <primary sortas="c-liblua52">liblua5.2.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
