<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY mercurial-download-http "https://www.mercurial-scm.org/release/mercurial-&mercurial-version;.tar.gz">
  <!ENTITY mercurial-download-ftp  "">
  <!ENTITY mercurial-md5sum        "57f92c00de07b902a21fd975adbfbecc">
  <!ENTITY mercurial-size          "7.7&nbsp;Mo">
  <!ENTITY mercurial-buildsize     "105 MB (with docs, add 1.8 GB for tests)">
  <!ENTITY mercurial-time          "0.7 SBU (with docs, add 28 SBU for tests using -j4)">
]>

<sect1 id="mercurial" xreflabel="Mercurial-&mercurial-version;">
  <?dbhtml filename="mercurial.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Mercurial-&mercurial-version;</title>

  <indexterm zone="mercurial">
    <primary sortas="a-mercurial">mercurial</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Mercurial</title>

    <para>
      <application>Mercurial</application> est un outil de gestion de contrôle des
sources distribuée similaire à <application>Git</application> et
<application>Bazaar</application>. <application>Mercurial</application> est
écrit en <application>Python</application> et il est utilisé par des projets
tels que Mozilla pour Firefox et Thunderbird.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&mercurial-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&mercurial-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &mercurial-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &mercurial-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &mercurial-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &mercurial-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Mercurial</bridgehead>

    

    <!--
    <bridgehead renderas="sect4">
Required</bridgehead>
    <para role="required">
      <xref linkend="python2"/>
    </para>
    -->
<bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
    <xref linkend="docutils"/> (requis pour construire la documentation), <xref
linkend="git"/>, <xref linkend="gpgme"/> (avec les liaisons Python), <xref
role="runtime" linkend="openssh"/> (exécution, pour accéder aux dépôts
ssh://...), <xref linkend="pygments"/>, <xref linkend="rust"/> (voir
<filename>rust/README.rst</filename> et
<filename>rust/rhg/README.md</filename>), <xref linkend="subversion"/> (avec
les liaisons Python), <ulink url="https://launchpad.net/bzr">Bazaar</ulink>,
<ulink url="http://www.nongnu.org/cvs/">CVS</ulink>, <ulink
url="https://pypi.python.org/pypi/pyflakes">pyflakes</ulink>, <ulink
url="https://www.pyopenssl.org/en/stable/">pyOpenSSL</ulink> et <ulink
url="https://github.com/google/re2/">re2</ulink>

    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/mercurial"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Mercurial</title>
    

    <!-- Rust port is now part of the standard tests -->
<para>
      Construisez <application>Mercurial</application> en exécutant la commande
suivante&nbsp;:
    </para>

<screen><userinput>make build</userinput></screen>

    <para>
      Pour construire la documentation (exige <xref linkend="docutils"/>),
lancez&nbsp;:
    </para>

<screen remap="doc"><userinput>make doc</userinput></screen>

    <para>
      To run the test suite, issue (8 tests are known to fail):
    </para>
<!-- The blacklists have to be checked every release of Mercurial, do a listing
     of tests/blacklists, but do not include the README. -->
<screen remap="test"><userinput>TESTFLAGS="-j<replaceable>&lt;N&gt;</replaceable> --tmpdir tmp --blacklist blacklists/fsmonitor --blacklist blacklists/linux-vfat" make check</userinput></screen>


    <para>
      où <replaceable>&lt;N&gt;</replaceable> est un nombre entier entre un et le
nombre de (cœurs × threads) inclus. Afin de pouvoir investiguer un test
échouant en particulier, utilisez le script
<command>run-tests.py</command>. Pour voir les presque quarante options,
dont certaines très utiles, lancez <command>tests/run-tests.py
--help</command>. Avec la commande suivante, vous exécuterez seulement les
tests précédemment échoués&nbsp;:
    </para>

<screen remap="test"><userinput>pushd tests  &amp;&amp;
  rm -rf tmp &amp;&amp;
  ./run-tests.py --tmpdir tmp test-gpg.t
popd</userinput></screen>

    <para>
      Normally, the previous failures will be reproducible. However, if you add
the switch <option>--debug</option> before <option>--tmpdir</option>, and
run the tests again, some failures may disappear, which is a problem with
the test suite. If this happens, there will be no more of these failures
even if you do not pass the --debug switch again.
    </para>

    <para>
      An interesting switch is <option>--time</option>, which will generate a
table of all the executed tests and their respective start, end, user,
system and real times once the tests are complete. Note that these switches
may be used with <command>make check</command> by including them in the
<envar>TESTFLAGS</envar> environment variable.
    </para>

    <para>
      Installez <application>Mercurial</application> en exécutant les commandes
suivantes (en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
    </para>

<screen role="root"><userinput>make PREFIX=/usr install-bin</userinput></screen>

    <para>
      Si vous avez construit la documentation, installez-la en exécutant la
commande suivante (en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
    </para>

<screen role="root"
        remap="doc"><userinput>make PREFIX=/usr install-doc</userinput></screen>

    <para>
      Après l'installation, vous devriez pouvoir correctement lancer deux tests
très rapides et simples. Le premier demande un peu de configuration&nbsp;:
    </para>

<screen><userinput>cat &gt;&gt; ~/.hgrc &lt;&lt; "EOF"
<literal>[ui]
username = <replaceable>&lt;user_name&gt; &lt;user@mail&gt;</replaceable></literal>
EOF</userinput></screen>

    <para>
      où vous devez remplacer &lt;user_name&gt; et &lt;your@mail&gt; (mail est
facultatif et peut être omis). Une fois l'identité de l'utilisateur définie,
lancez <command>hg debuginstall</command> et quelques lignes seront
affichées, la dernière affichant «&nbsp;no problems detected&nbsp;». Un
autre test rapide et simple est juste <command>hg</command>, qui doit
afficher les commandes basiques qui peuvent être utilisée avec
<command>hg</command>.
    </para>

  </sect2>



  <!--
  <sect2 role="commands">

    <title>Command Explanations</title>

      <para>
        <command>2to3 -w doc/hgmanpage.py</command>: Since <application>
        Python 3</application> is used with docutils, one file needs to be
        converted in order to be compatible.
      </para>

   </sect2>
-->
<sect2 role="configuration">
    <title>Configuration de Mercurial</title>

    <sect3 id="mercurial-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/mercurial/hgrc</filename> et <filename>~/.hgrc</filename>
      </para>

      <indexterm zone="mercurial mercurial-config">
        <primary sortas="e-etc-mercurial-hgrc">/etc/mercurial/hgrc</primary>
      </indexterm>

      <indexterm zone="mercurial mercurial-config">
        <primary sortas="e-AA.hgrc">~/.hgrc</primary>
      </indexterm>

      <para>
        The great majority of extensions are disabled by default. Run <command>hg
help extensions</command> if you need to enable any, e.g.  when
investigating test failures. This will output a list of enabled and disabled
extensions, as well as more information such as how to enable or disable
extensions using configuration files.
      </para>

      <para>
        Si vous avez installé les <xref linkend="make-ca"/> et que vous souhaitez
que <application>Mercurial</application> les utilise, lancez, en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>install -v -d -m755 /etc/mercurial &amp;&amp;
cat &gt; /etc/mercurial/hgrc &lt;&lt; "EOF"
<literal>[web]
cacerts = /etc/pki/tls/certs/ca-bundle.crt</literal>
EOF</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          hg
        </seg>
        <seg>
          plusieurs modules internes dans
/usr/lib/python&python3-majorver;/site-packages/mercurial
        </seg>
        <seg>
          /etc/mercurial et
/usr/lib/python&python3-majorver;/site-packages/{hgdemandimport,hgext,hgext3rd,mercurial}
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="hg">
        <term><command>hg</command></term>
        <listitem>
          <para>
            est le système de contrôle de version mercurial
          </para>
          <indexterm zone="mercurial hg">
            <primary sortas="b-hg">hg</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
