<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY gdb-download-http "&gnu-http;/gdb/gdb-&gdb-version;.tar.xz">
  <!ENTITY gdb-download-ftp  "&gnu-ftp;/gdb/gdb-&gdb-version;.tar.xz">
  <!ENTITY gdb-md5sum        "fbd3cdae16c581e8a742cb766ba35076">
  <!ENTITY gdb-size          "23&nbsp;Mo">
  <!ENTITY gdb-buildsize     "914&nbsp;Mo (plus 805&nbsp;Mo pour la doc, plus 575&nbsp;Mo pour les tests)">
  <!ENTITY gdb-time          "2,1&nbsp;SBU (plus 0,4&nbsp;SBU pour la doc et 18&nbsp;SBU pour les tests,
le tout avec parallélisme = 4)">
]>

<sect1 id="gdb" xreflabel="GDB-&gdb-version;">
  <?dbhtml filename="gdb.html"?>


  <title>GDB-&gdb-version;</title>

  <indexterm zone="gdb">
    <primary sortas="a-GDB">GDB</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à GDB</title>

    <para>
      <application>GDB</application>, le débogueur du projet GNU, permet de voir
ce qu'il se passe <quote>à l'intérieur</quote> d'un autre programme, pendant
qu'il s'exécute &mdash;&nbsp;ou ce que faisait un autre programme au moment
où il a planté. Notez que <application>GDB</application> est plus performant
quand les programmes et les bibliothèques tracées sont construits avec les
symboles de débogage et qu'ils n'ont pas été nettoyés.
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&gdb-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&gdb-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &gdb-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &gdb-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &gdb-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &gdb-time;
        </para>
      </listitem>
    </itemizedlist>
    
    <!--
    <bridgehead renderas="sect3">
Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/gdb-&gdb-version;-upstream_fixes-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
    -->
<bridgehead renderas="sect3">Dépendances de GDB</bridgehead>

    <bridgehead renderas="sect4">Dépendance recommandée à l'exécution</bridgehead>
    <para role="recommended">
      <xref linkend="six"/> (module Python 3, requis à l'exécution pour utiliser
des scripts GDB de divers paquets de LFS et BLFS avec le Python 3 installé
dans LFS)
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <!-- don't advertise python2...
      <xref linkend="python2"/>,-->
<xref linkend="doxygen"/>, <xref linkend="gcc"/> (ada, gfortran et go sont
utilisés pour certains tests), <xref linkend="guile"/>, <xref
linkend="rust"/> (utilisé par certains tests), <xref linkend="valgrind"/> et
<ulink url="https://sourceware.org/systemtap/">SystemTap</ulink> (dépendance
d'exécution, utilisé pour les tests)
    </para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de GDB</title>
    
    <!--
    <para>

      First, apply a patch that fixes problems when debugging programs compiled
      with <xref linkend="rust" role="nodep"/>:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../gdb-&gdb-version;-upstream_fixes-1.patch</userinput></screen>
-->
<para>
      Installez <application>GDB</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

../configure --prefix=/usr          \
             --with-system-readline \
             --with-python=/usr/bin/python3 &amp;&amp;
make</userinput></screen>

    <para>
      Éventuellement, pour construire la documentation de l'API en utilisant <xref
linkend="doxygen"/>, lancez&nbsp;:
    </para>

<screen remap="doc"><userinput>make -C gdb/doc doxy</userinput></screen>

    <para>
      Pour tester les résultats exécutez&nbsp;:
    </para>

<screen remap="test"><userinput>pushd gdb/testsuite &amp;&amp;
make  site.exp      &amp;&amp;
echo  "set gdb_test_timeout 120" &gt;&gt; site.exp &amp;&amp;
runtest
popd</userinput></screen>

    <para>
      Voir <emphasis>gdb/testsuite/README</emphasis> et <ulink
url="https://sourceware.org/gdb/wiki/TestingGDB">TestingGDB</ulink>. Il y a
plein de problème avec la suite de tests&nbsp;:
    </para>

    <itemizedlist>
      <listitem>
        <para>
          Des répertoires propres sont requis si vous relancez les tests. Pour cette
raison, il est recommandé de créer une copie du répertoire des codes sources
compilés avant les tests au cas où vous devriez relancer les tests.
        </para>
      </listitem>

      <listitem>
        <para>
          Les résultats dépendent des compilateurs installés.
        </para>
      </listitem>



      <!-- I did not see this
      <listitem>

        <para>
          There are a large number of timeouts (there is a variable
          that can be set to increase time for timeout, but
          changing it will result in a different number of tests being
          run).
        </para>
      </listitem>
or this
      <listitem>
        <para>
          There are failures associated with system readline 6.x.
        </para>
      </listitem>
-->
<!--
      <listitem>

        <para>
          A few tests assume that the header file
          <filename>&lt;sys/sdt.h&gt;</filename>, part of <ulink
          url="https://sourceware.org/systemtap/">SystemTap</ulink>, is
          present.
        </para>
      </listitem>
-->
<!-- I don't know if this is true or not.  I tested on a Haswell.
      <listitem>

        <para>
          If the test suite is run on a Skylake-based Intel CPU or newer,
          many tests will fail due to the removal of the deprecated/problematic
          libmpx library in GCC.
        </para>
      </listitem>
-->
<listitem>
        <para>




          <!-- for gdb-11.1, gcc-11.2 - pierre
          A test run of the test suite had about 1700 unexpected failures
          (out of over 80000 tests). Over 1370 of the failures were related
          to FORTRAN tests. -->
<!-- for gdb-12.1, gcc-11.3.0 - bdubbs
          A test run of the test suite had a little over 200 unexpected failures
          out of over 94000 tests.-->
<!-- for gdb-13.0, gcc-12.2.0 - bdubbs
          A test run of the test suite had 33 unexpected failures
          out of over 106000 tests. -->
<!-- for gdb-13.2, gcc-13.1.0 - pierre -->
Une tentative de lancer la suite de tests a eu 183 échecs inattendus sur
plus de 105&nbsp;000 tests.
        </para>
      </listitem>

      <listitem>
        <para>
          Sur certains systèmes, la suite de tests gdb.tui échouera si elle est lancée
via SSH.
        </para>
      </listitem>

      <listitem>
        <para>
          Sur certains systèmes AMD, plus de 200 tests supplémentaires ont échoués à
cause d'une différence dans l'implémentation du parallélisme sur ces CPU.
        </para>
      </listitem>

    </itemizedlist>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make -C gdb install &amp;&amp;
make -C gdbserver install</userinput></screen>

    <para>
      Si vous avez construit la documentation de l'API, c'est maintenant dans
gdb/doc/doxy. Vous pouvez l'installer (en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
    </para>

<screen role="root"
        remap="doc"><userinput>install -d /usr/share/doc/gdb-&gdb-version; &amp;&amp;
rm -rf gdb/doc/doxy/xml &amp;&amp;
cp -Rv gdb/doc/doxy /usr/share/doc/gdb-&gdb-version;</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--with-system-readline</parameter>&nbsp;: Ce paramètre force
<application>GDB</application> a utiliser la copie de
<application>Readline</application> installée dans LFS.
    </para>

    <para>
      <!-- We don't advise to use python2 anymore
      Remove this switch if you have installed
      <xref linkend="python2"/>
 and want to use it instead of Python 3.-->
<parameter>--with-python=/usr/bin/python3</parameter>&nbsp;: ce paramètre
force <application>GDB</application> à utiliser Python 3.
      
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          gcore, gdb, gdbserver, and gdb-add-index
        </seg>
        <seg>
          libinproctrace.so
        </seg>
        <seg>
          /usr/{include,share}/gdb and /usr/share/doc/gdb-&gdb-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="gcore">
        <term><command>gcore</command></term>
        <listitem>
          <para>
            génère un «&nbsp;core dump&nbsp;» d'un programme en cours d'exécution
          </para>
          <indexterm zone="gdb gcore">
            <primary sortas="b-gcore">gcore</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="gdb-prog">
        <term><command>gdb</command></term>
        <listitem>
          <para>
            est le débogueur GNU
          </para>
          <indexterm zone="gdb gdb-prog">
            <primary sortas="b-gdb-prog">gdb-prog</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="gdbserver">
        <term><command>gdbserver</command></term>
        <listitem>
          <para>
            est un serveur distant pour le débogueur GNU (il permet de déboguer des
programmes depuis une autre machine)
          </para>
          <indexterm zone="gdb gdbserver">
            <primary sortas="b-gdbserver">gdbserver</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="gdb-add-index">
        <term><command>gdb-add-index</command></term>
        <listitem>
          <para>
            Allows adding index files to ELF binaries. This speeds up
<command>gdb</command> start on large programs.
          </para>
          <indexterm zone="gdb gdb-add-index">
            <primary sortas="b-gdb-add-index">gdb-add-index</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libinproctrace">
        <term><filename class="libraryfile">libinproctrace.so</filename></term>
        <listitem>
          <para>
            contient les fonctions pour l'agent de traçage dans les processus. L'agent
autorise l'installation rapide de balises, le listage des marqueurs
statiques de balises, et le démarrage de la surveillance.
          </para>
          <indexterm zone="gdb libinproctrace">
            <primary sortas="c-libinproctrace">libinproctrace.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
