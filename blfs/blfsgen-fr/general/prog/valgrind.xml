<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY valgrind-download-http "https://sourceware.org/pub/valgrind/valgrind-&valgrind-version;.tar.bz2">
  <!ENTITY valgrind-download-ftp  "ftp://sourceware.org/pub/valgrind/valgrind-&valgrind-version;.tar.bz2">
  <!ENTITY valgrind-md5sum        "de56a5532b0c81781db677ca712c585a">
  <!ENTITY valgrind-size          "15&nbsp;Mo">
  <!ENTITY valgrind-buildsize     "550&nbsp;Mo (plus 62&nbsp;Mo pour les tests)">
  <!ENTITY valgrind-time          "0.5 SBU (Using parallelism=4; add 7.5 SBU for tests)">
]>

<sect1 id="valgrind" xreflabel="Valgrind-&valgrind-version;">
  <?dbhtml filename="valgrind.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Valgrind-&valgrind-version;</title>

  <indexterm zone="valgrind">
    <primary sortas="a-Valgrind">Valgrind</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Valgrind</title>

    <para>
      <application>Valgrind</application> est une boite à outils d'instrumentation
pour construire des outils d'analyses dynamiques. Il y a les outils de
Valgrind qui peuvent automatiquement détecter plusieurs bogues de gestion de
mémoires et de threading, et des programmes de profilages en
détail. Valgrind peut également être utilisé pour construire de nouveaux
outils.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&valgrind-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&valgrind-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &valgrind-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &valgrind-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &valgrind-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &valgrind-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink
url="&patch-root;/valgrind-&valgrind-version;-upstream_fixes-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Valgrind</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="gdb"/> (pour les tests), <xref linkend="llvm"/> (avec Clang),
et <xref linkend="which"/> (pour les tests)
    </para>


    <!-- See "maintainer note", below
    <bridgehead renderas="sect4">
Optional for regenerating the documentation</bridgehead>
    <para role="optional">
      <xref linkend="libxslt"/> and
      <xref linkend="texlive"/> (or <xref linkend="tl-installer"/>)
    </para>
-->
<para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/valgrind"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Valgrind</title>

    <para>
      First, make several changes that are required for Valgrind to function on
systems with glibc-2.35 installed:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../valgrind-&valgrind-version;-upstream_fixes-1.patch</userinput></screen>


    <para>
      Installez <application>Valgrind</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>sed -i 's|/doc/valgrind||' docs/Makefile.in &amp;&amp;

./configure --prefix=/usr \
            --datadir=/usr/share/doc/valgrind-&valgrind-version; &amp;&amp;
make</userinput></screen>

    <para>
      To test the results, issue: <command>make regtest</command>. The tests may
hang forever if <xref linkend="gdb"/> is not installed. Some tests are known
to hang also, depending on the version of glibc. A few test can fail in
various suites. Problematic tests can be disabled by changing the
<userinput>prereq:</userinput> line in the corresponding
<filename>.vgtest</filename> file to <userinput>prereq:
false</userinput>. For example:
    </para>

<screen role="nodump"><userinput>sed -e 's@prereq:.*@prereq: false@' \
    -i {helgrind,drd}/tests/pth_cond_destroy_busy.vgtest</userinput></screen>

    <note>
      <para>
        Les tests <application>OpenMP</application> sont ignorés si libgomp a été
compilé avec <option>--enable-linux-futex</option> (valeur par défaut). Si
besoin, recompilez simplement libgomp depuis l'arborescence de construction
de gcc, en passant <option>--disable-linux-futex</option> au script
configure, en enregistrant la bibliothèque ailleurs et en changeant le lien
de <filename>/usr/lib/libgomp.so.1</filename> vers la nouvelle bibliothèque.
      </para>
    </note>



    <!--  Note to maintainer: there is a long thread in ticket #5882 explaining
      why we do not provide instructions to rebuild the documentation.
      (still broken with TeXLive 2016) -->
<para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>sed -i ... docs/Makefile.in </command>&nbsp;: Ce sed permet
d'installer la documentation dans un répertoire versionné.
    </para>

    <para>
      <option>--enable-lto=yes</option>&nbsp;: Cette option permet de construire
Valgrind avec LTO (optimisation à l'édition de liens). Cela produit un
Valgrind plus petit et plus rapide (jusqu'à 10&nbsp;%) mais le temps de
construction augmente à 5.5 SBU.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          callgrind_annotate, callgrind_control, cg_annotate, cg_diff, cg_merge,
ms_print, valgrind, valgrind-di-server, valgrind-listener et vgdb
        </seg>
        <seg>
          None
        </seg>
        <seg>
          /usr/lib/valgrind, /usr/libexec/valgrind, /usr/include/valgrind et
/usr/share/doc/valgrind-&valgrind-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="valgrind-prog">
        <term><command>valgrind</command></term>
        <listitem>
          <para>
            est un programme pour déboguer et profiler les exécutables Linux
          </para>
          <indexterm zone="valgrind valgrind-prog">
            <primary sortas="b-valgrind">valgrind</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="callgrind_annotate">
        <term><command>callgrind_annotate</command></term>
        <listitem>
          <para>
            prend en entré le fichier de sortie produit par l'outil Callgrind de
<application>Valgrind</application> et affiche les informations dans une
forme facile à lire
          </para>
          <indexterm zone="valgrind callgrind_annotate">
            <primary sortas="b-callgrind_annotate">callgrind_annotate</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="callgrind_control">
        <term><command>callgrind_control</command></term>
        <listitem>
          <para>
            contrôle les programmes en train d'être lancés par l'outil Callgrind de
<application>Valgrind</application>
          </para>
          <indexterm zone="valgrind callgrind_control">
            <primary sortas="b-callgrind_control">callgrind_control</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="cg_annotate">
        <term><command>cg_annotate</command></term>
        <listitem>
          <para>
            est un outil de post-traitement pour l'outil Cachegrind de
<application>Valgrind</application>
          </para>
          <indexterm zone="valgrind cg_annotate">
            <primary sortas="b-cg_annotate">cg_annotate</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="cg_diff">
        <term><command>cg_diff</command></term>
        <listitem>
          <para>
            compare deux fichiers de sortie de Cachegrind
          </para>
          <indexterm zone="valgrind cg_diff">
            <primary sortas="b-cg_diff">cg_diff</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="cg_merge">
        <term><command>cg_merge</command></term>
        <listitem>
          <para>
            fusionne plusieurs fichiers de sortie de Cachegrind en un
          </para>
          <indexterm zone="valgrind cg_merge">
            <primary sortas="b-cg_merge">cg_merge</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="ms_print">
        <term><command>ms_print</command></term>
        <listitem>
          <para>
            prend un fichier de sortie produit par l'outil Massif de
<application>Valgrind</application> et affiche les informations dans une
forme facile à lire
          </para>
          <indexterm zone="valgrind ms_print">
            <primary sortas="b-ms_print">ms_print</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="valgrind-di-server">
        <term><command>valgrind-di-server</command></term>
        <listitem>
          <para>
            est un serveur qui lit les informations de débogage des objets stockés sur
un machine différente
          </para>
          <indexterm zone="valgrind valgrind-di-server">
            <primary sortas="b-valgrind-di-server">valgrind-di-server</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="valgrind-listener">
        <term><command>valgrind-listener</command></term>
        <listitem>
          <para>
            écoute les commentaires de Valgrind sur un socket
          </para>
          <indexterm zone="valgrind valgrind-listener">
            <primary sortas="b-valgrind-listener">valgrind-listener</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vgdb">
        <term><command>vgdb</command></term>
        <listitem>
          <para>
            est un intermédiaire entre Valgrind et GDB ou un shell
          </para>
          <indexterm zone="valgrind vgdb">
            <primary sortas="b-vgdb">vgdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
