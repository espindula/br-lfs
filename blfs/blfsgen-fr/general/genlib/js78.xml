<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

<!-- for when firefox and js78 use same version
  <!ENTITY ff78-version       "&firefox-version;">
  and when they are on different versions - keep this for when
  we have moved to next firefox-esr (ff-91) and JS  has not moved 
  <!ENTITY ff78-version       "&JS78-version;"> -->

  <!ENTITY ff78-version       "&firefox-version;">
  <!ENTITY js78-download-http "&mozilla-http;/firefox/releases/&ff78-version;esr/source/firefox-&ff78-version;esr.source.tar.xz">
  <!ENTITY js78-download-ftp  "">
  <!ENTITY js78-md5sum        "b81fc212639eab6a20c0a262e2eee302">
  <!ENTITY js78-size          "320&nbsp;Mo">
  <!ENTITY js78-buildsize     "3.0 GB (36 MB installed after removing 34MB static lib)">
  <!ENTITY js78-time          "2.5 SBU (on a 4-core machine)">
]>

<sect1 id="js78" xreflabel="js78-&ff78-version;">
  <?dbhtml filename="js78.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>JS-&ff78-version;</title>

  <indexterm zone="js78">
    <primary sortas="a-js78">js78</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à JS</title>

    <para>
      <application>JS</application> est le moteur JavaScript de Mozilla écrit en
C. JS78 provient de Firefox.
    </para>

    &lfs101_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&js78-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&js78-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &js78-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &js78-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &js78-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &js78-time;
        </para>
      </listitem>
    </itemizedlist>

    <!--	
    <bridgehead renderas="sect3">
Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/js78-code_coverage-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
-->
<bridgehead renderas="sect3">Dépendances de JS78</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <!-- Should we list llvm here? -->
<xref linkend="autoconf213"/>, <xref linkend="icu"/>, <xref linkend="rust"/>
et <xref linkend="which"/>
      
    </para>

    
    

    <!-- It seems nasm is only used for aarch64-win64. -->
<!--bridgehead renderas="sect4">
Optional</bridgehead>
    <para role="optional">
      <xref linkend="nasm"/>
    </para-->
<para condition="html" role="usernotes">
      Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/js78"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de JS</title>

    <note>
      <para>
        Contrairement à la plupart des autres paquets dans BLFS, les instructions
ci-dessous requièrent que vous décompressiez
<filename>firefox-&JS78-version;esr.tar.xz</filename> et entriez dans le
répertoire <filename>firefox-&JS78-version;</filename>.
      </para>

      <para>
        L'extraction de l'archive remettra les permissions du répertoire actuel à
0755 si vous avez les permissions nécessaires pour cela. Si vous faites cela
dans un répertoire avec le bit sticky, comme <filename
class="directory">/tmp</filename>, le processus terminera avec des messages
d'erreur&nbsp;:
      </para>

<literallayout>tar: .: Cannot utime: Operation not permitted
tar: .: Cannot change mode to rwxr-xr-t: Operation not permitted
tar: Exiting with failure status due to previous errors
</literallayout>

      <para>
        Cela termine avec un statut différent de zéro, mais ne signifie
<emphasis>PAS</emphasis> qu'il y a un vrai problème. Ne désarchivez pas en
tant qu'utilisateur <systemitem class="username">root</systemitem> das un
répertoire où le bit sticky est présent, cela le désactiverait.
      </para>

    </note>


    <!-- It's merged in 78.2.0.
    <para>
      Apply a patch required by <xref linkend="gjs"/>:
    </para>

<screen><userinput>patch -Np1 -i ../js78-code_coverage-1.patch</userinput></screen>
-->
<para>
      Installez <application>JS</application> en lançant les commandes
suivantes&nbsp;:
    </para>

     <note>
        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
         href="../../xincludes/mozshm.xml"/>

        <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
         href="../../xincludes/mozconfigure.xml"/>
     </note>


<screen><userinput>mkdir obj &amp;&amp;
cd    obj &amp;&amp;

CC=gcc CXX=g++ \
../js/src/configure --prefix=/usr            \
                    --with-intl-api          \
                    --with-system-zlib       \
                    --with-system-icu        \
                    --disable-jemalloc       \
                    --disable-debug-symbols  \
                    --enable-readline        &amp;&amp;
make</userinput></screen>

    <para>
      <!-- recheck when ICU gets upgraded -->
<!-- ken: removed "are known to fail' becasue there are
       4096 known failures, these icu items are unexpected failures
       and I found the wording confusing  -->
<!-- ken : For 78.4 this was 14 failures, I changed it to 10 for 78.5.
      On that machine with 78.6 still 10, but on another 14, both with similar
      setup and locale. -->
Pour lancer la suite de tests de JS, lancez&nbsp;: <command>make -C js/src
check-jstests JSTESTS_EXTRA_ARGS="--timeout 300
--wpt=disabled"</command>. Il est recommandé de rediriger la sortie vers un
fichier journal. En fonction de la machine, entre dix et quatorze tests de
JS liés aux paramètres régionaux et aux fuseaux horaires échouent à cause
d'un problème dans <xref linkend="icu"/>. Pour lancer la suite de tests du
JIT, lancez&nbsp;: <command>make -C js/src check-jit-test
JITTEST_EXTRA_ARGS="--timeout 300"</command>. De nouveau, quelques tests
peuvent avoir des échecs imprévus.
    </para>

    <caution>
      <para>
        Un problème avec le processus d'installation fait que les programmes qui se
lient à la bibliothèque partagée JS78 (par exemple, GNOME Shell) crashent si
JS78 est mis à jour ou réinstallé. Pour contourner le problème, supprimez
l'ancienne version de la bibliothèque partagée JS78 avant
l'installation&nbsp;:
      </para>

<screen role="root"><userinput>rm -fv /usr/lib/libmozjs-78.so</userinput></screen>
    </caution>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
rm -v /usr/lib/libjs_static.ajs &amp;&amp;
sed -i '/@NSPR_CFLAGS@/d' /usr/bin/js78-config</userinput></screen>

  </sect2>

  

  <!-- Several gjs-1.65.90 tests fail with js78.  Not sure why.
       OTOH an "otherwise" GNOME-3.36 environment works fine. -->
<sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <envar>CC=gcc CXX=g++</envar>&nbsp;: les développeurs en amont préfèrent
maintenant <application>clang</application>, corrigez cela comme avec les
autres paquets de Mozilla dans le livre BLFS.
    </para>

    <para>
      <parameter>--with-*</parameter>&nbsp;: ces paramètres permettent au système
de construction d'utiliser les versions du système des bibliothèques
ci-dessus. Ils sont requis pour la stabilité.
    </para>

    <para>
      <parameter>--enable-readline</parameter>&nbsp;: ce paramètre active la prise
en charge de Readline dans le shell JS.
    </para>
    
    <para>
      <parameter>--disable-jemalloc</parameter>&nbsp;: ce paramètre désactive
l'allocateur de mémoire interne utilisé dans JS78. jemalloc est conçu
uniquement pour l'environnement du navigateur Firefox. Si JS78 utilise
jemalloc, les autres applications qui l'utilisent peuvent crasher quand des
éléments alloués par jemalloc sont libérés avec l'allocateur du système
(glibc).
    </para>

    <para>
      <parameter>--disable-debug-symbols</parameter>&nbsp;: ne génère pas les
symboles de débogage parce qu'ils sont très gros et que la plupart des
utilisateurs n'en ont pas besoin. Supprimez-le si vous voulez déboguer JS78.
    </para>

    <para>
      <command>rm -v /usr/lib/libjs_static.ajs</command>&nbsp;: supprimez une
grosse bibliothèque statique qui n'est utilisée par aucun paquet de BLFS.
    </para>

    <para>
      <command>sed -i '/@NSPR_CFLAGS@/d' /usr/bin/js78-config</command>&bnps;:
évite que <command>js78-config</command> n'utilise des CFLAGS bogués.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          js78 et js78-config
        </seg>
        <seg>
          libmozjs-78.so
        </seg>
        <seg>
          /usr/include/mozjs-78
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="js6-js78">
        <term><command>js78</command></term>
        <listitem>
          <para>
            fournit une interface en ligne de commande au moteur
<application>JavaScript</application>
          </para>
          <indexterm zone="js78 js78">
            <primary sortas="b-js78">js78</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="js78-config">
        <term><command>js78-config</command></term>
        <listitem>
          <para>
            est utilisé pour trouver le compilateur JS et les drapeaux de l'éditeur de
liens
          </para>
          <indexterm zone="js78 js78-config">
            <primary sortas="b-js78-config">js78-config</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libmozjs-78">
        <term><filename class="libraryfile">libmozjs-78.so</filename></term>
        <listitem>
          <para>
            contient les fonction de l'API de Mozilla JavaScript
          </para>
          <indexterm zone="js78 libmozjs-78">
            <primary sortas="c-libmozjs78">libmozjs-78.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>

</sect1>
