<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY gdm-download-http "&gnome-download-http;/gdm/&gnome-43;/gdm-&gdm-version;.tar.xz">
  <!ENTITY gdm-download-ftp  "&gnome-download-ftp;/gdm/&gnome-43;/gdm-&gdm-version;.tar.xz">
  <!ENTITY gdm-md5sum        "d9ca2abdf2359d0420dc71a1bd1d7530">
  <!ENTITY gdm-size          "812&nbsp;Ko">
  <!ENTITY gdm-buildsize     "33&nbsp;Mo">
  <!ENTITY gdm-time          "0,3&nbsp;SBU">
]>

<sect1 id="gdm" xreflabel="GDM-&gdm-version;">
  <?dbhtml filename="gdm.html"?>


  <title>GDM-&gdm-version;</title>

  <indexterm zone="gdm">
    <primary sortas="a-GDM">GDM</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à GDM</title>

    <para>
      <application>GDM</application> est un service système qui est responsable
des authentifications graphiques et de la gestion des affichages locaux et à
distance.
    </para>

    &lfs112_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&gdm-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&gdm-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &gdm-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &gdm-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &gdm-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &gdm-time;
        </para>
      </listitem>
    </itemizedlist>
    
    <!--
    <bridgehead renderas="sect3">
Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/gdm-&gdm-version;-security_fix-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
    -->
<bridgehead renderas="sect3">Dépendances de GDM</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="accountsservice"/>, <xref linkend="gtk3"/>, <xref
linkend="iso-codes"/>, <xref linkend="itstool"/>, <xref
linkend="libcanberra"/>, <xref linkend="libdaemon"/> et <xref
linkend="linux-pam"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="keyutils"/>
    </para>

    <bridgehead renderas="sect4">Dépendances de Runtime</bridgehead>
    <para role="required">
      <xref role="runtime" linkend="gnome-session"/>, <xref role="runtime"
linkend="gnome-shell"/> et <phrase revision="sysv"><xref role="runtime"
linkend="elogind"/></phrase> <phrase revision="systemd"><xref role="runtime"
linkend="systemd"/></phrase>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/gdm"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de GDM</title>

    <para>
      Il est recommandé d'avoir un utilisateur et un groupe dédiés au contrôle du
démon <command>gdm</command> après son démarrage. Lancez les commandes
suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;
    </para>

<screen role="root"><userinput>groupadd -g 21 gdm &amp;&amp;
useradd -c "GDM Daemon Owner" -d /var/lib/gdm -u 21 \
        -g gdm -s /bin/false gdm &amp;&amp;
passwd -ql gdm</userinput></screen>

    <para revision="sysv">
      Tout d'abord, adaptez GDM pour qu'il construise sans la présence de
systemd&nbsp;:
    </para>

<screen revision="sysv"><userinput remap="pre">sed -i -r '/(^| )systemd_dep/d' meson.build</userinput></screen>

    <para>
      Installez <application>GDM</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen revision="sysv"><userinput>sed -e 's@systemd@elogind@'                                \
    -e '/elogind/isession  required       pam_loginuid.so' \
    -i data/pam-lfs/gdm-launch-environment.pam &amp;&amp;

mkdir build &amp;&amp;
cd    build &amp;&amp;

meson --prefix=/usr               \
      --buildtype=release         \
      -Dgdm-xsession=true         \
      -Drun-dir=/run/gdm          \
      -Dsystemd-journal=false     \
      -Dsystemdsystemunitdir=/tmp \
      -Dsystemduserunitdir=/tmp   .. &amp;&amp;
ninja</userinput></screen>

<screen revision="systemd"><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson --prefix=/usr               \
      --buildtype=release         \
      -Dgdm-xsession=true         \
      -Drun-dir=/run/gdm ..
ninja</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests utilisable.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root" revision="sysv"><userinput>ninja install &amp;&amp;
rm -rv /tmp/*.{service,target.d}</userinput></screen>

<screen role="root" revision="systemd"><userinput>ninja install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/meson-buildtype-release.xml"/>

    <para>
      <option>-Dinitial-vt=7</option>&nbsp;: utilisez ce paramètre pour que
<application>GDM</application> démarre sur le VT7 plutôt que le premier VT
libre.
    </para>

    <para>
      <option>-Ddefault-pam-config=lfs</option>&nbsp;: Utilisez ce paramètre si
vous n'avez pas créé le fichier <filename>/etc/lfs-release</filename> ou
l'auto-détection de la distribution échouera et vous serez incapables
d'utiliser <application>GDM</application>.
    </para>

    <para>
      <parameter>-Dgdm-xsession=true</parameter>&nbsp;: Ceci active l'installation
du fichier Xsession de <application>GDM</application>.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de GDM</title>

    <sect3 id="gdm-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/gdm/custom.conf</filename>
      </para>

      <indexterm zone="gdm gdm-config">
        <primary sortas="e-etc-gdm-custom.conf">/etc/gdm/custom.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        Le service GDM est configuré à l'aide du fichier
<filename>/etc/gdm/custom.conf</filename>. Les valeurs par défaut sont
stockées dans GSettings dans le fichier <filename>gdm.schemas</filename>. Il
est recommandé que les utilisateurs finaux modifient le fichier
<filename>/etc/gdm/custom.conf</filename> car le fichier de schémas peut
être écrasé quand les utilisateurs mettent à jour leur système pour avoir
une nouvelle version de <application>GDM</application>.
      </para>

    </sect3>

    <sect3 id="gdm-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Unité Systemd</phrase></title>

      <indexterm zone="gdm gdm-init">
        <primary sortas="f-gdm">gdm</primary>
      </indexterm>

      <para revision="sysv">
        Pour démarrer <command>gdm</command> automatiquement quand le système passe
au niveau d'exécution 5, installez le script
<filename>/etc/rc.d/init.d/xdm</filename> et le fichier de configuration
<filename>/etc/sysconfig/xdm</filename> inclus dans le paquet <xref
linkend="bootscripts"/> et ajustez <filename>/etc/inittab</filename> en
lançant en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="sysv"><userinput>make install-gdm</userinput></screen>

      <para revision="sysv">
        Pour indiquer la valeur par défaut de 5 pour toujours, ce qui démarre
l'écran d'accueil de <command>gdm</command> automatiquement, vous pouvez
modifier <filename>/etc/inittab</filename>. En tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="sysv"><userinput>sed /initdefault/s/3/5/ -i /etc/inittab</userinput></screen>

      <para revision="systemd">
        Pour démarrer le démon <command>gdm</command> au démarrage, activez l'unité
systemd précédemment installée en exécutant la commande suivante en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<!-- [pierre October 2020] I don't understand why this is here: power
     management works perfectly well
      <para revision="sysv">
          You should also disable default elogind power management:
      </para>

<screen role="root" revision="sysv"><userinput>cat &gt;&gt; /etc/elogind/logind.conf &lt;&lt; "EOF"
<literal>AllowSuspend=no
AllowHibernation=no</literal>
EOF</userinput></screen>
-->
<screen role="root" revision="systemd"><userinput>systemctl enable gdm</userinput></screen>



    </sect3>

  </sect2>

  <sect2 role="starting">
    <title>Démarrer GNOME</title>

    <para>
      Il est possible de démarrer <application>GNOME</application> à partir de la
ligne de commande, plutôt qu'avec GDM. Cependant, vous devez toujours
installer GDM pour que certaines parties de l'environnement de bureau
fonctionne. Une raison pour démarrer depuis la ligne de commande serait
d'avoir la prise en charge de Wayland sur un système qui a le pilote NVIDIA
propriétaire, car GDM ne fournira pas le type de session Wayland sur un tel
système.
    </para>

    <para>
      Pour démarrer <application>GNOME</application> avec <xref role="nodep"
linkend="xinit"/>, lancez les commandes suivantes&nbsp;:
    </para>

<screen role="nodump"><userinput>cat &gt; ~/.xinitrc &lt;&lt; "EOF"
<literal>dbus-run-session gnome-session</literal>
EOF

startx</userinput></screen>

    <para>
      Autrement, pour démarrer <application>GNOME</application> avec la prise en
charge de Wayland, lancez la commande suivante&nbsp;:
    </para>

<screen role="nodump"><userinput>dbus-run-session -- gnome-shell --display-server --wayland</userinput></screen>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          gdm, gdmflexiserver et gdm-screenshot
        </seg>
        <seg>
          libgdm.so et pam_gdm.so (Module PAM)
        </seg>
        <seg>
          <!-- seems those diretories are not created at install, but at
     runtime
          /var/cache/gdm,
          /var/lib/gdm,
          /var/log/gdm, and
          /var/run/gdm-->
/etc/gdm, /usr/include/gdm, /usr/share/gdm et /usr/share/help/*/gdm

        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="gdm-prog">
        <term><command>gdm</command></term>
        <listitem>
          <para>
            est le dialogue d'authentification pour <application>GNOME</application>
          </para>
          <indexterm zone="gdm gdm-prog">
            <primary sortas="b-gdm">gdm</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="gdm-screenshot">
        <term><command>gdm-screenshot</command></term>
        <listitem>
          <para>
            est un outil d'impression écran de <application>GDM</application>
          </para>
          <indexterm zone="gdm gdm-screenshot">
            <primary sortas="b-gdm-screenshot">gdm-screenshot</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
