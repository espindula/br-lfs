<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY mutter-download-http "&gnome-download-http;/mutter/&gnome-44;/mutter-&mutter-version;.tar.xz">
  <!ENTITY mutter-download-ftp  "&gnome-download-ftp;/mutter/&gnome-44;/mutter-&mutter-version;.tar.xz">
  <!ENTITY mutter-md5sum        "c9a692911a8ff849c6bbfb44eca7a92f">
  <!ENTITY mutter-size          "2.7 Mo">
  <!ENTITY mutter-buildsize     "99&nbsp;Mo (avec les tests)">
  <!ENTITY mutter-time          "0,8&nbsp;SBU (avec parallélisme = 4, plus 1,4&nbsp;SBU pour les tests)">
]>

<sect1 id="mutter" xreflabel="Mutter-&mutter-version;">
  <?dbhtml filename="mutter.html"?>


  <title>Mutter-&mutter-version;</title>

  <indexterm zone="mutter">
    <primary sortas="a-Mutter">Mutter</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Mutter</title>

    <para>
      <application>Mutter</application> est le gestionnaire de fenêtres de
<application>GNOME</application>. Il n'est pas invoqué directement, mais
depuis <application>GNOME Session</application> (sur une machine avec un
pilote d'accélération vidéo).
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&mutter-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&mutter-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &mutter-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &mutter-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &mutter-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &mutter-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Mutter</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="gnome-settings-daemon"/>, <xref linkend="graphene"/>, <xref
linkend="libxcvt"/>, <xref linkend="libxkbcommon"/> et <xref
linkend="pipewire"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="desktop-file-utils"/>, <xref
linkend="gobject-introspection"/> et <xref linkend="startup-notification"/>
    </para>

    <bridgehead renderas="sect4">Recommandées (Requises pour construire le compositeur Wayland)</bridgehead>
    <para role="recommended">
      <xref linkend="libinput"/>, <xref linkend="wayland"/>, <xref
linkend="wayland-protocols"/> et <xref linkend="xwayland"/>.
    </para>

    <bridgehead renderas="sect4"
                revision="sysv">Recommandées (à l'exécution)</bridgehead>
    <para role="recommended" revision="sysv">
      <xref linkend="blocaled" role="runtime"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="python-dbusmock"/> (requis pour les tests), <xref
linkend="sysprof"/> et <xref linkend="xorg-server"/> (pour les sessions X11)
    </para>

    

  <!-- NOTE: Mutter compiles shipped Cogl and Clutter for it's own
    internal use. This is because upstream have decided that Cogl and
    Clutter should be only used by Mutter in the future, so the development
    of Cogl and Clutter is now performed in the Mutter repository.  The
    "standalone" Cogl and Clutter are considered obsolete now and we have
    archived them.  -->
</sect2>

  <sect2 role="installation">
    <title>Installation de Mutter</title>

    <para>
      Installez <application>Mutter</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<!--
    <para>

      To test the results, issue:
      <command>dbus-run-session ninja test</command>. The tests
      require an active X session to run correctly. It is not necessary to
      run a  separate D-bus session if not in a GNOME session, but it
      provides a clean environment in any case. One test,
      <filename>native-headless</filename>, is known to fail.
    </para>
    -->
<!-- there are no added problems in sysv, AFAICT. Running the tests is
    not easy whatever the init system. But using the instructions below in
    a gnome session on sysv works (no test failure)...
    <para revision='sysv'>

       This package does not come with a test suite that runs properly in the
       SystemV environment.
    </para>
    -->
<screen><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup --prefix=/usr              \
            --buildtype=release        \
            -Dtests=false              \
            -Dprofiler=false           \
            ..                         &amp;&amp;
ninja</userinput></screen>


    

    <para>
      La suite de tests nécessite qu'un programme externe nommé
<command>xvfb-run</command>. Si vous souhaitez lancer les tests, vous
devriez le télécharger et l'installer avant de lancer
<command>meson</command>. Vous pouvez le récupérer sur <ulink
url="&sources-anduin-http;/mutter/xvfb-run">xvfb-run</ulink>, et l'installer
avec les permissions d'exécution dans <filename
class="directory">/usr/bin</filename>. <command>xvfb-run</command> nécessite
<command>Xvfb</command> à l'exécution, et <command>Xvfb</command> peut être
installé avec <xref linkend='xorg-server'/> ou avec <xref
linkend='xwayland'/>. Vous devriez aussi remplacer
<parameter>-Dtests=false</parameter> dans la commande
<command>meson</command> par <parameter>-Dtests=true
-Dclutter_tests=false</parameter>. La suite de tests nécessite
l'installation des schémas de mutter sur le système, donc il vaut mieux
lancer les tests après l'installation du paquet.
    </para>

    <para>
      Vous pouvez aussi tester les fonctionnalité de base de
<application>Mutter</application> en suivant <xref
linkend='mutter-starting'/>, après l'installation.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ninja install</userinput></screen>

    <para>
      Si vous voulez lancer la suite de tests, supprimez une référence dans un
test à <application>Zenity</application> qui ne fait pas partie de
BLFS&nbsp;:
    </para>

<screen role='test'><userinput>sed 's/zenity --[a-z]*/gtk4-demo/' -i ../src/tests/x11-test.sh</userinput></screen>

    <para>
      Maintenant exécutez la suite de tests&nbsp;:
    </para>

    
<screen role='test'><!-- Without "HOME=" one test can fail with certain monitor
         configuration in $HOME/.config/monitors.xml. -->
<userinput>HOME= ninja test</userinput></screen>

    <para>
      <!-- https://gitlab.gnome.org/GNOME/mutter/-/issues/2848 -->
<!-- This needs a pipewire daemon running.  As at Aug 2023
           the method to run a pipewire daemon is not in BLFS
           (but in editor notes), so claim this a known failure.  -->
The tests require an active X or wayland session.  Two tests named
<filename>cogl-test-framebuffer-get-bits-gl3</filename> and
<filename>native-unit</filename> are known to fail.  A few other tests may
fail depending on the configuration.  Don't make any mouse or keyboard input
while the test suite is running or some tests may fail.
    </para>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/meson-buildtype-release.xml"/>

    <para>
      <parameter>-Dtests=false</parameter>&nbsp;: évite la construction des tests
et supprime le prérequis à <command>xvfb-run</command>.
    </para>

    <para>
      <parameter>-Dprofiler=false</parameter>: Allow building this package without
<application>Sysprof</application>.  Remove this option if you've installed
<application>Sysprof</application> and want to analysis the rendering
performance of <application>Mutter</application>.
    </para>

    <para>
      <option>-Dtests=true -Dclutter_tests=false</option>: Building all the tests
but the tests for the shipped <application>Clutter</application> library.
The <application>Clutter</application> tests are known to fail with
<option>--buildtype=release</option>.
    </para>

  </sect2>

  <sect2 role="starting" id="mutter-starting">
    <title>Démarrer Mutter</title>

    

    <!-- Mutter as a Wayland compositor works with recent mutter releases.
         IIRC mutter can also be used as a X window manager: just replace
         "twm" with "mutter &dash;&dash;x11" in xinitrc. But I've not tested
         such a configuration recently (I don't build Xorg Server or xinit
         these days.  -->
<para>
      <application>Mutter</application> est habituellement utilisé comme composant
de <application>gnome-shell</application>, mais il peut aussi être utilisé
en tant que compositeur Wayland seul. Pour lancer
<application>Mutter</application> en tant que compositeur Wayland, dans une
console virtuelle, lancez&nbsp;:
    </para>

    <screen role='nodump'><userinput>mutter --wayland -- vte-2.91</userinput></screen>

    <para>
      Remplacez <command>vte-2.91</command> pour la ligne de commande pour la
première application que vous voulez dans la session Wayland. Remarquez
qu'une fois que l'application termine, la session Wayland est aussi
terminée.
    </para>

    <para>
      <application>Mutter</application> peut aussi fonctionner en tant que
compositeur imbriqué dans une autre session Wayland. Dans un émulateur de
terminal, tapez&nbsp;:
    </para>

    <screen role='nodump'><userinput>MUTTER_DEBUG_DUMMY_MODE_SPECS=1920x1080 mutter --wayland --nested -- vte-2.91</userinput></screen>

    <para>
      Replacez <replaceable>1920x1080</replaceable> par la taille que vous voulez
pour la session Wayland imbriquée.
    </para>
  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          mutter
        </seg>
        <seg>
          libmutter-12.so and libmutter-test-12.so (optional)
        </seg>
        <seg>
          /usr/{lib,include,libexec/installed-tests,share/{,installed-tests}}/mutter-12
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="mutter-prog">
        <term><command>mutter</command></term>
        <listitem>
          <para>
            est un gestionnaire de fenêtre <application>GTK+</application> composant
basé sur <application>Clutter</application>
          </para>
          <indexterm zone="mutter mutter-prog">
            <primary sortas="b-mutter">mutter</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libmutter">
        <term><filename class="libraryfile">libmutter-12.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API de <application>Mutter</application>
          </para>
          <indexterm zone="mutter libmutter">
            <primary sortas="c-libmutter">libmutter-12.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libmutter-test">
        <term><filename class="libraryfile">libmutter-test-12.so</filename></term>
        <listitem>
          <para>
            contains the <application>Mutter</application> test suite API functions;
this library is only installed if the test suite of this package is enabled
and it is needed by <application>gnome-shell</application> test suite
          </para>
          <indexterm zone="mutter libmutter-test">
            <primary sortas="c-libmutter-test">libmutter-test-12.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
