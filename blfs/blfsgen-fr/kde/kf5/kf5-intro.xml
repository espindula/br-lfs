<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
 <!ENTITY % general-entities SYSTEM "../../general.ent">
 %general-entities;

  <!ENTITY kf5-download-http "&kf5-download-http;">
  <!ENTITY kf5-download-ftp  "&kf5e-download-ftp;">
  <!ENTITY kf5-md5sum        "Voir ci-dessous">
  <!ENTITY kf5-size          "30 Mo">
  <!ENTITY kf5-buildsize     "11.7 Mo">
  <!ENTITY kf5-time          "0.4 SBU">
]>

<sect1 id="kf5-intro" xreflabel="Introduction à KF5">
  <?dbhtml filename="kf5-intro.html"?>


  <title>Configuration de pré-installation de KDE Frameworks 5</title>

  <indexterm zone="kf5-intro">
     <primary sortas="g-kf5">Introduction aux frameworks KDE</primary>
  </indexterm>

  <para>
    KF5 peut être installé dans <filename class="directory">/usr</filename> ou
<filename class="directory">/opt/kf5</filename>. Les éditeurs de BLFS
recommandent la dernière dans un environnement BLFS.
  </para>

  <sect2>
    <title>Installation dans /usr</title>

    <para>
      Une option est d'installer <application>KDE Frameworks 5</application> dans
la hiérarchie <filename class="directory">/usr</filename>. Cela crée une
installation simple mais rend plus difficile d'essayer des versions
différentes de <application>KDE Frameworks</application>.
    </para>

<screen><userinput>export KF5_PREFIX=/usr</userinput></screen>

    <para>
      C'est une bonne idée d'ajouter les variables suivantes à votre système ou à
votre profil personnel&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt;&gt; /etc/profile.d/qt5.sh &lt;&lt; "EOF"
<literal># Begin kf5 extension for /etc/profile.d/qt5.sh

pathappend /usr/lib/plugins        QT_PLUGIN_PATH
pathappend $QT5DIR/lib/plugins     QT_PLUGIN_PATH

pathappend /usr/lib/qt5/qml        QML2_IMPORT_PATH
pathappend $QT5DIR/lib/qml         QML2_IMPORT_PATH

# End extension for /etc/profile.d/qt5.sh</literal>
EOF

cat &gt; /etc/profile.d/kf5.sh &lt;&lt; "EOF"
<literal># Begin /etc/profile.d/kf5.sh

export KF5_PREFIX=/usr

# End /etc/profile.d/kf5.sh</literal>
EOF</userinput></screen>

    <note>
      <para>
        Si <application>qt5</application> est installé dans <filename
class="directory">/usr</filename>, la partie <filename
class="directory">$QT5DIR/lib/</filename> des chemins précédents doit être
changée en <filename class="directory">$QT5DIR/lib/qt5/</filename>.
      </para>
    </note>

    <para>
      En plus, si <xref linkend="sudo"/> est installé, ces variables devraient
être disponibles pour le super utilisateur. Exécutez les commandes suivantes
en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt;&gt; /etc/sudoers.d/qt &lt;&lt; "EOF"
<literal>Defaults env_keep += QT_PLUGIN_PATH
Defaults env_keep += QML2_IMPORT_PATH</literal>
EOF

cat &gt;&gt; /etc/sudoers.d/kde &lt;&lt; "EOF"
<literal>Defaults env_keep += KF5_PREFIX</literal>
EOF</userinput></screen>

  </sect2>

  <sect2>
    <title>Installation dans /opt</title>

    <para>
      Une méthode pour installer plusieurs versions de <application>KDE Frameworks
5</application> est de construire dans la hiérarchie <filename
class="directory">/opt</filename>&nbsp;:
    </para>

<screen><userinput>export KF5_PREFIX=/opt/kf5</userinput></screen>

    <para>
      Si vous n'avez pas installé <application>KDE Frameworks 5</application> dans
<filename class="directory">/usr</filename>, vous devrez faire des
modifications de configurations supplémentaires. La meilleure pratique est
d'ajouter cela à votre profil système ou personnel&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt; /etc/profile.d/kf5.sh &lt;&lt; "EOF"
<literal># Begin /etc/profile.d/kf5.sh

export KF5_PREFIX=/opt/kf5

pathappend $KF5_PREFIX/bin              PATH
pathappend $KF5_PREFIX/lib/pkgconfig    PKG_CONFIG_PATH

pathappend $KF5_PREFIX/etc/xdg          XDG_CONFIG_DIRS
pathappend $KF5_PREFIX/share            XDG_DATA_DIRS

pathappend $KF5_PREFIX/lib/plugins      QT_PLUGIN_PATH
pathappend $KF5_PREFIX/lib/plugins/kcms QT_PLUGIN_PATH

pathappend $KF5_PREFIX/lib/qml          QML2_IMPORT_PATH

pathappend $KF5_PREFIX/lib/python&python3-majorver;/site-packages PYTHONPATH

pathappend $KF5_PREFIX/share/man        MANPATH

pathappend $KF5_PREFIX/include          CPLUS_INCLUDE_PATH
# End /etc/profile.d/kf5.sh</literal>
EOF

cat &gt;&gt; /etc/profile.d/qt5.sh &lt;&lt; "EOF"
<literal># Begin Qt5 changes for KF5

pathappend /usr/lib/plugins            QT_PLUGIN_PATH
pathappend $QT5DIR/plugins             QT_PLUGIN_PATH
pathappend $QT5DIR/qml                 QML2_IMPORT_PATH

# End Qt5 changes for KF5</literal>
EOF</userinput></screen>

    <para>
      Complétez votre fichier <filename>/etc/ld.so.conf</filename>&nbsp;:
    </para>

<screen role="root"><userinput>cat &gt;&gt; /etc/ld.so.conf &lt;&lt; "EOF"
<literal># Begin KF5 addition

/opt/kf5/lib

# End KF5 addition</literal>
EOF</userinput></screen>

    <indexterm zone="kf5-intro">
      <primary sortas="e-etc-ld.so.conf">/etc/ld.so.conf</primary>
    </indexterm>

    <para revision="sysv">
      Plusieurs paquets de <application>KDE Frameworks 5</application> et
<application>Plasma 5</application> installent des fichiers dans les
répertoires <application>D-Bus</application> et
<application>Polkit</application>. Quand on installe <application>KDE
Frameworks 5</application> dans un endroit autre que <filename
class="directory">/usr</filename>, <application>D-Bus</application> et
<application>Polkit</application> doivent pouvoir trouver ces fichiers. La
façon la plus simple de faire est de créer les liens symboliques suivants
(en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
    </para>

<screen role="root"
        revision="sysv"><userinput>install -v -dm755           $KF5_PREFIX/{etc,share} &amp;&amp;
ln -sfv /etc/dbus-1         $KF5_PREFIX/etc         &amp;&amp;
ln -sfv /usr/share/dbus-1   $KF5_PREFIX/share       &amp;&amp;
ln -sfv /usr/share/polkit-1 $KF5_PREFIX/share</userinput></screen>

    <para revision="systemd">
      Plusieurs paquets de <application>KDE Frameworks 5</application> et
<application>KDE Plasma 5</application> installent des fichiers dans les
répertoires <application>D-Bus</application>,
<application>Polkit</application> et
<application>systemd</application>. Quand on installe <application>KDE
5</application> dans un endroit autre que <filename
class="directory">/usr</filename>, <application>D-Bus</application>,
<application>Polkit</application> et <application>systemd</application>
doivent pouvoir trouver ces fichiers. La façon la plus simple de faire est
de créer les liens symboliques suivants (en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
    </para>

<screen role="root"
        revision="systemd"><userinput>install -v -dm755           $KF5_PREFIX/{etc,share} &amp;&amp;
ln -sfv /etc/dbus-1         $KF5_PREFIX/etc         &amp;&amp;
ln -sfv /usr/share/dbus-1   $KF5_PREFIX/share       &amp;&amp;
ln -sfv /usr/share/polkit-1 $KF5_PREFIX/share       &amp;&amp;
install -v -dm755           $KF5_PREFIX/lib         &amp;&amp;
ln -sfv /usr/lib/systemd    $KF5_PREFIX/lib</userinput></screen>

    <para>
      Certains paquets peuvent aussi installer des icônes dans l'ensemble
"hicolor". Comme cet ensemble d'icônes est utilisé par plusieurs paquets,
c'est une bonne idée de créer un lien symbolique vers celui dans <filename
class="directory">/usr/share</filename> pour éviter d'avoir des
installations multiples de <xref linkend="hicolor-icon-theme"/>. Lancez les
commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -dm755                $KF5_PREFIX/share/icons &amp;&amp;
ln -sfv /usr/share/icons/hicolor $KF5_PREFIX/share/icons</userinput></screen>

    <tip>
      <para>
        Parfois, les chemins d'installation sont codés en durs dans les fichiers
installés. C'est pourquoi <filename class="directory">/opt/kf5</filename>
est utilisé comme préfixe d'installation à la place de <filename
class="directory">/opt/kf5-&kf5-version;</filename>. Après l'installation de
<application>KDE Frameworks</application>, vous pouvez renommer le
répertoire et créer un lien symbolique&nbsp;:
      </para>

<screen role="root"><userinput>mv /opt/kf5{,-&kf5-version;}
ln -sfv kf5-&kf5-version; /opt/kf5</userinput></screen>

      <para>
        Plus tard, vous pourriez vouloir installer d'autres versions de
<application>KDE Frameworks 5</application>. Pour cela, supprimez simplement
le lien symbolique et utilisez <filename
class="directory">/opt/kf5</filename> de nouveau comme préfixe. La version
de <application>KDE Frameworks 5</application> que vous utilisez dépend
seulement du répertoire pointé par le lien symbolique. Aucune autre
reconfiguration ne sera nécessaire.
      </para>
    </tip>

  </sect2>

</sect1>
