<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY rsync-download-http "https://www.samba.org/ftp/rsync/src/rsync-&rsync-version;.tar.gz">
  <!ENTITY rsync-download-ftp  "">
  <!ENTITY rsync-md5sum        "26f1c64259fbd2ed7a59b28d2787ecf2">
  <!ENTITY rsync-size          "1,1&nbsp;Mo">
  <!ENTITY rsync-buildsize     "9.5 MB (with tests; add 24 MB for HTML API documentation)">
  <!ENTITY rsync-time          "0.7&nbsp;SBU (avec les tests)">
]>

<sect1 id="rsync" xreflabel="rsync-&rsync-version;">
  <?dbhtml filename="rsync.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>rsync-&rsync-version;</title>

  <indexterm zone="rsync">
    <primary sortas="a-rsync">rsync</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à rsync</title>

    <para>
      Le paquet <application>rsync</application> contient l'outil
<command>rsync</command>. C'est utile pour synchroniser de grosses archives
de fichiers sur un réseau.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&rsync-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&rsync-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &rsync-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &rsync-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &rsync-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &rsync-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de rsync</bridgehead>

    
    <!-- This does now use OpenSSL and zstd from LFS. -->
<bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="popt"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="doxygen"/>, <ulink
url="https://lz4.github.io/lz4/">lz4</ulink> et <ulink
url="https://cyan4973.github.io/xxHash/">xxhash</ulink>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/rsync"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de rsync</title>

    <para>
      Pour des raisons de sécurité, il est recommandé d'exécuter le serveur
<application>rsync</application> en tant qu'utilisateur et que groupe non
privilégiés. Si vous souhaitez lancer <command>rsync</command> en tant que
démon, créez l'utilisateur et le groupe <systemitem
class="username">rsyncd</systemitem> avec les commandes suivantes lancées en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>groupadd -g 48 rsyncd &amp;&amp;
useradd -c "rsyncd Daemon" -m -d /home/rsync -g rsyncd \
    -s /bin/false -u 48 rsyncd</userinput></screen>

    <para>
      Installez <application>rsync</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./configure --prefix=/usr    \
            --disable-lz4    \
            --disable-xxhash \
            --without-included-zlib &amp;&amp;
make</userinput></screen>

    <para>
      Si vous avez installé <xref linkend="doxygen"/> et souhaitez construire la
documentation HTML de l'API, lancez&nbsp;:
    </para>

<screen remap="doc"><userinput>doxygen</userinput></screen>

    <para>
      Pour tester les résultats lancez&nbsp;: <command>make check</command>.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role='root'><userinput>make install</userinput></screen>

    <para>
      Si vous avez construit la documentation, installez-la en utilisant les
commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role='root'
        remap="doc"><userinput>install -v -m755 -d          /usr/share/doc/rsync-&rsync-version;/api &amp;&amp;
install -v -m644 dox/html/*  /usr/share/doc/rsync-&rsync-version;/api</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--disable-lz4</parameter>&nbsp;: ce paramètre désactive la
compression LZ4. Remarquez que ce paramètre fait utiliser le meilleur
algorithme «&nbsp;zstd&nbsp;», et que zstd est fournit dans LFS.
    </para>

    <para>
      <parameter>--disable-xxhash</parameter>&nbsp;: ce paramètre désactive la
prise en charge de la somme de contrôle avancée xxhash. Supprimez-le si vous
avez installé <ulink
url="https://cyan4973.github.io/xxHash/">xxhash</ulink>.
    </para>

    <para>
      <parameter>--without-included-zlib</parameter>&nbsp;: ce paramètre active la
compilation avec la bibliothèque zlib installée sur le système.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de rsync</title>

    <sect3 id="rsync-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/rsyncd.conf</filename>
      </para>

      <indexterm zone="rsync rsync-config">
        <primary sortas="e-etc-rsyncd.conf">/etc/rsyncd.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        Pour un accès client aux fichiers distants, il se peut que vous deviez
installer le paquet <xref linkend="openssh"/> pour vous connecter au serveur
distant.
      </para>

      <para>
        C'est une configuration simple pour le téléchargement seulement pour régler
un <command>rsync</command> fonctionnant comme un serveur. Voir la page de
manuel de rsyncd.conf(5) pour des options supplémentaires (donc
l'authentification utilisateur).
      </para>

<screen role="root"><userinput>cat &gt; /etc/rsyncd.conf &lt;&lt; "EOF"
<literal># This is a basic rsync configuration file
# It exports a single module without user authentication.

motd file = /home/rsync/welcome.msg
use chroot = yes

[localhost]
    path = /home/rsync
    comment = Default rsync module
    read only = yes
    list = yes
    uid = rsyncd
    gid = rsyncd
</literal>
EOF</userinput></screen>

      <para>
        Vous pouvez trouver des informations de configuration et de la documentation
générale concernant <command>rsync</command> sur <ulink
url="https://rsync.samba.org/documentation.html"/>.
      </para>

    </sect3>

    <sect3 id="rsync-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Unité Systemd</phrase></title>

      <para>
        Remarquez que vous ne voudrez démarrer le serveur
<application>rsync</application> que si vous voulez fournir une archive
<application>rsync</application> sur votre machine locale. Vous n'avez pas
besoin de <phrase revision="sysv">ce script</phrase><phrase
revision="systemd">cette unité</phrase> pour lancer le client
<application>rsync</application>.
      </para>

      <para>
        Installez <phrase revision="sysv">le script de démarrage
<filename>/etc/rc.d/init.d/rsyncd</filename> inclus</phrase><phrase
revision="systemd">l'unité <filename>rsyncd.service</filename>
incluse</phrase> dans le paquet <xref linkend="bootscripts"
revision="sysv"/><xref linkend="systemd-units" revision="systemd"/>.
      </para>

<screen role="root"><userinput>make install-rsyncd</userinput></screen>

      <note revision="systemd">
        <para>
          Ce paquet est distribué avec deux types d'unités&nbsp;: Un fichier de
service et un fichier de socket. Le fichier de service démarrera le démon
rsync au démarrage et le gardera actif jusqu'à l'extinction du système. Le
fichier socket fera écouter systemd sur le port rsync (par défaut 873, le
fichier doit être édité pour en utiliser un autre) et démarrera le démon
rsync lorsque quelque chose essaiera de se connecter à ce port, et éteindra
le démon lorsque la connexion se terminera. Ceci est appelé activation par
socket et est similaire à l'utilisation de
<application>{,x}inetd</application> sur un système basé sur SysVinit.
        </para>

        <para>
          Par défaut, la première méthode est utilisée - le démon rsync est démarré au
démarrage et stoppé à l'extinction. Si vous voulez utiliser l'activation par
socket, vous devez lance en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
        </para>

<screen role="nodump"><userinput>systemctl stop rsyncd &amp;&amp;
systemctl disable rsyncd &amp;&amp;
systemctl enable rsyncd.socket &amp;&amp;
systemctl start rsyncd.socket</userinput></screen>

        <para>
          Remarquez que la méthode par socket n'est utile que pour les sauvegardes
distantes. Pour les sauvegardes locales, vous devrez utiliser la méthode du
service.
        </para>
      </note>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>rsync et rsync-ssl</seg>
        <seg>Aucune</seg>
        <seg>Éventuellement, /usr//share/doc/rsync-&rsync-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="rsync-prog">
        <term><command>rsync</command></term>
        <listitem>
          <para>
            est le remplaçant de <command>rcp</command> (et <command>scp</command>) qui
a beaucoup plus de fonctionnalités. Il utilise l'<quote>algorithme
rsync</quote> qui fournit une méthode de synchronisation des fichiers
distants très rapide. Il fait cela en n'envoyant que les différences dans
les fichiers à travers le lien, sans exiger que les deux ensembles de
fichiers soient présents à l'avance d’un côté du lien
          </para>
          <indexterm zone="rsync rsync-prog">
            <primary sortas="b-rsync">rsync</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rsync-ssl">
        <term><command>rsync-ssl</command></term>
        <listitem>
          <para>
            est un script d'aide utilisé lors de la connexion à un démon rsync avec la
prise en charge de SSL incluse
          </para>
          <indexterm zone="rsync rsync-ssl">
            <primary sortas="b-rsync-ssl">rsync-ssl</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
