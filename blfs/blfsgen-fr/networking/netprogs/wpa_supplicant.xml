<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY wpa_supplicant-download-http
           "https://w1.fi/releases/wpa_supplicant-&wpa_supplicant-version;.tar.gz">
  <!ENTITY wpa_supplicant-download-ftp  "">
  <!ENTITY wpa_supplicant-md5sum        "d26797fcb002898d4ee989179346e1cc">
  <!ENTITY wpa_supplicant-size          "3.4&nbsp;Mo">
  <!ENTITY wpa_supplicant-buildsize     "37&nbsp;Mo">
  <!ENTITY wpa_supplicant-time          "0.5 SBU (sans l'interface graphique facultative)">
]>

<sect1 id="wpa_supplicant" xreflabel="wpa_supplicant-&wpa_supplicant-version;">
  <?dbhtml filename="wpa_supplicant.html"?>


  <title>wpa_supplicant-&wpa_supplicant-version;</title>

  <indexterm zone="wpa_supplicant">
    <primary sortas="a-wpa_supplicant">wpa_supplicant</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à WPA Supplicant</title>

    <para>
      <application>wpa_supplicant</application> est un client d'accès au Wi-fi
protégé (WPA) et compatible IEEE 802.1X. Il implémente la négociation de clé
WPA avec une authentification WPA et le protocole d'authentification étendue
(EAP) avec un serveur d'authentification. De plus, il contrôle l'itinérance
et l'authentification/association IEEE 802.11 des pilotes. Il est pratique
pour se connecter à un point d'accès protégé par mot de passe.
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&wpa_supplicant-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&wpa_supplicant-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &wpa_supplicant-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &wpa_supplicant-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &wpa_supplicant-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &wpa_supplicant-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de WPA Supplicant</bridgehead>

    <bridgehead renderas="sect4">Requise (à l'exécution)</bridgehead>
    <para role="nodump">
      <xref linkend="wireless-kernel"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="desktop-file-utils"/> (pour lancer
<command>update-desktop-database</command>) et <xref linkend="libnl"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <phrase revision="sysv"><xref linkend="dbus"/>,</phrase> <xref
linkend="libxml2"/> et &qt5-deps;
    </para>


  </sect2>

  <sect2 role="kernel" id="wpa_supplicant-kernel">
    <title>Configuration du noyau</title>

    <para>
      Pour utiliser <application>wpa_supplicant</application>, le noyau doit avoir
les pilotes et autres fonctions auxiliaires appropriés. Consultez <xref
linkend='wireless-kernel'/> pour plus de détails.
    </para>

    <indexterm zone="wpa_supplicant wpa_supplicant-kernel">
      <primary sortas="d-wpa_supplicant">wpa_supplicant</primary>
    </indexterm>
  </sect2>

  <sect2 role="installation">
    <title>Installation de WPA Supplicant</title>

    <para>
      En premier vous devez créer un fichier de configuration initial pour la
construction. Vous pouvez lire <filename>wpa_supplicant/README</filename> et
<filename>wpa_supplicant/defconfig</filename> pour les explications des
options suivantes aussi bien que pour les autres options qui peuvent être
utilisées. Créer un fichier de configuration qui peut fonctionner avec les
initialisations standards pour le WiFi en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>cat &gt; wpa_supplicant/.config &lt;&lt; "EOF"
<literal>CONFIG_BACKEND=file
CONFIG_CTRL_IFACE=y
CONFIG_DEBUG_FILE=y
CONFIG_DEBUG_SYSLOG=y
CONFIG_DEBUG_SYSLOG_FACILITY=LOG_DAEMON
CONFIG_DRIVER_NL80211=y
CONFIG_DRIVER_WEXT=y
CONFIG_DRIVER_WIRED=y
CONFIG_EAP_GTC=y
CONFIG_EAP_LEAP=y
CONFIG_EAP_MD5=y
CONFIG_EAP_MSCHAPV2=y
CONFIG_EAP_OTP=y
CONFIG_EAP_PEAP=y
CONFIG_EAP_TLS=y
CONFIG_EAP_TTLS=y
CONFIG_IEEE8021X_EAPOL=y
CONFIG_IPV6=y
CONFIG_LIBNL32=y
CONFIG_PEERKEY=y
CONFIG_PKCS12=y
CONFIG_READLINE=y
CONFIG_SMARTCARD=y
CONFIG_WPS=y
CFLAGS += -I/usr/include/libnl3</literal>
EOF</userinput></screen>

    <para>
      Si vous souhaitez utiliser <application>WPA Supplicant</application> avec
<xref linkend="NetworkManager"/>, soyez certain d'avoir installé <xref
linkend="dbus"/> et <xref linkend="libxml2"/>, ensuite ajoutez les options
suivantes dans le fichier de configuration de <application>WPA
Supplicant</application> en exécutant les commandes suivantes&nbsp;:
    </para>

<screen><userinput>cat &gt;&gt; wpa_supplicant/.config &lt;&lt; "EOF"
<literal>CONFIG_CTRL_IFACE_DBUS=y
CONFIG_CTRL_IFACE_DBUS_NEW=y
CONFIG_CTRL_IFACE_DBUS_INTRO=y</literal>
EOF</userinput></screen>

<screen><userinput>cd wpa_supplicant &amp;&amp;
make BINDIR=/usr/sbin LIBDIR=/usr/lib</userinput></screen>

    <para>
      Si vous avez installé &qt5-deps; et souhaitez construire l'interface
graphique de <application>WPA Supplicant</application>, lancez les commandes
suivantes&nbsp;:
    </para>

    <note>
      <para>
        Le répertoire suivant est nommé qt4, mais est compatible avec &qt5-deps;.
      </para>
    </note>

<screen><userinput>pushd wpa_gui-qt4 &amp;&amp;
qmake wpa_gui.pro &amp;&amp;
make &amp;&amp;
popd</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -m755 wpa_{cli,passphrase,supplicant} /usr/sbin/ &amp;&amp;
install -v -m644 doc/docbook/wpa_supplicant.conf.5 /usr/share/man/man5/ &amp;&amp;
install -v -m644 doc/docbook/wpa_{cli,passphrase,supplicant}.8 /usr/share/man/man8/</userinput></screen>

    <para revision="systemd">
      Installez les fichiers supports de <application>systemd</application> en
exécutant la commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>install -v -m644 systemd/*.service /usr/lib/systemd/system/</userinput></screen>

    <para>
      Si vous avez construit <application>WPA Supplicant</application> avec le
support <application>D-Bus</application>, vous devez installer les fichiers
de configuration de <application>D-Bus</application>. Installez-les en
exécutant les commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -m644 dbus/fi.w1.wpa_supplicant1.service \
                 /usr/share/dbus-1/system-services/ &amp;&amp;
install -v -d -m755 /etc/dbus-1/system.d &amp;&amp;
install -v -m644 dbus/dbus-wpa_supplicant.conf \
                 /etc/dbus-1/system.d/wpa_supplicant.conf</userinput></screen>

    <para revision="systemd">
      De plus, activez <filename>wpa_supplicant.service</filename> pour que
<application>systemd</application> puisse activer correctement le service
<application>D-Bus</application>. Remarquez que le service par connexion et
le service D-Bus ne peuvent pas être activés en même temps. Lancez la
commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>systemctl enable wpa_supplicant</userinput></screen>

    <para>
      Si vous avez construit l'interface graphique de <application>WPA
Supplicant</application>, installez-le en exécutant les commandes suivantes
en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -m755 wpa_gui-qt4/wpa_gui /usr/bin/ &amp;&amp;
install -v -m644 doc/docbook/wpa_gui.8 /usr/share/man/man8/ &amp;&amp;
install -v -m644 wpa_gui-qt4/wpa_gui.desktop /usr/share/applications/ &amp;&amp;
install -v -m644 wpa_gui-qt4/icons/wpa_gui.svg /usr/share/pixmaps/</userinput></screen>

    <note>
      <para>
        Vous devrez redémarrer le démon du système <application>D-Bus</application>
avant de pouvoir utiliser l'interface <application>D-Bus</application> de
<application>WPA Supplicant</application>.
      </para>
    </note>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/update-desktop-database.xml"/>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de wpa_supplicant</title>

    <sect3 id="wpa_supplicant-config">
      <title>Fichier de configuration</title>

      <para revision="sysv">
        <filename>/etc/sysconfig/wpa_supplicant-*.conf</filename>
      </para>

      <para revision="systemd">
        <filename>/etc/wpa_supplicant/wpa_supplicant-*.conf</filename>
      </para>

      <indexterm zone="wpa_supplicant wpa_supplicant-config" revision="sysv">
        <primary
        sortas="e-etc-sysconfig-wpa_supplicant-star.conf">/etc/sysconfig/wpa_supplicant-*.conf</primary>
      </indexterm>

      <indexterm zone="wpa_supplicant wpa_supplicant-config" revision="systemd">
        <primary
        sortas="e-etc-wpa_supplicant-wpa_supplicant-star.conf">/etc/wpa_supplicant/wpa_supplicant-*.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        Pour se connecter à un point d'accès qui utilise un mot de passe vous devez
mettre la clé partagée dans <phrase
revision="sysv"><filename>/etc/sysconfig/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</filename>.</phrase><phrase
revision="systemd"><filename>/etc/wpa_supplicant/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</filename>.</phrase>
Le SSID est la chaîne que le point d'accès ou le routeur transmet pour
s'identifier. Lancez la commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="nodump" revision="sysv"><userinput>wpa_passphrase <replaceable>SSID</replaceable> <replaceable>SECRET_PASSWORD</replaceable> &gt; /etc/sysconfig/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</userinput></screen>

<screen role="nodump" revision="systemd"><userinput>install -v -dm755 /etc/wpa_supplicant &amp;&amp;
wpa_passphrase <replaceable>SSID</replaceable> <replaceable>SECRET_PASSWORD</replaceable> &gt; /etc/wpa_supplicant/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</userinput></screen>

      <para>
        <phrase
revision="sysv"><filename>/etc/sysconfig/wpa_supplicant-<replaceable>wifi0</replaceable>.conf
</filename></phrase><phrase
revision="systemd"><filename>/etc/wpa_supplicant/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</filename></phrase>
peut retenir les détails de plusieurs points d'accès. Quand vous lancez
<command>wpa_supplicant</command> il scannera les SSID qu'il peut voir et
choisira le mot de passe approprié pour se connecter.
      </para>

      <para>
        Si vous souhaitez vous connecter à un point d'accès qui n'est pas protégé
par un mot de passe, indiquez une entrée comme cela dans <phrase
revision="sysv"
><filename>/etc/sysconfig/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</filename></phrase><phrase
revision="systemd"><filename>/etc/wpa_supplicant/wpa_supplicant-<replaceable>wifi0</replaceable>.conf</filename></phrase>.
Remplacez «&nbsp;Some-SSID&nbsp;» avec le SSID du point d'accès/routeur.
      </para>

<screen>network={
  ssid="<replaceable>Some-SSID</replaceable>"
  key_mgmt=NONE
}</screen>

      <para>
        Se connecter à un nouveau point d'accès qui n'est pas dans le fichier de
configuration peut se faire manuellement via la ligne de commande ou
l'interface graphique, mais cela doit se faire via un utilisateur
privilégié. Pour ce faire, ajoutez la suite dans le fichier de
configuration&nbsp;:
      </para>

<screen>ctrl_interface=DIR=/run/wpa_supplicant GROUP=&lt;privileged group&gt;
update_config=1</screen>

      <para>
        Remplacez le &lt;priviledged group&gt; ci-dessus avec le groupe système dont
les membres peuvent se connecter au point d'accès sans fil.
      </para>

      <para>
        Il y a beaucoup d'options que vous pouvez utiliser pour personnaliser la
façon de se connecter à chaque point d'accès. Elles sont décrites en détails
dans le fichier <filename>wpa_supplicant/wpa_supplicant.conf</filename> dans
les sources.
      </para>

    </sect3>

    <sect3>
      <title>Connexion à un point d'accès</title>

      <para id="wpa-service" revision="sysv">
        Si vous voulez configurer une interface réseau au démarrage en utilisant
<command>wpa_supplicant</command>, vous devez installer le script
<filename>/lib/services/wpa</filename> fourni dans le paquet <xref
linkend="bootscripts"/>&nbsp;:
      </para>

<screen role="root" revision="sysv"><userinput>make install-service-wpa</userinput></screen>

      <indexterm zone="wpa_supplicant wpa-service" revision="sysv">
        <primary sortas="f-wpa">wpa</primary>
      </indexterm>

      <para revision="sysv">
        If your router/access point uses DHCP to allocate IP addresses, you can
install <xref linkend="dhcpcd" role="nodep"/> and use it to automatically
obtain network addresses. Create the
<filename>/etc/sysconfig/ifconfig-<replaceable>wifi0</replaceable>
</filename> by running the following command as the <systemitem
class="username">root</systemitem> user:
      </para>

<screen role="root" revision="sysv"><userinput>cat &gt; /etc/sysconfig/ifconfig.<replaceable>wifi0</replaceable> &lt;&lt; "EOF"
<literal>ONBOOT="yes"
IFACE="<replaceable>wlan0</replaceable>"
SERVICE="wpa"

# Additional arguments to wpa_supplicant
WPA_ARGS=""

WPA_SERVICE="dhcpcd"
DHCP_START="-b -q <replaceable>&lt;insert appropriate start options here&gt;</replaceable>"
DHCP_STOP="-k <replaceable>&lt;insert additional stop options here&gt;</replaceable>"</literal>
EOF</userinput></screen>

      <para revision="sysv">
        Sinon, si vous utilisez une adresse statique de votre réseau local, alors
créez
<filename>/etc/sysconfig/ifconfig-<replaceable>wifi0</replaceable></filename>
en exécutant la commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="sysv"><userinput>cat &gt; /etc/sysconfig/ifconfig.<replaceable>wifi0</replaceable> &lt;&lt; "EOF"
<literal>ONBOOT="yes"
IFACE="<replaceable>wlan0</replaceable>"
SERVICE="wpa"

# Additional arguments to wpa_supplicant
WPA_ARGS=""

WPA_SERVICE="ipv4-static"
IP="192.168.1.1"
GATEWAY="192.168.1.2"
PREFIX="24"
BROADCAST="192.168.1.255"</literal>
EOF</userinput></screen>

      <para revision="systemd">
        Il y a 3 types d'unités <application>systemd</application> qui ont été
installées&nbsp;:
      </para>

      <itemizedlist spacing="compact" revision="systemd">
        <listitem>
          <para>
            wpa_supplicant@.service
          </para>
        </listitem>
        <listitem>
          <para>
            wpa_supplicant-nl80211@.service
          </para>
        </listitem>
        <listitem>
          <para>
            wpa_supplicant-wired@.service
          </para>
        </listitem>
      </itemizedlist>

      <para revision="systemd">
        La seule différence entre les 3 est le pilote utilisé pour se connecter
(option -D). La première utilise le pilote par défaut, la deuxième utilise
le pilote nl80211 et la troisième utilise le pilote filaire.
      </para>

      <para>
        Vous pouvez vous connecter au point d'accès sans fil en exécutant la
commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="sysv"><userinput>ifup <replaceable>wifi0</replaceable></userinput></screen>

      <para revision="sysv">
        Remplacez <replaceable>wlan0</replaceable> par la bonne interface sans fil
et <replaceable>wifi0</replaceable> par le nom du fichier de configuration
souhaité. Merci de noter que les fichiers de configuration
<filename>wpa_supplicant-*.conf</filename> et
<filename>ifconfig.*</filename> doivent avoir des noms identiques, c'est à
dire les deux contiennent <replaceable>wifi0</replaceable> dans leur nom.
      </para>

<screen role="root" revision="systemd"><userinput>systemctl start wpa_supplicant@<replaceable>wlan0</replaceable></userinput></screen>

      <para revision="systemd">
        Pour vous connecter au point d'accès sans fil au démarrage, activez
simplement le bon service <command>wpa_supplicant</command> en exécutant la
commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root" revision="systemd"><userinput>systemctl enable wpa_supplicant@<replaceable>wlan0</replaceable></userinput></screen>

      <para revision="systemd">
        En fonction de votre configuration, remplacez
<filename>wpa_supplicant@.service</filename> avec celle qui convient.
      </para>

      <para revision="systemd">
        Pour assigner une adresse réseau à votre interface sans fil, consultez la
page <ulink url="&lfs-root;/chapter09/network.html">Configuration Générale
du Réseau</ulink> de LFS.
      </para>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          wpa_gui, wpa_supplicant, wpa_passphrase et wpa_cli
        </seg>
        <seg>
          Aucune
        </seg>
        <seg>
Aucun
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="wpa_gui">
        <term><command>wpa_gui</command></term>
        <listitem>
          <para>
            est une interface graphique pour interagir avec
<application>wpa_supplicant</application>
          </para>
          <indexterm zone="wpa_supplicant wpa_gui">
            <primary sortas="b-wpa_gui">wpa_gui</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="wpa_supplicant-prog">
        <term><command>wpa_supplicant</command></term>
        <listitem>
          <para>
            est un démon qui peut se connecter à un point d'accès protégé par un mot de
passe
          </para>
          <indexterm zone="wpa_supplicant wpa_supplicant-prog">
            <primary sortas="b-wpa_supplicant">wpa_supplicant</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="wpa_passphrase">
        <term><command>wpa_passphrase</command></term>
        <listitem>
          <para>
            prend un SSID et un mot de passe et génère une configuration simple que
<command>wpa_supplicant</command> peut comprendre
          </para>
          <indexterm zone="wpa_supplicant wpa_passphrase">
            <primary sortas="b-wpa_passphrase">wpa_passphrase</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="wpa_cli">
        <term><command>wpa_cli</command></term>
        <listitem>
          <para>
            est une interface en ligne de commandes pour contrôler le lancement du démon
<command>wpa_supplicant</command>
          </para>
          <indexterm zone="wpa_supplicant wpa_cli">
            <primary sortas="b-wpa_cli">wpa_cli</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
