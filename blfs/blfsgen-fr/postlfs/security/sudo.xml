<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY sudo-download-http "https://www.sudo.ws/dist/sudo-&sudo-version;.tar.gz">
  <!ENTITY sudo-download-ftp  "ftp://ftp.sudo.ws/pub/sudo/sudo-&sudo-version;.tar.gz">
  <!ENTITY sudo-md5sum        "4cc21cf7c9a89290b230954aed0d1e11">
  <!ENTITY sudo-size          "5,0&nbsp;Mo">
  <!ENTITY sudo-buildsize     "51&nbsp;Mo (plus 17&nbsp;Mo pour les tests)">
  <!ENTITY sudo-time          "0,2&nbsp;SBU (avec parallélisme = 4, plus 0,1&nbsp;SBU pour les tests)">
]>

<sect1 id="sudo" xreflabel="Sudo-&sudo-version;">
  <?dbhtml filename="sudo.html"?>


  <title>Sudo-&sudo-version;</title>

  <indexterm zone="sudo">
    <primary sortas="a-Sudo">Sudo</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Sudo</title>

    <para>
      Le paquet <application>Sudo</application> permet à un administrateur système
de donner à certains utilisateurs (ou à certains groupes d'utilisateurs) la
possibilité de lancer tout ou partie des commandes en tant qu'utilisateur
<systemitem class="username">root</systemitem> ou qu'un autre utilisateur en
enregistrant les commandes et les arguments.
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&sudo-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&sudo-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &sudo-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &sudo-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &sudo-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &sudo-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Sudo</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="linux-pam"/>, <xref linkend="mitkrb"/>, <xref
linkend="openldap"/>, <xref linkend="server-mail"/> (qui fournit une
commande <command>sendmail</command>), <ulink
url="https://www.openafs.org/">AFS</ulink>, <ulink
url="https://www.fwtk.org/">FWTK</ulink> et <ulink
url="&sourceforge-dl;/opie/">Opie</ulink>
    </para>

    <para condition="html" role="usernotes">Notes des rédacteurs&nbsp;: <ulink url="&blfs-wiki;/sudo"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Sudo</title>

    <para>
      Installez <application>Sudo</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./configure --prefix=/usr              \
            --libexecdir=/usr/lib      \
            --with-secure-path         \
            --with-all-insults         \
            --with-env-editor          \
            --docdir=/usr/share/doc/sudo-&sudo-version; \
            --with-passprompt="[sudo] password for %p: " &amp;&amp;
make</userinput></screen>

    <para>
      Pour tester les résultats lancez&nbsp;: <command>env LC_ALL=C make check
2&gt;&amp;1 | tee make-check.log</command>. Check the results with
<command>grep failed make-check.log</command>.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>


<screen role="root"><!-- for a DESTDIR install as normal user, use
    "make install INSTALL_OWNER= DESTDIR=<destdir>"-->
<userinput>make install &amp;&amp;
ln -sfv libsudo_util.so.0.0.0 /usr/lib/sudo/libsudo_util.so.0</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
     <parameter>--libexecdir=/usr/lib</parameter>&nbsp;: Ce paramètre contrôle où
les programmes privés sont installés. Tous dans ce répertoire est une
bibliothèque, alors ils sont mis dans <filename
class="directory">/usr/lib</filename> au lieu de <filename
class="directory">/usr/libexec</filename>.
    </para>

    <para>
      <parameter>--with-secure-path</parameter>&nbsp;: Ce paramètre ajoute de
façon transparente les répertoires <filename
class="directory">/sbin</filename> et <filename
class="directory">/usr/sbin</filename> dans la variable d'environnement
<envar>PATH</envar>.
    </para>

    <para>
      <parameter>--with-all-insults</parameter>&nbsp;: Ce paramètre inclut toutes
les insultes de <application>sudo</application>.
    </para>

    <para>
      <parameter>--with-env-editor</parameter>&nbsp;: Ce paramètre active
l'utilisation de la variable d'environnement EDITOR pour
<command>visudo</command>.
    </para>

    <para>
      <parameter>--with-passprompt</parameter>&nbsp;: ce paramètre configure
l'invite de mot de passe. Le <parameter>%p</parameter> sera étendu en le nom
de l'utilisateur dont le mot de passe est demandé.
    </para>

    <para>
      <option>--without-pam</option>&nbsp;: Ce paramètre empêche de construire le
support <application>Linux-PAM</application> quand
<application>Linux-PAM</application> est installé sur le système.
    </para>


    <!-- See the developer note above before the configure command
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/static-libraries.xml"/>
-->
<note>
      <para>
        Il y a de nombreuses options pour la commande <command>configure</command>
de <application>sudo</application>. Regardez la sortie de <command>configure
--help</command> pour une liste complète.
      </para>
    </note>

    <para>
      <command>ln -sfv libsudo_util...</command>&nbsp;: contourne un bogue dans le
processus d'installation, qui lie à la version précédemment installée (si
elle est là) au lieu de la nouvelle.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Sudo</title>

    <sect3 id="sudo-config">
      <title>Fichier de configuration</title>

      <para>
        <filename>/etc/sudoers</filename>
      </para>

      <indexterm zone="sudo sudo-config">
        <primary sortas="e-etc-sudoers">/etc/sudoers</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        Le fichier <filename>sudoers</filename> peut être très compliqué. Il se
compose de deux types d'entrées&nbsp;: des alias (simplement des variables)
et des spécifications utilisateur (qui indiquent qui peut lancer
quoi). L'installation installe une configuration par défaut qui n'a aucun
privilège installés pour aucun utilisateur.
      </para>

      <para>
        Quelques modifications de la configuration usuelles consistent à indiquer le
chemin de recherche pour le super utilisateur et à autoriser les membres du
groupe wheel à exécuter toutes les commandes après avoir fournit leur propre
mot de passe. Utilisez les commandes suivantes pour créer le fichier de
configuration <filename>/etc/sudoers.d/00-sudo</filename> en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>cat &gt; /etc/sudoers.d/00-sudo &lt;&lt; "EOF"
<literal>Defaults secure_path="/usr/sbin:/usr/bin"
%wheel ALL=(ALL) ALL</literal>
EOF</userinput></screen>

      <note>
        <para>
          Dans les installations les plus simples où il n'y a qu'un seul utilisateur,
il peut être plus simple de simplement modifier le fichier
<filename>/etc/sudoers</filename> directement. Dans ce cas, l'entrée
<varname>secure_path</varname> n'est pas forcément utile et utiliser
<command>sudo -E …</command> peut importer l'environnement complet de
l'utilisateur non privilégié dans la session privilégiée.
        </para>

        <para>
          Les fichiers du répertoire <filename
class="directory">/etc/sudoers.d</filename> sont analysés et triés par ordre
lexicographique. Assurez-vous que les entrées dans un fichier ajouté ne
remplace pas les entrées précédentes.
        </para>
      </note>

      <para>
        Pour des détails, voir <command>man sudoers</command>.
      </para>

      <note>
        <para>
          Les développeurs de <application>Sudo</application> recommandent fortement
d'utiliser le programme <command>visudo</command> pour éditer le fichier
<filename>sudoers</filename>. Il fournira une vérification de santé de base
comme l'analyse de la syntaxe et les droits du fichier pour éviter des
erreurs possibles qui pourraient aboutir à une configuration vulnérable.
        </para>
      </note>

      <para>
        Si <application>PAM</application> est installé sur le système,
<application>Sudo</application> est construit avec le support
<application>PAM</application>, exécutez la commande suivante en tant
qu'utilisateur <systemitem class="username">root</systemitem> pour créer le
fichier de configuration <application>PAM</application>&nbsp;:
      </para>

<screen role="root"><userinput>cat &gt; /etc/pam.d/sudo &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/sudo

# include the default auth settings
auth      include     system-auth

# include the default account settings
account   include     system-account

# Set default environment variables for the service user
session   required    pam_env.so

# include system session defaults
session   include     system-session

# End /etc/pam.d/sudo</literal>
EOF
chmod 644 /etc/pam.d/sudo</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          cvtsudoers, sudo, sudo_logsrvd, sudo_sendlog, sudoedit (lien symbolique),
sudoreplay et visudo
        </seg>
        <seg>
          
          <!-- [pierre, September 25, 2020] except libsudo_util, the other
          shared objects in /usr/lib/sudo look more like modules than
          libraries. Leaving them now, and updating the list, but I think
          they should not be listed. -->
audit_json.so, group_file.so, libsudo_util.so, sample_approval.so,
sudoers.so, sudo_noexec.so et system_group.so
        </seg>
        <seg>
          /etc/sudoers.d, /usr/lib/sudo, /usr/share/doc/sudo-&sudo-version; et
/var/lib/sudo
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="cvtsudoers">
        <term><command>cvtsudoers</command></term>
        <listitem>
          <para>
            convertit entre les différents formats de fichiers sudoers
          </para>
          <indexterm zone="sudo cvtsudoers">
            <primary sortas="b-cvtsudoers">cvtsudoers</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sudo_prog">
        <term><command>sudo</command></term>
        <listitem>
          <para>
            exécute une commande en tant qu'un autre utilisateur selon les permissions
du fichier de configuration <filename>/etc/sudoers</filename>
          </para>
          <indexterm zone="sudo sudo">
            <primary sortas="b-sudo">sudo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sudo_logsrvd">
        <term><command>sudo_logsrvd</command></term>
        <listitem>
          <para>
            est un serveur de journalisation d'événements et d'E/S pour sudo
          </para>
          <indexterm zone="sudo sudo_logsrvd">
            <primary sortas="b-sudo_logsrvd">sudo_logsrvd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sudo_sendlog">
        <term><command>sudo_sendlog</command></term>
        <listitem>
          <para>
            envoie les journaux d'E/S de sudo au serveur de journalisation
          </para>
          <indexterm zone="sudo sudo_sendlog">
            <primary sortas="b-sudo_sendlog">sudo_sendlog</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sudoedit">
        <term><command>sudoedit</command></term>
        <listitem>
          <para>
            est un lien symbolique vers <command>sudo</command> qui inclut l'option
<option>-e</option> pour appeler un éditeur en tant qu'un autre utilisateur
          </para>
          <indexterm zone="sudo sudoedit">
            <primary sortas="b-sudoedit">sudoedit</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="sudoreplay">
        <term><command>sudoreplay</command></term>
        <listitem>
          <para>
            est utilisé pour rejouer ou afficher les logs de sorties créés par
<command>sudo</command>
          </para>
          <indexterm zone="sudo sudoreplay">
            <primary sortas="b-sudoreplay">sudoreplay</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="visudo">
        <term><command>visudo</command></term>
        <listitem>
          <para>
            permet une édition sécurisée du fichier <filename>sudoers</filename>
          </para>
          <indexterm zone="sudo visudo">
            <primary sortas="b-visudo">visudo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
