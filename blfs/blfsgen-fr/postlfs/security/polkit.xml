<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY polkit-download-http "https://gitlab.freedesktop.org/polkit/polkit/-/archive/&polkit-version;/polkit-&polkit-version;.tar.gz">
  <!ENTITY polkit-download-ftp  "">
  <!ENTITY polkit-md5sum        "36540b837c588e1e77145523bb39f511">
  <!ENTITY polkit-size          "736&nbsp;Ko">
  <!ENTITY polkit-buildsize     "6,8&nbsp;Mo (avec les tests)">
  <!ENTITY polkit-time          "0,3&nbsp;SBU (avec les tests, avec parallélisme = 4)">
]>

<sect1 id="polkit" xreflabel="Polkit-&polkit-version;">
  <?dbhtml filename="polkit.html"?>


  <title>Polkit-&polkit-version;</title>

  <indexterm zone="polkit">
    <primary sortas="a-Polkit">Polkit</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Polkit</title>

    <para>
      <application>Polkit</application> est une trousse à outils pour définir et
gérer les autorisations. Il est utilisé pour permettre aux processus non
privilégiés de communiquer avec des processus privilégiés.
    </para>

    &lfs120_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&polkit-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&polkit-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &polkit-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &polkit-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &polkit-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &polkit-time;
        </para>
      </listitem>
    </itemizedlist>



    <!--
    <bridgehead renderas="sect3">
Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/polkit-&polkit-version;-security_fixes-1.patch"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;/polkit-&polkit-version;-js91-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
-->
<bridgehead renderas="sect3">Dépendances de Polkit</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="glib2"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      
      <!-- For jhalfs just make it required to avoid over-complexity. -->
<xref role="required" linkend="duktape"/>, <xref
linkend="gobject-introspection"/>, <xref linkend="libxslt"/>, <phrase
revision="systemd"> et </phrase><xref linkend="linux-pam"/> <phrase
revision="sysv"> et <xref linkend="elogind"/> </phrase>
    </para>

    <note>
      <para>
        Comme <phrase revision="sysv"><command>elogind</command></phrase><phrase
revision="systemd"><command>systemd-logind</command></phrase> utilise PAM
pour enregistrer les sessions utilisateurs, il serait bien de construire
<application>Polkit</application> avec la prise en charge de PAM pour que
<phrase revision="sysv"><command>elogind</command></phrase><phrase
revision="systemd"><command>systemd-logind</command></phrase> puisse suivre
les sessions <application>Polkit</application>.
      </para>
    </note>


    

    <!-- Due to the fact that meson will not autodetect g-i and
         has it set to required unless you pass an option, and the likelihood
         of users ignoring a command explanation and then sending in mails
         regarding KDE or GNOME not working after installing polkit, let's move
         it to recommended. See #15640 for logic
    <bridgehead renderas="sect4">Optional (Required if building GNOME)</bridgehead>
    <para role="optional">
      <xref linkend="gobject-introspection"/>
    </para>
    -->
<bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="gtk-doc"/>, <xref linkend="js102"/> (peut être utilisé à la
place de duktape) et <xref linkend="python-dbusmock"/> (pour les tests)
    </para>

    <bridgehead renderas="sect4" revision="systemd">Dépendances de Required Runtime</bridgehead>
    <para role="required" revision="systemd">
      <xref role="runtime" linkend="systemd"/>
    </para>

    <bridgehead renderas="sect4" id="polkit-agent" xreflabel="Agent d'authentification Polkit">
      Dépendances à l'exécution facultatives
    </bridgehead>
    <para role="optional">
      Un agent d'authentification polkit pour utiliser polkit dans l'environnement
graphique&nbsp;:  <application>polkit-kde-agent</application> dans <xref
role="runtime" linkend="plasma5-build"/> pour KDE, l'agent construit dans
<xref role="runtime" linkend="gnome-shell"/> pour GNOME3, <xref
role="runtime" linkend="polkit-gnome"/> pour XFCE et
<application>lxpolkit</application> dans <xref role="runtime"
linkend="lxsession"/> pour LXDE.
    </para>

    <note>
      <para>
        Si <xref linkend="libxslt"/> est installé, alors <xref linkend="DocBook"/>
et <xref linkend="docbook-xsl"/> sont requis. Si vous avez installé <xref
linkend="libxslt"/>, mais que vous ne voulez installer aucun des paquets
DocBook mentionnés, vous devez utiliser <option>-Dman=false</option> dans
les instructions qui suivent.
      </para>
    </note>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Polkit</title>

    <para>
      Il doit y avoir un utilisateur et un groupe dédiés pour prendre le contrôle
du démon <command>polkitd</command> après son démarrage. Tapez les commandes
suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>groupadd -fg 27 polkitd &amp;&amp;
useradd -c "PolicyKit Daemon Owner" -d /etc/polkit-1 -u 27 \
        -g polkitd -s /bin/false polkitd</userinput></screen>

    <para>
      Si vous utilisez <xref linkend="js102"/>, effectuez les changement suivants
(voir l'explication des commandes plus bas pour plus d'informations)&nbsp;:
    </para>

<!--
    <para>

      Apply a patch to fix two security issues:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../polkit-&polkit-version;-security_fixes-1.patch</userinput></screen>

    <para>
      Port this package to use JS-91:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../polkit-&polkit-version;-js91-1.patch</userinput></screen>
-->
<screen><userinput remap="nodump">sed -e 's/JS_Init/JS::DisableJitBackend(); &amp;/' \
    -i src/polkitbackend/polkitbackendjsauthority.cpp</userinput></screen>



    <para>
      Installez <application>Polkit</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen revision="systemd"><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup ..                            \
      --prefix=/usr                       \
      --buildtype=release                 \
      -Dman=true                          \
      -Dsession_tracking=libsystemd-login \
      -Dtests=true                        &amp;&amp;
ninja</userinput></screen>

<screen revision="sysv"><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson setup ..                      \
      --prefix=/usr                 \
      --buildtype=release           \
      -Dman=true                    \
      -Dsession_tracking=libelogind \
      -Dtests=true                  &amp;&amp;
ninja</userinput></screen>

    <para>
      Pour tester les résultats, assurez-vous d'abord que le démon
<application>D-Bus</application> du système tourne et que <xref
linkend='dbus-python'/> et <xref linkend='python-dbusmock'/> sont tous deux
installés. Ensuite, lancez <command>ninja test</command>.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ninja install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>sed -e 's/JS_Init/JS::DisableJitBackend(); &amp;/' ...
</command>&nbsp;: la compilation JIT de JS102 nécessite les droits W+X ce
qui est dangereux et n'est pas permis par le fichier d'unité
<application>systemd</application> fournit das le paquet polkit. Cette
commande n'est pas vraiment nécessaire sur les systèmes basés sur sysvinit
mais elle améliore tout de même la sécurité. Elle n'a pas d'effet si vous
construisez polkit avec le moteur Javascript recommandé, <xref
linkend='duktape'/>.
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/meson-buildtype-release.xml"/>

    <para>
      <parameter>-Dtests=true</parameter>&nbsp;: ce paramètre permet de lancer la
suite de tests de ce paquet. Comme <application>Polkit</application> est
utilisé pour les autorisation, son intégrité peut affecter la sécurité du
système. Il est donc recommandé de lancer la suite de tests en construisant
ce paquet.
    </para>

    <para>
      <option>-Djs_engine=mozjs</option>&nbsp;: ce paramètre permet d'utiliser le
moteur JavaScript <xref linkend="js102"/> au lieu du moteur <xref
linkend='duktape'/>.
    </para>

    

    <!--
    <para revision="sysv">

      <parameter>- -disable-libsystemd-login</parameter>: This switch forces
      polkit to build with elogind support (if available) rather than
      systemd-logind.
    </para>


    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/static-libraries.xml"/>
    -->
<para>
      <option>-Dos_type=lfs</option>&nbsp;: utilisez ce paramètre si vous n'avez
pas créé le fichier <filename>/etc/lfs-release</filename> ou
l'auto-détection de la distribution échouera et vous ne pourrez pas utiliser
<application>Polkit</application>.
    </para>

    <para>
      <option>-Dauthfw=shadow</option>&nbsp;: Ce paramètre configure le paquet
pour utiliser le système d'authentification
<application>Shadow</application> au lieu de
<application>Linux-PAM</application>. Utilisez-le si vous n'avez pas
installé <application>Linux-PAM</application>.
    </para>

    

    <!--
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../../xincludes/gtk-doc-rebuild.xml"/>

    -->
<para>
      <option>-Dintrospection=false</option>&nbsp;: utilisez cette option si vous
êtes certain que vous n'avez pas besoin des fichiers gobject-introspection
pour polkit, ou que vous n'avez pas installé gobject-introspection.
    </para>

    <para>
      <option>-Dman=false</option>&nbsp;: utilisez cette option pour désactiver la
génération et l'installation des pages de manuel. C'est utile si vous n'avez
pas installé libxslt.
    </para>

    <para>
      <option>-Dexamples=true</option>&nbsp;: utilisez cette option pour
construire les programmes d'exemple.
    </para>

    <para>
      <option>-Dgtk_doc=true</option>&nbsp;: utilisez cette option pour activer la
construction et l'installation de l'API de la documentation.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          <!--pk-example-frobnicate,-->
pkaction, pkcheck, pkexec, pkttyagent et polkitd
        </seg>
        <seg>
          libpolkit-agent-1.so et libpolkit-gobject-1.so
        </seg>
        <seg>
          /etc/polkit-1, /usr/include/polkit-1, /usr/lib/polkit-1,
/usr/share/gtk-doc/html/polkit-1 et /usr/share/polkit-1
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="pkaction">
        <term><command>pkaction</command></term>
        <listitem>
          <para>
            est utilisé pour obtenir des informations sur les actions PolicyKit
enregistrées
          </para>
          <indexterm zone="polkit pkaction">
            <primary sortas="b-pkaction">pkaction</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pkcheck">
        <term><command>pkcheck</command></term>
        <listitem>
          <para>
            est utilisé pour vérifier si un processus est autorisé à faire une action
          </para>
          <indexterm zone="polkit pkcheck">
            <primary sortas="b-pkcheck">pkcheck</primary>
          </indexterm>
        </listitem>
      </varlistentry>



      <!--
      <varlistentry id="pk-example-frobnicate">

        <term><command>pk-example-frobnicate</command></term>
        <listitem>
          <para>
            is an example program to test the <command>pkexec</command>
            command
          </para>
          <indexterm zone="polkit pk-example-frobnicate">
            <primary sortas="b-pk-example-frobnicate">pk-example-frobnicate</primary>
          </indexterm>
        </listitem>
      </varlistentry>
-->
<varlistentry id="pkexec">
        <term><command>pkexec</command></term>
        <listitem>
          <para>
            permet à un utilisateur autorisé d'exécuter une commande en tant
qu'utilisateur différent
          </para>
          <indexterm zone="polkit pkexec">
            <primary sortas="b-pkexec">pkexec</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pkttyagent">
        <term><command>pkttyagent</command></term>
        <listitem>
          <para>
            est utilisé pour démarrer un l'agent d'authentification en mode texte
          </para>
          <indexterm zone="polkit pkttyagent">
            <primary sortas="b-pkttyagent">pkttyagent</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="polkitd">
        <term><command>polkitd</command></term>
        <listitem>
          <para>
            fournit le service <application>D-Bus</application>
org.freedesktop.PolicyKit1 sur le bus de message du système
          </para>
          <indexterm zone="polkit polkitd">
            <primary sortas="b-polkitd">polkitd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libpolkit-agent-1">
        <term><filename class="libraryfile">libpolkit-agent-1.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API de <application>Polkit</application> pour
l'authentification
          </para>
          <indexterm zone="polkit libpolkit-agent-1">
            <primary sortas="c-libpolkit-agent-1">libpolkit-agent-1.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libpolkit-gobject-1">
        <term><filename class="libraryfile">libpolkit-gobject-1.so</filename></term>
        <listitem>
          <para>
            contient les fonctions de l'API d'authentification
<application>Polkit</application>
          </para>
          <indexterm zone="polkit libpolkit-gobject-1">
            <primary sortas="c-libpolkit-gobject-1">libpolkit-gobject-1.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
