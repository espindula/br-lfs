<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY linux-pam-download-http "https://github.com/linux-pam/linux-pam/releases/download/v&linux-pam-version;/Linux-PAM-&linux-pam-version;.tar.xz">
  <!ENTITY linux-pam-download-ftp  "">
  <!ENTITY linux-pam-md5sum        "895e8adfa14af334f679bbeb28503f66">
  <!ENTITY linux-pam-size          "966&nbsp;Ko">
  <!ENTITY linux-pam-buildsize     "39&nbsp;Mo (avec les tests)">
  <!ENTITY linux-pam-time          "0.4&nbsp;SBU (avec les tests)">

  <!ENTITY linux-pam-docs-download "https://github.com/linux-pam/linux-pam/releases/download/v&linux-pam-version;/Linux-PAM-&linux-pam-docs-version;-docs.tar.xz">
  <!ENTITY linux-pam-docs-md5sum   "ceb3dc248cb2f49a40904b93cb91db1b">
  <!ENTITY linux-pam-docs-size     "433&nbsp;Ko">
  <!--
  <!ENTITY debian-pam-docs         "http://debian.securedservers.com/kernel/pub/linux/libs/pam">
  -->
]>

<sect1 id="linux-pam" xreflabel="Linux-PAM-&linux-pam-version;">
  <?dbhtml filename="linux-pam.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Linux-PAM-&linux-pam-version;</title>

  <indexterm zone="linux-pam">
    <primary sortas="a-Linux-PAM">Linux-PAM</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Linux PAM</title>

    <para>
      Le paquet <application>Linux-PAM</application> contient des Pluggable
Authentication Modules (modules d'authentification connectables). C'est
utile pour permettre à l'administrateur système local de choisir la façon
dont s'authentifient les utilisateurs des applications.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&linux-pam-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&linux-pam-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &linux-pam-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &linux-pam-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &linux-pam-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &linux-pam-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
    <title>Documentation facultative</title>
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&linux-pam-docs-download;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &linux-pam-docs-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement &linux-pam-docs-size;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Linux PAM</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="db"/>, <xref linkend="libnsl"/>, <xref linkend="libtirpc"/>,
<ulink url="https://github.com/linux-audit/audit-userspace">libaudit</ulink>
et <ulink url="http://www.prelude-siem.org">Prelude</ulink>
    </para>

    <bridgehead renderas="sect4">Facultatifs (pour reconstruire la documentation)</bridgehead>
    <para role="optional">
      <xref linkend="DocBook"/>, <xref linkend="docbook-xsl"/>, <xref
linkend="fop"/>, <xref linkend="libxslt"/> et soit <xref linkend="lynx"/>,
soit <ulink url="&w3m-url;">W3m</ulink>
    </para>

    <note>
      <para role="required">
        <xref role="runtime" linkend="shadow"/> <phrase revision="systemd"> et <xref
role="runtime" linkend="systemd"/> doivent être réinstallés</phrase><phrase
revision="sysv">doit être réinstallé</phrase> après avoir installé et
configuré <application>Linux PAM</application>.
      </para>

      <para role="recommended">
         Avec Linux-PAM-1.4.0 et supérieur, le module pam_cracklib n'est pas installé
par défaut. Pour assurer des mots de passe forts, il est recommandé
d'utiliser <xref role="runtime" linkend="libpwquality"/>.
      </para>
    </note>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/linux-pam"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Linux PAM</title>

    <para revision="sysv">
      Commencez par éviter l'installation d'un fichier systemd inutile&nbsp;:
    </para>

<screen revision="sysv"><userinput>sed -e /service_DATA/d \
    -i modules/pam_namespace/Makefile.am &amp;&amp;
autoreconf</userinput></screen>

    <para>
      Si vous avez téléchargé la documentation, déballez l'archive tar en
exécutant la commande suivante.
    </para>

<screen><userinput>tar -xf ../Linux-PAM-&linux-pam-docs-version;-docs.tar.xz --strip-components=1</userinput></screen>

    <para>
      Si vous voulez plutôt regénérer la documentation, corrigez le script
<command>configure</command> pour qu'il détecte lynx s'il est
installé&nbsp;:
    </para>

<screen><userinput>sed -e 's/dummy elinks/dummy lynx/'                                    \
    -e 's/-no-numbering -no-references/-force-html -nonumbers -stdin/' \
    -i configure</userinput></screen>

    <para>
      Installez <application>Linux PAM</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./configure --prefix=/usr                        \
            --sbindir=/usr/sbin                  \
            --sysconfdir=/etc                    \
            --libdir=/usr/lib                    \
            --enable-securedir=/usr/lib/security \
            --docdir=/usr/share/doc/Linux-PAM-&linux-pam-version; &amp;&amp;
make</userinput></screen>

    <para>
      Pour tester les résultats, le fichier de configuration suivant
<filename>/etc/pam.d/other</filename> doit exister.
    </para>

    <caution>
      <title>Réinstallation ou mise à jour de Linux PAM</title>
      <para>
        Si vous avez un système avec Linux PAM installé et en fonctionnement, soyez
attentif quand vous modifiez les fichiers dans <filename
class="directory">/etc/pam.d</filename>, car votre système peut devenir
totalement inutilisable. Si vous souhaitez lancer les tests, vous n'avez pas
besoin de créer un autre fichier <filename>/etc/pam.d/other</filename>. Le
fichier installé peut être utilisé pour cela.
      </para>

      <para>
         Vous devez aussi être conscient que <command>make install</command> écrase
les fichiers de configuration dans <filename
class="directory">/etc/security</filename> ainsi que dans
<filename>/etc/environment</filename>. Dans le cas où vous avez modifié ces
fichiers, soyez certain de les avoir sauvegardés.
      </para>
    </caution>

    <para>
      Pour une première installation, créez le fichier de configuration en tapant
les commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>install -v -m755 -d /etc/pam.d &amp;&amp;

cat &gt; /etc/pam.d/other &lt;&lt; "EOF"
<literal>auth     required       pam_deny.so
account  required       pam_deny.so
password required       pam_deny.so
session  required       pam_deny.so</literal>
EOF</userinput></screen>

    <para>
      Maintenant lancez les tests en exécutant <command>make
check</command>. Assurez-vous qu’il n’y a pas d'erreurs produites par les
tests avant de continuer l'installation. Notez que les tests sont très
longs. Il peut être utile de rediriger la sortie vers un fichier de log pour
pouvoir l'inspecter consciencieusement.
    </para>

    <para>
      Seulement dans le cas d'une première installation, supprimez le fichier de
configuration créé plus haut en exécutant la commande suivante en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>rm -fv /etc/pam.d/other</userinput></screen>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
chmod -v 4755 /usr/sbin/unix_chkpwd</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--enable-securedir=/usr/lib/security</parameter>&nbsp;: ce
paramètre initialise l'emplacement pour les modules
<application>PAM</application>.
    </para>

    <para>
      <option>--disable-regenerate-docu</option>&nbsp;: Si les dépendances
requises (<xref linkend="DocBook"/>, <xref linkend="docbook-xsl"/>, <xref
linkend="libxslt"/> et <xref linkend="lynx"/> ou <ulink
url="&w3m-url;">W3m</ulink>) sont installés, les pages de manuel et la
documentation html et textuelle est régénérée et installée. En plus, si
<xref linkend="fop"/> est installé, la documentation PDF est générée et
installée. Utilisez ce paramètre si vous ne voulez pas reconstruire la
documentation.
    </para>

    <para>
      <command>chmod -v 4755 /usr/sbin/unix_chkpwd</command>&nbsp;: Le programme
d'aide <command>unix_chkpwd</command> doit être setuid afin que les
processus non-<systemitem class="username">root</systemitem> puissent
accéder au fichier shadow.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Linux-PAM</title>

    <sect3 id="pam-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/security/*</filename> et <filename>/etc/pam.d/*</filename>
      </para>

      <indexterm zone="linux-pam pam-config">
        <primary sortas="e-etc-security">/etc/security/*</primary>
      </indexterm>

      <indexterm zone="linux-pam pam-config">
        <primary sortas="e-etc-pam.d">/etc/pam.d/*</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>
        Les informations de configuration se trouvent dans <filename
class="directory">/etc/pam.d/</filename>. Voici ci-dessous un fichier
exemple&nbsp;:
      </para>

<screen><literal># Begin /etc/pam.d/other

auth            required        pam_unix.so     nullok
account         required        pam_unix.so
session         required        pam_unix.so
password        required        pam_unix.so     nullok

# End /etc/pam.d/other</literal></screen>

      <para>
        Maintenant, mettez en place des fichiers génériques. En tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>install -vdm755 /etc/pam.d &amp;&amp;
cat &gt; /etc/pam.d/system-account &lt;&lt; "EOF" &amp;&amp;
<literal># Begin /etc/pam.d/system-account

account   required    pam_unix.so

# End /etc/pam.d/system-account</literal>
EOF

cat &gt; /etc/pam.d/system-auth &lt;&lt; "EOF" &amp;&amp;
<literal># Begin /etc/pam.d/system-auth

auth      required    pam_unix.so

# End /etc/pam.d/system-auth</literal>
EOF

cat &gt; /etc/pam.d/system-session &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/system-session

session   required    pam_unix.so

# End /etc/pam.d/system-session</literal>
EOF
cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/system-password

# use sha512 hash for encryption, use shadow, and try to use any previously
# defined authentication token (chosen password) set by any prior module
password  required    pam_unix.so       sha512 shadow try_first_pass

# End /etc/pam.d/system-password</literal>
EOF
</userinput></screen>

     <para>
       Si vous voulez activer la prise en charge des mots de passe forts, installez
<xref linkend="libpwquality"/> et suivez les instructions de cette page pour
configurer le module PAM pam_pwquality avec la prise en charge des mots de
passe forts.
     </para>



      <!-- With the removal of the pam_cracklib module, we're supposed to be using
     libpwquality. That already includes instructions in it's configuration
     information page, so we'll use those instead.

     Linux-PAM must be installed prior to libpwquality so that PAM support
     is built in, and the PAM module is built.
-->
<!--
      <para>

        The remaining generic file depends on whether <xref
        linkend="cracklib"/> is installed.  If it is installed, use:
      </para>

<screen role="root"><userinput>cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/system-password

# check new passwords for strength (man pam_cracklib)
password  required    pam_cracklib.so    authtok_type=UNIX retry=1 difok=5 \
                                         minlen=9 dcredit=1 ucredit=1 \
                                         lcredit=1 ocredit=1 minclass=0 \
                                         maxrepeat=0 maxsequence=0 \
                                         maxclassrepeat=0 \
                                         dictpath=/lib/cracklib/pw_dict
# use sha512 hash for encryption, use shadow, and use the
# authentication token (chosen password) set by pam_cracklib
# above (or any previous modules)
password  required    pam_unix.so        sha512 shadow use_authtok

# End /etc/pam.d/system-password</literal>
EOF</userinput></screen>

      <note>
        <para>
          In its default configuration, pam_cracklib will
          allow multiple case passwords as short as 6 characters, even with
          the <parameter>minlen</parameter> value set to 11. You should review
          the pam_cracklib(8) man page and determine if these default values
          are acceptable for the security of your system.
        </para>
      </note>

      <para>
        If <xref linkend="cracklib"/> is <emphasis>NOT</emphasis> installed,
        use:
      </para>

<screen role="nodump"><userinput>cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/system-password

# use sha512 hash for encryption, use shadow, and try to use any previously
# defined authentication token (chosen password) set by any prior module
password  required    pam_unix.so       sha512 shadow try_first_pass

# End /etc/pam.d/system-password</literal>
EOF</userinput></screen>
-->
<para>
        Maintenant ajoutez un fichier de configuration
<filename>/etc/pam.d/other</filename> restrictif. Avec ce fichier, les
programmes qui ne sont pas sous PAM ne pourront pas se lancer sans qu'un
fichier de configuration spécifique pour l'application ne soit créé.
      </para>

<screen role="root"><userinput>cat &gt; /etc/pam.d/other &lt;&lt; "EOF"
<literal># Begin /etc/pam.d/other

auth        required        pam_warn.so
auth        required        pam_deny.so
account     required        pam_warn.so
account     required        pam_deny.so
password    required        pam_warn.so
password    required        pam_deny.so
session     required        pam_warn.so
session     required        pam_deny.so

# End /etc/pam.d/other</literal>
EOF</userinput></screen>

      <para>
        La page de manuel de <application>PAM</application> (<command>man
pam</command>) offre un bon point de départ pour des descriptions des champs
et des entrées autorisées. Le <ulink
url="http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_SAG.html">Linux-PAM
System Administrators' Guide (guide de l'administrateur système
Linux-PAM)</ulink> est recommandé pour des informations supplémentaires.
      </para>

      <important>
        <para>
          Vous devriez maintenant réinstaller <phrase revision="sysv">le
paquet</phrase><phrase revision="systemd">les paquets</phrase> <xref
linkend="shadow"/><phrase revision="systemd"> et <xref
linkend="systemd"/></phrase>.
        </para>
      </important>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          faillock, mkhomedir_helper, pam_namespace_helper, pam_timestamp_check,
pwhistory_helper, unix_chkpwd et unix_update
        </seg>
        <seg>
          libpam.so, libpamc.so et libpam_misc.so
        </seg>
        <seg>
          /etc/security, /usr/lib/security, /usr/include/security et
/usr/share/doc/Linux-PAM-&linux-pam-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="faillock">
        <term><command>faillock</command></term>
        <listitem>
          <para>
            affiche et modifie les fichiers d'enregistrement des échecs
d'authentification
          </para>
          <indexterm zone="linux-pam faillock">
            <primary sortas="b-faillock">faillock</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mkhomedir_helper">
        <term><command>mkhomedir_helper</command></term>
        <listitem>
          <para>
            est un assistant binaire qui crée des répertoires home
          </para>
          <indexterm zone="linux-pam mkhomedir_helper">
            <primary sortas="b-mkhomedir_helper">mkhomedir_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pam_namespace_helper">
        <term><command>pam_namespace_helper</command></term>
        <listitem>
          <para>
            est un programme d'aide utilisé pour configurer un espace de noms privé pour
une session utilisateur
          </para>
          <indexterm zone="linux-pam pam_namespace_helper">
            <primary sortas="b-pam_namespace_helper">pam_namespace_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pwhistory_helper">
        <term><command>pwhistory_helper</command></term>
        <listitem>
          <para>
            est un programme d'aide qui transfère les hash de mots de passes de passwd
ou shadow à opasswd
          </para>
          <indexterm zone="linux-pam pwhistory_helper">
            <primary sortas="b-pwhistory_helper">pwhistory_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>


      <!-- Removed with the removal of the pam_tally{,2} module
      <varlistentry id="pam_tally">

        <term><command>pam_tally</command></term>
        <listitem>
          <para>
            is used to interrogate and manipulate the login counter file.
          </para>
          <indexterm zone="linux-pam pam_tally">
            <primary sortas="b-pam_tally">pam_tally</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pam_tally2">
        <term><command>pam_tally2</command></term>
        <listitem>
          <para>
            is used to interrogate and manipulate the login counter file, but
            does not have some limitations that <command>pam_tally</command>
            does.
          </para>
          <indexterm zone="linux-pam pam_tally2">
            <primary sortas="b-pam_tally2">pam_tally2</primary>
          </indexterm>
        </listitem>
      </varlistentry>
-->
<varlistentry id="pam_timestamp_check">
        <term><command>pam_timestamp_check</command></term>
        <listitem>
          <para>
            est utilisé pour vérifier si l'horodatage par défaut est valide.
          </para>
          <indexterm zone="linux-pam pam_timestamp_check">
            <primary sortas="b-pam_timestamp_check">pam_timestamp_check</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unix_chkpwd">
        <term><command>unix_chkpwd</command></term>
        <listitem>
          <para>
            est un assistant binaire qui vérifie le mot de passe de l'actuel utilisateur
          </para>
          <indexterm zone="linux-pam unix_chkpwd">
            <primary sortas="b-unix_chkpwd">unix_chkpwd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unix_update">
        <term><command>unix_update</command></term>
        <listitem>
          <para>
            est un assistant binaire qui met à jour le mot de passe d'un utilisateur
donné
          </para>
          <indexterm zone="linux-pam unix_update">
            <primary sortas="b-unix_update">unix_update</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libpam">
        <term><filename class="libraryfile">libpam.so</filename></term>
        <listitem>
          <para>
            fournit les interfaces entre les applications et les modules PAM
          </para>
          <indexterm zone="linux-pam libpam">
            <primary sortas="c-libpam">libpam.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
