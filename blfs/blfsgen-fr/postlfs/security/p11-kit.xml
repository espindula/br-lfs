<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY p11-kit-download-http "https://github.com/p11-glue/p11-kit/releases/download/&p11-kit-version;/p11-kit-&p11-kit-version;.tar.xz">
  <!ENTITY p11-kit-download-ftp  "">
  <!ENTITY p11-kit-md5sum        "8ccf11c4a2e2e505b8e516d8549e64a5">
  <!ENTITY p11-kit-size          "816&nbsp;Ko">
  <!ENTITY p11-kit-buildsize     "56&nbsp;Mo (avec les tests)">
  <!ENTITY p11-kit-time          "0.2&nbsp;SBU (plus 0.6&nbsp;SBU pour les tests)">
]>

<sect1 id="p11-kit" xreflabel="p11-kit-&p11-kit-version;">
  <?dbhtml filename="p11-kit.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>p11-kit-&p11-kit-version;</title>

  <indexterm zone="p11-kit">
    <primary sortas="a-p11-kit">p11-kit</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à p11-kit</title>

    <para>
      Le paquet <application>p11-kit</application> offre une façon de charger et
d'énumérer les modules PKCS #11 (un standard d'interface de chiffrement).
    </para>

    &lfs110a_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&p11-kit-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&p11-kit-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &p11-kit-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &p11-kit-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &p11-kit-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &p11-kit-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de p11-kit</bridgehead>

    
    <!-- There is a check for libsystemd. It seems to install a systemd service
    in /usr/lib/systemd/user.-->
<bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="libtasn1"/> et <xref role="runtime" linkend="make-ca"/>
(exécution)
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="gtk-doc"/>, <xref linkend="libxslt"/> et <xref role="runtime"
linkend="nss"/> (exécution)
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/p11-kit"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de p11-kit</title>

    <para>
      Préparez le crochet d'ancrage spécifique à la distribution&nbsp;:
    </para>

<screen><userinput>sed '20,$ d' -i trust/trust-extract-compat &amp;&amp;
cat &gt;&gt; trust/trust-extract-compat &lt;&lt; "EOF"
<literal># Copy existing anchor modifications to /etc/ssl/local
/usr/libexec/make-ca/copy-trust-modifications

# Generate a new trust store
/usr/sbin/make-ca -f -g</literal>
EOF</userinput></screen>

    <para>
      Installez <application>p11-kit</application> en lançant les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>mkdir p11-build &amp;&amp;
cd    p11-build &amp;&amp;

meson --prefix=/usr       \
      --buildtype=release \
      -Dtrust_paths=/etc/pki/anchors &amp;&amp;
ninja</userinput></screen>

    <para>
      Pour tester les résultats lancez&nbsp;: <command>ninja test</command>. 
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>ninja install &amp;&amp;
ln -sfv /usr/libexec/p11-kit/trust-extract-compat \
        /usr/bin/update-ca-certificates</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/meson-buildtype-release.xml"/>

    <para>
      <parameter>-Dtrust_paths=/etc/pki/anchors</parameter>&nbsp;: ce paramètre
initialise l'emplacement des certificats de confiance utilisés par
libp11-kit.so.
    </para>

    <para>
      <option>-Dhash_impl=freebl</option>&nbsp;: Utilisez ce paramètre si vous
voulez utiliser la bibliothèque Freebl de <application>NSS</application>
pour le calcul des hashs SHA1 et MD5.
    </para>

    <para>
      <option>-Dgtk_doc=true</option>&nbsp;: Utilisez ce paramètre si vous avez
installé <xref linkend="gtk-doc"/> et <xref linkend="libxslt"/> et souhaitez
reconstruire la documentation et générer les pages de manuel.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de p11-kit</title>

    <para>
      Le module de confiance <application>p11-kit</application>
(<filename>/usr/lib/libp11-kit.so</filename>) peut être utilisé comme
remplaçant de <filename>/usr/lib/libnssckbi.so</filename> pour rendre les CA
du système disponibles de manière transparente pour les applications
conscientes de <application>NSS</application>, plutôt qu'une liste statique
fournie par <filename>/usr/lib/libnssckbi.so</filename>. En tant
qu'utilisateur <systemitem class="username">root</systemitem>, exécutez les
commandes suivantes&nbsp;:
    </para>

<screen role="root"><userinput>ln -sfv ./pkcs11/p11-kit-trust.so /usr/lib/libnssckbi.so</userinput></screen>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          p11-kit, trust et update-ca-certificates
        </seg>
        <seg>
          libp11-kit.so et p11-kit-proxy.so
        </seg>
        <seg>
          /etc/pkcs11, /usr/include/p11-kit-1, /usr/lib/pkcs11, /usr/libexec/p11-kit,
/usr/share/gtk-doc/html/p11-kit et /usr/share/p11-kit
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="p11-kit-prog">
        <term><command>p11-kit</command></term>
        <listitem>
          <para>
            est un outil en ligne de commande qui peut être utilisé pour faire des
opérations sur les modules PKCS#11 configurés sur le système
          </para>
          <indexterm zone="p11-kit p11-kit-prog">
            <primary sortas="b-p11-kit">p11-kit</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="trust">
        <term><command>trust</command></term>
        <listitem>
          <para>
            est un outil en ligne de commandes pour examiner et modifier le stockage de
la politique de partage
          </para>
          <indexterm zone="p11-kit trust">
            <primary sortas="b-trust">trust</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="update-ca-certificates">
        <term><command>update-ca-certificates</command></term>
        <listitem>
          <para>
            est un outil en ligne de commande pour extraire les certificats locaux d'une
banque de certificats dont les ancres ont été modifiées et pour régénérer
toutes les ancres et les banques de certificats sur le système. Cela est
possible sans condition sur BLFS avec les drapeaux
<parameter>--force</parameter> et <parameter>--get</parameter> de
<command>make-ca</command> mais ils ne devraient pas être utilisés pour des
mises à jour automatiques
          </para>
          <indexterm zone="p11-kit update-ca-certificates">
            <primary sortas="b-update-ca-certificates">update-ca-certificates</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libp11-kit">
        <term><filename class="libraryfile">libp11-kit.so</filename></term>
        <listitem>
          <para>
            contient les fonctions utilisées pour coordonner l'initialisation et la
finalisation d'un module PKCS#11
          </para>
          <indexterm zone="p11-kit libp11-kit">
            <primary sortas="c-libp11-kit">libp11-kit.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="p11-kit-proxy">
        <term><filename class="libraryfile">p11-kit-proxy.so</filename></term>
        <listitem>
          <para>
            est un module proxy PKCS#11
          </para>
          <indexterm zone="p11-kit p11-kit-proxy">
            <primary sortas="c-p11-kit-proxy">p11-kit-proxy.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
