<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY stunnel-download-http "">
  <!-- Following ftp also has older releases -->
  <!ENTITY stunnel-download-ftp  "ftp://ftp.stunnel.org/stunnel/archive/5.x/stunnel-&stunnel-version;.tar.gz">
  <!-- Following ftp only has later release -->
<!--   "ftp://ftp.stunnel.org/stunnel/stunnel-&stunnel-version;.tar.gz"> -->
  <!ENTITY stunnel-md5sum        "947c1e114a217f2cf2adaabc5573788c">
  <!ENTITY stunnel-size          "968&nbsp;Ko">
  <!ENTITY stunnel-buildsize     "8.8&nbsp;Mo">
  <!ENTITY stunnel-time          "0.1 SBU">
]>

<sect1 id="stunnel" xreflabel="stunnel-&stunnel-version;">
  <?dbhtml filename="stunnel.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>stunnel-&stunnel-version;</title>

  <indexterm zone="stunnel">
    <primary sortas="a-stunnel">stunnel</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à stunnel</title>

    <para>
      Le paquet <application>Stunnel</application> contient un programme qui vous
permet de chiffrer des connexions TCP de votre choix en SSL (Secure Sockets
Layer) pour que vous puissiez communiquer facilement avec des clients par
des canaux sécurisés. <application>Stunnel</application> peut être utilisé
pour ajouter la fonctionnalité SSL aux démons
<application>Inetd</application> couramment utilisés comme les serveurs
POP-2, POP-3, et IMAP, aussi bien qu'à des démons autonomes comme NNTP, SMTP
et HTTP. <application>Stunnel</application> peut aussi être utilisé pour les
tunnels PPP par des sockets réseaux sans modifications du code source du
paquet du serveur.
    </para>

    &lfs101_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&stunnel-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&stunnel-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement&nbsp;: &stunnel-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &stunnel-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &stunnel-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &stunnel-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de stunnel</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <ulink url="http://netcat.sourceforge.net/">netcat</ulink> (requis pour les
tests), <ulink
url="ftp://ftp.porcupine.org/pub/security/">tcpwrappers</ulink> et <ulink
url="https://dist.torproject.org/">TOR</ulink>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/stunnel"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de stunnel</title>

    <para>
      Le démon <command>Stunnel</command> sera lancé dans une cage
<command>chroot</command> par un utilisateur non privilégié. Créez le nouvel
utilisateur et le nouveau groupe en utilisant les commandes suivantes en
tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>groupadd -g 51 stunnel &amp;&amp;
useradd -c "stunnel Daemon" -d /var/lib/stunnel \
        -g stunnel -s /bin/false -u 51 stunnel</userinput></screen>

    <note>
      <para>
        Un certificat SSL signé et une clé privée sont nécessaires pour lancer le
démon <command>stunnel</command>. Après l'installation du paquet, il y a des
instructions pour les générer. Cependant si vous possédez ou si vous avez
déjà créé un certificat SSL signé que vous souhaitez l'utiliser, copiez-le
dans <filename>/etc/stunnel/stunnel.pem</filename> avant de commencer la
construction (assurez-vous que seul <systemitem
class="username">root</systemitem> a l'accès en lecture et écriture). Le
fichier <filename class="extension">.pem</filename> doit être formaté comme
décrit ci-dessous&nbsp;:
      </para>

<screen><literal>-----BEGIN PRIVATE KEY-----
<replaceable>&lt;many encrypted lines of private key&gt;</replaceable>
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
<replaceable>&lt;many encrypted lines of certificate&gt;</replaceable>
-----END CERTIFICATE-----
-----BEGIN DH PARAMETERS-----
<replaceable>&lt;encrypted lines of dh parms&gt;</replaceable>
-----END DH PARAMETERS-----</literal></screen>

    </note>

    <para>
      Installez <application>stunnel</application> en lançant les commandes
suivantes&nbsp;:
    </para>



<screen revision="sysv"><!-- Not needed, we're 10+ versions ahead of this now
    <note>
      <para>
        For some systems with <application>binutils</application>
        versions prior to 2.25, <command>configure</command> may fail.  If
        necessary, fix it either with:
      </para>

<screen><userinput>sed -i '/LDFLAGS.*static_flag/ s/^/#/' configure</userinput>
</screen>

      <para>
        or, if <xref linkend="llvm"/> with Clang is installed, you can
        replace <command>./configure ...</command> with <command>CC=clang
        ./configure ...</command> in the first command below.
      </para>
    </note>
-->
<userinput>./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --localstatedir=/var \
            --disable-systemd    &amp;&amp;
make</userinput></screen>

<screen revision="systemd"><userinput>./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --localstatedir=/var &amp;&amp;
make</userinput></screen>

    <para>
      Si vous avez installé l'application netcat facultative, les tests de
regression peuvent être lancés avec <command>make check</command>.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make docdir=/usr/share/doc/stunnel-&stunnel-version; install</userinput></screen>

    <para revision="systemd">
      Installez l'unité systemd incluse en lançant la commande suivante en tant
qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>install -v -m644 tools/stunnel.service /usr/lib/systemd/system</userinput></screen>

    <para>
      Si vous n'avez pas déjà un certificat SSL signé et une clé privée, créez le
fichier <filename>stunnel.pem</filename> dans le répertoire <filename
class="directory">/etc/stunnel</filename> en utilisant la commande
suivante. Vous aurez une invite pour rentrer les informations
nécessaires. Assurez-vous de répondre à
    </para>

<screen><prompt>Common Name (FQDN of your server) [localhost]:</prompt></screen>

    <para>
      avec le nom ou l'adresse IP que vous utiliserez pour accéder au(x)
service(s).
    </para>

    <para>
      Pour générer un certificat, en tant qu'utilisateur <systemitem
class="username">root</systemitem>, tapez&nbsp;:
    </para>

<screen role="root"><userinput>make cert</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para revision="sysv">
      <parameter>--disable-systemd</parameter>&nbsp;: Ce paramètre désactive le
support de l'activation de systemd, qui n'est pas disponible dans BLFS.
    </para>

    <para>
      <command>make docdir=... install</command>&nbsp;: Cette commande installe le
paquet et modifie le répertoire d'installation de la documentation en un nom
conforme aux conventions.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Stunnel</title>

    <sect3 id="stunnel-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/stunnel/stunnel.conf</filename>
      </para>

      <indexterm zone="stunnel stunnel-config">
        <primary sortas="e-etc-stunnel-stunnel.conf">/etc/stunnel/stunnel.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations sur la configuration</title>

      <para>
        En tant qu'utilisateur <systemitem class="username">root</systemitem>, créez
le répertoire utilisé pour le fichier <filename
class="extension">.pid</filename> créé quand le démon
<application>Stunnel</application> démarre&nbsp;:
      </para>

<screen role="root"><userinput>install -v -m750 -o stunnel -g stunnel -d /var/lib/stunnel/run &amp;&amp;
chown stunnel:stunnel /var/lib/stunnel</userinput></screen>

      <para>
        Ensuite, créez un fichier de configuration
<filename>/etc/stunnel/stunnel.conf</filename> de base en utilisant les
commandes suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

<screen role="root"><userinput>cat &gt; /etc/stunnel/stunnel.conf &lt;&lt; "EOF" 
<literal>; File: /etc/stunnel/stunnel.conf

; Note: The pid and output locations are relative to the chroot location.

pid    = /run/stunnel.pid
chroot = /var/lib/stunnel
client = no
setuid = stunnel
setgid = stunnel
cert   = /etc/stunnel/stunnel.pem

;debug = 7
;output = stunnel.log

;[https]
;accept  = 443
;connect = 80
;; "TIMEOUTclose = 0" is a workaround for a design flaw in Microsoft SSL
;; Microsoft implementations do not use SSL close-notify alert and thus
;; they are vulnerable to truncation attacks
;TIMEOUTclose = 0</literal>

EOF</userinput></screen>

      <para>
        Enfin, ajoutez le(s) service(s) que vous souhaitez chiffrer au fichier de
configuration. Le format ressemble à ce qui suit&nbsp;:
      </para>

<screen><literal>[<replaceable>&lt;service&gt;</replaceable>]
accept  = <replaceable>&lt;hostname:portnumber&gt;</replaceable>
connect = <replaceable>&lt;hostname:portnumber&gt;</replaceable></literal></screen>

      <para>
        Si vous utilisez <application>Stunnel</application> pour chiffrer un démon
lancé à partir de <command>[x]inetd</command>, il se peut que vous deviez
désactiver ce démon dans le fichier <filename>/etc/[x]inetd.conf</filename>
et activer un service <replaceable>&lt;service&gt;</replaceable>_stunnel
correspondant. Il se peut que vous deviez également ajouter une entrée
adéquate dans <filename>/etc/services</filename>.
      </para>

      <para>
        Pour une explication complète des commandes et de leurs syntaxes, utilisées
dans le fichier de configuration, lancez <command>man stunnel</command>.
      </para>

    </sect3>

    <sect3  id="stunnel-init">
      <title><phrase revision="sysv">Script de démarrage</phrase> <phrase
revision="systemd">Unité Systemd</phrase></title>

      <para revision="sysv">
        Pour démarrer automatiquement le démon <command>stunnel</command> quand on
démarre le système, installez le script de démarrage
<filename>/etc/rc.d/init.d/stunnel</filename> du paquet <xref
linkend="bootscripts"/>.
      </para>

      <para revision="systemd">
        Pour démarrer le démon <command>stunnel</command> au démarrage, activez
l'unité <application>systemd</application> précédemment installée en lançant
la commande suivante en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
      </para>

      <indexterm zone="stunnel stunnel-init">
        <primary sortas="f-stunnel">stunnel</primary>
      </indexterm>

<screen role="root" revision="sysv"><userinput>make install-stunnel</userinput></screen>

<screen role="root" revision="systemd"><userinput>systemctl enable stunnel</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          stunnel et stunnel3
        </seg>
        <seg>
          libstunnel.so
        </seg>
        <seg>
          /{etc,usr/lib,var/lib}/stunnel and /usr/share/doc/stunnel-&stunnel-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="stunnel-prog">
        <term><command>stunnel</command></term>
        <listitem>
          <para>
            est un programme conçu pour fonctionner en tant qu'enveloppe SSL chiffrée
entre des clients distants et locaux (<command>{x}inetd</command>-startable)
ou des serveurs distants
          </para>
          <indexterm zone="stunnel stunnel-prog">
            <primary sortas="b-stunnel">stunnel</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="stunnel3">
        <term><command>stunnel3</command></term>
        <listitem>
          <para>
            est un script enveloppe <application>Perl</application> pour utiliser la
syntaxe <command>stunnel</command> 3.x avec <command>stunnel</command>
&gt;=4.05
          </para>
          <indexterm zone="stunnel stunnel3">
            <primary sortas="b-stunnel3">stunnel3</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libstunnel">
        <term><filename class="libraryfile">libstunnel.so</filename></term>
        <listitem>
          <para>
            contient les fonctions API exigées par <application>Stunnel</application>
          </para>
          <indexterm zone="stunnel libstunnel">
            <primary sortas="c-libstunnel">libstunnel.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
