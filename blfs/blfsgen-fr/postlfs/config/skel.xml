<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="postlfs-config-skel" xreflabel="Configuration de l'ajout d'utilisateurs">
  <?dbhtml filename="skel.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>Configuration de l'ajout d'utilisateurs</title>

  <indexterm zone="postlfs-config-skel">
    <primary sortas="e-etc-skel">/etc/skel/*</primary>
  </indexterm>

  <indexterm zone="postlfs-config-skel">
    <primary sortas="e-etc-default-useradd">/etc/default/useradd</primary>
  </indexterm>

  <para>
    Ensembles, la commande <command>/usr/sbin/useradd</command> et le répertoire
<filename class="directory">/etc/skel</filename> (on peut les paramétrer et
les utiliser facilement) offrent un moyen de garantir que les nouveaux
utilisateurs soient ajoutés à votre système LFS avec les mêmes réglages de
base d'éléments tels que le <envar>PATH</envar>, le traitement du clavier et
d'autres variables d'environnement. L'utilisation de ces deux possibilités
facilite la garantie de cet état initial pour tous les nouveaux utilisateurs
ajoutés au système.
  </para>

  <para>
    Le répertoire <filename class="directory">/etc/skel</filename> contient des
copies de divers fichiers d'initialisation ou autres qui peuvent être copiés
dans le répertoire home du nouvel utilisateur lorsque la commande
<command>/usr/sbin/useradd</command> ajoute le nouvel utilisateur.
  </para>

  <bridgehead renderas="sect5">Useradd</bridgehead>

  <para>
    Le programme <command>useradd</command> utilise un ensemble de valeurs par
défaut contenues dans <filename>/etc/default/useradd</filename>. Ce fichier
est créé dans une installation de LFS de base par le paquet
<application>Shadow</application>. S'il a été supprimé ou renommé, le
programme <command>useradd</command> utilise des paramères par défaut
internes. Vous pouvez voir les valeurs par défaut en lançant
<command>/usr/sbin/useradd -D</command>.
  </para>

  <para>
    Pour modifier ces valeurs, modifiez simplement le fichier
<filename>/etc/default/useradd</filename> en tant qu'utilisateur <systemitem
class='username'>root</systemitem>. Une alternative à la modification
directe du fichier consiste à exécuter <command>useradd</command> en tant
qu'utilisateur <systemitem class='username'>root</systemitem> en fournissant
les modifications désirées sur la ligne de commande. Vous pouvez trouver des
informations sur la façon de faire cela dans la page de man de
<command>useradd</command>.
  </para>

  <bridgehead renderas="sect5">/etc/skel</bridgehead>

  <para>
    Pour commencer, créez un répertoire <filename
class="directory">/etc/skel</filename> et assurez-vous qu'il n'est
modifiable en écriture que par l'administrateur du système, en général
<systemitem class="username">root</systemitem>. La création de ce répertoire
en tant que <systemitem class="username">root</systemitem> est la meilleure
manière de faire.
  </para>

  <para>
    Les droits des fichiers issus de cette partie du livre que vous mettez dans
<filename class="directory">/etc/skel</filename> devraient n'être
modifiables que par leur propriétaire. En outre, puisqu'il n'existe pas de
règle sur le genre d'informations sensibles qu'un utilisateur peut
éventuellement mettre dans leur copie de ces fichiers, vous devriez les
rendre inaccessibles en lecture par «&nbsp;group&nbsp;» et
«&nbsp;other&nbsp;» (autres).
  </para>

  <para>
    Vous pouvez également mettre d'autres fichiers dans <filename
class="directory">/etc/skel</filename> et il se peut que différents droits
leur soient nécessaires.
  </para>

  <para>
    Décidez des fichiers d'initialisation qui devraient être fournis dans chaque
(ou la plupart des) répertoire home d'un nouvel utilisateur. Les décisions
que vous prendrez changeront ce que vous ferez dans les deux prochaines
sections, <xref linkend="postlfs-config-profile"/> et <xref
linkend="postlfs-config-vimrc"/>. Certains ou tous ces fichiers seront
utiles à <systemitem class="username">root</systemitem>, aux utilisateurs
qui existent déjà et aux nouveaux utilisateurs.
  </para>

  <para>
    Les fichiers de ces sections que vous pourriez vouloir mettre dans <filename
class="directory">/etc/skel</filename> comprennent
<filename>.inputrc</filename>, <filename>.bash_profile</filename>,
<filename>.bashrc</filename>, <filename>.bash_logout</filename>,
<filename>.dircolors</filename> et <filename>.vimrc</filename>. Si vous
n'êtes pas sûr qu'ils devraient être mis là, poursuivez simplement les
sections suivantes, lisez chaque section et les références fournies, puis
prenez votre décision.
  </para>

  <para>
    Vous lancerez un jeu de commandes légèrement différent pour les fichiers qui
se trouvent dans <filename class="directory">/etc/skel</filename>. Chaque
section vous le rappellera. En bref, les commandes du livre ont été écrites
pour des fichiers <emphasis>non</emphasis> ajoutés à <filename
class="directory">/etc/skel</filename> et elles envoient simplement les
résultats dans le répertoire personnel de l'utilisateur. Si le fichier va
être dans <filename class="directory">/etc/skel</filename>, modifiez la/les
commande(s) du livre pour y envoyer la sortie au lieu de juste copier le
fichier de <filename class="directory">/etc/skel</filename> vers les
répertoires adéquats, comme <filename class="directory">/etc</filename>,
<filename class="directory">~</filename> ou le répertoire home d'un autre
utilisateur déjà sur le systéme.
  </para>

  <bridgehead renderas="sect5">Lors de l'ajout d'un utilisateur</bridgehead>

  <para>
    Lors de l'ajout d'un nouvel utilisateur avec <command>useradd</command>,
utilisez le paramètre <option>-m</option> qui dit à
<command>useradd</command> de créer le répertoire home de l'utilisateur et
de copier les fichiers de <filename class="directory">/etc/skel</filename>
(il peut être écrasé)  vers le répertoire home du nouvel utilisateur. Par
exemple (effectuez ceci en tant qu'utilisateur <systemitem
class="username">root</systemitem>)&nbsp;:
  </para>

<screen role="root"><userinput>useradd -m <replaceable>&lt;newuser&gt;</replaceable></userinput></screen>

  <para>
    If you are sharing a <filename class="directory">/home</filename> or
<filename class="directory">/usr/src</filename> with another Linux distro
(for example, the host distro used for building LFS), you can create a user
with the same UID (and, same primary group GID) to keep the file ownership
consistent across the systems.  First, on <emphasis>the other
distro</emphasis>, get the UID of the user and the GID of the user's primary
group:
  </para>

<screen role="nodump"><userinput>getent passwd <replaceable>&lt;username&gt;</replaceable> | cut -d ':' -f 3,4</userinput></screen>

  <para>
    The command should output the UID and GID, separated by a colon.  Now on the
BLFS system, create the primary group and the user:
  </para>

<screen role="root"><userinput>groupadd -g <replaceable>&lt;GID&gt;</replaceable> <replaceable>&lt;username&gt;</replaceable> &amp;&amp;
useradd -u <replaceable>&lt;UID&gt;</replaceable> -g <replaceable>&lt;username&gt;</replaceable> <replaceable>&lt;username&gt;</replaceable></userinput></screen>

</sect1>
