<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../../general.ent">
  %general-entities;

  <!ENTITY grub-efi-download-http "https://ftp.gnu.org/gnu/grub/grub-&grub-version;.tar.xz">
  <!ENTITY grub-efi-download-ftp  "">
  <!ENTITY grub-efi-md5sum        "cf0fd928b1e5479c8108ee52cb114363">
  <!ENTITY grub-efi-size          "6.3&nbsp;Mo">
  <!ENTITY grub-efi-buildsize     "137&nbsp;Mo">
  <!ENTITY grub-efi-time          "1.0&nbsp;SBU">

  <!ENTITY unifont-download-http  "https://unifoundry.com/pub/unifont/unifont-&unifont-version;/font-builds/unifont-&unifont-version;.pcf.gz">
  <!ENTITY unifont-md5sum         "8191ca4fce0eb6073d47c7573e6babc1">
  <!ENTITY unifont-size           "1.3&nbsp;Mo">
]>

<sect1 id="grub-efi" xreflabel="GRUB-&grub-version; for EFI">
  <?dbhtml filename="grub-efi.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>GRUB-&grub-version; pour EFI</title>

  <indexterm zone="grub-efi">
    <primary sortas="a-grub-efi">grub-efi</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à GRUB</title>

    <para>
      Le paquet <application>Grub</application> contient un chargeur de démarrage,
le <foreignphrase>GRand Unified Bootloader</foreignphrase>. Dans cette page
il sera construit avec la prise en charge d'UEFI, qui n'était pas activée
dans le GRUB construit dans LFS.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&grub-efi-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&grub-efi-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &grub-efi-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &grub-efi-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &grub-efi-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &grub-efi-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>

    <itemizedlist spacing="compact">
      <title>Données de polices unicode utilisées pour afficher le menu de GRUB</title>
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&unifont-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &unifont-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &unifont-size;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de GRUB</bridgehead>

    <bridgehead renderas="sect4">Requis (à l'exécution)</bridgehead>
    <para role="runtime">
      <xref linkend="efibootmgr"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="freetype2"/>
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <xref linkend="lvm2"/>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/grub-efi"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de GRUB</title>

    <warning>
      <para>
        The instruction does not work correctly on 32-bit LFS system at now.
      </para>
    </warning>

    <para>
      Tout d'abord, installez les données de police en tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>mkdir -pv /usr/share/fonts/unifont &amp;&amp;
gunzip -c ../unifont-&unifont-version;.pcf.gz > /usr/share/fonts/unifont/unifont.pcf</userinput></screen>

    <warning>
      <para>Nettoyez les variables d'environnement qui peuvent affecter la
construction&nbsp;:</para>

      <screen><userinput>unset {C,CPP,CXX,LD}FLAGS</userinput></screen>

      <para>N'essayez pas de <quote>régler</quote> ce paquet avec des drapeaux de
compilation personnalisés&nbsp;: ce paquet est un chargeur d'amorçage, avec
des opérations de bas-niveau dans le code source qui seront sans doute
cassées par certaines optimisations agressives.</para>
    </warning>

    <para>
      Construisez <application>GRUB</application> avec les commandes
suivantes&nbsp;:
    </para>

<screen><userinput>./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --disable-efiemu     \
            --enable-grub-mkfont \
            --with-platform=efi  \
            --disable-werror     &amp;&amp;
make</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests qui fournisse des résultats
intéressants.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
mv -v /etc/bash_completion.d/grub /usr/share/bash-completion/completions</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <parameter>--enable-grub-mkfont</parameter>&nbsp;: construit l'outil
<command>grub-mkfont</command> pour générer le fichier de polices pour le
chargeur d'amorçage à partir des données de police qu'on a installées.
    </para>

    <warning>
      <para>If the recommended dependency <xref linkend="freetype2"/> is not installed,
it is possible to omit this option and build GRUB.  However, if
<command>grub-mkfont</command> is not built, or the unicode font data is not
available at the time GRUB is built, GRUB won't install any font for the
boot loader.  The GRUB boot menu will be displayed using a coarse font and
the early stage of kernel initialization will be in <quote>blind
mode</quote> &mdash; you can't see any kernel messages before the graphics
card driver is initialized.  It will be very difficult to diagnose some boot
issues, especially if the graphics driver is built as module.</para>
    </warning>

    <para>
      <parameter>--with-platform=efi</parameter>&nbsp;: s'assure de construire
GRUB avec EFI activé.
    </para>

    <para>
      <option>--target=i386</option>: Some x86_64 systems have 32-bit UEFI
implementation, but they are very old and rare.  Do <emphasis
role='bold'>not</emphasis> use this option unless you are absolutely sure
that LFS is running on such a system.
    </para>

  </sect2>

  <sect2>
    <title>Configuration de GRUB</title>

    <para>
      On discute de comment utiliser GRUB pour rendre le système LFS amorçable sur
une plateforme UEFI sur <xref linkend="grub-setup"/>.
    </para>
  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <para>Voir la page pour GRUB dans le livre LFS.</para>
  </sect2>

</sect1>
