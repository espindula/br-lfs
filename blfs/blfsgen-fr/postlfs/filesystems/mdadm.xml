<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY mdadm-download-http "&kernel-dl;/linux/utils/raid/mdadm/mdadm-&mdadm-version;.tar.xz">
  <!ENTITY mdadm-download-ftp "">
  <!ENTITY mdadm-md5sum        "a304eb0a978ca81045620d06547050a6">
  <!ENTITY mdadm-size          "444&nbsp;Ko">
  <!ENTITY mdadm-buildsize     "5.0&nbsp;Mo">
  <!ENTITY mdadm-time          "0.1&nbsp;SBU">
<!--  <!ENTITY mdadm-time          "0.1 SBU (tests take about an hour, only partially processor dependent)">-->
]>

<sect1 id="mdadm" xreflabel="mdadm-&mdadm-version;">
  <?dbhtml filename="mdadm.html"?>

  <sect1info>
<date>$Date$</date></sect1info>

  <title>mdadm-&mdadm-version;</title>

  <indexterm zone="mdadm">
    <primary sortas="a-mdadm">mdadm</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à mdadm</title>

    <para>
      Le paquet <application>mdadm</application> contient les outils
d'administrations pour les RAID logiciels.
    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&mdadm-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&mdadm-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &mdadm-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &mdadm-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &mdadm-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &mdadm-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de mdadm</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      Un <xref linkend="server-mail"/>
    </para>
    

    <!-- Contains -DSendmail=/usr/sbin/sendmail in the build procedure -->
<para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/mdadm"/></para>
    <caution>
      <para>
        Les noyaux entre 4.1 et 4.4.1 ont une implémentation RAID cassée. Vous
devriez installer un noyau en version 4.4.2 ou supérieur.
      </para>
    </caution>

  </sect2>

  <sect2 role="kernel" id='mdadm-kernel'>
    <title>Configuration du noyau</title>

    <para>
      Autoriser les options suivantes dans la configuration du noyau et recompiler
le noyau, si nécessaire. Seulement le type de RAID souhaité est nécessaire.
    </para>

<screen><literal>Device Drivers ---&gt;
  [*] Multiple devices driver support (RAID and LVM) ---&gt; [CONFIG_MD]
    &lt;*&gt; RAID support                                      [CONFIG_BLK_DEV_MD]
    [*]   Autodetect RAID arrays during kernel boot       [CONFIG_MD_AUTODETECT]
    &lt;*/M&gt;  Linear (append) mode                           [CONFIG_MD_LINEAR]
    &lt;*/M&gt;  RAID-0 (striping) mode                         [CONFIG_MD_RAID0]
    &lt;*/M&gt;  RAID-1 (mirroring) mode                        [CONFIG_MD_RAID1]
    &lt;*/M&gt;  RAID-10 (mirrored striping) mode               [CONFIG_MD_RAID10]
    &lt;*/M&gt;  RAID-4/RAID-5/RAID-6 mode                      [CONFIG_MD_RAID456]</literal></screen>

    <indexterm zone="mdadm mdadm-kernel">
      <primary sortas="d-mdadm">mdadm</primary>
    </indexterm>

  </sect2>

  <sect2 role="installation">
    <title>Installation de mdadm</title>

    <!--
    <para>

      Fix a build error introduced by gcc-7.1:
    </para>

<screen><userinput>sed 's@-Werror@@' -i Makefile</userinput></screen>
-->
<para>
      Construisez <application>mdadm</application> en exécutant la commande
suivante&nbsp;:
    </para>

<screen><userinput>make</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de test fonctionnelle.
    </para>


    <!--
    The test suite errors out after about half the tests are run.
    Of those tests, about half fail.
    There are tests that indicate failure when the test is clearly wrong
    for the current code.
    I asked about it at linux-raid@vger.kernel.org, but did not get
    a responsive answer.
      - bdubbs 6 January 22


    <para>

      If you wish to run the tests, ensure that your kernel supports RAID
      and that a version of mdadm is not already running.  As many as 9 out
      of 124 tests may fail.
    </para>

    <caution>
      <para>
        The tests edit values in /proc and run tests on software raid devices.
        They shouldn't be run on systems with active software RAID devices.
      </para>
    </caution>

    <para>
      Run the tests as the <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"
        remap="test"><userinput>./test - -keep-going - -logdir=test-logs - -save-logs</userinput></screen>
-->
<para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>make BINDIR=/usr/sbin install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <!-- and also versions of
      <command>
mdassemble</command>. These all need to be manually installed.-->
<command>make everything</command>&nbsp;: cette cible facultative crée des
programmes supplémentaires, en particulier une version liée statiquement de
<command>mdadm</command>. Ils doivent tous être installés manuellement.
    </para>

    <para>
      <parameter>--keep-going</parameter>&nbsp;: Exécute les tests jusqu'à la fin,
même si un ou plusieurs tests échouent.
    </para>

    <para>
      <parameter>--logdir=test-logs</parameter>&nbsp;: Défini dans quel répertoire
les logs de tests sont sauvegardés.
    </para>

    <para>
      <parameter>--save-logs</parameter>&nbsp;: Indique à la suite de tests de
sauvegarder les logs.
    </para>

    <para>
      <option>--tests=<replaceable>&lt;test1,test2,...&gt;</replaceable></option>&nbsp;:
liste facultative de tests à exécuter, séparés par des virgules (tous les
tests si cette option n'est pas donnée).
    </para>

  </sect2>


  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoire installé</segtitle>

      <seglistitem>
        <seg><!--and optionally mdassemble-->
mdadm et mdmon </seg>
        <seg>Aucune</seg>
        <seg>Aucun</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="mdadm-prog">
        <term><command>mdadm</command></term>
        <listitem>
          <para>
            gère les périphériques MD aka les RAID logiciels Linux
          </para>
          <indexterm zone="mdadm mdadm-prog">
            <primary sortas="b-mdadm-prog">mdadm</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mdmon">
        <term><command>mdmon</command></term>
        <listitem>
          <para>
            surveille les métadonnées externes des grappes MD
          </para>
          <indexterm zone="mdadm mdmon">
            <primary sortas="b-mdmon">mdmon</primary>
          </indexterm>
        </listitem>
      </varlistentry>

<!-- Seems to be removed without a trace in 4.1
      <varlistentry id="mdassemble">

        <term><command>mdassemble</command></term>
        <listitem>
          <para>
            is a tiny program that can be used to assemble MD devices
            inside an initial ramdisk (initrd) or initramfs
          </para>
          <indexterm zone="mdadm mdassemble">
            <primary sortas="b-mdassemble">mdassemble</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      -->
      

    </variablelist>

  </sect2>

</sect1>
