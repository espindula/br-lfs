<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY thunderbird-download-http "&mozilla-http;/thunderbird/releases/&thunderbird-version;/source/thunderbird-&thunderbird-version;.source.tar.xz">
  <!ENTITY thunderbird-download-ftp  "">
  <!ENTITY thunderbird-md5sum        "aebf4e44e428cf0a9055024b96721624">
  <!ENTITY thunderbird-size          "484&nbsp;Mo">
  <!ENTITY thunderbird-buildsize     "7.2 GB (201 MB installed)">
  <!ENTITY thunderbird-time          "20&nbsp;SBU (sur une machine à 4 cœurs)">
  <!-- Removed the -j1 time because python and rust do not obey it, although
       the C/C++ code appears to obey it.

       Version 102.3.3: I disabled all but 4 cores.  SBU was 20 (2019 seconds)
       -->
]>

<sect1 id="thunderbird" xreflabel="Thunderbird-&thunderbird-version;">
  <?dbhtml filename="thunderbird.html" ?>


  <title>Thunderbird-&thunderbird-version;</title>

  <indexterm zone="thunderbird">
    <primary sortas="a-Thunderbird">Thunderbird</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Thunderbird</title>

    <para>
      <application>Thunderbird</application> est un client autonome de mail/news
basé sur le code source de <application>Mozilla</application>. Il utilise le
moteur de rendement Gecko afin d'afficher et d'écrire des courriels HTML
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&thunderbird-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&thunderbird-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &thunderbird-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &thunderbird-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &thunderbird-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &thunderbird-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink
url="&patch-root;/thunderbird-&thunderbird-version;-consolidated-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Thunderbird</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <!--and <xref linkend="gtk2"/>
,-->
<!-- used by default if found -->
<!--<xref linkend="yasm"/>
-->
<xref linkend="autoconf213"/>, <xref linkend="cbindgen"/>, <xref
linkend="dbus-glib"/>, <xref linkend="gtk3"/>, <xref linkend="llvm"/> avec
clang, <xref linkend="nodejs"/>, <xref linkend="pulseaudio"/> (ou <xref
linkend="alsa-lib"/> si vous modifiez le mozconfig, bien qu'il soit
maintenant considéré obsolète par mozilla), <xref linkend="python3"/>
(reconstruit avec le module sqlite), <xref linkend="startup-notification"/>,
<xref linkend="zip"/> et <xref linkend="unzip"/>
      
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="icu"/>, <xref linkend="libevent"/>, <xref linkend="libvpx"/>,
<xref linkend="nasm"/>, <xref linkend="nspr"/> et <xref linkend="nss"/>
    </para>

    <note>
      <para>
        Si vous n'installez pas les dépendances recommandées, alors des copies
internes de ces paquets seront utilisés. Elles sont certes testées pour
fonctionner, mais elles peuvent être dépassées et contenir des trous de
sécurité.
      </para>
    </note>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      
      
      
      <!--<xref linkend="cyrus-sasl"/>
,-->
<!--<xref linkend="doxygen"/>
,-->
<!--<xref linkend="GConf"/>
,-->
<xref linkend="wget"/>, <xref linkend="wireless_tools"/> et <ulink
url="https://facebook.github.io/watchman/">watchman</ulink>
    </para>

    <para condition="html" role="usernotes">
      Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/Thunderbird"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Installation de Thunderbird</title>

    <note>
      <para>
        Le processus de construction pour Thunderbird peut utiliser plus de 8 Go de
RAM lors de l'édition des liens. Assurez-vous que vous avez assez de swap ou
de RAM avant de continuer.
      </para>
    </note>

    <para>
      La configuration de <application>Thunderbird</application> est réalisée en
créant un fichier <filename>mozconfig</filename> contenant les options de
configuration désirées. Un <filename>mozconfig</filename> par défaut est
créé plus bas. Pour voir la liste complète des options de configuration
disponibles (et une brève description de chacune), lancez
<command>mozilla/configure --help</command>. Créez le fichier avec la
commande suivante&nbsp;:
    </para>

<!-- Fixed in 102.9
    <para>

      A change in cbindgen-0.24.2 causes a symbol to now be output by
      cbindgen, but it has already been defined in a header. This sed
      prevents the build from eventually failing:
    </para>

<screen><userinput>sed -i '/ROOT_CLIP_CHAIN/d' gfx/webrender_bindings/webrender_ffi.h</userinput></screen>
-->
<!-- Not needed with clang
     https://bugzilla.mozilla.org/show_bug.cgi?id=1729459
    <para>

      If building on a 32 bit machine, the following sed works around
      an issue with an incompatible <quote>double</quote> type in one
      header file:
    </para>

<screen><userinput>case "$(uname -m)" in
    i?86) sed -e '/typedef[ ]*double/s/double/long double/' \
              -i modules/fdlibm/src/math_private.h ;;
esac</userinput></screen>
-->
<screen><userinput>cat &gt; mozconfig &lt;&lt; "EOF"
<literal># If you have a multicore machine, all cores will be used.

# If you have installed wireless-tools comment out this line:
ac_add_options --disable-necko-wifi

# Uncomment the following option if you have not installed PulseAudio
#ac_add_options --enable-audio-backends=alsa

# Comment out following options if you have not installed
# recommended dependencies:
ac_add_options --with-system-libevent
ac_add_options --with-system-libvpx
ac_add_options --with-system-nspr
ac_add_options --with-system-nss
ac_add_options --with-system-icu

# The elf-hack causes failed installs on some machines.
# It is supposed to improve startup time and it shrinks libxul.so
# by a few MB - comment this if you know your machine is not affected.
ac_add_options --disable-elf-hack

# The BLFS editors recommend not changing anything below this line:
ac_add_options --prefix=/usr
ac_add_options --enable-application=comm/mail

ac_add_options --disable-crashreporter
ac_add_options --disable-updater
ac_add_options --disable-debug
ac_add_options --disable-debug-symbols
ac_add_options --disable-tests

ac_add_options --enable-optimize=-O2
ac_add_options --enable-linker=gold
ac_add_options --enable-strip
ac_add_options --enable-install-strip

ac_add_options --enable-official-branding

ac_add_options --enable-system-ffi
ac_add_options --enable-system-pixman

ac_add_options --with-system-jpeg
ac_add_options --with-system-png
ac_add_options --with-system-zlib

# Using sandboxed wasm libraries has been moved to all builds instead
# of only mozilla automation builds. It requires extra llvm packages
# and was reported to seriously slow the build. Disable it.
ac_add_options --without-wasm-sandboxed-libraries</literal>
EOF</userinput></screen>



    <para>
      Fix building Thunderbird with Clang 16 or C++ headers from GCC 13.  And,
work around a crash caused by an undefined behavior in the Rust FFI code
which is exploited by Rustc using LLVM 16 as the backend:
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../thunderbird-&thunderbird-version;-consolidated-1.patch</userinput></screen>

    <para>
      Maintenant invoquez le script Python <command>mach</command> pour compiler
<application>Thunderbird</application>&nbsp;:
    </para>

    <note>
      <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
       href="../../xincludes/mozshm.xml"/>

      <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/mozmach.xml"/>

    </note>
    

<screen><!-- Fixed in 102.8
    <para>

      First remove an obsolete flag in python code, that has been removed
      in python-3.11:
    </para>

<screen><userinput>grep -rl \"rU\" | xargs sed -i 's/"rU"/"r"/'</userinput></screen>

    <para>
      Then fix an issue with regular expressions in python-3.11:
    </para>

<screen><userinput>sed -e 's/?s)\./?s:.)/'               \
    -e '/?m)/{s/?m)/?m:/;s/\$"/$)"/}' \
    -e '/?s)%/{s/?s)/?s:/;s/?"/?)"/}' \
    -i xpcom/idl-parser/xpidl/xpidl.py</userinput></screen>
-->
<userinput>export MACH_BUILD_PYTHON_NATIVE_PACKAGE_SOURCE=none &amp;&amp;
export MOZBUILD_STATE_PATH=./mozbuild               &amp;&amp;
./mach configure                                    &amp;&amp;
./mach build</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests.
    </para>

    <para>
      Installez <application>Thunderbird</application> en exécutant les commandes
suivantes en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<!-- devs: For DESTDIR install, prepend DESTDIR=<dest>
 to the above -->
<screen role="root"><userinput>MACH_BUILD_PYTHON_NATIVE_PACKAGE_SOURCE=none ./mach install</userinput></screen>

    <para>
      Videz les variables d'environnement qui ont été définies plus haut&nbsp;:
    </para>

<screen><userinput>unset MACH_BUILD_PYTHON_NATIVE_PACKAGE_SOURCE MOZBUILD_STATE_PATH</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>MACH_BUILD_PYTHON_NATIVE_PACKAGE_SOURCE=none</command>&nbsp;:
utilise le python du système pour créer un environnement virtuel pour
<command>mach</command> sans télécharger de wheel python ni utiliser les
modules python du système. Cela évite des incohérences de versions entre les
modules systèmes et ceux embarqués.
    </para>

    <para>
      <command>./mach configure</command>&nbsp;: cela valide les dépendances
fournies et le <filename>mozconfig</filename>.
    </para>

    <para>
      <option>./mach build --verbose</option>&nbsp;: utilisez cette alternative si
vous voulez des détails sur les fichiers compilés, avec les drapeaux C ou
C++ utilisés.
    </para>

    <para>
      <option>./mach build -jN</option>&nbsp;: la construction devrait, par
défaut, utiliser tous les cœurs de CPU en ligne. Si utiliser tous les cœurs
fait utiliser l'espace d'échange à la construction parce que vous n'avez pas
asse de mémoire, utiliser moins de cœurs peut être plus rapide.
    </para>

    <para>
      <option><envar>CC=gcc CXX=g++</envar></option>&nbsp;: BLFS préférait
utiliser gcc et g++ au lieu des programmes <application>clang</application>
par défaut en amont. Avec la publication de gcc-12 la construction est plus
longue avec gcc et g++, surtout à cause d'avertissements supplémentaires, et
est plus grosse. Paramétrez ces variables d'environnement <emphasis>avant de
lancer le script configure</emphasis> si vous voulez continuer à utiliser
gcc et g++. La construction avec GCC sur i?86 est actuellement cassée.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Thunderbird</title>

    <sect3><title>Informations sur la configuration</title>

      <para>
        Si votre gestionnaire de bureau ou de fenêtre ne vous permet pas de
configurer un navigateur par défaut, vous pouvez ajouter un paramètre de
configuration à <application>Thunderbird</application> pour qu'un navigateur
démarre lorsque vous cliquez sur une URL Internet/intranet/locale. La
procédure pour vérifier ou modifier tout paramètre de configuration est
plutôt simple et les instructions présentées ici peuvent être utilisées pour
voir ou modifier n'importe quel paramètre.
      </para>

      <para>
        Commencez par ouvrir la fenêtre de configuration en ouvrant le menu
déroulant <quote>Edit</quote>. Choisissez <quote>Préferences</quote> puis
défilez vers le bas de la page. Ensuite, cliquez sur le bouton
<quote>Éditeur de configuration</quote>. Cliquez sur le bouton
<quote>J'accepte le risque !</quote>. Ceci affichera une liste des
préférences de configuration et des informations liées à chacune. Vous
pouvez utiliser la barre <quote>Filtrer :</quote> pour saisir des critères
de recherche et réduire le nombre d'entrées listées. Changer une préférence
se fait de deux manières. La première, si la préférence est une valeur
booléenne (Vrai/Faux), consiste à double-cliquer simplement sur la
préférence pour inverser la valeur et la deuxième, pour les autres
préférences consiste en un clic-droit sur la ligne voulue, à choisir
<quote>Modifier</quote> dans le menu et à changer la valeur. Créez une
nouvelle entrée de préférence de la même manière, sauf que vous choisirez
<quote>Nouveau</quote> dans le menu et que vous fournirez les données
désirées dans les champs quand demandé.
      </para>

      <para>
        L'entrée de préférence que vous devez vérifier pour que
<application>Thunderbird</application> utilise un navigateur spécifique est
<parameter>network.protocol-handler.app.http</parameter> qui devrait
contenir le chemin du navigateur désiré, par exemple
<option>/usr/bin/firefox</option>.
      </para>

    <!--  Bad URL
      <tip>

        <para>
          There is a multitude of configuration parameters you can tweak to
          customize <application>Thunderbird</application>. A very extensive,
          but not so up-to-date list of these parameters can be found at
          <ulink url="http://preferential.mozdev.org/preferences.html"/>.
        </para>
      </tip>
-->
<para>

      <!--If you didn't enable
      <application>startup-notification</application> in your mozconfig, then
      change the StartupNotify line to false.-->
Si vous utilisez un environnement de bureau comme
<application>GNOME</application> ou <application>KDE</application>, un
fichier desktop <filename>thunderbird.desktop</filename> peut être créé pour
inclure une entrée <quote><application>Thunderbird</application></quote>
dans les menus. Lancez les commandes suivantes en tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:

    </para>

<screen role="root"><userinput>mkdir -pv /usr/share/{applications,pixmaps} &amp;&amp;

cat &gt; /usr/share/applications/thunderbird.desktop &lt;&lt; "EOF" &amp;&amp;
<literal>[Desktop Entry]
Name=Thunderbird Mail
Comment=Send and receive mail with Thunderbird
GenericName=Mail Client
Exec=thunderbird %u
Terminal=false
Type=Application
Icon=thunderbird
Categories=Network;Email;
MimeType=text/html;text/xml;application/xhtml+xml;application/xml;application/rss+xml;x-scheme-handler/mailto;
StartupNotify=true</literal>
EOF

ln -sfv /usr/lib/thunderbird/chrome/icons/default/default256.png \
        /usr/share/pixmaps/thunderbird.png</userinput></screen>
    </sect3>
  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoire installé</segtitle>

      <seglistitem>
        <seg>
          thunderbird
        </seg>
        <seg>
          De nombreuses bibliothèques et modules dans le répertoire
/usr/lib/thunderbird
        </seg>
        <seg>
          /usr/lib/thunderbird
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="thunderbird-prog">
        <term><command>thunderbird</command></term>
        <listitem>
          <para>
            est le client de courriel et de nouvelles de
<application>Mozilla</application>
          </para>
          <indexterm zone="thunderbird thunderbird-prog">
            <primary sortas="b-thunderbird">thunderbird</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
