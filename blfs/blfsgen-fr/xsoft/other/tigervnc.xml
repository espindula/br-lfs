<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY tigervnc-download-http "https://github.com/TigerVNC/tigervnc/archive/v&tigervnc-version;/tigervnc-&tigervnc-version;.tar.gz">
  <!ENTITY tigervnc-download-ftp  "">
  <!ENTITY tigervnc-md5sum        "3a794e3a063443e07250de8e99e2e05a">
  <!ENTITY tigervnc-size          "1,8&nbsp;Mo">
  <!ENTITY tigervnc-buildsize     "97&nbsp;Mo">
  <!ENTITY tigervnc-time          "0,4&nbsp;SBU (avec parallélisme = 4)">
  <!ENTITY tigervnc-xorg-version  "21.1.6">
]>

<sect1 id="tigervnc" xreflabel="tigervnc-&tigervnc-version;">
  <?dbhtml filename="tigervnc.html"?>


  <title>Tigervnc-&tigervnc-version;</title>

  <indexterm zone="tigervnc">
    <primary sortas="a-tigervnc">tigervnc</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Tigervnc</title>

    <para>
      <application>Tigervnc</application> est une implémentation VNC (Virtual
Network Computing) avancée. Il permet la création d'un serveur Xorg non lié
à une console physique et fournit également un client pour la visualisation
des bureaux graphiques distants.
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&tigervnc-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&tigervnc-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &tigervnc-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &tigervnc-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &tigervnc-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &tigervnc-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Fichier requis&nbsp;: <ulink
url="&xorg-download-http;/xserver/xorg-server-&tigervnc-xorg-version;.tar.xz"/>
        </para>
      </listitem>
    </itemizedlist>

    <note>
      <para>
        La version de <application>Xorg</application> est ancienne de quelques
versions, mais est requise pour les personalisations nécessaire pour ce
paquet.
      </para>
    </note>

    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink
url="&patch-root;/tigervnc-&tigervnc-version;-configuration_fixes-1.patch"/>
        </para>
      </listitem>
      <listitem revision='sysv'>
        <para>
          Fichier facultatif pour démarrer le serveur sans gestionnaire
d'affichage&nbsp;: <ulink url="&sources-anduin-http;/tigervnc/vncserver"/>
        </para>
      </listitem>
      <listitem revision='sysv'>
        <para>
          Page de manuel facultative&nbsp;: <ulink
url="&sources-anduin-http;/tigervnc/vncserver.1"/>
        </para>
      </listitem>
      <listitem revision='systemd'>
        <para>
          Fichier facultatif pour démarrer le serveur sans gestionnaire
d'affichage&nbsp;: <ulink url="&sources-anduin-http;/tigervnc/Xsession"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de Tigervnc</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="cmake"/>, <xref linkend="fltk"/>, <xref linkend="gnutls"/>,
<xref linkend="libgcrypt"/>, <xref linkend="libjpeg"/>, <phrase
revision='sysv'><xref linkend="linux-pam"/>,</phrase> <xref
linkend="pixman"/>, <phrase revision='systemd'><xref linkend="systemd"/>
(avec <xref linkend="linux-pam"/>),</phrase> <xref linkend="xorg7-app"/>,
<xref linkend="xinit"/> et <xref linkend="xorg7-legacy"/>
    </para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="imagemagick"/>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;: <ulink url="&blfs-wiki;/tigervnc"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Tigervnc</title>

    <para>
      <!-- Replaces an incompatible PAM file and disables SELinux support
           in systemd units. Also modifies the search path for
           /usr/libexec/vncserver to include /etc/X11/tigervnc -->
Tout d'abord, ajustez les fichiers de configuration pour les rendre
compatible avec votre système LFS&nbsp;:
      
    </para>

<screen><userinput remap="pre">patch -Np1 -i ../tigervnc-&tigervnc-version;-configuration_fixes-1.patch</userinput></screen>

    <para>
      Installez <application>tigervnc</application> en exécutant les commandes
suivantes&nbsp;:
    </para>

<screen revision="sysv"><userinput># Put code in place
mkdir -p unix/xserver &amp;&amp;
tar -xf ../xorg-server-&tigervnc-xorg-version;.tar.xz \
    --strip-components=1              \
    -C unix/xserver                   &amp;&amp;
( cd unix/xserver &amp;&amp;
  patch -Np1 -i ../xserver21.1.1.patch ) &amp;&amp;

# Build viewer
cmake -G "Unix Makefiles"         \
      -DCMAKE_INSTALL_PREFIX=/usr \
      -DCMAKE_BUILD_TYPE=Release  \
      -DINSTALL_SYSTEMD_UNITS=OFF \
      -Wno-dev . &amp;&amp;
make &amp;&amp;

# Build server
pushd unix/xserver &amp;&amp;
  autoreconf -fiv  &amp;&amp;

  CPPFLAGS="-I/usr/include/drm"       \
  ./configure $XORG_CONFIG            \
      --disable-xwayland    --disable-dri        --disable-dmx         \
      --disable-xorg        --disable-xnest      --disable-xvfb        \
      --disable-xwin        --disable-xephyr     --disable-kdrive      \
      --disable-devel-docs  --disable-config-hal --disable-config-udev \
      --disable-unit-tests  --disable-selective-werror                 \
      --disable-static      --enable-dri3                              \
      --without-dtrace      --enable-dri2        --enable-glx          \
      --with-pic &amp;&amp;
  make  &amp;&amp;
popd</userinput></screen>

<screen revision="systemd"><userinput># Put code in place
mkdir -p unix/xserver &amp;&amp;
tar -xf ../xorg-server-&tigervnc-xorg-version;.tar.xz \
    --strip-components=1              \
    -C unix/xserver                   &amp;&amp;
( cd unix/xserver &amp;&amp;
  patch -Np1 -i ../xserver21.1.1.patch ) &amp;&amp;

# Build viewer
cmake -G "Unix Makefiles"         \
      -DCMAKE_INSTALL_PREFIX=/usr \
      -DCMAKE_BUILD_TYPE=Release  \
      -Wno-dev . &amp;&amp;
make &amp;&amp;

# Build server
pushd unix/xserver &amp;&amp;
  autoreconf -fiv  &amp;&amp;

  CPPFLAGS="-I/usr/include/drm"       \
  ./configure $XORG_CONFIG            \
      --disable-xwayland    --disable-dri        --disable-dmx         \
      --disable-xorg        --disable-xnest      --disable-xvfb        \
      --disable-xwin        --disable-xephyr     --disable-kdrive      \
      --disable-devel-docs  --disable-config-hal --disable-config-udev \
      --disable-unit-tests  --disable-selective-werror                 \
      --disable-static      --enable-dri3                              \
      --without-dtrace      --enable-dri2        --enable-glx          \
      --with-pic &amp;&amp;
  make  &amp;&amp;
popd</userinput></screen>

    <para>
      Ce paquet n'a pas de suite de tests.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>

<screen role="root"><userinput>#Install viewer
make install &amp;&amp;

#Install server
( cd unix/xserver/hw/vnc &amp;&amp; make install ) &amp;&amp;

[ -e /usr/bin/Xvnc ] || ln -svf $XORG_PREFIX/bin/Xvnc /usr/bin/Xvnc</userinput></screen>

   <para revision="sysv">
     Enfin, modifiez le fichier PAM pour qu'il soit compatible avec
elogind&nbsp;:
   </para>

<!-- These are installed as part of 'make install' for the client.
    <para>

      Finally, create a menu entry.  As the
      <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>cat &gt; /usr/share/applications/vncviewer.desktop &lt;&lt; "EOF"
<literal>[Desktop Entry]
Type=Application
Name=TigerVNC Viewer
Comment=VNC client
Exec=/usr/bin/vncviewer
Icon=tigervnc
Terminal=false
StartupNotify=false
Categories=Network;RemoteAccess;</literal>
EOF

install -vm644 media/icons/tigervnc_24.png /usr/share/pixmaps &amp;&amp;
ln -sfv tigervnc_24.png /usr/share/pixmaps/tigervnc.png</userinput></screen>
-->
<screen role="root" revision="sysv"><userinput>sed -i 's/pam_systemd.so/pam_elogind.so/' /etc/pam.d/tigervnc</userinput></screen>


  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>tar -xf .. xorg-server...</command>&nbsp;: Cette commande extrait
les paquets Xorg standards dans l'arborescence à un endroit requis pour
modification.
    </para>

    <para>
      <parameter>--disable ...</parameter>&nbsp;: la plupart des options qui sont
habituellement utilisées pour le serveur Xorg standard ne sont pas utile
pour l'instance Xvnc que l'on construit ici.
    </para>

    <para>
      <command>[ -e /usr/bin/Xvnc ] || ln ... Xvnc</command>&nbsp;: Si le serveur
Xvnc n'est pas installé dans le répertoire <filename
class='directory'>/usr/bin</filename>, créez un lien pour que le script
<command>vncserver</command> puisse le trouver.
    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Tigervnc</title>

    <para revision='sysv'>
      L'installation par défaut de ce paquet change un peu la manière de
l'utiliser. Le script perl vncserver est placé dans /usr/bin/libexec et le
serveur est conçu pour être lancé via un fichier .service de type systemd ou
par le script vncsession en tant qu'utilisateur root. La page de manuel de
vncserver se trouve dans la section 8 des pages de manuel. Les nouvelles
procédures nécessitent un gestionnaire d'affichage.
    </para>

    <para revision='sysv'>
      Pour retrouver l'ancien comportement, installez les fichiers supplémentaires
téléchargés en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:</para>

<screen role="root" revision='sysv'><userinput>install -m755 --owner=root ../vncserver /usr/bin &amp;&amp;
cp ../vncserver.1 /usr/share/man/man1</userinput></screen>

    <para revision='sysv'>
      Avec la procédure précédente, les fichiers de configuration de vncserver
spécifiques à l'utilisateur sont dans le répertoire <filename
class='directory'>.vnc</filename> du répertoire home de l'utilisateur. Le
fichier <filename>xstartup</filename> dans ce répertoire est un script
spécifiant quelle commande doit être lancée quand un bureau VNC est
démarré. Si le fichier <filename>xstartup</filename> existe,
<command>vncserver</command> essayera de démarrer un xterm dans une session
twm. Un exemple de <filename>xstartup</filename> peut être&nbsp;:
    </para>

<screen revision='sysv'>#!/bin/sh
[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup
[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources
startlxde &amp;</screen>

    <para revision='sysv'>
      Le fichier <filename>xstartup</filename> doit être exécutable pour que les
commandes à l'intérieur puissent être exécutées, donc lancez <command>chmod
a+x ~/.vnc/xstartup</command>.
    </para>

    <para revision='sysv'>
      Configurez le mot de passe de vnc avec <command>vncpasswd</command>. Le
serveur peut ensuite être démarré avec la commande
<command>vncserver</command>. Voir les pages de manuels dans la section 1
pour vncserver, sur le système serveur, et pour vncviewer, sur le système
distant.
    </para>

    <bridgehead renderas="sect3" revision="systemd">Configuration du serveur</bridgehead>

    
    <!--
    <note revision="systemd">

      <para>
        This section is optional and is only useful if you want to have VNC
        sessions launch on system startup. Both configuration methods can
        coexist on the same system.
      </para>
    </note>
    -->
<para revision="systemd">
      Sur les systèmes systemd, une autre méthode de configuration est
disponible. Cette configuration a pour bénéfice supplémentaire de rendre
systemd conscient des sessions VNC et permet aux environnements de bureau
comme <application>GNOME</application> de démarrer automatiquement les
services une fois la session VNC démarrée. Cette configuration permet aussi
de démarrer des sessions VNC au démarrage du système. Pour configurer le
serveur VNC de cette manière, suivez ces instructions.
    </para>

    <para revision="systemd">
       D'abord, installez un fichier Xsession rudimentaire pour que le serveur VNC
puisse initialiser les sessions X correctement&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>install -vdm755 /etc/X11/tigervnc &amp;&amp;
install -v -m755 ../Xsession /etc/X11/tigervnc</userinput></screen>

    <para revision="systemd">
      <!-- For example: :1=renodr will assign 'renodr' to :1 -->
Ensuite, configurez une carte des utilisateurs dans
<filename>/etc/tigervnc/vncserver.users</filename>. Cela dit au serveur VNC
quelle session est allouée à quel utilisateur.
      
    </para>

<screen role="root" revision="systemd"><userinput>echo ":1=$(whoami)" >> /etc/tigervnc/vncserver.users</userinput></screen>

    <para revision="systemd">
      Ensuite, configurez un fichier pour dire à
<application>vncserver</application> quel environnement de bureau utiliser
et quelle géométrie utiliser. Il y a plusieurs autres options qui peuvent
être définies dans ce fichier, mais elles ne rentrent pas dans le cadre de
BLFS.
    </para>

<screen revision="systemd"><userinput>install -vdm 755 ~/.vnc &amp;&amp;
cat &gt; ~/.vnc/config &lt;&lt; EOF
<literal># Begin ~/.vnc/config
# The session must match one listed in /usr/share/xsessions.
# Ensure that there are no spaces at the end of the lines.

session=LXDE
geometry=1024x768

# End ~/.vnc/config</literal>
EOF</userinput></screen>

    <para revision="systemd">
      Pour démarrer le serveur VNC, lancez la commande suivante&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>systemctl start vncserver@:1</userinput></screen>

    <para revision="systemd">
      Pour démarrer le serveur VNC au démarrage du système, lancez la commande
suivante&nbsp;:
    </para>

<screen role="root" revision="systemd"><userinput>systemctl enable vncserver@:1</userinput></screen>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>Xvnc, vncconfig, vncpasswd, vncserver, vncviewer et x0vncserver</seg>

        <seg>libvnc.so</seg>
        <seg>/usr/share/doc/tigervnc-&tigervnc-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="xvnc">
        <term><command>Xvnc</command></term>
        <listitem>
          <para>
            est un serveur X VNC (Virtual Network Computing). Il est basé sur un serveur
X standard, mais il a un écran <quote>virtuel</quote> plutôt qu'un écran
physique
          </para>
          <indexterm zone="tigervnc xvnc">
            <primary sortas="b-xvnc">Xvnc</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vncconfig">
        <term><command>vncconfig</command></term>
        <listitem>
          <para>
            est un programme pour configurer et contrôler un serveur VNC
          </para>
          <indexterm zone="tigervnc vncconfig">
            <primary sortas="b-vncconfig">vncconfig</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vncpasswd">
        <term><command>vncpasswd</command></term>
        <listitem>
          <para>
            vous permet d'initialiser le mot de passe utilisé pour accéder aux bureaux
VNC
          </para>
          <indexterm zone="tigervnc vncpasswd">
            <primary sortas="b-vncpasswd">vncpasswd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vncserver">
        <term><command>vncserver</command></term>
        <listitem>
          <para>
            est un script perl utilisé pour démarrer ou stopper un serveur VNC
          </para>
          <indexterm zone="tigervnc vncserver">
            <primary sortas="b-vncserver">vncserver</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="vncviewer">
        <term><command>vncviewer</command></term>
        <listitem>
          <para>
            est un client utilisé pour accéder aux bureaux VNC
          </para>
          <indexterm zone="tigervnc vncviewer">
            <primary sortas="b-vncviewer">vncviewer</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="x0vncserver">
        <term><command>x0vncserver</command></term>
        <listitem>
          <para>
            est un programme pour rendre accessible un affichage X sur un terminal
physique via TigerVNC ou un visualiseur compatible
          </para>
          <indexterm zone="tigervnc x0vncserver">
            <primary sortas="b-x0vncserver">x0vncserver</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
