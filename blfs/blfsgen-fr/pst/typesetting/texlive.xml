<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!-- utah -->
  <!ENTITY texlive-download-http "https://ftp.math.utah.edu/pub/tex/historic/systems/texlive/&texlive-year;/texlive-&texlive-version;-source.tar.xz">
  <!ENTITY texlive-download-ftp  "ftp://tug.org/texlive/historic/&texlive-year;/texlive-&texlive-version;-source.tar.xz">
  <!ENTITY texlive-md5sum        "bec84c5d6e340967783302f432c78efe">
  <!ENTITY texlive-size          "66&nbsp;Mo">

  <!ENTITY texlive-buildsize      "8,5&nbsp;Go dont le téléchargement supplémentaire et les tests, 7,7&nbsp;Go
installés">
  <!ENTITY texlive-time           "2,3&nbsp;SBU dont le téléchargement supplémentaire et les tests, en
construisant avec parallélisme = 4">

  <!-- utah -->
  <!ENTITY texlive-texmf-download-http "https://ftp.math.utah.edu/pub/tex/historic/systems/texlive/&texlive-year;/texlive-&texlive-version;-texmf.tar.xz">
  <!ENTITY texlive-texmf-download-ftp  "ftp://tug.org/texlive/historic/&texlive-year;/texlive-&texmf-version;-texmf.tar.xz">
  <!ENTITY texlive-texmf-md5sum        "704fb39c69e3710b8e9e9158cec5047a">
  <!ENTITY texlive-texmf-size          "3,7&nbsp;Go">

  <!ENTITY texlive-tlpdb-download-http "https://ftp.tu-chemnitz.de/pub/tug/historic/systems/texlive/&texlive-year;/texlive-&tex-tlpdb-version;-tlpdb-full.tar.gz">
  <!ENTITY texlive-tlpdb-download-ftp  "ftp://tug.org/texlive/historic/&texlive-year;/texlive-&tex-tlpdb-version;-tlpdb-full.tar.gz">
  <!ENTITY texlive-tlpdb-md5sum        "5078a7ddaa7b309b7392e33916b817f7">
  <!ENTITY texlive-tlpdb-size          "3,2&nbsp;Mo">

]>


<sect1 id="texlive" xreflabel="texlive-&texlive-version;">
  <?dbhtml filename="texlive.html"?>


  <title>texlive-&texlive-version;-source</title>

  <indexterm zone="texlive">
    <primary sortas="a-texlive">texlive</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à TeX Live from source</title>

    <note>
      <para>
        <!-- the chinese mirros do not use a 'historic' subdirectory. -->
According to <ulink url="https://www.tug.org/historic/"/> the master site in
France only supports ftp and rsync. Now that ftp is generally deprecated,
that page has links to mirrors, some of which support https, e.g. in Utah
and Chemnitz as well as in China. If you prefer to use a different mirror
from the example links here, you will need to navigate to
systems/historic/texlive/&texlive-year; or systems/texlive/&texlive-year; as
the case may be.
        
      </para>
    </note>

    <para>
      La majorité de TeX Live peut être construite depuis les sources sans une
installation pré-existante, mais <application>xindy</application> (pour
l'indexage) demande des versions fonctionnelles de <command>latex</command>
et <command>pdflatex</command> quand configure est lancé, et les suites de
tests et l'installation de <command>asy</command> (pour les graphiques
vectoriels) échoueront si TeX n'a pas déjà été installé. De plus,
<application>biber</application> n'est pas fournit dans les sources de
<application>texlive</application> et la version de
<application>dvisvgm</application> dans l'arborescence de
<application>texlive</application> ne peut pas être construit si les
bibliothèques partagées du système sont utilisées.
    </para>

      <para>
      </para>
    <para>
      L'ensemble de ces paquets sont traités dans leur propre page et peuvent être
construits après l'installation de ce paquet. Si vous ne l'avez pas encore
fait, vous pouvez démarrer par <xref linkend="tex-path"/> pour que les
dernières commandes pour initialiser la nouvelle installation soient
trouvées.
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&texlive-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&texlive-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &texlive-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &texlive-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis&nbsp;: &texlive-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction&nbsp;: &texlive-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargement supplémentaire requis</bridgehead>

      <para>
        La plupart de l'environnement texlive (incluant scripts, documentation,
polices et divers autres fichiers) n'est pas dans l'archive des
sources. Vous devez les télécharger séparément. Cela vous donnera tous les
fichiers supplémentaires qui sont fournis par une installation complète de
la version binaire, ce n'est pas réaliste de limiter les parties à
installer.
      </para>

      <para>
        À cause de la taille de ce paquet, il n'est pas disponible sur les miroirs
BLFS. En cas de problème, allez sur http://www.ctan.org/mirrors/ pour
trouver un miroir plus accessible.
      </para>

    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&texlive-texmf-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&texlive-texmf-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &texlive-texmf-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &texlive-texmf-size;
        </para>
      </listitem>
    </itemizedlist>

      <para>
        À partir de 2019, la base de données tlpdb des paquets dans texlive n'est
plus installée avec les sources. Mais <command>texdoc</command> a besoin
d'un fichier de cache dérivé de cette base (et créera le cache à sont
premier démarrage).
      </para>

    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP)&nbsp;: <ulink url="&texlive-tlpdb-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP)&nbsp;: <ulink url="&texlive-tlpdb-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5&nbsp;: &texlive-tlpdb-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement&nbsp;: &texlive-tlpdb-size;
        </para>
      </listitem>

      <listitem>
        <para>
          Correctif requis&nbsp;: <ulink url=
"&patch-root;/texlive-&texlive-version;-source-security_fix-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de TeX Live from source</bridgehead>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="x-window-system"/>
    </para>

    
    <!-- text for recommended libraries -->
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
     href="../../xincludes/texrecommendlibs.xml"/>



    <!-- the following ensures jhalfs will set paths before running texlive -->
<para role="recommended">
      En plus, les instructions ci-dessous supposent que vous utilisez la
disposition décrite dans <xref linkend="tex-path"/>.
    </para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    
    <!-- text for optional deps -->
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
     href="../../xincludes/texoptional.xml"/>

    <bridgehead renderas="sect4">Dépendances d'exécution</bridgehead>
    
    <!-- text for runtime deps, shared with tl-installer -->
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
     href="../../xincludes/texruntime.xml"/>

  </sect2>

  <sect2 role="installation">
    <title>Installation de TeX Live</title>

    <para>
      Installez TeX Live en exécutant les commandes suivantes&nbsp;:
    </para>

    <caution>
      <para>
        Si vous voulez mettre à jour <application>texlive</application> vers la
version actuelle sur un système plus ancien où des paquets supplémentaires
(<application>asymptote</application>,
<application>biber</application>. <application>dvisvgm</application> ou
<application>xindy</application>) sont installés, vous devrez les
réinstaller et corriger votre <literal>PATH</literal> pour inclure
<literal>$TEXLIVE_PREFIX</literal>.
      </para>
    </caution>

    <note>
      <para>
        Une installation complète demande que des commandes de texlive soient
lancées en tant qu'utilisateur root, donc nous exporterons la variable
TEXARCH pour que <systemitem class="username">root</systemitem> l'utilise.
      </para>
    </note>

    <para>
      Maintenant, en tant qu'utilisateur normal&nbsp;:
    </para>

<screen><userinput>export TEXARCH=$(uname -m | sed -e 's/i.86/i386/' -e 's/$/-linux/') &amp;&amp;

patch -Np1 -i ../texlive-&texlive-version;-source-security_fix-1.patch &amp;&amp;

mkdir texlive-build &amp;&amp;
cd    texlive-build &amp;&amp;

../configure -C                                   \
    --prefix=$TEXLIVE_PREFIX                      \
    --bindir=$TEXLIVE_PREFIX/bin/$TEXARCH         \
    --datarootdir=$TEXLIVE_PREFIX                 \
    --includedir=$TEXLIVE_PREFIX/include          \
    --infodir=$TEXLIVE_PREFIX/texmf-dist/doc/info \
    --libdir=$TEXLIVE_PREFIX/lib                  \
    --mandir=$TEXLIVE_PREFIX/texmf-dist/doc/man   \
    --disable-native-texlive-build                \
    --disable-static --enable-shared              \
    --disable-dvisvgm                             \
    --with-system-cairo                           \
    --with-system-fontconfig                      \
    --with-system-freetype2                       \
    --with-system-gmp                             \
    --with-system-graphite2                       \
    --with-system-harfbuzz                        \
    --with-system-icu                             \
    --with-system-libgs                           \
    --with-system-libpaper                        \
    --with-system-libpng                          \
    --with-system-mpfr                            \
    --with-system-pixman                          \
    --with-system-zlib                            \
    --with-banner-add=" - BLFS" &amp;&amp;

make</userinput></screen>

    <para>
      <!-- It started to fail with libpaper-2.0.10 which rounds differently
           in the 6th place of decimals, causing diff to fail -->
<!-- Upstream say that encoding conversion procedure Encode::from_to()
      failed in fn-generate.perl, test now skips if that errors: possibly
      related to changes in perl-5.36 since I understand current slackware
      also sees this - ken -->
To test the results, issue: <command>make -k check</command>.  Two tests,
<filename>psutils.test</filename> and <filename>eptexdir/wcfname</filename>
are known to fail.
    </para>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem
class="username">root</systemitem>&nbsp;:
    </para>


<screen role="root"><!-- Editors, you can run 'make texlinks' in a DESTDIR by passing
DESTDIR#some/where -->
<userinput>make install-strip &amp;&amp;
/sbin/ldconfig     &amp;&amp;
make texlinks      &amp;&amp;
mkdir -pv                                $TEXLIVE_PREFIX/tlpkg/TeXLive/ &amp;&amp;
install -v -m644 ../texk/tests/TeXLive/* $TEXLIVE_PREFIX/tlpkg/TeXLive/ &amp;&amp;
tar -xf ../../texlive-&tex-tlpdb-version;-tlpdb-full.tar.gz -C $TEXLIVE_PREFIX/tlpkg</userinput></screen>

    <note>
      <para>
        Ne lancez <command>make texlinks</command> qu'une seul fois. S'il est
relancé, il peut changer tous les liens symboliques de programmes vers
eux-mêmes ce qui les rend inutilisables.
      </para>
    </note>

    <para>
      Maintenant installez les fichiers supplémentaires en tant qu'utilisateur
<systemitem class="username">root</systemitem>&nbsp;:
    </para>


<screen role="root"><!-- if texmf does not need to be patched, remove &amp;&amp; from first line,
 close userinput, screen, comment pushd, patch, popd -->
<userinput>tar -xf ../../texlive-&texmf-version;-texmf.tar.xz -C $TEXLIVE_PREFIX --strip-components=1</userinput></screen>

    <para>
      It has been established by Debian that the <command>python</command> scripts
in <filename class="directory">l\atex-make</filename> will work with
<command>python3</command>, so update them to invoke that by running the
following command as the <systemitem class="username">root</systemitem>
user:
    </para>

<screen role="root"><userinput>for F in $TEXLIVE_PREFIX/texmf-dist/scripts/latex-make/*.py ; do
  sed -i 's%/usr/bin/env python%/usr/bin/python3%' $F
done
</userinput></screen>

    <para>
      Still as the <systemitem class="username">root</systemitem> user, initialize
the new system (the command <command>fmtutil-sys --all</command> will
produce a <emphasis>lot</emphasis> of output):
    </para>



<screen role="root"><!-- Editors, fmtutil-sys can apparently only be run on
a real install, as root.  But mktexlsr can be run in a DESTDIR with
cd /YOUR/TEXMF/ROOT ; ls -LAR ./ >
ls-R -->
<userinput>mktexlsr &amp;&amp;
fmtutil-sys --all</userinput></screen>

    <para>
      To allow <xref linkend="evince"/> or <xref linkend="dvisvgm"/> to link to
<filename class="libraryfile">libkpathsea.so</filename>, as the &root; user
(re)create a symlink from <filename class="directory">/usr/lib</filename>:
    </para>

<screen role="root"><userinput>ln -svf $TEXLIVE_PREFIX/lib/libkpathsea.so /usr/lib</userinput></screen>

    <note>
      
      <!-- following based on fedora, but amended to run in the BLFS
           layout, where adapting fedora's script for mtxrun did not
           reliably work. ken -->
<para>
        TeXLive includes some files for ConTeXt but the source of that is separate
and has moved on from using luatex in the previous 'mkiv' version to using
luametatex which can be pulled with git from <ulink
url="href=https://github.com/contextgarden/luametatex/releases/tags/"/>.
Luametatex uses meson and ninja, but it does not fit easily into the BLFS
layout of TeXLive.
      </para>
      <para>
        However, with a little extra work 'mkiv' files can still be processed using
the files shipped in texmf.
      </para>
    </note>

    <para>
       The following steps, run as the <systemitem
class="username">root</systemitem> user, will create
<command>mtxrun</command> and <command>context</command>.
     </para>


<screen role="root"><!-- I've put blank lines in this to make it a little less hard to read. ken -->
<userinput>sed -e '/local template=\[\[--ini/s/\(primaryflags%\)\(.*\)/\1 --socket --shell-escape \2/' \
 -e '/local template=\[\[%primaryflags%/s/\(primaryflags%\)\(.*\)/\1 --socket --shell-escape \2/' \
  -i $TEXLIVE_PREFIX/texmf-dist/scripts/context/lua/mtxrun.lua &amp;&amp;

mkdir -pv $TEXLIVE_PREFIX/texmf-var/luatex-cache/context/ &amp;&amp;

ln -sfv /$TEXLIVE_PREFIX/texmf-dist/scripts/context/lua/mtxrun.lua \
        /$TEXLIVE_PREFIX/bin/$TEXARCH/mtxrun &amp;&amp;

cat > $TEXLIVE_PREFIX/bin/$TEXARCH/context &lt;&lt; EOF
#!/bin/sh
export TEXMF=$TEXLIVE_PREFIX/texmf-dist;
export TEXMFCNF=$TEXLIVE_PREFIX/texmf-dist/web2c;
export TEXMFCACHE=$TEXLIVE_PREFIX/texmf-var/luatex-cache/context/;
$TEXLIVE_PREFIX/bin/$TEXARCH/mtxrun --script context "\$@"
EOF
chmod -v 0755 $TEXLIVE_PREFIX/bin/$TEXARCH/context</userinput></screen>

    <para>
      Vous pouvez continuer par <xref linkend="asymptote"/>, <xref
linkend="biber"/>, <xref linkend="dvisvgm"/> ou <xref linkend="xindy"/> si
vous souhaitez les installer.
    </para>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>patch -Np1 -i
../texlive-&texlive-version;-source-security_fix-1.patch</command>: this
updates the luatex source to v1.17.0 to fix security issues.
    </para>

    <para>
      <command>sed -e '/local template (...)' (...)mtxrun.lua</command>: this
makes a change in a texmf-dist script so that ConTeXt can now run with
luatex-v1.17.0.
    </para>

    <para>
      <command>-C</command>: create config.cache, this saves significant time in a
parallel build.
    </para>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
     href="../../xincludes/tex-prefix.xml"/>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
     href="../../xincludes/tex-lib.xml"/>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/static-libraries.xml"/>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/tex-shared.xml"/>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/tex-system.xml"/>


    <!--
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/tex-xpdf.xml"/>
-->
<para>
      <command>--disable-dvisvgm</command>&nbsp;: Comme indiqué plus haut, la
version intégrée de dvisvgm, qui a des fichiers de configuration modifiés,
ne peut pas être construite avec les bibliothèques partagées du système.
    </para>

    <para>
      <command>/sbin/ldconfig</command>&nbsp;: ceci doit être lancé ici pour que
<command>make texlinks</command> puisse utiliser kpsewhich.
    </para>

    <para>
      <command>make texlinks</command>&nbsp;: cela lance le script texlinks.sh
pour créer les liens symboliques depuis les formats du moteur. En pratique,
plusieurs des cibles comme <command>xetex</command> sont maintenant des
binaires séparés et pour ceux la signalera "fichiers existants" ("file
already exists").
    </para>

    <para>
      <command>tar -xf texlive-&texmf-version;-texmf.tar.xz -C $TEXLIVE_PREFIX
--strip-components=1</command>&nbsp;: L'archive contient les fichiers pour
le répertoire texmf-dist, et à cause de sa taille nous ne voulons pas
gaspiller de temps et d'espace à le déballer et ensuite copier les fichiers.
    </para>

    <para>
      <command>install -v -m644 ../texk/tests/TeXLive/*
$TEXLIVE_PREFIX/tlpkg/TeXLive/</command>&nbsp;: cela met les modules perl
<filename>TLConfig.pm</filename> et <filename>TLUtils.pm</filename> dans le
répertoire où l'installateur binaire les place - c'est au début du PATH perl
@INC@ dans texlive quand l'installation utilise les paramètres de
configuration précédents. Sans ces modules, texlive est inutilisable.
    </para>

    <para>
      <command>mktexlsr</command>&nbsp;: Crée un fichier <filename>ls-R</filename>
qui liste ce qui a été installé - c'est utilisé par kpathsea pour trouver
les fichiers
    </para>

    <para>
      <command>fmtutil-sys --all</command>&nbsp;: Ceci initialise les formats TeX,
les bases Metafont et les mémoires Metapost.
    </para>

    <para>
      <command>mkdir -pv
$TEXLIVE_PREFIX/texmf-var/luatex-cache/context/</command>: the context
script created after this will not run correctly if this directory is not
present.
    </para>

    <para>
      <option>--without-x</option>&nbsp;: utilisez ceci si vous n'avez pas
installé Xorg.
    </para>

    <para>
      There are many other '--disable' or '--without' options. Some of them such
as <option>--without-texinfo</option> are accepted but no longer do
anything, others will prevent a program being built - but the far greater
amount of space used for the related items in texmf means there is no
obvious benefit from disabling a few of the programs.
    </para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>Plus de 300 binaires et liens symboliques vers des scripts</seg>
        <seg>libkpathsea.so, libptexenc.so, libsynctex.so, libtexlua52.so,
libtexluajit.so
        </seg>
        <seg>$TEXLIVE_PREFIX/bin, $TEXLIVE_PREFIX/include, $TEXLIVE_PREFIX/lib,
$TEXLIVE_PREFIX/texmf-dist
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="texlive-programs">
        <term><command>TeX&nbsp;programs</command></term>
        <listitem>
          <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
          href="../../xincludes/texprogs.xml"/>
          <indexterm zone="texlive texlive-programs">
            <primary sortas="b-texlive-programs">programmes TeX Live</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libkpathsea">
        <term><filename class="libraryfile">libkpathsea.so</filename></term>
        <listitem>
          <para>
            (kpathsearch) existe pour rechercher un fichier dans une liste de
répertoires et est utilisé par <command>kpsewhich</command>
          </para>
          <indexterm zone="texlive libkpathsea">
            <primary sortas="c-libkpathsea">libkpathsea.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libptexenc">
        <term><filename class="libraryfile">libptexenc.so</filename></term>
        <listitem>
          <para>
            est une bibliothèque pour pTeX (publishing TeX) japonnais
          </para>
          <indexterm zone="texlive libptexenc">
            <primary sortas="c-libptexenc">libptexenc.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libsynctex">
        <term><filename class="libraryfile">libsynctex.so</filename></term>
        <listitem>
          <para>
            est la bibliothèque d'analyse SyncTeX (Synchronize TeXnology)
          </para>
          <indexterm zone="texlive libsynctex">
            <primary sortas="c-libsynctex">libsynctex.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libtexlua52">
        <term><filename class="libraryfile">libtexlua52.so</filename></term>
        <listitem>
          <para>
            fournit Lua 5.2, modifié pour fonctionner avec LuaTeX
          </para>
          <indexterm zone="texlive libtexlua52">
            <primary sortas="c-libtexlua52">libtexlua52.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libtexluajit">
        <term><filename class="libraryfile">libtexluajit.so</filename></term>
        <listitem>
          <para>
            fournit LuaJIT, modifié pour fonctionner avec LuaJITTeX
          </para>
          <indexterm zone="texlive libtexluajit">
            <primary sortas="c-libtexluajit">libtexluajit.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>

  </sect2>

</sect1>
