<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      Xorg-7 Test et configuration
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-914+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">System V)</span> - Version r10.1-914+
      </h4>
      <h3>
        Chapitre&nbsp;24.&nbsp;Environnement X Window System
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="xinit.html" title=
          "xinit-1.4.1">Précédent</a>
          <p>
            xinit-1.4.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="tuning-fontconfig.html" title=
          "Réglages de Fontconfig">Suivant</a>
          <p>
            Réglages de Fontconfig
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="installing.html" title=
          "Chapitre&nbsp;24.&nbsp;Environnement X Window System">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition System V) - Version r10.1-914+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="xorg-config" name="xorg-config"></a>Xorg-7 Test et
        configuration
      </h1>
      <div class="sect2" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="X11-testing" name="X11-testing"></a>Test de Xorg
        </h2>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Avant de démarrer Xorg pour la première fois, il est utile de
            reconstruire le cache des bibliothèques en lançant <strong class=
            "userinput"><code>ldconfig</code></strong> en tant qu'utilisateur
            <code class="systemitem">root</code>.
          </p>
        </div>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Avant de démarrer Xorg pour la première fois, il est souvent
            nécessaire de redémarrer le système pour s'assurer que les démons
            appropriés sont démarrés et que les paramètres de sécurités sont
            correctement initialisés. Autrement, vous déconnecter et vous
            reconnecter peut fonctionner mais la méthode n'a pas été testée.
          </p>
        </div>
        <div class="admon warning">
          <img alt="[Avertissement]" src="../images/warning.png" />
          <h3>
            Avertissement
          </h3>
          <p>
            Si Xorg freeze (par exemple, s'il lui manque un pilote d'entrée),
            le système peut arrêter de répondre aux entrées utilisateurs. En
            précaution, vous pouvez activer la touche <span class=
            "keycap"><strong>SysRq</strong></span> magique avant de tester
            Xorg. En tant qu'utilisateur <code class=
            "systemitem">root</code>&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">echo 4 &gt; /proc/sys/kernel/sysrq</kbd></pre>
          <p>
            Si Xorg freeze, vous pouvez utiliser <span class=
            "keycap"><strong>Alt</strong></span>+<span class=
            "keycap"><strong>SysRq</strong></span>+<span class=
            "keycap"><strong>R</strong></span> pour réinitialiser le mode
            clavier. Maintenant vous devriez pouvoir utiliser <span class=
            "keycap"><strong>Ctrl</strong></span>+<span class=
            "keycap"><strong>Alt</strong></span>+<span class=
            "keycap"><strong>Fx</strong></span> (remplacez x par un numéro de
            terminal virtuel) pour passer à un autre VT. Si cela fonctionne,
            connectez-vous et tuez Xorg via la ligne de commande dans le
            nouveau VT.
          </p>
        </div>
        <p>
          Pour tester l'installation de <span class=
          "application">Xorg</span>, tapez <span class=
          "command"><strong>startx</strong></span>. Cette commande lance un
          gestionnaire de fenêtres très rudimentaire appelé <span class=
          "emphasis"><em>twm</em></span> avec trois terminaux X (xterm) et
          une fenêtre d'horloge (xclock). Le terminal X dans le coin
          supérieur gauche est un terminal de login et lancer <span class=
          "emphasis"><em>exit</em></span> dans le terminal quittera la
          session <span class="application">X Window</span>. Le troisième
          terminal X peut être recouvert sur votre système par les deux
          autres terminaux X.
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Lorsque vous testez <span class="application">Xorg</span> avec le
            gestionnaire de fenêtres <span class="application">twm</span>, il
            y aura plusieurs avertissements dans le fichier de log de Xorg,
            $HOME/.local/share/xorg/Xorg.0.log à propos de fichiers de police
            manquants. En plus, il y a plusieurs avertissement sur le
            terminal en mode texte (habituellement tty1) à propos de polices
            manquantes. Ces avertissements n'affectent pas le fonctionnement,
            mais peuvent être supprimés si désiré en installant <a class=
            "xref" href="x7legacy.html" title="Xorg Legacy">Xorg Legacy
            Fonts</a>.
          </p>
        </div>
        <p>
          Généralement, il n'y a pas de configuration spécifique requise pour
          <span class="application">Xorg</span>, mais une personnalisation
          est possible. Pour plus de détails voir <a class="xref" href=
          "xorg-config.html#xconfig" title=
          "Configuration des périphériques Xorg">la section intitulée
          «&nbsp;Configuration des périphériques Xorg&nbsp;»</a> en dessous.
        </p>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="checking-dri" name="checking-dri"></a>Vérifier
          l'installation de la Direct Rendering Infrastructure (DRI)
        </h2>
        <p>
          DRI est un environnement permettant aux logiciels d'accéder au
          matériel graphique d'une manière sûre et efficace. Elle est
          installée par défaut dans <span class="application">X</span> (en
          utilisant <span class="application">MesaLib</span>) si vous avez
          une carte graphique supportée.
        </p>
        <p>
          Pour vérifier que les pilotes DRI sont correctement installés,
          vérifiez que le fichier journal <code class=
          "filename">$HOME/.local/share/xorg/Xorg.0.log</code> (ou
          <code class="filename">/var/log/Xorg.0.log</code> si vous avez
          construit <a class="xref" href="xorg-server.html" title=
          "Xorg-Server-1.20.13">Xorg-Server-1.20.13</a> avec le bit suid)
          contient des messages comme&nbsp;:
        </p>
        <pre class="screen"><code class=
        "literal">(II) intel(0): direct rendering: DRI2 Enabled</code></pre>
        <p>
          ou
        </p>
        <pre class="screen"><code class=
        "literal">(II) NOUVEAU(0): Loaded DRI module</code></pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Il se peut que la configuration DRI diffère si vous utilisez
            d'autres pilotes tels que ceux de <a class="ulink" href=
            "http://www.nvidia.com/page/home.html">NVIDIA</a> ou de <a class=
            "ulink" href="http://www.amd.com/">AMD</a>.
          </p>
        </div>
        <p>
          Une autre façon de déterminer si DRI fonctionne proprement est
          d'utiliser un des deux programmes de démo d'OpenGL installés
          éventuellement par <a class="xref" href="mesa.html" title=
          "Mesa-21.1.6">Mesa-21.1.6</a>. Depuis un terminal X, lancez
          <span class="command"><strong>glxinfo</strong></span> et cherchez
          le passage&nbsp;:
        </p>
        <pre class="screen"><code class="computeroutput">name of display: :0
display: :0  screen: 0
direct rendering: Yes</code></pre>
        <p>
          Si le direct rendering est activé, vous pouvez ajouter de la
          verbosité en lançant <span class=
          "command"><strong>LIBGL_DEBUG=verbose glxinfo</strong></span>. Ceci
          affichera les pilotes, les nœuds de périphériques et les fichiers
          utilisés par le système DRI.
        </p>
        <p>
          Pour confirmer que l'accélération matérielle DRI2 fonctionne, vous
          pouvez (toujours dans un terminal X) lancer la commande
          <span class="command"><strong>glxinfo | egrep "(OpenGL
          vendor|OpenGL renderer|OpenGL version)"</strong></span> - si cela
          renvoie quelque chose <span class="emphasis"><em>d'autre
          que</em></span> <code class="literal">Software Rasterizer</code>
          c'est que l'accélération fonctionne pour l'utilisateur qui a lancé
          la commande.
        </p>
        <p>
          Si votre matériel n'a pas de pilote DRI2 de disponible, il
          utilisera un rendu logiciel pour le Direct Rendering. Dans ce cas,
          vous pouvez utiliser le nouveau rendu logiciel accéléré de LLVM
          appelé LLVMPipe. Avant de construire LLVMPipe soyez certain que
          <a class="xref" href="../general/llvm.html" title=
          "LLVM-12.0.1">LLVM-12.0.1</a> est présent au moment de la
          construction de Mesa. Merci de noter que tous les décodages sont
          fait par le processeur à la place du GPU, donc l'affichage sera
          plus lent qu'avec l'accélération matérielle. Pour vérifier si vous
          utilisez LLVMpipe, regardez la sortie de la commande glxinfo
          précédente. Un exemple de sortie utilisant le rendu logiciel est
          montré en dessous&nbsp;:
        </p>
        <pre class="screen"><code class=
        "computeroutput">OpenGL vendor string: VMware, Inc.
OpenGL renderer string: Gallium 0.4 on llvmpipe (LLVM 3.5, 256 bits)
OpenGL version string: 3.0 Mesa 10.4.5</code></pre>
        <p>
          Vous pouvez toujours forcer LLVMPipe en exportant la variable
          d'environnement <code class="envar">LIBGL_ALWAYS_SOFTWARE=1</code>
          quand vous démarré Xorg.
        </p>
        <p>
          De nouveau, si vous avez ajouté le paquet Mesa-Demos, vous pouvez
          aussi lancer le programme de test <span class=
          "command"><strong>glxgears</strong></span>. Ce programme affiche
          une fenêtre de trois boutons à bascule. Le <span class=
          "command"><strong>xterm</strong></span> affichera le nombre de
          cadres dessinés toutes les cinq secondes, donc c'est un test
          fiable. La fenêtre est redimensionnable et les cadres dessinés par
          secondes dépendent beaucoup de la taille de la fenêtre.
        </p>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="hybrid-graphics" name="hybrid-graphics"></a>Hybrid Graphics
        </h2>
        <p>
          Hybrid Graphics est expérimental dans Linux. Les développeurs de
          Xorg ont mis au point une technologie appelé PRIME qui peut être
          utilisée pour commuter entre le GPU intégré et celui du processeur
          "muxless" à souhait. La commutation automatique n'est pas possible
          pour le moment.
        </p>
        <p>
          Pour utiliser PRIME pour la commutation de GPU, soyez certain
          d'utiliser le noyau Linux 3.4 ou plus (recommandé). Vous devez
          avoir les pilotes DRI et DDX pour votre matériel et avoir
          <span class="application">Xorg Server</span> 1.13 ou plus.
        </p>
        <p>
          <span class="application">Xorg Server</span> devrait charger les
          deux pilotes GPU automatiquement. Vous pouvez le vérifier en
          lançant&nbsp;:
        </p>
        <pre class="userinput"><kbd class=
        "command">xrandr --listproviders</kbd></pre>
        <p>
          Il devrait y avoir deux (ou plus) fournisseurs indiqués, par
          exemple&nbsp;:
        </p>
        <pre class="screen"><code class=
        "computeroutput">Providers: number : 2
Provider 0: id: 0x7d cap: 0xb, Source Output, Sink Output, Sink Offload crtcs: 3 outputs: 4 associated providers: 1 name:Intel
Provider 1: id: 0x56 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 6 outputs: 1 associated providers: 1 name:radeon</code></pre>
        <p>
          Pour pouvoir lancer une application GLX sur un GPU particulier,
          vous devrez lancer la commande suivante, où &lt;provider&gt; est le
          plus puissant et &lt;sink&gt; est la carte qui fait l'affichage.
        </p>
        <pre class="userinput"><kbd class=
        "command">xrandr --setprovideroffloadsink <em class=
        "replaceable"><code>&lt;provider&gt; &lt;sink&gt;</code></em></kbd></pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Avec les nouveaux pilotes <span class="application">Xorg</span>,
            comme modesetting ou intel, qui peuvent utiliser DRI3, la
            commande ci-dessus n'est plus nécessaire. Ça ne fait pas de mal
            non plus.
          </p>
        </div>
        <p>
          Ensuite, vous devrez exporter la variable d'environnement
          <code class="envar">DRI_PRIME=1</code> à chaque fois que vous
          voudrez utiliser le GPU le plus puissant. Par exemple,
        </p>
        <pre class="userinput"><kbd class=
        "command">DRI_PRIME=1 glxinfo | egrep "(OpenGL vendor|OpenGL renderer|OpenGL version)"</kbd></pre>
        <p>
          affichera le fournisseur OpenGL, le rendu et la version du GPU.
        </p>
        <p>
          Si la dernière commande affiche le même rendu OpenGL avec ou sans
          <code class="envar">DRI_PRIME=1</code>, vous devez vérifier votre
          installation.
        </p>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          <a id="xconfig" name="xconfig"></a>Configuration des périphériques
          Xorg
        </h2>
        <p>
          Pour la plupart des configurations matérielles, Xorg va
          automatiquement obtenir la configuration correcte du serveur sans
          aucune intervention de l'utilisateur. Il existe cependant certains
          cas où l'auto-configuration sera incorrecte. Voici quelques
          exemples de la configuration manuelle qui peuvent être utile dans
          ces cas-là.
        </p>
        <div class="sect3">
          <h3 class="sect3">
            <a id="xinput" name="xinput"></a>Configuration des périphériques
            X d'entrée
          </h3>
          <p>
            Pour la plupart des périphériques d'entrée, aucune configuration
            supplémentaire ne sera nécessaire. Cette section est fournie à
            titre informatif seulement.
          </p>
          <p>
            Un exemple de configuration XKB par défaut peut être celui-ci
            (exécuté en tant que <code class="systemitem">root</code>)&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">cat &gt; /etc/X11/xorg.conf.d/xkb-defaults.conf &lt;&lt; "EOF"
<code class="literal">Section "InputClass"
    Identifier "XKB Defaults"
    MatchIsKeyboard "yes"
    Option "XkbLayout" "fr"
    Option "XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</code>
EOF</kbd></pre>
          <p>
            La ligne <span class="quote">«&nbsp;<span class=
            "quote">XkbLayout</span>&nbsp;»</span> est un exemple pour un
            clavier français (AZERTY). Modifiez-la pour votre modèle de
            clavier. Cette ligne n'est pas utile pour un clavier QWERTY (US).
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="xdisplay" name="xdisplay"></a>Réglage fin des paramètres
            d'affichage
          </h3>
          <p>
            Encore une fois, avec Xorg, peu ou aucune configuration
            supplémentaire n'est nécessaire. Si vous avez besoin d'options
            supplémentaires à passer à votre pilote vidéo, par exemple, vous
            pouvez utiliser ce qui suit (de nouveau, exécuté en tant que
            <code class="systemitem">root</code>)&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">cat &gt; /etc/X11/xorg.conf.d/videocard-0.conf &lt;&lt; "EOF"
<code class="literal">Section "Device"
    Identifier  "Videocard0"
    Driver      "radeon"
    VendorName  "Videocard vendor"
    BoardName   "ATI Radeon 7500"
    Option      "NoAccel" "true"
EndSection</code>
EOF</kbd></pre>
          <p>
            Une autre configuration courante est d'avoir des configurations
            multi-serveurs pour une utilisation dans des environnements
            différents. Bien que le serveur détecte automatiquement la
            présence d'un autre moniteur, il peut obtenir un ordre
            incorrect&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">cat &gt; /etc/X11/xorg.conf.d/server-layout.conf &lt;&lt; "EOF"
<code class="literal">Section "ServerLayout"
    Identifier     "DefaultLayout"
    Screen      0  "Screen0" 0 0
    Screen      1  "Screen1" LeftOf "Screen0"
    Option         "Xinerama"
EndSection</code>
EOF</kbd></pre>
        </div>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="xinit.html" title=
          "xinit-1.4.1">Précédent</a>
          <p>
            xinit-1.4.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="tuning-fontconfig.html" title=
          "Réglages de Fontconfig">Suivant</a>
          <p>
            Réglages de Fontconfig
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="installing.html" title=
          "Chapitre&nbsp;24.&nbsp;Environnement X Window System">Niveau
          supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition System V) - Version r10.1-914+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
