<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY bind-download-http "http://gd.tuwien.ac.at/infosys/servers/isc/bind9/&bind-version;/bind-&bind-version;.tar.gz">
  <!ENTITY bind-download-ftp "ftp://ftp.isc.org/isc/bind9/&bind-version;/bind-&bind-version;.tar.gz">
  <!ENTITY bind-md5sum "afa41f8203d50bedad65071f9b6f96d7">
  <!ENTITY bind-size "8.1 Mio">
  <!ENTITY bind-buildsize "260 Mio">

  <!ENTITY bind-time "1.7 SBU (plus 11 minutes, quel que soit le processeur,
  pour lancer la suite de tests complète)">
]>

<sect1 id="bind" xreflabel="BIND-&bind-version;">
  <?dbhtml filename="bind.html"?>

  <sect1info>
    <othername>$LastChangedBy&nbsp;: andy $</othername>
    <date>$Date&nbsp;: 2012-02-20 17:06:01 +0100 (lun. 20 févr. 2012) $</date>
  </sect1info>

  <title>BIND-&bind-version;</title>

  <indexterm zone="bind">
    <primary sortas="a-BIND">BIND</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à BIND</title>

    <para>Le paquet <application>BIND</application> offre un serveur et un
    client DNS. Si vous n'êtes intéressé que par les outils, reportez-vous au
    chapitre <xref linkend="bind-utils"/>.</para>

    &lfs70_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&bind-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&bind-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &bind-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &bind-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &bind-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &bind-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing='compact'>
      <listitem>
        <para>Correctif facultatif (si net-tools n'est pas installé)&nbsp;:
        <ulink 
        url="&patch-root;/bind-&bind-version;-use_iproute2-1.patch"/></para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de BIND</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="openssl"/></para>

    <bridgehead renderas="sect4">Facultatives (to run the test suite)</bridgehead>
    <para role="optional"><xref linkend="perl-net-dns"/> et
    <xref linkend="net-tools"/> (vous pouvez vous passer de net-tools en
    utilisant le correctif facultatif pour utiliser iproute2, mais il se peut 
    que les tests IPV6 échouent)</para>

    <bridgehead renderas="sect4">Facultatives (to rebuild documentation)</bridgehead>
    <para role="optional"><!-- <xref linkend="tetex"/> ou -->
	<xref linkend="texlive"/>, et
    <xref linkend="libxslt"/></para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/bind"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de BIND</title>

    <para>Si vous avez choisi de ne pas installer net-tools, appliquez le
    correctif iproute2 avec la commande suivante&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../bind-&bind-version;-use_iproute2-1.patch</userinput></screen>

     <para>Si vous voulez <command>configure</command> (configurer)
    <application>BIND</application> avec l'option, corrigez un bogue dans un des
    Makefiles&nbsp;:</para>
    <!-- this is a bug in bind-9.8.1 that wasn't in bind-9.8.0 -->

<screen><userinput>sed -i 's# driver.o# .libs/driver.o#' bin/tests/system/dlzexternal/Makefile.in</userinput></screen>

    <para>Installez <application>BIND</application> en lançant les commandes
    suivantes&nbsp;:</para>

<screen><userinput>./configure --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --mandir=/usr/share/man \
            --enable-threads \
            --with-libtool &amp;&amp;
make</userinput></screen>

    <para>Exécutez les commandes suivantes pour lancer la suite de tests complète.
    Tout d'abord, en tant qu'utilisateur <systemitem class="username">root</systemitem>,
    paramétrez quelques interfaces de test&nbsp;:</para>

<screen role="root"><userinput>bin/tests/system/ifconfig.sh up</userinput></screen>

    <para>Maintenant lancez la suite de tests en tant qu'utilisateur non 
    privilégié&nbsp;:</para>

<screen><userinput>make check 2&gt;&amp;1 | tee check.log</userinput></screen>

    <para>De nouveau en tant qu'utilisateur <systemitem class="username">root</systemitem>, 
    nettoyez les interfaces de test&nbsp;:</para>

<screen role="root"><userinput>bin/tests/system/ifconfig.sh down</userinput></screen>

    <para>Lancez la commande suivante pour vérifier que les 148 tests ont
    réussi&nbsp;:</para>

<screen><userinput>grep "R:PASS" check.log | wc -l</userinput></screen>

    <para>Enfin, installez le paquet en tant qu'utilisateur <systemitem
    class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install &amp;&amp;
chmod 755 /usr/lib/lib{bind9,isc{,cc,cfg},lwres,dns}.so.*.?.? &amp;&amp;

cd doc &amp;&amp;
install -v -d -m755 /usr/share/doc/bind-&bind-version;/{arm,draft,misc,rfc} &amp;&amp;
install -v -m644 arm/*.html \
    /usr/share/doc/bind-&bind-version;/arm &amp;&amp;
install -v -m644 draft/*.txt \
    /usr/share/doc/bind-&bind-version;/draft &amp;&amp;
install -v -m644 rfc/* \
    /usr/share/doc/bind-&bind-version;/rfc &amp;&amp;
install -v -m644 \
    misc/{dnssec,ipv6,migrat*,options,rfc-compliance,roadmap,sdb} \
    /usr/share/doc/bind-&bind-version;/misc</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><parameter>--sysconfdir=/etc</parameter>&nbsp;: Ce paramètre oblige
    <application>BIND</application> à chercher des fichiers de configuration dans
    <filename class='directory'>/etc</filename> et non dans
    <filename class='directory'>/usr/etc</filename>.</para>

    <para><parameter>--enable-threads</parameter>&nbsp;: Ce paramètre active
    la fonctionnalité de multi-threading.</para>

    <para><parameter>--with-libtool</parameter>&nbsp;: Ce paramètre oblige
    la construction de bibliothèques et de liens dynamiques vers les binaires
    installés vers ces bibliothèques.</para>

    <para><command>chmod 755
    /usr/lib/{lib{bind9,isc{,cc,cfg},lwres,dns}.so.*.?.?}</command>&nbsp;: Active
    le bit d'exécution pour empêcher un avertissement lors de l'utilisation de
   <command>ldd</command> pour vérifier les dépendances de bibliothèque.</para>

    <para><command>cd doc; install ...</command>&nbsp;: Ces commandes installent
    la documentation supplémentaire du paquet. Ne mettez pas tout ou partie de ces
    commandes si vous le désirez.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de BIND</title>

    <sect3 id="bind-config">
      <title>Fichiers de configuration</title>

      <para><filename>named.conf</filename>,
      <filename>root.hints</filename>,
      <filename>127.0.0</filename>,
      <filename>rndc.conf</filename> et
      <filename>resolv.conf</filename></para>

      <indexterm zone="bind bind-config">
        <primary sortas="e-etc-named.conf">/etc/named.conf</primary>
      </indexterm>

      <indexterm zone="bind bind-config">
      <primary sortas="e-etc-rndc.conf">/etc/rndc.conf</primary>
      </indexterm>

      <indexterm zone="bind bind-config">
        <primary sortas="e-etc-resolv.conf">/etc/resolv.conf</primary>
      </indexterm>

      <indexterm zone="bind bind-config">
        <primary
        sortas="e-etc-namedb-root.hints">/etc/namedb/root.hints</primary>
      </indexterm>

      <indexterm zone="bind bind-config">
        <primary
        sortas="e-etc-namedb-pz-127.0.0.0">/etc/namedb/pz/127.0.0.0</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para><application>BIND</application> sera configurer pour se lancer dans
      une cage <command>chroot</command> en tant qu'utilisateur non privilégié
      (<systemitem class="username">named</systemitem>). Cette configuration est
      plus sécurisée dans la mesure où la compromission d'un DNS ne peut
      toucher que quelques fichiers du répertoire de la variable <envar>HOME</envar> 
      de l'utilisateur <systemitem class="username">named</systemitem>.</para>

      <para>Créez l'utilisateur et le groupe non privilégiés <systemitem
      class="username">named</systemitem>&nbsp;:</para>

<screen role="root"><userinput>groupadd -g 20 named &amp;&amp;
useradd -c "BIND Owner" -g named -s /bin/false -u 20 named &amp;&amp;
install -d -m770 -o named -g named /srv/named</userinput></screen>

      <para>Paramétrez des fichiers, des répertoires et des périphériques 
      dont a besoin <application>BIND</application>&nbsp;:</para>

<screen role="root"><userinput>cd /srv/named &amp;&amp;
mkdir -p dev etc/namedb/{slave,pz} usr/lib/engines var/run/named &amp;&amp;
mknod /srv/named/dev/null c 1 3 &amp;&amp;
mknod /srv/named/dev/random c 1 8 &amp;&amp;
chmod 666 /srv/named/dev/{null,random} &amp;&amp;
cp /etc/localtime etc &amp;&amp;
touch /srv/named/managed-keys.bind &amp;&amp;
cp /usr/lib/engines/libgost.so usr/lib/engines &amp;&amp;
[ $(arch) = x86_64 ] &amp;&amp; ln -sv lib usr/lib64</userinput></screen>

      <para>Le fichier <filename>rndc.conf</filename> contient des informations
      pour contrôler les opérations de <command>named</command> avec l'outil
      <command>rndc</command>. Générez une clé à utiliser dans <filename>named.conf</filename> 
      et <filename>rdnc.conf</filename> avec la commande 
      <command>rndc-confgen</command>&nbsp;:</para>

<screen role="root"><userinput>rndc-confgen -r /dev/urandom -b 512 > /etc/rndc.conf &amp;&amp;
sed '/conf/d;/^#/!d;s:^#&nbsp;::' /etc/rndc.conf > /srv/named/etc/named.conf</userinput></screen>

       <para>Complétez le fichier <filename>named.conf</filename> à partir duquel
      <command>named</command> lira l'emplacement des fichiers de zone, le serveur
      de DNS racine, et les clés DNS sécurisées&nbsp;:</para>

<screen role="root"><?dbfo keep-together="auto"?><userinput>cat &gt;&gt; /srv/named/etc/named.conf &lt;&lt; "EOF"
<literal>options {
    directory "/etc/namedb";
    pid-file "/var/run/named.pid";
    statistics-file "/var/run/named.stats";

};
zone "." {
    type hint;
    file "root.hints";
};
zone "0.0.127.in-addr.arpa" {
    type master;
    file "pz/127.0.0";
};

// Bind 9 journalise maintenant via syslog (sauf le débogage).
// Ce sont les règles de journalisation par défaut.

logging {
     category default { default_syslog; default_debug; };
     category unmatched { null; };

  channel default_syslog {
      syslog daemon;                      // send to syslog's daemon
                                          // facility
      severity info;                      // only send priority info
                                          // et higher
  };

  channel default_debug {
      file "named.run";                   // write to named.run in
                                          // the working directory
                                          // Note: stderr is used instead
                                          // of "named.run"
                                          // if the server is started
                                          // with the '-f' option.
      severity dynamic;                   // log at the server's
                                          // current debug level
  };

  channel default_stderr {
      stderr;                             // writes to stderr
      severity info;                      // only send priority info
                                          // et higher
  };

  channel null {
     null;                                // toss anything sent to
                                          // this channel
  };
};</literal>

EOF</userinput></screen>

      <para>Créez un fichier de zone ayant le contenu suivant&nbsp;:</para>

<screen role="root"><userinput>cat &gt; /srv/named/etc/namedb/pz/127.0.0 &lt;&lt; "EOF"
<literal>$TTL 3D
@      IN      SOA     ns.local.domain. hostmaster.local.domain. (
                        1       ; Serial
                        8H      ; Refresh
                        2H      ; Retry
                        4W      ; Expire
                        1D)     ; Minimum TTL
                NS      ns.local.domain.
1               PTR     localhost.</literal>
EOF</userinput></screen>

      <para>Créez le fichier <filename>root.hints</filename> avec les commandes
      suivantes&nbsp;:</para>

      <note>
        <para>Faites bien attention à vous assurer qu'il n'y a pas de grands
        espaces dans ce fichier.</para>
      </note>

<screen role="root"><userinput>cat &gt; /srv/named/etc/namedb/root.hints &lt;&lt; "EOF"
<literal>.                       6D  IN      NS      A.ROOT-SERVERS.NET.
.                       6D  IN      NS      B.ROOT-SERVERS.NET.
.                       6D  IN      NS      C.ROOT-SERVERS.NET.
.                       6D  IN      NS      D.ROOT-SERVERS.NET.
.                       6D  IN      NS      E.ROOT-SERVERS.NET.
.                       6D  IN      NS      F.ROOT-SERVERS.NET.
.                       6D  IN      NS      G.ROOT-SERVERS.NET.
.                       6D  IN      NS      H.ROOT-SERVERS.NET.
.                       6D  IN      NS      I.ROOT-SERVERS.NET.
.                       6D  IN      NS      J.ROOT-SERVERS.NET.
.                       6D  IN      NS      K.ROOT-SERVERS.NET.
.                       6D  IN      NS      L.ROOT-SERVERS.NET.
.                       6D  IN      NS      M.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.     6D  IN      A       198.41.0.4
B.ROOT-SERVERS.NET.     6D  IN      A       192.228.79.201
C.ROOT-SERVERS.NET.     6D  IN      A       192.33.4.12
D.ROOT-SERVERS.NET.     6D  IN      A       128.8.10.90
E.ROOT-SERVERS.NET.     6D  IN      A       192.203.230.10
F.ROOT-SERVERS.NET.     6D  IN      A       192.5.5.241
G.ROOT-SERVERS.NET.     6D  IN      A       192.112.36.4
H.ROOT-SERVERS.NET.     6D  IN      A       128.63.2.53
I.ROOT-SERVERS.NET.     6D  IN      A       192.36.148.17
J.ROOT-SERVERS.NET.     6D  IN      A       192.58.128.30
K.ROOT-SERVERS.NET.     6D  IN      A       193.0.14.129
L.ROOT-SERVERS.NET.     6D  IN      A       199.7.83.42
M.ROOT-SERVERS.NET.     6D  IN      A       202.12.27.33</literal>
EOF</userinput></screen>

      <para>Le fichier <filename>root.hints</filename> est une liste de serveurs
      de DNS racines. Il faut mettre régulièrement à jour ce fichier avec l'outil
      <command>dig</command>. Vous pouvez obtenir une copie actuelle de root.hints
      sur <ulink url="ftp://rs.internic.net/domain/named.root" />.
      Consultez le the <ulink url="http://www.bind9.net/Bv9ARM.html">BIND 9
      Administrator Reference Manual</ulink> (manuel de référence de l'administrateur
      BIND 9) pour des détails.</para>

      <para>Créez ou modifiez <filename>resolv.conf</filename> pour utiliser
      le nouveau serveur de DNS avec les commandes suivantes&nbsp;:</para>

      <note>
        <para>Remplacez <replaceable>&lt;votredomaine.com&gt;</replaceable> par
        votre propre nom de domaine valide.</para>
      </note>

<screen role="root"><userinput>cp /etc/resolv.conf /etc/resolv.conf.bak &amp;&amp;
cat &gt; /etc/resolv.conf &lt;&lt; "EOF"
<literal>search <replaceable>&lt;votredomaine.com&gt;</replaceable>
nameserver 127.0.0.1</literal>
EOF</userinput></screen>

      <para>Réglez les droits de la cage <command>chroot</command> avec la
      commande suivante&nbsp;:</para>

<screen role="root"><userinput>chown -R named:named /srv/named</userinput></screen>

    </sect3>

    <sect3  id="bind-init">
      <title>Script de démarrage</title>

      <para>Pour lancer le serveur DNS au démarrage, installez le script de
      démarrage <filename>/etc/rc.d/init.d/bind</filename> inclu dans le
      paquet <xref linkend="bootscripts"/>.</para>

      <indexterm zone="bind bind-init">
        <primary sortas="f-bind">bind</primary>
      </indexterm>

<screen role="root"><userinput>make install-bind</userinput></screen>

      <para>Maintenant démarrez <application>BIND</application> avec le nouveau
      script de démarrage&nbsp;:</para>

<screen role="root"><userinput>/etc/rc.d/init.d/bind start</userinput></screen>

    </sect3>

    <sect3>
      <title>Tester BIND</title>

      <para>Testez la nouvelle installation de
      <application>BIND</application> 9. Cherchez tout d'abord l'adresse de l'hôte
      local avec <command>dig</command>&nbsp;:</para>

<screen><userinput>dig -x 127.0.0.1</userinput></screen>

      <para>Maintenant essayez une recherche de nom externe, en observant la
      différence de vitesse dans des recherches répétées du fait de la mise en 
      cache. Lancez la commande <command>dig</command> deux fois sur la
      même adresse&nbsp;:</para>

<screen><userinput>dig www.&lfs-domainname; &amp;&amp;
dig www.&lfs-domainname;</userinput></screen>

      <para>Vous pouvez voir presque des résultats instantanés avec les recherches
      de mise en cache nommées. Consultez le <foreignphrase>Administrator
      Reference Manual</foreignphrase> (manuel de référence de l'administrateur
      <application>BIND</application>) qui se trouve dans <filename>doc/arm/Bv9ARM.html</filename>
      dans l'arborescence des sources du paquet, pour plus d'options de
      configuration.</para>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>dig, dnssec-keygen, dnssec-signzone, host, isc-config.sh, lwresd,
        named, named-checkconf, named-checkzone, nslookup, nsupdate, rndc, et
        rndc-confgen</seg>
        <seg>libbind9.{so,a}, libdns.{so,a}, libisc.{so,a}, libisccc.{so,a},
        libisccfg.{so,a}, et liblwres.{so,a}</seg>
        <seg>/srv/named, /usr/include/bind9, /usr/include/dns, /usr/include/dst,
        /usr/include/isc, /usr/include/isccc, /usr/include/isccfg,
        /usr/include/lwres, et /usr/share/doc/bind-&bind-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="dig">
        <term><command>dig</command></term>
        <listitem>
          <para>interroge les serveurs de DNS.</para>
          <indexterm zone="bind dig">
            <primary sortas="b-dig">dig</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dnssec-keygen">
        <term><command>dnssec-keygen</command></term>
        <listitem>
          <para>est un générateur de clés pour du DNS sécurisé.</para>
          <indexterm zone="bind dnssec-keygen">
            <primary sortas="b-dnssec-keygen">dnssec-keygen</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dnssec-signzone">
        <term><command>dnssec-signzone</command></term>
        <listitem>
          <para>génère des versions signées des fichiers de zone.</para>
          <indexterm zone="bind dnssec-signzone">
            <primary sortas="b-dnssec-signzone">dnssec-signzone</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="host">
        <term><command>host</command></term>
        <listitem>
          <para>est un outil de recherche de DNS.</para>
          <indexterm zone="bind host">
            <primary sortas="b-host">host</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="lwresd">
        <term><command>lwresd</command></term>
        <listitem>
          <para>est un serveur de DNS pour la mise en cache seulement pour 
          l'utilisation d'un processus local.</para>
          <indexterm zone="bind lwresd">
            <primary sortas="b-lwresd">lwresd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="named">
        <term><command>named</command></term>
        <listitem>
          <para>est le démon du serveur de DNS.</para>
          <indexterm zone="bind named">
            <primary sortas="b-named">named</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="named-checkconf">
        <term><command>named-checkconf</command></term>
        <listitem>
          <para>vérifie la syntaxe des fichiers <filename>named.conf</filename>.</para>
          <indexterm zone="bind named-checkconf">
            <primary sortas="b-named-checkconf">named-checkconf</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="named-checkzone">
        <term><command>named-checkzone</command></term>
        <listitem>
          <para>vérifie la validité d'un fichier de zone.</para>
          <indexterm zone="bind named-checkzone">
            <primary sortas="b-named-checkzone">named-checkzone</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="nslookup">
        <term><command>nslookup</command></term>
        <listitem>
          <para>est un programme utilisé pour interroger des serveurs de nom de
          domaine sur Internet.</para>
          <indexterm zone="bind nslookup">
            <primary sortas="b-nslookup">nslookup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="nsupdate">
        <term><command>nsupdate</command></term>
        <listitem>
          <para>est utilisé pour soumettre des demandes de mise à jour de DNS.</para>
          <indexterm zone="bind nsupdate">
            <primary sortas="b-nsupdate">nsupdate</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rndc">
        <term><command>rndc</command></term>
        <listitem>
          <para>contrôle le fonctionnement de <application>BIND</application>.</para>
          <indexterm zone="bind rndc">
            <primary sortas="b-rndc">rndc</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rndc-confgen">
        <term><command>rndc-confgen</command></term>
        <listitem>
          <para>génère des fichiers <filename>rndc.conf</filename>.</para>
          <indexterm zone="bind rndc-confgen">
            <primary sortas="b-rndc-confgen">rndc-confgen</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
