<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY samba3-download-http "http://us1.samba.org/samba/ftp/stable/samba-&samba3-version;.tar.gz">
  <!ENTITY samba3-download-ftp  "ftp://us5.samba.org/pub/samba-ftp/samba-&samba3-version;.tar.gz">
  <!ENTITY samba3-md5sum        "d647ec1f34414fa8691f74536dcccfb5">
  <!ENTITY samba3-size          "20 Mio">
  <!ENTITY samba3-buildsize     "238 Mio">
  <!ENTITY samba3-time          "2.3 SBU (additional 1.0 SBU to run the test suite)">
]>

<sect1 id="samba3" xreflabel="Samba-&samba3-version;">
  <?dbhtml filename="samba3.html"?>

  <sect1info>
    <othername>$LastChangedBy: thomas $</othername>
    <date>$Date: 2008-06-07 09:16:27 +0200 (sam, 07 jun 2008) $</date>
  </sect1info>

  <title>Samba-&samba3-version;</title>

  <indexterm zone="samba3">
    <primary sortas="a-Samba">Samba</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Samba</title>

    <para>Le paquet <application>Samba</application> offre des services de
    fichiers et d'imprimante à des clients SMB/CIFS et du partage réseau Windows
    à des clients Linux. 
    <application>Samba</application> peut aussi se configurer en tant que 
    remplaçant du contrôleur de domaine4.0 de Windows NT (attention si vous
    travaillez avec  NT PDC's et BDC's), un serveur de fichiers/imprimantes 
    agissant comme membre d'un domaine de Windows NT 4.0 ou
    Active Directory et un serveur DNS NetBIOS (rfc1001/1002) (qui offre
    entre autres choses le support de la navigation dans un LAN).</para>

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&samba3-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&samba3-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &samba3-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &samba3-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &samba3-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &samba3-time;</para>
      </listitem>
    </itemizedlist>

    <!--<bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="http://us3.samba.org/samba/patches/patches-&samba3-version;/spoolss.diff"/></para>
      </listitem>
    </itemizedlist> -->

    <bridgehead renderas="sect3">Dépendances de Samba</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="popt"/>,
    <xref linkend="linux-pam"/>,
    <xref linkend="cups"/>,
    <xref linkend="openldap"/>,
    <xref linkend="gamin"/>,
    <xref linkend="heimdal"/> or <xref linkend="mitkrb"/>,
    <xref linkend="python"/> (to build Samba API bindings for the
    <application>Python</application> installation),
    <ulink url="ftp://oss.sgi.com/projects/xfs/cmd_tars/">libacl</ulink>
    (exige <ulink url="ftp://oss.sgi.com/projects/xfs/cmd_tars/">libattr</ulink>),
    et <ulink url="http://valgrind.kde.org/">Valgrind</ulink> (éventuerrement
    utilisé par la suite de tests)</para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/samba3"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Samba</title>

    <note>
      <para>Si vous souhaitez lancer la suite de tests après la construction des
      binaires, vous devez ajouter le paramètre <option>--enable-socket-wrapper</option> 
      au script <command>configure</command> ci-dessous. Il se peut que vous
      souhaitiez lancer au préalable <command>configure</command> avec le paramètre
      <option>--help</option>. Il se peut que vous deviez ajouter d'autres
      paramètres pour tirer parti des dépendences facultatives.</para>
    </note>

    <para>Installez <application>Samba</application> en lançant les commandes
    suivantes&nbsp;:</para>

<!-- <screen><userinput>for FILENAME in $(ls ../*.diff); do patch -Np1 -i $FILENAME; done &amp;&amp; -->

<screen><userinput>cd source &amp;&amp;

./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --with-piddir=/var/run \
    --with-pammodulesdir=/lib/security \
    --with-fhs \
    --with-smbmount &amp;&amp;
make</userinput></screen>

    <para>Vous devenez devenir utilisateur <systemitem class="username">root</systemitem>
    pour lancer l'environnement de test. Pour exécuter les tests, lancez&nbsp;:
    <command>make test</command>. Si vous avez installé
    <application>Linux-PAM</application> et construit les modules de la 
    bibliothèque PAM, vous pouvez effectuer un test dlopen en effectuant&nbsp;:
    <command>make test_pam_modules</command>.</para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install &amp;&amp;
mv -v /usr/lib/samba/libsmbclient.so /usr/lib &amp;&amp;
ln -v -sf ../libsmbclient.so /usr/lib/samba &amp;&amp;
ln -v -sf libsmbclient.so /usr/lib/libsmbclient.so.0 &amp;&amp;

chmod -v 644 /usr/include/lib{smbclient,msrpc}.h &amp;&amp;

install -v -m755 nsswitch/libnss_win{s,bind}.so /lib &amp;&amp;
ln -v -sf libnss_winbind.so /lib/libnss_winbind.so.2 &amp;&amp;
ln -v -sf libnss_wins.so /lib/libnss_wins.so.2 &amp;&amp;

install -v -m644 ../examples/smb.conf.default /etc/samba &amp;&amp;

install -v -m755 -d /usr/share/doc/samba-&samba3-version; &amp;&amp;
install -v -m644 ../docs/*.pdf /usr/share/doc/samba-&samba3-version; &amp;&amp;
ln -v -s ../../samba/swat  /usr/share/doc/samba-&samba3-version;</userinput></screen>

  <para>Si vous avez passé l'option <option>--with-python</option> au script
  <command>configure</command>, lancez les commandes suivantes en tant qu'utilisateur
  <systemitem class="username">root</systemitem> pour installer les extensions
  <application>Python</application>&nbsp;:</para>

<screen role="root"><userinput>make python_install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><parameter>--sysconfdir=/etc</parameter>&nbsp;: Paramètre le 
    répertoire des fichiers de configuration pour éviter celui par défaut
    <filename class="directory">/usr/etc</filename>.</para>

    <para><parameter>--localstatedir=/var</parameter>&nbsp;: Paramètre le
    répertoire de données de variable pour éviter celui par défaut
    <filename class="directory">/usr/var</filename>.</para>

    <para><parameter>--with-fhs</parameter>&nbsp;: Affecte tous les autres 
    chemins de fichiers de façon conforme au <foreignphrase>Filesystem Hierarchy
    Standard</foreignphrase> (standard de hiérarchie de système de fichiers) (FHS).</para>

    <para><parameter>--with-smbmount</parameter>&nbsp;: Demande la 
    création d'un binaire supplémentaire pour être utilisé par la commande
    <command>mount</command> afin que le montage de partage SMB (Windows) 
    distants ne soit pas plus compliqué que le montage des partages NFS distants.</para>

    <para><option>--with-pam</option>&nbsp;: Utilisez ce paramètre pour lier
    <application>Linux-PAM</application> à la construction. Ceci construit aussi
    les modules <filename class='libraryfile'>pam_winbind.so</filename>
    et <filename class='libraryfile'>pam_smbpass.so</filename>
    de <application>PAM</application>. Vous pouvez trouver des
    instructions sur la manière de configurer et d'utiliser module
    <filename class='libraryfile'>pam_winbind.so</filename> en lançant 
    <command>man winbindd</command>.</para>

    <para><command>mv -v /usr/lib/samba/libsmbclient.so ...; ln -v -sf
    ../libsmbclient.so ...</command>&nbsp;: La bibliothèque
    <filename class='libraryfile'>libsmbclient.so</filename> est nécessaire pour
    d'autres paquets. Cette commande la déplace à un endroit où d'autres
    paquets pourront la trouver.</para>

    <para><command>install -v -m755 nsswitch/libnss_win{s,bind}.so /lib</command>&nbsp;:
    Les bibliothèques nss ne sont pas installées par défaut. Si vous souhaitez 
    utiliser winbindd pour l'authentification du domaine, et/ou la résolution
    de nom WINS, vous avez besoin de ces bibliothèques.</para>

    <para><command>ln -v -sf libnss_winbind.so /lib/libnss_winbind.so.2</command>
    et <command>ln -v -sf libnss_wins.so /lib/libnss_wins.so.2</command>&nbsp;:
    Ces liens symboliques sont exigés par glibc pour utiliser les bibliothèques
    NSS.</para>

    <para><command>install -v -m644 ../examples/smb.conf.default
    /etc/samba</command>&nbsp;: Ceci copie un fichier <filename>smb.conf</filename>
    par défaut dans <filename>/etc/samba</filename>. Ce modèle de configuration
    ne fonctionnera pas tant que vous ne la copiez pas dans <filename>/etc/samba/smb.conf</filename> et
    ne ferez pas les modifications adaptées à votre installation. Voir la
    section de configuration pour les valeurs minimum à régler.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Samba</title>

    <sect3 id="samba3-config">
      <title>Fichiers de configuration</title>

      <para>/etc/samba/smb.conf</para>

      <indexterm zone="samba3 samba3-config">
        <primary sortas="e-etc-samba-smb.conf">/etc/samba/smb.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Montage des partages par des utilisateurs non privilégiés</title>

      <para>Si vous désirez qu'un utilisateur non privilégié monte directement 
      (et démonte) des partages SMB et CIFS, il faut paramétrer l'uid de
      <command>smbmnt</command>,
      <command>smbumount</command>, <command>mount.cifs</command> et
      <command>umount.cifs</command> sur
      <systemitem class='username'>root</systemitem>. Remarquez que les 
      utilisateurs ne peuvent monter des partages SMB/CIFS que sur un point de 
      montage lui appartenant (exige aussi l'accès en écriture). Si vous le
      désirez, passez ces programmes en setuid 
      <systemitem class='username'>root</systemitem> en lançant la commande
      suivante en tant qu'utilisateur <systemitem class='username'>root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>chmod -v 4755 /usr/bin/smb{mnt,umount} \
              /usr/sbin/{,u}mount.cifs</userinput></screen>

    </sect3>

    <sect3>
      <title>Imprimer par des clients SMB</title>

      <para>Si vous utilisez <application>CUPS</application> pour les services
      d'impression, et si vous souhaitez imprimer sur une imprimante attachée à
      un client SMB, vous devez créer un périphérique de fond SMB. Pour créer le
      périphérique, lancez la commande suivante en tant qu'utilisateur 
      <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>ln -v -sf /usr/bin/smbspool /usr/lib/cups/backend/smb</userinput></screen>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>Compte tenu de la complexité et des usages très variés de
      <application>Samba</application>, une configuration complète pour toutes
      les possibilités du paquet va bien au-delà du but du livre BLFS. Cette
      section fournit des instructions pour configurer le fichier
      <filename>/etc/samba/smb.conf</filename> pour deux scénari classiques.
      Le contenu complet de <filename>/etc/samba/smb.conf</filename> dépendra
      de la finalité de l'installation de <application>Samba</application>.</para>

      <note>
        <para>Il se peut que vous trouviez plus facile de copier les paramètres
         de configuration indiqués ci-dessous dans un fichier
         <filename>/etc/samba/smb.conf</filename> vierge plutôt que de copier et
         d'éditer le fichier par défaut comme l'indique la section
        <quote>Explication des commandes</quote>. La façon de créer et d'éditer
        le fichier <filename>/etc/samba/smb.conf</filename> vous appartient.
        Assurez-vous que le fichier n'est accessible en écriture que pour
        l'utilisateur <systemitem class="username">root</systemitem> (mode 644).</para>
      </note>

      <sect4>
        <title>Scénario 1&nbsp;: Installation pour un client unique autonome minimal</title>

        <para>Choisissez cette variante si vous ne voulez que transférer des
        fichiers en utilisant <command>smbclient</command>, monter des partages
        Windows et imprimer sur des imprimantes Windows et si vous ne voulez pas
        partager vos fichiers et vos imprimantes avec des machines Windows.</para>

        <para>Un fichier <filename>/etc/samba/smb.conf</filename> avec les
        trois paramètres suivants suffit&nbsp;:</para>

<screen role='root'><literal>[global]
    workgroup = <replaceable>MONGROUPE</replaceable>
    dos charset = <replaceable>cp850</replaceable>
    unix charset = <replaceable>ISO-8859-1</replaceable></literal></screen>

        <para>Les valeurs de cet exemple indiquent que l'ordinateur appartient
        à un groupe de travail Windows appelé <quote><replaceable>MONGROUPE</replaceable></quote>, 
        il utilise l'encodage <quote><replaceable>cp850</replaceable></quote>
        sur la toile lorsqu'il parle à MS-DOS et à MS Windows 9x, et les noms
        de fichier sont stockés dans l'encodage <quote><replaceable>ISO-8859-1</replaceable></quote>
        sur le disque. Adaptez ces valeurs à votre installation. La
        valeur <quote>unix charset</quote> doit être la même que la sortie de
        <command>locale charmap</command> lorsqu'on l'exécute avec la variable
        <envar>LANG</envar> paramétrée sur votre locale préférée, sinon il se
        peut que <command>ls</command> n'affiche pas de bons noms de fichiers
        pour les fichiers téléchargés.</para>

        <para>Il n'est pas nécessaire de lancer de serveurs <application>Samba</application>
        dans ce scénario, vous n'avez donc pas besoin d'installer les scripts de
        démarrage fournis.</para>

      </sect4>

      <sect4>
        <title>Scénario 2&nbsp;: Serveur de fichiers/impression autonome</title>

        <para>Choisissez cette variante si vous voulez partager vos fichiers et
        vos imprimantes avec des machines Windows sur votre groupe de travail, 
        en plus des possibilités indiquées au scénario 1.</para>

        <para>Dans ce cas, le fichier <filename>/etc/samba/smb.conf.default</filename>
        peut être un bon modèle de point de départ. Ajoutez également les paramètres
        <quote>dos charset</quote> et <quote>unix charset</quote> à la section
        <quote>[global]</quote> comme décrit au scénario 1 pour empêcher la
        corruption des noms de fichiers.</para>

        <para>Le fichier de configuration suivant crée un partage séparé pour
        chaque répertoire home d'utilisateur et il rend disponibles toutes les 
        imprimantes disponibles sur des machines Windows&nbsp;:</para>

<screen role='root'><literal>[global]
    workgroup = <replaceable>MONGROUPE</replaceable>
    dos charset = <replaceable>cp850</replaceable>
    unix charset = <replaceable>ISO-8859-1</replaceable>

[homes]
    comment = Répertoires Home
    browseable = no
    writable = yes

[printers]
    comment = Toutes les imprimantes
    path = /var/spool/samba
    browseable = no
    guest ok = no
    printable = yes</literal></screen>

        <para>Les autres paramètres que vous pourriez vouloir personnaliser dans
        la section <quote>[global]</quote> comprennent&nbsp;:</para>

<screen role='root'><literal>    server string =
    security =
    hosts allow =
    load printers =
    log file =
    max log size =
    socket options =
    local master =</literal></screen>

        <para>Reportez-vous aux commentaires dans le fichier
        <filename>/etc/samba/smb.conf.default</filename> pour des informations
        concernant ces paramètres.</para>

        <para>Vu que les démons <command>smbd</command> et <command>nmbd</command>
        sont nécessaires dans ce cas, installez le script de démarrage
        <filename>samba</filename>. Assurez-vous de lancer <command>smbpasswd</command> 
        (avec l'option <option>-a</option>) pour ajouter des utilisateurs) pour
        activer et paramétrer les mots de passe des comptes ayant besoin d'un 
        accès <application>Samba</application>, ou utilisez l'interface Web SWAT 
        (voir ci-dessous) pour faire la même chose. En utilisant la
        fondation passdb par défaut de <application>Samba</application>, tout
        utilisateur que vous essaierez d'ajouter devra aussi exister
        dans le fichier <filename>/etc/passwd</filename>.</para>

      </sect4>

      <sect4>
        <title>Exigences avancées</title>

        <para>Des scénari plus complexes impliquant le contrôle de domaine ou
        de la qualité de membre sont envisageables si on passe les bons drapeaux
        au script./configure lors de la construction du paquet. De tels réglages
        sont des sujets avancés et ne peuvent pas être traités correctement dans
        BLFS. De nombreux livres complets ont été écrits exclusivement sur ces 
        thèmes. Vous devriez remarquer cependant qu'un BDC
        <application>Samba</application> ne peut pas être utilisé comme point de
        chute pour un PDC Windows, et réciproquement, on ne peut pas utiliser un
        BDC Windows comme point de chute d'un PDC 
        <application>Samba</application>. En outre, dans certains scénari de
        membres d'un domaine, le démon <command>winbindd</command> et le
        script de démarrage correspondant sont nécessaires.</para>

        <para>Il y a très peu de documentation disponible capable de traiter
        bon nombre de ces configurations avancées. Pointez votre navigateur
        Internet vers les liens ci-dessous pour trouver une partie de la 
        documentation incluse avec le paquet
        <application>Samba</application>&nbsp;:</para>

        <itemizedlist spacing='compact'>
          <listitem>
            <para>Using Samba, 2nd Edition; a popular book published by O'Reilly
            (Utiliser Samba, 2ème édition, livre populaire publié par O'Reilly)
            <ulink url="file:///usr/share/samba/swat/using_samba/toc.html"/></para>
          </listitem>
          <listitem>
            <para>The Official Samba HOWTO et Reference Guide 
            (Le Guide de référence et le guide pratique de SAMBA officiels) <ulink
            url="file:///usr/share/samba/swat/help/Samba-HOWTO-Collection/index.html"/>
            </para>
          </listitem>
          <listitem>
            <para>Samba-3 by Example (Samba-3 par l'exemple)
            <ulink url="file:///usr/share/samba/swat/help/Samba-Guide/index.html"/>
            </para>
          </listitem>
          <listitem>
            <para>The Samba-3 man Pages (Les pages de man de Samba-3)
            <ulink url="file:///usr/share/samba/swat/help/samba.7.html"/></para>
          </listitem>
        </itemizedlist>

      </sect4>

    </sect3>

    <sect3 id="samba3-swat-config">
      <title>Configuration de SWAT</title>

      <para>On peut utiliser l'outil intégré SWAT (<foreignphrase><application>Samba</application> Web
      Administration Tool</foreignphrase> (outil d'administration Web Samba) 
      pour la configuration de base de l'installation de <application>Samba</application>, 
      mais vu qu'il peut ne pas être commode, être indésirable voire rendre 
      impossible l'accès à la console, BLFS recommande de paramétrer l'accès à 
      SWAT en utilisant 
      <application>Stunnel</application>. Sans 
      <application>Stunnel</application>, le mot de passe
      <systemitem class="username">root</systemitem> est transmis en clair sur
      la toile et on le considère comme un risque de sécurité inacceptable.
      Après avoir étudié les problèmes de s&curité liés à l'utilisation de
      SWAT sans
      <application>Stunnel</application> et si vous souhaitez toujours implémenter
      SWAT sans lui, des instructions vous sont données à la fin de cette section.</para>

      <indexterm zone="samba3 samba3-swat-config">
        <primary sortas="g-SWAT">SWAT</primary>
      </indexterm>

      <sect4>
        <title>Réglage de SWAT en utilisant Stunnel</title>

        <para>Installez tout d'abord, ou assurez-vous qu'il est déjà installé, 
        le paquet <xref linkend="stunnel"/>.</para>

        <para>Vous devez ensuite ajouter des entrées à <filename>/etc/services</filename>
        et modifier la configuration de
        <command>inetd</command>/<command>xinetd</command>.</para>

        <indexterm zone="samba3 samba3-swat-config">
          <primary sortas="e-etc-services">/etc/services</primary>
        </indexterm>

        <indexterm zone="samba3 samba3-swat-config">
          <primary sortas="e-etc-inetd.conf">/etc/inetd.conf</primary>
        </indexterm>

        <indexterm zone="samba3 samba3-swat-config">
          <primary sortas="e-etc-xinetd.conf">/etc/xinetd.conf</primary>
        </indexterm>

        <para>Ajoutez les entrées swat et swat_tunnel à
        <filename>/etc/services</filename> avec les commandes suivantes à 
        exécuter en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>echo "swat            904/tcp" &gt;&gt; /etc/services &amp;&amp;
echo "swat_tunnel     905/tcp" &gt;&gt; /etc/services</userinput></screen>

        <para>Si vous utilisez <command>inetd</command>, la commande suivante
        ajoutera l'entrée swat_tunnel à <filename>/etc/inetd.conf</filename> (en
        tant qu'utilisateur <systemitem class="username">root</systemitem>)&nbsp;:</para>

<screen role="root"><userinput>echo "swat_tunnel stream tcp nowait.400 root /usr/sbin/swat swat" \
    &gt;&gt; /etc/inetd.conf</userinput></screen>

        <para>Effectuez un <command>killall -HUP inetd</command> pour relire
        le fichier <filename>inetd.conf</filename> modifié.</para>

        <para>Si vous utilisez <command>xinetd</command>, la commande suivante
        créera le fichier <application>Samba</application> en tant que
        <filename>/etc/xinetd.d/swat_tunnel</filename> (il se peut que vous
        deviez modifier ou supprimer la ligne <quote>only_from</quote> pour
        inclure le[s] hôte[s] désiré[s])&nbsp;:</para>

<screen role="root"><userinput>cat &gt;&gt; /etc/xinetd.d/swat_tunnel &lt;&lt; "EOF"
<literal># Début de /etc/xinetd.d/swat_tunnel

service swat_tunnel
{
    port            = 905
    socket_type     = stream
    wait            = no
    only_from       = 127.0.0.1
    user            = root
    server          = /usr/sbin/swat
    log_on_failure  += USERID
}

# Fin de /etc/xinetd.d/swat_tunnel</literal>
EOF</userinput></screen>

        <indexterm zone="samba3 samba3-swat-config">
          <primary sortas="e-etc-xinetd.d-swat-tunnel">/etc/xinetd.d/swat_tunnel</primary>
        </indexterm>

        <para>Effectuez un <command>killall -HUP xinetd</command> pour lire
        le nouveau fichier <filename>/etc/xinetd.d/swat_tunnel</filename>.</para>

        <para>Ensuite, vous devez ajouter une entrée pour le service swat au
        fichier <filename>/etc/stunnel/stunnel.conf</filename> (en tant 
        qu'utilisateur <systemitem class="username">root</systemitem>)&nbsp;:</para>

        <indexterm zone="samba3 samba3-swat-config">
          <primary sortas="e-etc-stunnel-stunnel.conf">/etc/stunnel/stunnel.conf</primary>
        </indexterm>

<screen role="root"><userinput>cat &gt;&gt; /etc/stunnel/stunnel.conf &lt;&lt; "EOF"
<literal>[swat]
accept  = 904
connect = 905
TIMEOUTclose = 1</literal>

EOF</userinput></screen>

        <para>Redémarrez le démon <command>stunnel</command> en utilisant la
        commande suivante en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>/etc/rc.d/init.d/stunnel restart</userinput></screen>

      <para>SWAT peut être lancé en faisant pointer votre navigateur Internet sur
      <uri>https://<replaceable>&lt;champ_CA_DN&gt;</replaceable>:904</uri>.
      Mettez le nom de l'hôte listé dans le champ DN du certificat CA utilisé
      avec <application>Stunnel</application> à la place de
      <replaceable>&lt;champ_CA_DN&gt;</replaceable>.</para>

      </sect4>

      <sect4>
        <title>Réglage de SWAT sans Stunnel</title>

        <warning>
          <para>BLFS ne recommande pas d'utiliser ces procédures du fait des
          risques de sécurité que cela entraîne. Cependant, dans un environnement
          de réseau familial et où l'échange du mot de passe
          <systemitem class='username'>root</systemitem> est un risque acceptable,
          les instructions suivantes sont fournies pour vous être commode.</para>
        </warning>

        <para>Ajoutez une entrée swat à <filename>/etc/services</filename> avec
        la commande suivante lancée en tant qu'utilisateur
        <systemitem class='username'>root</systemitem>&nbsp;:</para>

<screen role='root'><userinput>echo "swat            904/tcp" &gt;&gt; /etc/services</userinput></screen>

        <para>Si vous utilisez <command>inetd</command>, la commande suivante
        lancée en tant qu'utilisateur <systemitem class='username'>root</systemitem> 
        ajoutera une entrée swat au fichier <filename>/etc/inetd.conf</filename>&nbsp;:</para>

<screen role='root'><userinput>echo "swat stream tcp nowait.400 root /usr/sbin/swat swat" \
    &gt;&gt; /etc/inetd.conf</userinput></screen>

        <para>Effectuez un <command>killall -HUP inetd</command> pour relire le
        fichier <filename>inetd.conf</filename> modifié.</para>

        <para>Si vous utilisez <command>xinetd</command>, la commande suivante
        effectuée en tant qu'utilisateur <systemitem class='username'>root</systemitem> 
        créera un fichier <filename>/etc/xinetd.d/swat</filename>&nbsp;:</para>

<screen role='root'><userinput>cat &gt;&gt; /etc/xinetd.d/swat &lt;&lt; "EOF"
<literal># Début de /etc/xinetd.d/swat

service swat
{
    port            = 904
    socket_type     = stream
    wait            = no
    only_from       = 127.0.0.1
    user            = root
    server          = /usr/sbin/swat
    log_on_failure  += USERID
}

# Fin de /etc/xinetd.d/swat</literal>
EOF</userinput></screen>

        <para>Effectuez un <command>killall -HUP xinetd</command> pour lire
        le nouveau fichier <filename>/etc/xinetd.d/swat</filename>.</para>

        <para>SWAT peut être lancé en faisant pointer votre navigateur Internet
         sur http://localhost:904.</para>

      </sect4>

    </sect3>

    <sect3>
      <title/>

      <note>
        <para>Si vous avez lié <application>Linux-PAM</application> à la
        construction de <application>Samba</application>, vous devrez créer un
        fichier <filename>/etc/pam.d/samba</filename>.</para>
      </note>

      <indexterm zone="samba3 samba3-swat-config">
        <primary sortas="e-etc-pam.d-samba">/etc/pam.d/samba</primary>
      </indexterm>

    </sect3>

    <sect3 id="samba3-init">
      <title>Script de démarrage</title>

      <para>Pour vom( être commode, on a créé un script de démarrage pour
      <application>Samba</application>. Deux sont inclus dans le paquet
      <xref linkend="bootscripts"/>. Le premier,
      <filename>samba</filename>, démarrera les démons <command>smbd</command>
      et <command>nmbd</command> nécessaires pour fournir les services SMB/CIFS.
      Le deuxième script, <filename>winbind</filename>, démarre le démon
      <command>winbindd</command> utilisé pour fournir les services de domaine 
      Windows pour les clients Linux.</para>

      <indexterm zone="samba3 samba3-init">
        <primary sortas="f-samba">samba</primary>
      </indexterm>

      <indexterm zone="samba3 samba3-init">
        <primary sortas="f-winbind">winbind</primary>
      </indexterm>

      <para>L'installation <application>Samba</application> par défaut utilise 
      l'utilisateur
      <systemitem class='username'>nobody</systemitem> pour l'accès invité
      au serveur. On peut éviter cela en réglant le paramètre
      <option>guest account =</option> dans le fichier
<filename>/etc/samba/smb.conf</filename>. Si vous utilisez le paramètre
      <option>guest account =</option>, assurez-vous que cet utilisateur existe
      dans le fichier <filename>/etc/passwd</filename>. Pour utiliser
      l'utilisateur par défaut, lancez les commandes suivantes en tant 
      qu'utilisateur <systemitem class='username'>root</systemitem>&nbsp;:</para>

<screen><userinput>groupadd -g 99 nogroup &amp;&amp;
useradd -c "Unprivileged Nobody" -d /dev/null -g nogroup \
    -s /bin/false -u 99 nobody</userinput></screen>

      <para>Installez le script de démarrage <filename>samba</filename> avec
      la commande suivante effectuée en tant qu'utilisateur 
      <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install-samba</userinput></screen>

      <para>Si vous avez aussi besoin du script <filename>winbind</filename>&nbsp;:</para>

<screen role="root"><userinput>make install-winbind</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

<!--newprogs: eventlogadm smbget-->

      <seglistitem>
        <seg>eventlogadm, findsmb, mount.cifs, mount.smbfs, net, nmbd,
        nmblookup, ntlm_auth, pdbedit, profiles, rpcclient, smbcacls,
        smbclient, smbcontrol, smbcquotas, smbd, smbget, smbmnt, smbmount,
        smbpasswd, smbspool, smbstatus, smbtar, smbtree, smbumount, swat,
        tdbbackup, tdbdump, tdbtool, testparm, unmount.cifs, wbinfo
        et winbindd</seg>
        <seg>libnss_winbind.so, libnss_wins.so, libsmbclient.so, libmsrpc.so,
        the pam_winbind.so et pam_smbpass.so PAM libraries, and assorted
        character set, filesystem et support modules.</seg>
        <seg>/etc/samba, /usr/lib/python&python-majorver;/site-packages/samba,
        /usr/lib/samba, /usr/share/doc/samba-&samba3-version;,
        /usr/share/samba, /var/lib/samba et /var/log/samba</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="eventlogadm">
        <term><command>eventlogadm</command></term>
        <listitem>
          <para>est utilisé pour enregistrer l'entrée standard, la source spécifiée
          et les entrées du registre du journal d'événement DLL dans un journal 
          d'événements et pour afficher les noms des journaux d'événement actifs
          (à partir de <filename>smb.conf</filename>).</para>
          <indexterm zone="samba3 eventlogadm">
            <primary sortas="b-eventlogadm">eventlogadm</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="findsmb">
        <term><command>findsmb</command></term>
        <listitem>
          <para>liste les informations sur les machines qui répondent à des
          recherches de moms SMB sur un sous-réseau.</para>
          <indexterm zone="samba3 findsmb">
            <primary sortas="b-findsmb">findsmb</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mount.cifs">
        <term><command>mount.cifs</command></term>
        <listitem>
          <para>monte un szstème de fichiers Linux CIFS. Il est en général appelé
          indirectement par la commande <command>mount</command> lors de l'utilisation
          de l'option <option>-t cifs</option>.</para>
          <indexterm zone="samba3 mount.cifs">
            <primary sortas="b-mount.cifs">mount.cifs</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mount.smbfs">
        <term><command>mount.smbfs</command></term>
        <listitem>
          <para>est un lien symbolique vers <command>smbmount</command> qui
          fournit <command>/bin/mount</command> avec une autre façon de monter 
          des partages de fichiers Windows (ou <application>Samba</application>).</para>
          <indexterm zone="samba3 mount.smbfs">
            <primary sortas="b-mount.smbfs">mount.smbfs</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="net">
        <term><command>net</command></term>
        <listitem>
          <para>est un outil d'administration de
          <application>Samba</application> et des serveurs CIFS distants, 
          ressemblant à l'outil <command>net</command> pour DOS/Windows.</para>
          <indexterm zone="samba3 net">
            <primary sortas="b-net">net</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="nmbd">
        <term><command>nmbd</command></term>
        <listitem>
          <para>est le serveur de DNS NetBIOS <application>Samba</application>.</para>
          <indexterm zone="samba3 nmbd">
            <primary sortas="b-nmbd">nmbd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="nmblookup">
        <term><command>nmblookup</command></term>
        <listitem>
          <para>est utilisé pour chercher des noms NetBIOS et les associer à des
          adresses IP.</para>
          <indexterm zone="samba3 nmblookup">
            <primary sortas="b-nmblookup">nmblookup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="ntlm_auth">
        <term><command>ntlm_auth</command></term>
        <listitem>
          <para>est un outil pour autoriser l'accès extérieur à la fonction
          d'authentication NTLM de Winbind.</para>
          <indexterm zone="samba3 ntlm_auth">
            <primary sortas="b-ntlm_auth">ntlm_auth</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pdbedit">
        <term><command>pdbedit</command></term>
        <listitem>
          <para>est un outil pour gérer la base de données SAM.</para>
          <indexterm zone="samba3 pdbedit">
            <primary sortas="b-pdbedit">pdbedit</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="profiles">
        <term><command>profiles</command></term>
        <listitem>
          <para>est un outil qui affiche et modifie les SIDs dans les fichiers
          du registre Windows. Il ne supporte actuellement que Windows NT.</para>
          <indexterm zone="samba3 profiles">
            <primary sortas="b-profiles">profiles</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="rpcclient">
        <term><command>rpcclient</command></term>
        <listitem>
          <para>est utilisé pour exécuter les fonctions MS-RPC côté client.</para>
          <indexterm zone="samba3 rpcclient">
            <primary sortas="b-rpcclient">rpcclient</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbcacls">
        <term><command>smbcacls</command></term>
        <listitem>
          <para>est utilisé pour manipuler des listes de contrôle d'accès Windows
          NT.</para>
          <indexterm zone="samba3 smbcacls">
            <primary sortas="b-smbcacls">smbcacls</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbclient">
        <term><command>smbclient</command></term>
        <listitem>
          <para>est un outil d'accès à SMB/CIFS, ressemblant à FTP.</para>
          <indexterm zone="samba3 smbclient">
            <primary sortas="b-smbclient">smbclient</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbcontrol">
        <term><command>smbcontrol</command></term>
        <listitem>
          <para>est utilisé pour contrôler le fonctionnement des démons
          <command>smbd</command>, <command>nmbd</command> et <command>winbindd</command>.</para>
          <indexterm zone="samba3 smbcontrol">
            <primary sortas="b-smbcontrol">smbcontrol</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbcquotas">
        <term><command>smbcquotas</command></term>
        <listitem>
          <para>est utilisé pour manipuler les quotas de Windows NT sur des partages
          de fichiers SMB.</para>
          <indexterm zone="samba3 smbcquotas">
            <primary sortas="b-smbcquotas">smbcquotas</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbd">
        <term><command>smbd</command></term>
        <listitem>
          <para>est le démon <application>Samba</application> principal, qui
          fournit les services SMB/CIFS aux clients.</para>
          <indexterm zone="samba3 smbd">
            <primary sortas="b-smbd">smbd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbget">
        <term><command>smbget</command></term>
        <listitem>
          <para>est un simple outil avec las sémantiques du type <command>wget</command>
          qui peut télécharger des fichiers sur des serveurs SMB. Vous pouvez
          spécifier les fichiers que vous aimeriez télécharger sur la ligne de
          commande.</para>
          <indexterm zone="samba3 smbget">
            <primary sortas="b-smbget">smbget</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbmnt">
        <term><command>smbmnt</command></term>
        <listitem>
          <para>est une application d'aide utilisée par le programme
          <command>smbmount</command> pour faire le montage actuel de partages
          SMB. Vous pouvez l'installer avec le setuid
          <systemitem class='username'>root</systemitem> si vous voulez que les
          utilisateurs non privilégiés puissent monter leurs partages SMB.</para>
          <indexterm zone="samba3 smbmnt">
            <primary sortas="b-smbmnt">smbmnt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbmount">
        <term><command>smbmount</command></term>
        <listitem>
          <para>est appelé en général en tant que<command>mount.smbfs</command>
          par la commande <command>mount</command> lors de l'utilisation 
          de l'option <parameter>-t smbfs</parameter>, elle monte un système
          de fichiers SMB Linux.</para>
          <indexterm zone="samba3 smbmount">
            <primary sortas="b-smbmount">smbmount</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbpasswd">
        <term><command>smbpasswd</command></term>
        <listitem>
          <para>modifie le mot de passe <application>Samba</application> de
          l'utilisateur.</para>
          <indexterm zone="samba3 smbpasswd">
            <primary sortas="b-smbpasswd">smbpasswd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbspool">
        <term><command>smbspool</command></term>
        <listitem>
          <para>envoie une tâche d'impression sur une imprimante SMB.</para>
          <indexterm zone="samba3 smbspool">
            <primary sortas="b-smbspool">smbspool</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbstatus">
        <term><command>smbstatus</command></term>
        <listitem>
          <para>affiche les connexions <application>Samba</application> actuelles.</para>
          <indexterm zone="samba3 smbstatus">
            <primary sortas="b-smbstatus">smbstatus</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbtar">
        <term><command>smbtar</command></term>
        <listitem>
          <para>est un script shell utilisé pour sauvegarder des partages 
          SMB/CIFS directement sur des lecteurs de bandes Linux ou dans un 
          fichier.</para>
          <indexterm zone="samba3 smbtar">
            <primary sortas="b-smbtar">smbtar</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbtree">
        <term><command>smbtree</command></term>
        <listitem>
          <para>est un navigateur réseau SMB en mode texte.</para>
          <indexterm zone="samba3 smbtree">
            <primary sortas="b-smbtree">smbtree</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="smbumount">
        <term><command>smbumount</command></term>
        <listitem>
          <para>est utilisé par les utilisateurs non privilégiés pour démonter 
          des systèmes de fichiers SMB, s'il est setuid (l'identifiant utilisateur
          est paramétré) sur root.</para>
          <indexterm zone="samba3 smbumount">
            <primary sortas="b-smbumount">smbumount</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="swat">
        <term><command>swat</command></term>
        <listitem>
          <para>est l'outil d'administration Web <application>Samba</application>.</para>
          <indexterm zone="samba3 swat">
            <primary sortas="b-swat">swat</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="tdbbackup">
        <term><command>tdbbackup</command></term>
        <listitem>
          <para>est un outil pour sauvegarder ou valider l'intégrité de fichiers
          <application>Samba</application> <filename>.tdb</filename>.</para>
          <indexterm zone="samba3 tdbbackup">
            <primary sortas="b-tdbbackup">tdbbackup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="tdbdump">
        <term><command>tdbdump</command></term>
        <listitem>
          <para>est un outil utilisé pour imprimer le contenu d'un fichier
          <application>Samba</application> <filename>.tdb</filename>.</para>
          <indexterm zone="samba3 tdbdump">
            <primary sortas="b-tdbdump">tdbdump</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="tdbtool">
        <term><command>tdbtool</command></term>
        <listitem>
          <para>est un outil qui permet une manipulation simple en ligne de 
          commande de la base de données.</para>
          <indexterm zone="samba3 tdbtool">
            <primary sortas="b-tdbtool">tdbtool</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="testparm">
        <term><command>testparm</command></term>
        <listitem>
          <para>vérifie la bonne syntaxe d'un fichier <filename>smb.conf</filename>.</para>
          <indexterm zone="samba3 testparm">
            <primary sortas="b-testparm">testparm</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="umount.cifs">
        <term><command>umount.cifs</command></term>
        <listitem>
          <para>est utilisé par les utilisateurs normaux, non <systemitem
          class="username">root</systemitem> pour
          <command>unmount</command> (démonter) leurs propres montages de systèmes de fichiers
          Internet habituel (<foreignphrase>Common Internet File System</foreignphrase>
          CIFS).</para>
          <indexterm zone="samba3 umount.cifs">
            <primary sortas="b-umount.cifs">umount.cifs</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="wbinfo">
        <term><command>wbinfo</command></term>
        <listitem>
          <para>cherche un démon <command>winbindd</command> en fonction.</para>
          <indexterm zone="samba3 wbinfo">
            <primary sortas="b-wbinfo">wbinfo</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="winbindd">
        <term><command>winbindd</command></term>
        <listitem>
          <para>résout des noms à partir de serveurs Windows NT.</para>
          <indexterm zone="samba3 winbindd">
            <primary sortas="b-winbindd">winbindd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
