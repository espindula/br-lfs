<sect2>
<title>Configurer <application><acronym>BIND</acronym></application></title>

<sect3><title>Fichiers de configuration</title>
<para><filename>named.conf</filename>, <filename>root.hints</filename>,
<filename>127.0.0</filename>, <filename>rndc.conf</filename></para>
</sect3>

<sect3><title>Informations de configuration</title>

<para>Nous configurons <application><acronym>BIND</acronym></application> pour
qu'il soit lancé dans une prison chroot en tant qu'utilisateur non privilégié
(named). Cette configuration est plus sécurisée car une compromission
<acronym>DNS</acronym> peut seulement affecter quelques fichiers dans le
répertoire <envar>HOME</envar> de l'utilisateur named.</para> 

<para>Tout d'abord, nous créons l'utilisateur et le groupe non privilégiés named:</para>

<screen><userinput><command>groupadd named &amp;&amp;
useradd -m -g named -s /bin/false named</command></userinput></screen>

<para>Ensuite nous configurons quelques fichiers, répertoires et périphériques
nécessaires à <application><acronym>BIND</acronym></application>:</para>

<screen><userinput><command>cd /home/named &amp;&amp;
mkdir -p dev etc/namedb/slave var/run &amp;&amp;
mknod /home/named/dev/null c 1 3 &amp;&amp;
mknod /home/named/dev/random c 1 8 &amp;&amp;
chmod 666 /home/named/dev/{null,random} &amp;&amp;
mkdir /home/named/etc/namedb/pz &amp;&amp;
cp /etc/localtime /home/named/etc</command></userinput></screen>

<para>Créez le fichier <filename>named.conf</filename> à partir duquel named
lira l'emplacement des fichiers de zone, les serveurs de nom racines et les clés
<acronym>DNS</acronym> sécurisés:</para>

<screen><userinput><command>cat &gt; /home/named/etc/named.conf &lt;&lt; "EOF"</command>
 options {
     directory "/etc/namedb";
    pid-file "/var/run/named.pid";
    statistics-file "/var/run/named.stats";
       
 };
 controls {
     inet 127.0.0.1 allow { localhost; } keys { rndc_key; };
 };
 key "rndc_key" {
     algorithm hmac-md5;
     secret "<replaceable>[c3Ryb25nIGVub3VnaCBmb3IgYSBtYW4gYnV0IG1hZGUgZm9yIGEgd29tYW4K]</replaceable>";
 };
 zone "." {
     type hint;
     file "root.hints";
 };
 zone "0.0.127.in-addr.arpa" {
     type master;
     file "pz/127.0.0";
 };
<command>EOF</command></userinput></screen>

<para>Créez un fichier zone avec le contenu suivant: </para>

<screen><userinput><command>cat &gt; /home/named/etc/namedb/pz/127.0.0 &lt;&lt; "EOF"</command>
$TTL 3D
@      IN      SOA     ns.local.domain. hostmaster.local.domain. (
                        1       ; Serial
                        8H      ; Refresh
                        2H      ; Retry
                        4W      ; Expire
                        1D)     ; Minimum TTL
                NS      ns.local.domain.
1               PTR     localhost.
<command>EOF</command></userinput></screen>

<para>Créez le fichier <filename>root.hints</filename> avec les commandes suivantes:</para>

<note><para>Faites attention et assurez-vous qu'il n'existe aucun espace final
dans ce fichier.</para></note>

<screen><userinput><command>cat &gt; /home/named/etc/namedb/root.hints &lt;&lt; "EOF"</command>
.                       6D  IN      NS      A.ROOT-SERVERS.NET.
.                       6D  IN      NS      B.ROOT-SERVERS.NET.
.                       6D  IN      NS      C.ROOT-SERVERS.NET.
.                       6D  IN      NS      D.ROOT-SERVERS.NET.
.                       6D  IN      NS      E.ROOT-SERVERS.NET.
.                       6D  IN      NS      F.ROOT-SERVERS.NET.
.                       6D  IN      NS      G.ROOT-SERVERS.NET.
.                       6D  IN      NS      H.ROOT-SERVERS.NET.
.                       6D  IN      NS      I.ROOT-SERVERS.NET.
.                       6D  IN      NS      J.ROOT-SERVERS.NET.
.                       6D  IN      NS      K.ROOT-SERVERS.NET.
.                       6D  IN      NS      L.ROOT-SERVERS.NET.
.                       6D  IN      NS      M.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.     6D  IN      A       198.41.0.4
B.ROOT-SERVERS.NET.     6D  IN      A       128.9.0.107
C.ROOT-SERVERS.NET.     6D  IN      A       192.33.4.12
D.ROOT-SERVERS.NET.     6D  IN      A       128.8.10.90
E.ROOT-SERVERS.NET.     6D  IN      A       192.203.230.10
F.ROOT-SERVERS.NET.     6D  IN      A       192.5.5.241
G.ROOT-SERVERS.NET.     6D  IN      A       192.112.36.4
H.ROOT-SERVERS.NET.     6D  IN      A       128.63.2.53
I.ROOT-SERVERS.NET.     6D  IN      A       192.36.148.17
J.ROOT-SERVERS.NET.     6D  IN      A       192.58.128.30
K.ROOT-SERVERS.NET.     6D  IN      A       193.0.14.129
L.ROOT-SERVERS.NET.     6D  IN      A       198.32.64.12
M.ROOT-SERVERS.NET.     6D  IN      A       202.12.27.33
<command>EOF</command></userinput></screen>

<para>Le fichier <filename>root.hints</filename> est une liste des serveurs de
nom racines. Ce fichier doit être mis à jour périodiquement avec l'outil
<command>dig</command>. Consultez le <ulink
url="http://www.bind9.net/Bv9ARM.html">manuel de référence de l'administrateur
<application><acronym>BIND</acronym></application> 9</ulink> pour plus de détails.
</para>

<para>Créez <filename>rndc.conf</filename> avec les commandes suivantes:</para>

<screen><userinput><command>cat &gt; /etc/rndc.conf &lt;&lt; "EOF"</command>
key rndc_key {
algorithm "hmac-md5";
    secret
    "<replaceable>[c3Ryb25nIGVub3VnaCBmb3IgYSBtYW4gYnV0IG1hZGUgZm9yIGEgd29tYW4K]</replaceable>";
    };
options {
    default-server localhost;
    default-key    rndc_key;
};
<command>EOF</command></userinput></screen>

<para>Le fichier <filename>rndc.conf</filename> contient des informations pour
contrôler les opérations de named avec l'outil <command>rndc</command>.
</para>

<note><para>Remplacez yourdomain.com avec votre propre nom de domaine valide.
</para></note>

<screen><userinput><command>cp /etc/resolv.conf /etc/resolv.conf.bak &amp;&amp;
cat &gt; /etc/resolv.conf &lt;&lt; "EOF"</command>
search <replaceable>[yourdomain.com]</replaceable>
nameserver 127.0.0.1
<command>EOF</command></userinput></screen>

<para>Indiquez les droits sur la prison chroot avec la commande suivante:
</para>
<screen><userinput><command>chown -R named.named /home/named</command></userinput></screen>

<para>Pour lancer le serveur DNS au démarrage, installez le script d'initialisation <filename>/etc/rc.d/init.d/bind</filename> inclus dans le paquetage
<xref linkend="intro-important-bootscripts"/>.</para>

<screen><userinput><command>make install-bind</command></userinput></screen>

<para>Maintenant, lancez <application><acronym>BIND</acronym></application> avec
le nouveau script de démarrage:</para>

<screen><userinput><command>/etc/rc.d/init.d/bind start</command></userinput></screen>

</sect3>

<sect3><title>Tester <application><acronym>BIND</acronym></application></title>

<para>Testez la nouvelle installation de
<application><acronym>BIND</acronym></application> 9. Tout d'abord, recherchez
l'adresse locale de l'hôte avec <command>dig</command>:</para>

<screen><userinput><command>dig -x 127.0.0.1</command></userinput></screen>

<para>Maintenant, essayez la recherche de noms externes, en prenant note de la
différence de vitesse dans des recherches répétées grace au cache. Lancez la
commande dig deux fois sur la même adresse&nbsp;:</para>

<screen><userinput><command>dig beyond.linuxfromscratch.org &amp;&amp;
dig beyond.linuxfromscratch.org</command></userinput></screen>

<para>Vous pouvez voir des résultats pratiquement instantanés avec des recherches
cachées de named. Consultez
<filename>bind-&bind-version;/doc/arm/Bv9ARM.html</filename>, le manuel
de référence de l'administrateur de <application><acronym>BIND</acronym></application>
pour plus d'options de configurations.
</para></sect3>
</sect2>

