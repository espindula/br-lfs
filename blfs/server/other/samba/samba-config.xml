<sect2>
<title>Configurer Samba</title>
<para>Nous configurerons un serveur Samba (SAMBABOX) pour agir en tant que
contrôleur primaire de domaine, et aussi configurer un client de domaine
utilisant Windows 2000 Server (WIN2KBOX) et en agissant comme un serveur membre
du domaine. Des instructions détaillées vont être données pour ajouter
WIN2KBOX au domaine avec les étapes supplémentaires nécessaires. Des
instructions pour ajouter des clients Windows 95/98/XP peuvent être trouvées
dans la nouvelle documentation installée en pointant un navigateur web vers:
</para>

<para><screen><userinput>
file:///usr/share/samba/swat/using_samba/ch03_01.html#ch03-55770
.</userinput></screen></para>

<sect3><title>Fichiers de configuration</title>
<para><userinput>
/etc/samba/smb.conf, /etc/rc.d/init.d/samba </userinput></para>

<para>Tout d'abord, nous mettons en place les répertoires nécessaires à Samba:
</para>
<para><screen><userinput>
mkdir /var/lib/samba &amp;&amp;
mkdir /var/lib/samba/netlogon &amp;&amp;
mkdir /var/lib/samba/ntprofile &amp;&amp;
mkdir /var/lib/samba/profiles &amp;&amp;
chmod -R 1777 /var/lib/samba
</userinput></screen></para>

<para>Et le fichier de configuration Samba: </para>
<para><screen><userinput>
cat &gt; /etc/samba/smb.conf &lt;&lt; "EOF"
[global]
    netbios name = SAMBABOX
    workgroup = DOMAIN01
    os level = 64
    preferred master = yes
    domain master = yes
    local master = yes
    security = user
    encrypt passwords = yes
    domain logons = yes
    log file = /var/log/log.%m
    log level = 1
    logon path = \\%N\home\%u
    logon drive = H:
    logon home = \\homeserver\%u
    logon script = logon.cmd
[netlogon]
      path = /var/lib/samba/netlogon
      read only = yes
      write list = ntadmin
[profiles]
      path = /var/lib/samba/ntprofile
      read only = no
      create mask = 0600
      directory mask = 0700
; World writable share for testing
[tmp]
comment = Temporary file space
        path = /tmp
        read only = no
        public = yes
[home]
comment = Users' home directories
        path = /home
        read only = no
        public = no
EOF
</userinput></screen></para>

<para>Maintenant, ajoutez le compte de confiance de la machine pour WIN2KBOX:</para>
<para><screen><userinput>
/usr/sbin/useradd -g 100 -d /dev/null -c \
    "machine nickname" -s /bin/false win2kbox$ &amp;&amp;
passwd -l win2kbox$ &amp;&amp;
smbpasswd -a -m win2kbox
</userinput></screen></para>

<para>Créez le script de démarrage Samba:</para>
<para><screen><userinput>
cat &gt; /etc/rc.d/init.d/samba &lt;&lt; "EOF"
#!/bin/bash
# Début $rc_base/init.d/samba
# Basé sur le script sysklogd de LFS-3.1 et précédents.
# Réécrit par Gerard Beekmans  - gerard@linuxfromscratch.org
source /etc/sysconfig/rc
source $rc_functions
case "$1" in
	start)
		echo "Starting nmbd..."
		loadproc /usr/sbin/nmbd -D
		echo "Starting smbd..."
		loadproc /usr/sbin/smbd -D
		;;
	stop)
		echo "Stopping smbd..."
		killproc /usr/sbin/smbd
		echo "Stopping nmbd..."
		killproc /usr/sbin/nmbd
		;;
	reload)
		echo "Reloading smbd..."
		reloadproc /usr/sbin/smbd
		echo "Reloading nmbd..."
		reloadproc /usr/sbin/nmbd
		;;
	restart)
		$0 stop
		sleep 1
		$0 start
		;;
	status)
		statusproc /usr/sbin/nmbd
		statusproc /usr/sbin/smbd
		;;
	*)
		echo "Usage: $0 {start|stop|reload|restart|status}"
		exit 1
		;;
esac
# Fin $rc_base/init.d/samba
EOF

</userinput></screen></para>
<para>Ajotez les liens symboliques de niveaux d'exécution:</para>
<para><screen><userinput>
chmod 754 /etc/rc.d/init.d/samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc0.d/K48samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc1.d/K48samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc2.d/K48samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc3.d/S23samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc4.d/S23samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc5.d/S23samba &&
ln -s  /etc/rc.d/init.d/samba /etc/rc.d/rc6.d/K48samba
</userinput></screen></para>

<para>Maintenant, nous utiliserons notre nouveau script de démarrage pour
démarrer Samba: </para>
<para><screen><userinput>
/etc/rc.d/init.d/samba start
</userinput></screen></para>
<para>Nous avons ajouter le compte root SAMBABOX à la liste des utilisateurs
Samba tout d'abord dans le but de joindre WIN2KBOX au domaine DOMAIN01:</para>

<para><screen><userinput>
smbpasswd -a root
</userinput></screen></para>

<para>Après avoir lancé Samba et ajouté root à la liste des utilisateurs Samba,
la première machine que nous joignerons à DOMAIN01 sera WIN2KBOX, la machine
Windows 2000 Server pour qui nous avons créé la machine des comptes de
confiance. Sur WIN2KBOX:</para><para><screen><userinput>

1.  Clic droit sur My Computer.
2.  Cliquez sur Properties.
3.  Cliquez sur l'onglet du Network Identification.
4.  Cliquez sur le bouton Properties.
5.  Dans le champ d'édition Computer Name: entrez WIN2KBOX.
6.  Cliquez sur le bouton radio Domain: et entrez DOMAIN01 dans le champ
    d'édition et cliquez sur OK.
7.  A la présentation avec la boîte de dialogue Domain Username And Password,
    entrez root et le mot de passe sur SAMBABOX et cliquez OK.
8.  Après que la machine de confiance est négociée, cliquez sur le bouton OK
    dans le boîte de dialogue vous accueillant dans le domaine DOMAIN01.
9.  Cliquez OK dans la boite de dialogue de redémarrage.
10. Cliquez OK pour fermer la fenetre System Properties.
11. Cliquez Yes pour relancer WIN2KBOX.
</userinput></screen></para></sect3>

<sect3><title>Ajoutez un nouvel utilisateur pour le domaine DOMAIN01.</title>
<para>Avant de se connecter sur WIN2KBOX, nous créerons un nouvel utilisateur
avec les commandes suivantes:</para>
<para><screen><userinput>
useradd -m win2kuser01 &amp;&amp;
passwd win2kuser01 &amp;&amp;
smbpasswd -a win2kuser01 
</userinput></screen></para></sect3>

<sect3><title>Se connecter sur DOMAIN01.</title>
<para>Maintenant, nous nous connectrons sur le domaine en tant que notre
utilisateur nouvellement créé comme ce qui suit:</para> 
<para><screen><userinput>
1. Appuyez Ctrl-Alt-Del pour amener la boite de dialogue de connexion Log On.
2. Entrez les nom et mot de passe win2kuser01.
3. Sélectionnez DOMAIN01 de la boite Log on to: et cliquez OK.
</userinput></screen></para>

<para>Ajoutez l'entrée swat sur <filename>/etc/services</filename> avec la
commande suivante:</para>

<para><screen><userinput>
echo "swat            901/tcp" &gt;&gt; /etc/services
</userinput></screen></para>

<para>Si inetd est utilisé, la commande suivante ajoutera l'entrée swat dans
<filename>/etc/inetd.conf</filename>:</para>
<para><screen><userinput>
echo "swat stream tcp nowait.400 root /usr/sbin/swat swat" \
    &gt;&gt; /etc/inetd.conf
</userinput></screen></para>

<para>Si xinetd est utilisé, la commande suivante ajoutera l'entrée swat vers
<filename>/etc/xinetd.conf</filename>:</para>
<para><screen><userinput>
cat &gt;&gt; /etc/xinetd.conf &lt;&lt; "EOF"
service swat
{
    port            = 901
    socket_type     = stream
    wait            = no
    only_from       = 127.0.0.1
    user            = root
    server          = /usr/sbin/swat
    log_on_failure  += USERID
}
EOF
</userinput></screen></para>

<para>L'outil d'administration web de Samba (Samba Web Administration Tool ou
swat) peut etre lancé avec la commande suivante sur SAMBABOX: </para>
<para><screen><userinput>
lynx http://localhost:901
</userinput></screen></para>
<note><para>Assurez-vous que inetd est démarré, et lancez un killall -HUP inetd
avant de démarrer swat.</para></note>
<para>Le navigateur lynx est utilisé pour cette démonstration, mais n'est pas
nécessaire.</para></sect3>

</sect2>

