<sect2>
<title>Mettre en place un serveur <acronym>CVS</acronym></title>

<para>Nous allons discuter comment mettre en place un serveur
<acronym>CVS</acronym> en utilisant OpenSSH en tant que méthode d'accès à
distance. D'autres méthodes d'accès, incluant :pserver: et :server:, ne seront
pas utilisées pour des accès en écriture au dépôt <acronym>CVS</acronym>. La
méthode :pserver: envoie les mots de passe en clair sur le réseau et la méthode
:server: n'est pas supportée sur tous les ports <acronym>CVS</acronym>. Des
instructions pour l'accès anonyme, en lecture seule, utilisant :pserver:,
peuvent être trouvées à la fin de cette section.</para>

<para>La configuration de notre serveur <acronym>CVS</acronym> consiste en quatre étapes:</para>

<sect3><title>1. Créer le dépôt.</title>

<para>Créez le nouveau dépôt <acronym>CVS</acronym> avec les commandes suivantes, connecté en tant
que root:</para>

<screen><userinput><command>mkdir /cvsroot &amp;&amp;
chmod 1777 /cvsroot &amp;&amp;
export CVSROOT=/cvsroot &amp;&amp;
cvs init</command></userinput></screen>

</sect3>

<sect3><title>2. Importer le code source dans le dépôt.</title>

<para>Importez un module source dans le dépôt avec les commandes suivantes,
envoyé à partir du compte utilisateur sur la même machine que le dépôt <acronym>CVS</acronym>:
</para>

<screen><userinput><command>export CVSROOT=/cvsroot &amp;&amp;
cd sourcedir &amp;&amp;
cvs import -m "repository test" cvstest vendortag releasetag</command></userinput></screen></sect3>

<sect3><title>3. Vérifier l'accès local au dépôt.</title>

<para>Testez l'accès au dépôt <acronym>CVS</acronym> pour le même compte utilisateur avec la
commande suivante:</para>

<screen><userinput><command>cvs co cvstest</command></userinput></screen></sect3>

<sect3><title>4. Vérifier l'accès distant au dépot.</title>

<para>Testez l'accès au dépot <acronym>CVS</acronym> d'une machine distante en
utilisant un compte utilisateur qui a un accès <command>ssh</command> au serveur
<acronym>CVS</acronym> avec les commandes suivantes:
<note><para>Remplacez <replaceable>[nom_serveur]</replaceable> avec l'adresse
<acronym>IP</acronym> ou le nom d'hote de la machine du dépot
<acronym>CVS</acronym>. Le nom du compte utilisateur va vous être demandé avant
que le <acronym>CVS</acronym> checkout puisse continuer.</para></note></para>

<screen><userinput><command>export CVS_RSH=/usr/bin/ssh &amp;&amp;
cvs -d:ext:<replaceable>[nom_serveur]</replaceable>:/cvsroot co cvstest</command></userinput></screen></sect3>
</sect2>

<sect2>
<title>Configurer <acronym>CVS</acronym> pour un accès anonyme en lecture seul.</title>

<para><acronym>CVS</acronym> peut etre configuré pour permettre l'accès anonyme en lecture seule
en utilisant la méthode :pserver: pour se connecter en tant que root et
exécuter les commandes suivantes:</para>

<screen><userinput><command>(grep anonymous /etc/passwd || useradd anonymous -s /bin/false) &amp;&amp;
echo anonymous: &gt; /cvsroot/CVSROOT/passwd &amp;&amp;
echo anonymous &gt; /cvsroot/CVSROOT/readers</command></userinput></screen>

<para>Si vous utilisez <command>inetd</command>, la commande suivante ajoutera l'entrée pserver à
<filename>/etc/inetd.conf</filename>:</para>

<screen><userinput><command>echo "2401  stream  tcp  nowait  root  /usr/bin/cvs cvs -f \
        --allow-root=/cvsroot pserver" &gt;&gt; /etc/inetd.conf</command></userinput></screen>

<para>Envoyez un <command>killall -HUP inetd</command> pour relire le
fichier <filename>inetd.conf</filename> modifié.
</para>

<para>Si vous utilisez <command>xinetd</command>, la commande suivante ajoutera l'entrée pserver
à <filename>/etc/xinetd.conf</filename>:</para>

<screen><userinput><command>cat &gt;&gt; /etc/xinetd.conf &lt;&lt; "EOF"</command>
     service cvspserver
     {
          port        = 2401
          socket_type = stream
          protocol    = tcp
          wait        = no
          user        = root
          passenv     = PATH
          server      = /usr/bin/cvs
         server_args = -f --allow-root=/cvsroot pserver
     }
<command>EOF</command></userinput></screen>

<para>Envoyez un <command>killall -HUP xinetd</command> pour relire le
fichier <filename>xinetd.conf</filename> modifié.</para>

<para>Testez l'accès anonyme pour le nouveau dépot requiert un compte sur une
autre machine qui peut atteindre le serveur <acronym>CVS</acronym> via le réseau. Aucun compte
est nécessaire dans le dépot <acronym>CVS</acronym>. Pour tester l'accès anonyme au dépot <acronym>CVS</acronym>,
connectez-vous sur une autre machine en tant qu'utilisateur non privilégié et
exécutez la commande suivante:</para>

<screen><userinput><command>cvs -d:pserver:anonymous@<replaceable>[nom_serveur]</replaceable>:/cvsroot co cvstest</command></userinput></screen>

<note><para>Remplacez <replaceable>[nom_serveur]</replaceable> avec l'adresse
<acronym>IP</acronym> ou le nom d'hote du serveur <acronym>CVS</acronym>.</para></note></para>

</sect2>


