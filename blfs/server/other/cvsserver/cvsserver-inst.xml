<sect2>
<title>Mettre en place un serveur CVS.</title>

<para>Nous allons discuter comment mettre en place un serveur CVS en utilisant
OpenSSH en tant que méthode d'accès à distance. D'autres méthodes d'accès,
incluant :pserver: et :server:, ne seront pas utilisées pour des accès en
écriture au dépôt CVS. La méthode :pserver: envoie les mots de passe en clair
sur le réseau et la méthode :server: n'est pas supportée sur tous les ports CVS.
Des instructions pour l'accès anonyme, en lecture seule, utilisant :pserver:,
peuvent être trouvées à la fin de cette section.</para>

<para>La configuration de notre serveur CVS consiste en quatre étapes:</para>

<sect3><title>1. Créer le dépôt.</title>

<para>Créez le nouveau dépôt CVS avec les commandes suivantes, connecté en tant
que root:</para>

<para><screen><userinput>mkdir /cvsroot &amp;&amp;
chmod 1777 /cvsroot &amp;&amp;
export CVSROOT=/cvsroot &amp;&amp;
cvs init</userinput></screen></para></sect3>

<sect3><title>2. Importer le code source dans le dépôt.</title>

<para>Importez un module source dans le dépôt avec les commandes suivantes,
envoyé à partir du compte utilisateur sur la même machine que le dépôt CVS:
</para>

<para><screen><userinput>export CVSROOT=/cvsroot &amp;&amp;
cd sourcedir &amp;&amp;
cvs import -m "repository test" cvstest vendortag releasetag</userinput></screen></para></sect3>

<sect3><title>3. Vérifier l'accès local au dépôt.</title>

<para>Testez l'accès au dépôt CVS pour le même compte utilisateur avec la
commande suivante:</para>

<para><screen><userinput>cvs co cvstest</userinput></screen></para></sect3>

<sect3><title>4. Vérifier l'accès distant au dépot.</title>

<para>Testez l'accès au dépot CVS d'une machine distante en utilisant un compte
utilisateur qui a un accès ssh au serveur CVS avec les commandes suivantes:
<note><para>Remplacez "nom_serveur" avec l'adresse IP ou le nom d'hote de la
machine du dépot CVS. Le nom du compte utilisateur va vous etre demandé avant
que le CVS checkout puisse continuer.</para></note></para>

<para><screen><userinput>export CVS_RSH=/usr/bin/ssh &amp;&amp;
cvs -d:ext:nom_serveur:/cvsroot co cvstest</userinput></screen></para></sect3>
</sect2>

<sect2>
<title>Configurer CVS pour un accès anonyme en lecture seul.</title>

<para>CVS peut etre configuré pour permettre l'accès anonyme en lecture seule
en utilisant la méthode :pserver: pour se connecter en tant que root et
exécuter les commandes suivantes:</para>

<para><screen><userinput>(grep anonymous /etc/passwd || useradd anonymous -s /bin/false) &amp;&amp;
echo anonymous: &gt; /cvsroot/CVSROOT/passwd &amp;&amp;
echo anonymous &gt; /cvsroot/CVSROOT/readers</userinput></screen></para>

<para>Si vous utilisez inetd, la commande suivante ajoutera l'entrée pserver à
/etc/inetd.conf:</para>

<para><screen><userinput>echo "2401  stream  tcp  nowait  root  /usr/bin/cvs cvs -f \
        --allow-root=/cvsroot pserver" &gt;&gt; /etc/inetd.conf</userinput></screen></para>

<para>Envoyez un killall -HUP inetd pour relire le fichier inetd.conf modifié.
</para>

<para>Si vous utilisez xinetd, la commande suivante ajoutera l'entrée pserver
à /etc/xinetd.conf:</para>

<para><screen><userinput>cat &gt;&gt; /etc/xinetd.conf &lt;&lt; "EOF"</userinput>
     service cvspserver
     {
          port        = 2401
          socket_type = stream
          protocol    = tcp
          wait        = no
          user        = root
          passenv     = PATH
          server      = /usr/bin/cvs
         server_args = -f --allow-root=/cvsroot pserver
     }
<userinput>EOF</userinput></screen></para>

<para>Envoyez un killall -HUP xinetd pour relire le fichier xinetd.conf modifié.
</para>

<para>Testez l'accès anonyme pour le nouveau dépot requiert un compte sur une
autre machine qui peut atteindre le serveur CVS via le réseau. Aucun compte
est nécessaire dans le dépot CVS. Pour tester l'accès anonyme au dépot CVS,
connectez-vous sur une autre machine en tant qu'utilisateur non privilégié et
exécutez la commande suivante:</para>

<para><screen><userinput>cvs -d:pserver:anonymous@nom_serveur:/cvsroot co cvstest</userinput></screen>

<note><para> Remplacez "nom_serveur" avec l'adresse IP ou le nom d'hote du
serveur CVS.</para></note></para>

</sect2>


