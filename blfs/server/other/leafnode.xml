<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
   "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

<!ENTITY leafnode-download-http "http://prdownloads.sourceforge.net/leafnode/leafnode-&leafnode-version;.rel.tar.bz2">
<!ENTITY leafnode-download-ftp "ftp://ftp.gwdg.de/pub/linux/mirrors/sunsite/system/news/transport/leafnode-&leafnode-version;.rel.tar.bz2">
<!ENTITY leafnode-md5sum "1d8d27673780ba49fcb69883c2cabdec">
<!ENTITY leafnode-size "385&nbsp;Ko">
<!ENTITY leafnode-buildsize "6,3&nbsp;Mo">
<!ENTITY leafnode-time "0,10&nbsp;SBU">
]>

<sect1 id="leafnode" xreflabel="Leafnode-&leafnode-version;">
<sect1info>
<othername>$LastChangedBy: randy $</othername>
<date>$Date: 2005-06-16 06:11:50 $</date>
</sect1info>
<?dbhtml filename="leafnode.html"?>
<title>Leafnode-&leafnode-version;</title>
<indexterm zone="leafnode">
<primary sortas="a-Leafnode">Leafnode</primary></indexterm>

<sect2>
<title>Introduction à <application>Leafnode</application></title>

<para><application>Leafnode</application> est un serveur <acronym>NNTP</acronym>
conçu pour les petits sites fournissant un spooler USENET local.</para>

<sect3><title>Informations sur le paquetage</title>
<itemizedlist spacing='compact'>
<listitem><para>Téléchargement (HTTP)&nbsp;: 
<ulink url="&leafnode-download-http;"/></para></listitem>
<listitem><para>Téléchargement (FTP)&nbsp;: 
<ulink url="&leafnode-download-ftp;"/></para></listitem>
<listitem><para>Téléchargement de la somme MD5&nbsp;: &leafnode-md5sum;</para></listitem>
<listitem><para>Taille du téléchargement&nbsp;:&leafnode-size;</para></listitem>
<listitem><para>Estimation de l'espace disque requis&nbsp;: 
&leafnode-buildsize;</para></listitem>
<listitem><para>Estimation du temps de construction&nbsp;: 
&leafnode-time;</para></listitem></itemizedlist>
</sect3>

<sect3><title>Dépendances de <application>Leafnode</application></title>
<sect4><title>Requis</title>
<para><xref linkend="pcre"/> et <xref linkend="tcpwrappers"/></para>
</sect4>

<sect4><title>Recommandé</title>
<para><xref linkend="xinetd"/> et <xref linkend="fcron"/></para>
</sect4>
</sect3>

</sect2>

<sect2>
<title>Installation de <application>Leafnode</application></title>

<para>Créez le groupe et l'utilisateur news, s'ils ne sont pas déjà
présents&nbsp;:</para>

<screen><userinput><command>groupadd news &amp;&amp;
useradd -c "Leafnode News Server" -d /var/spool/news -g news news</command></userinput></screen>

<para>Installez <application>Leafnode</application> en lançant les commandes
suivantes&nbsp;:</para>

<screen><userinput><command>./configure --prefix=/usr \
    --localstatedir=/var --sysconfdir=/etc/leafnode \
    --with-lockfile=/var/lock/leafnode/fetchnews.lck &amp;&amp;
make</command></userinput></screen>

<para>Maintenant, en tant qu'utilisateur root&nbsp;:</para>

<screen><userinput role='root'><command>make install</command></userinput></screen>

</sect2>

<sect2>
<title>Explications des commandes d'installation</title>

<para><parameter>--localstatedir=/var</parameter>&nbsp;: modifie le répertoire
spool, étant <filename class="directory">/usr/var</filename> par défaut.</para>

<para><parameter>--sysconfdir=/etc/leafnode</parameter>&nbsp;:
<application>Leafnode</application> lit les données de configuration à partir
d'un fichier nommé <filename>config</filename> qui sera créé dans
<filename class="directory">/etc/leafnode</filename> pour éviter tout conflit
potentiel avec d'autres paquetages.</para>

<para><command>make update</command>&nbsp;: lancez cette commande si vous faites
une mise à jour à partir d'une très vieille version de
<application>Leafnode</application>.</para>

</sect2>

<sect2>
<title>Configurer <application>Leafnode</application></title>

<sect3 id="leafnode-config"><title>Fichiers de configuration</title>
<para><filename>/etc/leafnode/config</filename>, 
<filename>/etc/nntpserver</filename>, 
<filename>/etc/xinetd.conf</filename> ou
<filename>/etc/inetd.conf</filename> et
<filename>/etc/sysconfig/createfiles</filename></para>
<indexterm zone="leafnode leafnode-config">
<primary sortas="e-etc-leafnode-config">/etc/leafnode/config</primary>
</indexterm>
<indexterm zone="leafnode leafnode-config">
<primary sortas="e-etc-nntpserver">/etc/nntpserver</primary></indexterm>
<indexterm zone="leafnode leafnode-config">
<primary sortas="e-etc-xinetd.conf">/etc/xinetd.conf</primary></indexterm>
<indexterm zone="leafnode leafnode-config">
<primary sortas="e-etc-inetd.conf">/etc/inetd.conf</primary></indexterm>
<indexterm zone="leafnode leafnode-config"><primary 
sortas="e-etc-sysconfig-createfiles">/etc/sysconfig/createfiles</primary>
</indexterm>
</sect3>

<sect3><title>Commandes de configuration</title>

<para>Le fichier <filename>/etc/leafnode/config</filename> doit être édité
pour refléter le nom du fournisseur <acronym>NNTP</acronym> en amont. Copiez
le fichier de configuration d'exemple dans <filename>/etc/leafnode/config</filename>
et sauvegardez l'original pour référence&nbsp;:</para>

<screen><userinput><command>cp /etc/leafnode/config.example /etc/leafnode/config</command></userinput></screen>

<para>Modifiez l'entrée
<screen><userinput>server = </userinput></screen>
pour refléter votre fournisseur de nouvelles.</para>

<para>Le fichier <filename>/etc/nntpserver</filename> doit contenir 127.0.0.1
pour empêcher les nouveaux clients de lire à partir du flux en amont. Créez ce
fichier en utilisant la commande suivante&nbsp;:</para>

<screen><userinput><command>cat &gt; /etc/nntpserver &lt;&lt; "EOF"</command>
127.0.0.1

<command>EOF</command></userinput></screen>

<para>Le script <command>/etc/rc.d/init.d/cleanfs</command>, faisant partie du
paquetage des scripts de démarrage <acronym>LFS</acronym>, supprimera le
répertoire <filename class="directory">/var/lock/leafnode</filename> pendant la
séquence de démarrage du système. Installez la ligne suivante dans le fichier
<filename>/etc/sysconfig/createfiles</filename> pour créer de nouveau le
répertoire&nbsp;:</para>

<screen><userinput>/var/lock/leafnode   dir   2775   news   news</userinput></screen>

<para><application>Leafnode</application> pourrait être configuré pour utiliser
<command>inetd</command> en ajoutant une entrée dans le fichier
<filename>/etc/inetd.conf</filename> avec la commande&nbsp;:</para>

<screen><userinput><command>echo "nntp stream tcp nowait news /usr/sbin/tcpd /usr/sbin/leafnode" \
&gt;&gt; /etc/inetd.conf</command></userinput></screen>

<para>Lancez la commande <command>killall -HUP inetd</command> pour relire le
fichier <filename>inetd.conf</filename> modifié.</para>

<para>Autrement, <application>Leafnode</application> pourrait être configuré
pour utiliser <command>xinetd</command> en ajoutant une entrée dans le fichier
<filename>/etc/xinetd.conf</filename> avec la commande suivante&nbsp;:</para>

<screen><userinput><command>cat &gt;&gt; /etc/xinetd.conf &lt;&lt; "EOF"</command>
        service nntp
        {
           flags           = NAMEINARGS NOLIBWRAP
           socket_type     = stream
           protocol        = tcp
           wait            = no
           user            = news
           server          = /usr/sbin/tcpd
           server_args     = /usr/sbin/leafnode
           instances       = 7
           per_source      = 3
        }
<command>EOF</command></userinput></screen>

<para>Lancez la commande a <command>killall -HUP xinetd</command> pour relire
le fichier <filename>xinetd.conf</filename> modifié.</para>

<para>Ajoutez des entrées dans le fichier crontab de root ou de l'utilisateur
news pour lancer les commandes <command>fetchnews</command> et
<command>texpire</command> aux intervalles de temps désirés.</para>

</sect3>

</sect2>

<sect2>
<title>Contenu</title>

<segmentedlist>
<segtitle>Programmes installés</segtitle>
<segtitle>Bibliothèques installées</segtitle>
<segtitle>Répertoires installés</segtitle>

<seglistitem>
<seg>applyfilter, checkgroups, fetchnews, leafnode, leafnode-version, 
newsq et texpire</seg>
<seg>Aucune</seg>
<seg>/etc/leafnode, /var/lock/leafnode et /var/spool/news</seg>
</seglistitem>
</segmentedlist>

<variablelist>
<bridgehead renderas="sect3">Descriptions courtes</bridgehead>
<?dbfo list-presentation="list"?>

<varlistentry id="applyfilter">
<term><command>applyfilter</command></term>
<listitem><para>filtre les articles des groupes de nouvelles euivant des
expressions rationnelles.</para>
<indexterm zone="leafnode applyfilter">
<primary sortas="b-applyfilter">applyfilter</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="checkgroups">
<term><command>checkgroups</command></term>
<listitem><para>insère des titres de groupes de nouvelles dans la base de
données.</para>
<indexterm zone="leafnode checkgroups">
<primary sortas="b-checkgroups">checkgroups</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="fetchnews">
<term><command>fetchnews</command></term>
<listitem><para>envoie les articles postés et récupère les nouveaux articles
à partir d'un serveur de nouvelles en amont.</para>
<indexterm zone="leafnode fetchnews">
<primary sortas="b-fetchnews">fetchnews</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="leafnode-prog">
<term><command>leafnode</command></term>
<listitem><para>est un démon pour le serveur <acronym>NNTP</acronym>.</para>
<indexterm zone="leafnode leafnode-prog">
<primary sortas="b-leafnode">leafnode</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="leafnode-version">
<term><command>leafnode-version</command></term>
<listitem><para>affiche la version de <application>Leafnode</application>.</para>
<indexterm zone="leafnode leafnode-version">
<primary sortas="b-leafnode-version">leafnode-version</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="newsq">
<term><command>newsq</command></term>
<listitem><para>affiche les articles attendant d'être envoyés en amont.</para>
<indexterm zone="leafnode newsq">
<primary sortas="b-newsq">newsq</primary>
</indexterm></listitem>
</varlistentry>

<varlistentry id="texpire">
<term><command>texpire</command></term>
<listitem><para>fait expirer les vieux articles et les groupes non lus.</para>
<indexterm zone="leafnode texpire">
<primary sortas="b-texpire">texpire</primary>
</indexterm></listitem>
</varlistentry>
</variablelist>

</sect2>

</sect1>
