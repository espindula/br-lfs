<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

]>

<sect1 id="cvsserver" xreflabel="Running a CVS Server">
  <?dbhtml filename="cvsserver.html"?>

  <sect1info>
    <othername>$LastChangedBy: randy $</othername>
    <date>$Date: 2007-04-04 21:42:53 +0200 (mer, 04 avr 2007) $</date>
  </sect1info>

  <title>Exécution d'un serveur CVS</title>

  <sect2 role="package">
    <title>Exécution d'un serveur CVS</title>

    <para>Cette section va décrire la manière de paramétrer, d'administrer et de
    sécuriser un serveur CVS.</para>

    <bridgehead renderas="sect3">Dépendances de CVS Server</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para><xref linkend="cvs"/> et
    <xref linkend="openssh"/></para>

  </sect2>

  <sect2 role="configuration">
    <title>Paramétrage d'un serveur CVS.</title>

    <para>On va paramétrer un serveur CVS en utilisant OpenSSH comme méthode
    d'accès à distance. Les autres méthodes d'accès, comme :pserver: et :server:,
    ne seront pas utilisées pour l'accès en écriture au dépôt CVS. La méthode
    :pserver: envoie les mots de passe en clair sur le réseau et la méthode
    :server: n'est pas supportée dans tous les ports CVS. Vous pouvez trouver des
    Instructions pour un accès anonyme en lecture seule au serveur CVS en 
    utilisant la méthode :pserver: à la fin de cette
    section.</para>

    <para>La configuration d'un serveur CVS tient à quatre étapes&nbsp;:</para>

    <sect3>
      <title>1. Créer un dépôt.</title>

      <para>Créez un nouveau dépôt CVS avec les commandes suivantes&nbsp;:</para>

<screen role="root"><userinput>mkdir /srv/cvsroot &amp;&amp;
chmod 1777 /srv/cvsroot &amp;&amp;
export CVSROOT=/srv/cvsroot &amp;&amp;
cvs init</userinput></screen>

    </sect3>

    <sect3>
      <title>2. Importer le code source dans le dépôt.</title>

      <para>Importez un module source dans le dépôt avec les commandes suivantes
      exécutées à partir d'un compte utilisateur sur la mâme machine que le dépôt
      CVS&nbsp;:</para>

<screen><userinput>cd <replaceable>&lt;sourcedir&gt;</replaceable> &amp;&amp;
cvs import -m "<replaceable>&lt;depot test&gt;</replaceable>" <replaceable>&lt;cvstest&gt;</replaceable> <replaceable>&lt;vendortag&gt;</replaceable> <replaceable>&lt;tagversion&gt;</replaceable></userinput></screen>

    </sect3>

    <sect3>
      <title>3. Vérifiez l'accès au dépôt local.</title>

      <para>Testez l'accès au dépôt CVS depuis le même compte utilisateur
      avec la commande suivante&nbsp;:</para>

<screen><userinput>cvs co cvstest</userinput></screen>

    </sect3>

    <sect3>
      <title>4. Vérifier l'accès distant au dépôt.</title>

      <para>Testez l'accès au dépôt CVS à partir d'une machine distante en 
      utilisant un compte utilisateur ayant un accès <command>ssh</command> au
      serveur CVS avec les commandes suivantes&nbsp;:</para>

      <note>
        <para>Remplacez <replaceable>&lt;nomserveur&gt;</replaceable> par
        l'adresse IP ou le nom d'hôte de la machine du dépôt CVS. On vous 
        invitera à entrer le mot de passe du compte shell de l'utilisateur avant
        de poursuivre la récupération.</para>
      </note>

<screen><userinput>export CVS_RSH=/usr/bin/ssh &amp;&amp;
cvs -d:ext:<replaceable>&lt;nomserveur&gt;</replaceable>:/srv/cvsroot co cvstest</userinput></screen>

    </sect3>

  </sect2>

  <sect2 id='cvsserver-config' role="configuration">
    <title>Configuration de CVS pour un accès anonyme en lecture seule.</title>

    <para>CVS peut être réglé pour autoriser l'accès anonyme en lecture seule 
    en utilisant la méthode :pserver: en se connectant en tant qu'utilisateur
    <systemitem class="username">root</systemitem> et en exécutant
    les commandes suivantes&nbsp;:</para>

<screen role="root"><userinput>(grep anonymous /etc/passwd || useradd anonymous -s /bin/false -u 98) &amp;&amp;
echo anonymous: &gt; /srv/cvsroot/CVSROOT/passwd &amp;&amp;
echo anonymous &gt; /srv/cvsroot/CVSROOT/readers</userinput></screen>

    <para>Si vous utilisez <command>inetd</command>, la commande suivante
    ajoutera l'entrée <application>CVS</application> à 
    <filename>/etc/inetd.conf</filename>&nbsp;:</para>

<screen role="root"><userinput>echo "2401  stream  tcp  nowait  root  /usr/bin/cvs cvs -f \
    --allow-root=/srv/cvsroot pserver" &gt;&gt; /etc/inetd.conf</userinput></screen>

    <indexterm zone="cvsserver cvsserver-config">
      <primary sortas="e-etc-inetd.conf">/etc/inetd.conf</primary>
    </indexterm>

    <para>Faites un <command>killall -HUP inetd</command> pour relire le fichier
    <filename>inetd.conf</filename> modifié.</para>

    <para>Si vous utilisez <command>xinetd</command>, la commande suivante 
    créera le fichier CVS en tant que <filename>/etc/xinetd.d/cvspserver</filename>&nbsp;:</para>

<screen role="root"><userinput>cat &gt;&gt; /etc/xinetd.d/cvspserver &lt;&lt; "EOF"
<literal># Début de /etc/xinetd.d/cvspserver

     service cvspserver
     {
          port        = 2401
          socket_type = stream
          protocol    = tcp
          wait        = no
          user        = root
          passenv     = PATH
          server      = /usr/bin/cvs
          server_args = -f --allow-root=/srv/cvsroot pserver
     }

# Fin de /etc/xinetd.d/cvspserver</literal>
EOF</userinput></screen>

    <indexterm zone="cvsserver cvsserver-config">
      <primary sortas="e-etc-xinetd.d-cvspserver">/etc/xinetd.d/cvspserver</primary>
    </indexterm>

    <para>Faites un <command>/etc/rc.d/init.d/xinetd reload</command> pour
    lire le fichier <filename>xinetd.conf</filename> modifié.</para>

    <para>Le test de l'accès anonyme au nouveau dépôt exige un 
    compte sur une autre machine, qui peut atteindre le serveur CVS par le réseau.
    Aucun compte n'est nécessaire sur le dépôt CVS. Pour tester l'accès anonyme
    au dépôt CVS, connectez-vous à une autre machine en tant qu'utilisateur non
    privilégié et exécutez la commande suivante&nbsp;:</para>
    
<screen><userinput>cvs -d:pserver:anonymous@<replaceable>&lt;nomserveur&gt;</replaceable>:/srv/cvsroot co cvstest</userinput></screen>

    <note>
      <para>Remplacez <replaceable>&lt;nomserveur&gt;</replaceable> par l'adresse
      IP ou le nom d'hôte du serveur CVS.</para>
    </note>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>mkdir /srv/cvsroot</command>&nbsp;: Crée le répertoire du 
    dépôt CVS.</para>

    <para><command>chmod 1777 /srv/cvsroot</command>&nbsp;: Met des droits sur
    be bit sticky pour <envar>CVSROOT</envar>.</para>

    <para><command>export CVSROOT=/srv/cvsroot</command>&nbsp;: Spécifie le 
    nouveau <envar>CVSROOT</envar> pour toutes les commandes <command>cvs</command>.</para>

    <para><command>cvs init</command>&nbsp;: Initialise le nouveau dépô] CVS.</para>

    <para><command>cvs import -m "repository test" cvstest vendortag
    releasetag</command>&nbsp;: Tous les modules du code source doivent être
    importés dans le dépôt CVS avant d'être utilisés, avec la commande
    <command>cvs import</command>. Le drapeau <option>-m</option> spécifie une
    entrée descriptive de départ pour le nouveau module. Le paramètre
    <option>cvstest</option> est le nom utilisé pour le module dans toutes les
    commandes <command>cvs</command> consécutives. Les paramètres
    <option>vendortag</option> et <option>releasetag</option> sont utilisés pour
    identifier davantage le module CVS et ils sont obligatoires qu'on l'utilise
    ou pas.</para>

    <para><command>(grep anonymous /etc/passwd || useradd anonymous -s
    /bin/false -u 98)</command>&nbsp;: Vérifie l'existence d'un utilisateur <systemitem
    class="username">anonymous</systemitem> et en crée un s'il n'en trouve pas.</para>

    <para><command>echo anonymous: &gt; /srv/cvsroot/CVSROOT/passwd</command>&nbsp;:
    Ajoute l'utilisateur <systemitem class="username">anonymous</systemitem> au
    fichier passwd de CVS, qui n'est pas utilisé hors de cette configuration.</para>

    <para><command>echo anonymous &gt; /srv/cvsroot/CVSROOT/readers</command>&nbsp;:
    Ajoute l'utilisateur <systemitem class="username">anonymous</systemitem> au
    fichiers readers (lecteurs) de CVS, une liste des utilisateurs ayant un accès
    en lecture seule au dépôt.</para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>Aucun</seg>
        <seg>Aucune</seg>
        <seg>/srv/cvsroot</seg>
      </seglistitem>
    </segmentedlist>

  </sect2>

</sect1>
