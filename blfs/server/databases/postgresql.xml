<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY postgresql-download-http " ">
  <!ENTITY postgresql-download-ftp  "ftp://ftp5.us.postgresql.org/pub/PostgreSQL/source/v&postgresql-version;/postgresql-&postgresql-version;.tar.bz2">
  <!ENTITY postgresql-md5sum        "6ee5bb53b97da7c6ad9cb0825d3300dd">
  <!ENTITY postgresql-size          "16.0 Mo">
  <!ENTITY postgresql-buildsize     "181 Mo (additional 151 Mo to run the testsuite)">
  <!ENTITY postgresql-time          "1.4 SBU (additional 0.2 SBU to run the testsuite)">
]>
<sect1 id="postgresql" xreflabel="PostgreSQL-&postgresql-version;">
  <?dbhtml filename="postgresql.html"?>
  <sect1info>
    <othername>$LastChangedBy&nbsp;: bdubbs $</othername>
    <date>$Date&nbsp;: 2012-10-01 02:19:42 +0200 (Mon, 01 Oct 2012) $</date>
  </sect1info>
  <title>PostgreSQL-&postgresql-version;</title>
  <indexterm zone="postgresql">
    <primary sortas="a-PostgreSQL">PostgreSQL</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à PostgreSQL</title>
    <para><application>PostgreSQL</application> est un <foreignphrase>advanced
    object-relational database management system</foreignphrase> (ORDBMS, système 
    avancé de gestion de base de données relationnelles), dérivé
    du système de gestion de base de données Berkeley Postgres.</para>
    <para>Il se peut qu'il existe une version plus récente disponible sur
    la page d'accueil de <application>MySQL</application>. Vous pouvez regarder
    <ulink url="http://dev.mysql.com/"/> et probablement utiliser les instructions
    BLFS existantes. Remarquez que des versions différentes de celle indiquée
    aux adresses de téléchargement n'ont pas été testées dans un environnement
    BLFS.</para>
   &lfs73_checked;
    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&postgresql-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&postgresql-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &postgresql-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &postgresql-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &postgresql-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &postgresql-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de PostgreSQL</bridgehead>
    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="python2"/>,
    <xref linkend="tcl"/>,
    <xref linkend="openssl"/>,
    <xref linkend="libxml2"/>,
    <xref linkend="libxslt"/>,
    <xref linkend="openldap"/>,
    <xref linkend="linux-pam"/>,
    
    <xref linkend="mitkrb"/> et
    <ulink url="http://developer.apple.com/networking/bonjour/">Bonjour</ulink></para>
    <bridgehead renderas="sect4">Facultatives (To Regenerate Documentation)</bridgehead>
    <para role="optional"><xref linkend="sgml-dtd"/>,
    <xref linkend="docbook-dsssl"/>,
    <xref linkend="openjade"/> et
    <xref linkend="perl-sgmlspm"/></para>
    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/postgresql"/></para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de PostgreSQL</title>
    <para>Installez <application>PostgreSQL</application> avec les commandes
    suivantes&nbsp;: </para>
<screen>
<userinput>sed -e "s@DEFAULT_PGSOCKET_DIR  \"/tmp\"@DEFAULT_PGSOCKET_DIR  \"/run/postgresql\"@" \
    -i src/include/pg_config_manual.h &amp;&amp;
./configure --prefix=/usr          \
            --enable-thread-safety \
            --docdir=/usr/share/doc/postgresql-&postgresql-version; &amp;&amp;
make</userinput>
</screen>
    <para>Pour tester les résultats, lancez&nbsp;: <command>make check</command>.</para>
    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>make install      &amp;&amp;
make install-docs</userinput>
</screen>
 
    
    <note>
      <para>Si vous mettez à jour un système existant et si vous allez installer
      les nouveaux fichiers par-dessus les anciennes, vous devriez sauvegarder
      vos données, éteindre le vieux serveur et suivre les instructions dans
      <ulink url="http://www.postgresql.org/docs/9.0/static/install-upgrading.html">the
      official <application>PostgreSQL</application> documentation</ulink> (la documentation
      officielle).</para>
    </note>
    <para>Initialisez un morceau (cluster) de base de données par les commandes
    suivantes effectuées par l'utilisateur
    <systemitem class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>install -v -dm700 /srv/pgsql/data &amp;&amp;
install -v -dm755 /run/postgresql &amp;&amp;
groupadd -g 41 postgres &amp;&amp;
useradd -c "PostgreSQL Server" -g postgres -d /srv/pgsql/data \
        -u 41 postgres &amp;&amp;
chown -Rv postgres:postgres /srv/pgsql /run/postgresql &amp;&amp;
su - postgres -c '/usr/bin/initdb -D /srv/pgsql/data'</userinput>
</screen>
    <para>En tant qu'utilisateur <systemitem class="username">root</systemitem>, 
    démarrez le serveur de base de données avec la commande suivante&nbsp;:</para>
<screen role="root">
<userinput>su - postgres -c '/usr/bin/postmaster -D /srv/pgsql/data > \
    /srv/pgsql/data/logfile 2&gt;&amp;1 &amp;'</userinput>
</screen>
    <para>Toujours en tant qu'utilisateur <systemitem class="username">root</systemitem>, 
    créez une base de données et vérifiez l'installation&nbsp;:</para>
<screen role="root">
<userinput>su - postgres -c '/usr/bin/createdb test' &amp;&amp;
echo "create table t1 ( name varchar(20), state_province varchar(20) );" \
    | (su - postgres -c '/usr/bin/psql test ') &amp;&amp;
echo "insert into t1 values ('Billy', 'NewYork');" \
    | (su - postgres -c '/usr/bin/psql test ') &amp;&amp;
echo "insert into t1 values ('Evanidus', 'Quebec');" \
    | (su - postgres -c '/usr/bin/psql test ') &amp;&amp;
echo "insert into t1 values ('Jesse', 'Ontario');" \
    | (su - postgres -c '/usr/bin/psql test ') &amp;&amp;
echo "select * from t1;" | (su - postgres -c '/usr/bin/psql test')</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explication des commandes</title>
    
    <para>
      <command>sed -e ...</command>: Ce sed modifie l'endroit du socket de
      <filename class="directory">/tmp</filename> vers
      <filename class="directory">/run/postgresql</filename>.
    </para>
    <para><parameter>--docdir=/usr/share/doc/postgresql-&postgresql-version;</parameter>>&nbsp;:nbsp;:
    Ce paramètre met la documentation dans un répertoire versionné.</para>
	
    <para><parameter>--enable-thread-safety</parameter>&nbsp;: Ce paramètre
    rend les bibliothèques client enfilées de manière sécurisée en autorisant les
    filages concurrents <filename class='libraryfile'>libpq</filename> et aux
    programmes ECPG de contrôler en sécurité leur gestions de connexion privée.</para>
    
    <para><option>--with-openssl</option>&nbsp;: construit avec le support de
    <application>OpenSSL</application> pour les connexions chiffrées.</para>
   <para><option>--with-perl</option>>&nbsp;:nbsp;: Construit le langage PL/Perl coté serveur.
    </para>
    <para><option>--with-python</option>>&nbsp;:nbsp;: Construit le langage PL/Python coté serveur.</para>
    <para><option>--with-tcl</option>&nbsp;:  construit le langaga PL/Tcl coté serveur.</para>
 
    <para><command>groupadd ...</command>&nbsp;; <command>useradd ...</command>&nbsp;:
    Ces commandes ajoutent un utilisateur et un groupe non privilégiés pour 
    lancer le serveur de base de données.</para>
    <para><command>createdb test; create table t1; insert into t1 values...;
    select * from t1</command>&nbsp;: Crée une base de données, y ajoute une 
    table, insère des lignes dans la table et les sélectionne pour  vérifier que
    l'installation fonctionne correctement.</para>
  </sect2>
  <sect2 role="configuration">
    <title>Configuration de PostgreSQL</title>
    <sect3 id="postgresql-config">
      <title>Fichiers de configuration</title>
      <para><filename>$PGDATA/pg_ident.con</filename>,
      <filename>$PGDATA/pg_hba.conf</filename> et
      <filename>$PGDATA/postgresql.conf</filename></para>
      <indexterm zone="postgresql postgresql-config">
        <primary sortas="e-A.PGDATA-pg_ident.con">$PGDATA/pg_indent.con</primary>
      </indexterm>
      <indexterm zone="postgresql postgresql-config">
        <primary sortas="e-A.PGDATA-pg_hba.conf">$PGDATA/pg_hba_conf</primary>
      </indexterm>
      <indexterm zone="postgresql postgresql-config">
        <primary sortas="e-A.PGDATA-postgresql.conf">$PGDATA/postgresql.conf</primary>
      </indexterm>
      <para>La variable d'environnement <envar>PGDATA</envar> est utilisée pour
      distinguer les clusters de base de données entre eux en la réglant sur
      la valeur du répertoire qui contient le cluster désiré. Les trois 
      fichiers de configuration existent dans tout répertoire <filename
      class="directory">PGDATA/</filename> directory. Vous pouvez trouver des
      détails sur le format des fichiers et les options qu'on peut régler dans
      chacun d'eux sur <ulink url="file:///usr/share/doc/postgresql-&postgresql-version;/html/index.html"/>.</para>
    </sect3>
    <sect3  id="postgresql-init">
      <title>Script de démarrage</title>
      <para>Installez le script de démarrage <filename>/etc/rc.d/init.d/postgresql</filename>
      inclu dans le paquet <xref linkend="bootscripts"/>.</para>
      <indexterm zone="postgresql postgresql-init">
        <primary sortas="f-postgresql">postgresql</primary>
      </indexterm>
<screen role="root">
<userinput>make install-postgresql</userinput>
</screen>
    </sect3>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>clusterdb, createdb, createlang, createuser, dropdb, droplang,
        dropuser, ecpg, initdb,pg_basebackup, pg_config, pg_controldata, pg_ctl,
	pg_dump, pg_dumpall, pg_resetxlog, pg_restore, pltcl_delmod,
        pltcl_listmod, pltcl_loadmod, postgres, postmaster, psql,
        reindexdb, et vacuumdb</seg>
        <seg>libecpg.{so,a}, libecpg_compat.{so,a}, libpgport.a, libpgtypes.{so,a},
        libpq.{so,a}, et de nombreux modules de caractères ( et facultativement, des
	langage de programmation).</seg>
        <seg>/srv/pgsql, /usr/include/libpq, /usr/include/postgresql,
        /usr/lib/postgresql, /usr/share/doc/postgresql-&postgresql-version;, et
        /usr/share/postgresql</seg>
      </seglistitem>
    </segmentedlist>
    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="clusterdb">
        <term><command>clusterdb</command></term>
        <listitem>
          <para>est un outil pour reconstruire (reclustering) des tables dans une
          base de données <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql clusterdb">
            <primary sortas="b-clusterdb">clusterdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="createdb">
        <term><command>createdb</command></term>
        <listitem>
          <para> crée une nouvelle base de données <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql createdb">
            <primary sortas="b-createdb">createdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="createlang">
        <term><command>createlang</command></term>
        <listitem>
          <para>définit un nouveau langage procédural
          <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql createlang">
            <primary sortas="b-createlang">createlang</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="createuser">
        <term><command>createuser</command></term>
        <listitem>
          <para>définit un nouveau compte utilisateur <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql createuser">
            <primary sortas="b-createuser">createuser</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="dropdb">
        <term><command>dropdb</command></term>
        <listitem>
          <para>supprime une base de données <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql dropdb">
            <primary sortas="b-dropdb">dropdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="droplang">
        <term><command>droplang</command></term>
        <listitem>
          <para>supprime un langage procédural <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql droplang">
            <primary sortas="b-droplang">droplang</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="dropuser">
        <term><command>dropuser</command></term>
        <listitem>
          <para>supprime un compte utilisateur <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql dropuser">
            <primary sortas="b-dropuser">dropuser</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="ecpg">
        <term><command>ecpg</command></term>
        <listitem>
          <para>est le préprocesseur SQL embarqué.</para>
          <indexterm zone="postgresql ecpg">
            <primary sortas="b-ecpg">ecpg</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="initdb">
        <term><command>initdb</command></term>
        <listitem>
          <para>crée un nouveau cluster de base de données.</para>
          <indexterm zone="postgresql initdb">
            <primary sortas="b-initdb">initdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
 <varlistentry id="pg_basebackup">
        <term><command>pg_basebackup</command></term>
        <listitem>
          <para>fait des sauvegardes de la base sur une grappe
          <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql pg_basebackup">
            <primary sortas="b-pg_basebackup">pg_basebackup</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_config">
        <term><command>pg_config</command></term>
        <listitem>
          <para>récupère des informations sur la version de
          <application>PostgreSQL</application>.</para>
          <indexterm zone="postgresql pg_config">
            <primary sortas="b-pg_config">pg_config</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_controldata">
        <term><command>pg_controldata</command></term>
        <listitem>
          <para>retourne des informations initialisées pendant
          <command>initdb</command>, telles que la version du catalogue et la
          locale du serveur.</para>
          <indexterm zone="postgresql pg_controldata">
            <primary sortas="b-pg_controldata">pg_controldata</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_ctl">
        <term><command>pg_ctl</command></term>
        <listitem>
          <para>contrôle l'arrêt et le démarrage du serveur de base de données.</para>
          <indexterm zone="postgresql pg_ctl">
            <primary sortas="b-pg_ctl">pg_ctl</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_dump">
        <term><command>pg_dump</command></term>
        <listitem>
          <para>place dans un script des données et des méta-données de base de
          données, elles sont utilisées pour recréer la base de données.</para>
          <indexterm zone="postgresql pg_dump">
            <primary sortas="b-pg_dump">pg_dump</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_dumpall">
        <term><command>pg_dumpall</command></term>
        <listitem>
          <para>appelle de manière récursive <command>pg_dump</command> pour
          chaque base de données d'un cluster.</para>
          <indexterm zone="postgresql pg_dumpall">
            <primary sortas="b-pg_dumpall">pg_dumpall</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_resetxlog">
        <term><command>pg_resetxlog</command></term>
        <listitem>
          <para>nettoie le journal écrit et réinitialise éventuellement des
          champs dans le fichier <filename>pg_control</filename>.</para>
          <indexterm zone="postgresql pg_resetxlog">
            <primary sortas="b-pg_resetxlog">pg_resetxlog</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pg_restore">
        <term><command>pg_restore</command></term>
        <listitem>
          <para>crée des bases de données à partir de fichiers cachés créés par
          <command>pg_dump</command>.</para>
          <indexterm zone="postgresql pg_restore">
            <primary sortas="b-pg_restore">pg_restore</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pltcl_delmod">
        <term><command>pltcl_delmod</command></term>
        <listitem>
          <para>est un script de support utilisé pour effacer un  module d'une
          table PL/<application>Tcl</application>. La commande exige que le
          paquet <ulink url="http://gborg.postgresql.org/project/pgtcl/">Pgtcl</ulink>
          soit aussi installé.</para>
          <indexterm zone="postgresql pltcl_delmod">
            <primary sortas="b-pltcl_delmod">pltcl_delmod</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pltcl_listmod">
        <term><command>pltcl_listmod</command></term>
        <listitem>
          <para>est un script support utilisé pour lister les modules d'une
          table PL/<application>Tcl</application>. La commande exige que le
          paquet <ulink url="http://gborg.postgresql.org/project/pgtcl/">Pgtcl</ulink>
          soit aussi installé.</para>
          <indexterm zone="postgresql pltcl_listmod">
            <primary sortas="b-pltcl_listmod">pltcl_listmod</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="pltcl_loadmod">
        <term><command>pltcl_loadmod</command></term>
        <listitem>
          <para>est un script support utilisé pour charger un module d'une table
          PL/<application>Tcl</application>. La commande exige que le paquet
          <ulink url="http://gborg.postgresql.org/project/pgtcl/">Pgtcl</ulink>
          soit aussi installé.</para>
          <indexterm zone="postgresql pltcl_loadmod">
            <primary sortas="b-pltcl_loadmod">pltcl_loadmod</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="postgres">
        <term><command>postgres</command></term>
        <listitem>
          <para>est un serveur de base de données mono-utilisateur, utilisée en
          général pour du débogage.</para>
          <indexterm zone="postgresql postgres">
            <primary sortas="b-postgres">postgres</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="postmaster">
        <term><command>postmaster</command></term>
        <listitem>
          <para>(un lien symbolique vers <command>postgres</command>) est un démon de
		  base de données multi-utilisateurs.</para>
          <indexterm zone="postgresql postmaster">
            <primary sortas="b-postmaster">postmaster</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="psql">
        <term><command>psql</command></term>
        <listitem>
          <para>est un shell de base de données en console.</para>
          <indexterm zone="postgresql psql">
            <primary sortas="b-psql">psql</primary>
          </indexterm>
        </listitem>
      </varlistentry>
       <varlistentry id="reindexdb">
        <term><command>reindexdb</command></term>
        <listitem>
          <para>est un outil pour reconstruire les index d'une base de données.</para>
          <indexterm zone="postgresql reindexdb">
            <primary sortas="b-reindexdb">reindexdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="vacuumdb">
        <term><command>vacuumdb</command></term>
        <listitem>
          <para>compacte des bases de données et génère des statistiques pour 
          l'analyseur de demandes.</para>
          <indexterm zone="postgresql vacuumdb">
            <primary sortas="b-vacuumdb">vacuumdb</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="libecpg">
        <term><filename class='libraryfile'>libecpg.{so,a}</filename></term>
        <listitem>
          <para>contient des fonctions pour supporté du SQL embarqué dans des programmes C.</para>
          <indexterm zone="postgresql libecpg">
            <primary sortas="c-libecpg">libecpg.{so,a}</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="libecpg_compat">
        <term><filename class='libraryfile'>libecpg_compat.{so,a}</filename></term>
        <listitem>
          <para>est la bibliothèque de compatibilité ecpg.</para>
          <indexterm zone="postgresql libecpg_compat">
            <primary sortas="c-libecpg_compat">libecpg_compat.{so,a}</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="libgport">
        <term><filename class='libraryfile'>libgport.a</filename></term>
        <listitem>
          <para>est le sous-système de port spécifique du backend Postgres.</para>
          <indexterm zone="postgresql libgport">
            <primary sortas="c-libgport">libgport.a</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="libpgtypes">
        <term><filename class='libraryfile'>libpgtypes.{so,a}</filename></term>
        <listitem>
          <para>contient des fonctions pour traiter des types de données Postgres.</para>
          <indexterm zone="postgresql libpgtypes">
            <primary sortas="c-libpgtypes">libpgtypes.{so,a}</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="libpq">
        <term><filename class='libraryfile'>libpq.{so,a}</filename></term>
        <listitem>
          <para>est l'API de programmation C pour Postgres.</para>
          <indexterm zone="postgresql libpq">
            <primary sortas="c-libpq">libpq.{so,a}</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
