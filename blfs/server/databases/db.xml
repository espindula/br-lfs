<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY db-download-http "http://download-east.oracle.com/berkeley-db/db-&db-version;.tar.gz">
  <!ENTITY db-download-ftp  "&gentoo-ftp-repo;/db-&db-version;.tar.gz">
  <!ENTITY db-md5sum        "3476bac9ec0f3c40729c8a404151d5e3">
  <!ENTITY db-size          "22.8 Mio">
  <!ENTITY db-buildsize     "250 MB (additional 100 MB to run parallel standard test suite)">
  <!ENTITY db-time          "1.9 SBU (builds all bindings, add an additional 145 SBU to run parallel standard test suite)">
]>

<sect1 id="db" xreflabel="Berkeley DB-&db-version;">
  <?dbhtml filename="db.html"?>

  <sect1info>
    <othername>$LastChangedBy: dj $</othername>
    <date>$Date: 2010-10-17 19:55:40 +0200 (dim 17 oct 2010) $</date>
  </sect1info>

  <title>Berkeley DB-&db-version;</title>

  <indexterm zone="db">
    <primary sortas="a-Berkeley-DB">Berkeley DB</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Berkeley DB</title>

    <!-- <para>The <application>Berkeley DB</application> package contains programs
    et utilities used by many other applications for database related
    functions. This package is also installed during LFS et may already exist
    on your system. It is listed here in BLFS as well because you may need to
    reinstall it if you need the additional language bindings or the RPC
    server. If you do reinstall <application>Berkeley DB</application>, ensure
    you use the &lfs-bdb-version; version used in the LFS book.</para> -->

    <para>Le paquet <application>Berkeley DB</application> contient des programmes
    et des outils utilisés par de nombreuses autres applications pour des
    fonctions liées à la base de données.</para>

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&db-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&db-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &db-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &db-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &db-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &db-time;</para>
      </listitem>
    </itemizedlist>

    <!-- <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="http://www.oracle.com/technology/products/berkeley-db/db/update/&db-version;/patch.&db-version;.1"/></para>
      </listitem>
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="http://www.oracle.com/technology/products/berkeley-db/db/update/&db-version;/patch.&db-version;.2"/></para>
      </listitem>
    </itemizedlist> -->

    <bridgehead renderas="sect3">Dépendances de Berkeley DB</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="tcl"/>,
    <xref linkend="icedtea6"/> or <xref linkend="jdk"/>, et
    <ulink url="http://www.gnu.org/software/sharutils/">sharutils</ulink>
    (for the <command>uudecode</command> command)</para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/db"/></para>

  </sect2>

  <sect2 role="testing">
    <title>Tester Berkeley DB</title>

    <para>Il se peut que vous souhaitiez aller directement à 
    <xref linkend="bdb-installation"/>. La suite de tests peut prendre jusqu'à
    150 SBUs et elle a quelques bogues donnant un signalement de 
    <quote>Regression tests failed</quote> (tests de régression échoués). 
    Cependant, l'exécution de la suite de tests est très fatigant pour votre
    matériel, poussant votre machine dans des limites (surtout en E/S disque)
    qu'elle n'atteindra jamais en production. Remarquez que vous devez avoir
    installé <application>Tcl</application> pour lancer la suite de test.</para>

    <para>Construisez les tests de <application>Berkeley DB</application> en
    lançant les commandes suivantes&nbsp;:</para>

<screen><userinput>cd build_unix &amp;&amp;
../dist/configure --prefix=/usr \
                  --enable-test \
                  --enable-tcl  \
                  --with-tcl=/usr/lib &amp;&amp;
make</userinput></screen>

    <para>Pour tester les résultats, start <command>tclsh</command>:</para>

<screen><userinput>tclsh</userinput></screen>

    <para>À partir de l'invite de  <command>tclsh</command> (<prompt>%&nbsp;</prompt>),
    lancez&nbsp;:</para>

<screen><userinput>source ../test/test.tcl
run_parallel 5 run_std
exit</userinput></screen>

    <para>Nettoyez l'arborescence des sources avec la commande suivante&nbsp;:</para>

<screen><userinput>make realclean &amp;&amp;
cd ..</userinput></screen>

  </sect2>

  <sect2 role="installation" id="bdb-installation">
    <title>Installation de Berkeley DB</title>

    <!-- <para>The installation commands below are identical to the commands used
    in the LFS book. If you installed <application>Berkeley DB</application>
    in LFS, et you don't add anything to the <command>configure</command>
    script, you'll end up with exactly what you already have. The additional
    parameters you can use are listed in the Explication des commandes section
    below.</para> -->

    <note>
      <para>Si vous envisagez d'installer <application>Berkeley DB</application>
      avec le support Java, vous devriez vérifier que le système a certaines
      versions de <xref linkend="jdk"/> et <xref linkend="gmime"/>. En
      particulier, s'il y a sur le système
      <application>JDK</application>-6 mettez à jour X et le programme
      <command>uudecode</command> du programme
      <application>GMime</application>, la construction échouera (sauf si vous
      lancez la commande <command>./configure</command> modifiée indiquée
      ci-dessous). Vous pouvez lancer deux commandes (<command>javac -version</command>
      et <command>uudecode --version</command>) pour déterminer les versions qui
      sont installées. Vous pouvez aussi télécharger et exécuter un script shell
      à partir de <ulink url="&files-anduin;/jdk-uudecode-check.sh"/> pour
      vous alerter d'une condition non opérationnelle. Si les programmes identifiés
      existent sur le système, vous devez modifier la commande
      <command>./configure</command> comme indiqué ci-dessous.</para>

<screen><userinput>uudecode="no" ../dist/configure --(use the parameters shown below)</userinput></screen>
    </note>

    <para>Installez <application>Berkeley DB</application> en lançant les
    commandes suivantes&nbsp;:</para>

<screen><userinput>cd build_unix &amp;&amp;
../dist/configure --prefix=/usr \
                  --enable-compat185 \
                  --enable-cxx &amp;&amp;
make</userinput></screen>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make docdir=/usr/share/doc/db-&db-version; install &amp;&amp;
chown -v -R root:root \
      /usr/bin/berkeley_db_svc \
      /usr/bin/db_* \
      /usr/include/db{,_185,_cxx}.h \
      /usr/lib/libdb{{,_cxx}.a,{,_cxx,_java,_tcl}-4.8.{so,a,la}} \
      /usr/share/doc/db-&db-version;</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>cd build_unix &amp;&amp;
    ../dist/configure --prefix=/usr...</command>&nbsp;: Ceci
    This remplace la commande <command>./configure</command> normale car 
    <application>Berkeley DB</application> est fourni avec divers répertoires
    de construction pour divers plateformes.</para>

    <para><parameter>--enable-compat185</parameter>&nbsp;: Ce paramètre active
    la construction de l'API de compatibilité DB-1.85.</para>

    <para><parameter>--enable-cxx</parameter>&nbsp;: Ce paramètre active la 
    construction les bibliothèques de l'API de C++.</para>

    <para><parameter>--enable-tcl --with-tcl=/usr/lib</parameter>&nbsp;: Active
    le support de <application>Tcl</application> dans DB crée des bibliothèques
    <filename class="libraryfile">libdb_tcl</filename>.</para>

    <para><parameter>--enable-java</parameter>&nbsp;: Active le support de
    <application>Java</application> dans DB et crée les bibliothèques
    <filename class='libraryfile'>libdb_java</filename>.</para>

    <para><command>make docdir=/usr/share/doc/db-&db-version;
    install</command>&nbsp;: Ceci installe la documentation à l'endroit 
    standard et non dans
    <filename class='directory'>/usr/docs</filename>.</para>

    <para><command>chown -v -R root:root ...</command>&nbsp;: Cette commande
    modifie l'appartenance de divers fichiers installés de l'uid:gid du
    constructeur en root:root.</para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <!-- <para>Only the program et libraries not installed in LFS are listed here,
    the others can be found at <ulink
    url="&lfs-root;/chapter06/db.html#contents-db"/> as they were initially
    installed during the building of LFS.</para> -->

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoire installé</segtitle>

      <seglistitem>
        <seg>db_archive, db_checkpoint, db_deadlock, db_dump,
        db_load, db_printlog, db_recover, db_stat, db_upgrade, db_verify</seg>
        <seg>libdb.{so,a}, libdb_cxx.{so,a}, libdb_java.{so,a},
        libdb_tcl.{so,a} et db.jar</seg>
        <seg>/usr/share/doc/db-&db-version;</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

    <varlistentry id="db_archive">
        <term><command>db_archive</command></term>
        <listitem>
          <para>affiche le chemin des fichiers journaux qui ne sont plus
          utilisé.</para>
          <indexterm zone="db db_archive">
            <primary sortas="b-db_archive">db_archive</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_checkpoint">
        <term><command>db_checkpoint</command></term>
        <listitem>
          <para>est un processus démon utilisé pour surveiller et vérifier la
          base de données des journaux.</para>
          <indexterm zone="db db_checkpoint">
            <primary sortas="b-db_checkpoint">db_checkpoint</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_deadlock">
        <term><command>db_deadlock</command></term>
        <listitem>
          <para>est utilisé pour arrêter des requêtes de verrouillage quand des
          deadlocks sont détectés.</para>
          <indexterm zone="db db_deadlock">
            <primary sortas="b-db_deadlock">db_deadlock</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_dump">
        <term><command>db_dump</command></term>
        <listitem>
          <para>convertit des fichiers de base de données en format de fichier 
          lisibles par <command>db_load</command>.</para>
          <indexterm zone="db db_dump">
            <primary sortas="b-db_dump">db_dump</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_load">
        <term><command>db_load</command></term>
        <listitem>
          <para>est utilisé pour créer des fichiers de base de données à partir
          de fichiers plats créés avec <command>db_dump</command>.</para>
          <indexterm zone="db db_load">
            <primary sortas="b-db_load">db_load</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_printlog">
        <term><command>db_printlog</command></term>
        <listitem>
          <para>convertit des fichiers journaux de base de données en texte 
          lisible par un humain.</para>
          <indexterm zone="db db_printlog">
            <primary sortas="b-db_printlog">db_printlog</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_recover">
        <term><command>db_recover</command></term>
        <listitem>
          <para>est utilisé pour restaurer une base de données à un état cohérent
          après un échec.</para>
          <indexterm zone="db db_recover">
            <primary sortas="b-db_recover">db_recover</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_stat">
        <term><command>db_stat</command></term>
        <listitem>
          <para>affiche des statistiques d'environnement de la base de données.</para>
          <indexterm zone="db db_stat">
            <primary sortas="b-db_stat">db_stat</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_upgrade">
        <term><command>db_upgrade</command></term>
        <listitem>
          <para>est utilisé pour mettre à jour des fichiers de base de données
          vers une version plus récente de
          <application>Berkeley DB</application>.</para>
          <indexterm zone="db db_upgrade">
            <primary sortas="b-db_upgrade">db_upgrade</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="db_verify">
        <term><command>db_verify</command></term>
        <listitem>
          <para>est utilisé pour effectuer des tests de cohérence sur des fichiers
          de bases de données.</para>
          <indexterm zone="db db_verify">
            <primary sortas="b-db_verify">db_verify</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
