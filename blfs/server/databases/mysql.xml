<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY mysql-download-http "http://cdn.mysql.com/Downloads/MySQL-5.5/mysql-&mysql-version;.tar.gz">
  <!ENTITY mysql-download-ftp  " ">
  <!ENTITY mysql-md5sum        "e6b9f9cb82e990bd8f0474df7462904e">
  <!ENTITY mysql-size          "24 Mo">
  <!ENTITY mysql-buildsize     "760 Mo (additional 170 Mo to run the test suite)">
  <!ENTITY mysql-time          "4.0 SBU (Test suite is an additional 45 minutes, only partially CPU dependent)">
]>

<sect1 id="mysql" xreflabel="MySQL-&mysql-version;">
  <?dbhtml filename="mysql.html"?>

  <sect1info>
    <othername>$LastChangedBy&nbsp;: krejzi $</othername>
    <date>$Date&nbsp;: 2012-10-26 12:46:42 +0200 (Fri, 26 Oct 2012) $</date>
  </sect1info>

  <title>MySQL-&mysql-version;</title>

  <indexterm zone="mysql">
    <primary sortas="a-MySQL">MySQL</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à MySQL</title>

    <para><application>MySQL</application> est un serveur de base de données rapide et
    largement utilisé. C'est une implémentation client/serveur consistant dans 
    un démon serveur et de nombreux programmes et bibliothèques différents.</para>

   &lfs72_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&mysql-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&mysql-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &mysql-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &mysql-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &mysql-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &mysql-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif facultatif (requis si vous construisez pour Amarok)&nbsp;: <ulink
        url="&patch-root;/mysql-&mysql-version;-embedded_library_shared-1.patch"/></para>
      </listitem>
      <listitem>
        <para>Documentation facultative (voir l'astuce ci-dessous):
          <ulink url="http://dev.mysql.com/doc/"/>
        </para>      
		</listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de MySQL</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="cmake"/></para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended"><xref linkend="openssl"/></para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <ulink url="http://packages.debian.org/source/sid/libaio">libaio</ulink>
    </para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/mysql"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de MySQL</title>

    <para>Pour des raisons de sécurité, vous êtes fortement encouragé à exécuter
    le serveur en tant qu'utilisateur et groupe non privilégiés. Lancez ce
    qui suit (en tant qu'utilisateur <systemitem class="username">root</systemitem>)
    pour créer l'utilisateur et le groupe&nbsp;:</para>

<screen role="root"><userinput>groupadd -g 40 mysql &amp;&amp;
useradd -c "MySQL Server" -d /srv/mysql -g mysql -s /bin/false -u 40 mysql</userinput></screen>

    <para>Si le serveur MySQL n'est pas nécessaire, il est possible de ne
    construire que les bibliothèques clients de MySQL. Pour cela, vous devez
    ajouter <parameter>-DWITHOUT_SERVER=ON</parameter> dans la commande <command>cmake</command>
    ci-dessous.</para>

    <para>MySQL contient une bibliothèque serveur embarquée qui peut être activée
    par l'option <parameter>-DWITH_EMBEDDED_SERVER=ON</parameter> de cmake.
    Par défaut, ce serveur est construit comme bibliothèque liée de façon
    statique, <filename>libmysqld.a</filename>, mais en appliquant le
    correctif facultatif, on peut construire une version partagée de cette
    bibliothèque. La bibliothèque est nécessaire pour certaines
    applications, telles que <application>Amarok</application> et nous recommandons
    l'utilisation des bibliothèques partagées.</para>
     
    <para>Beaucoup d'options sont disponibles avec
    <userinput>cmake</userinput>. Vérifiez la sortie de `<userinput>cmake .
    -LH</userinput>` pour des options supplémentaires de personnalisation. Voir
    la <ulink
    url="http://dev.mysql.com/doc/refman/5.5/en/source-configuration-options.html">
    Documentation MySQL </ulink> pour une liste complète des options.</para>
     
    <para>Si vous voulez la version partagée de la bibliothèque serveur
    embarquée, appliquez le correctif suivant&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../mysql-&mysql-version;-embedded_library_shared-1.patch</userinput></screen>
 
    <para>Installez <application>MySQL</application> en
    lançant les commandes suivantes&nbsp;:</para>
     
<screen><userinput>sed -i "/ADD_SUBDIRECTORY(sql\/share)/d" CMakeLists.txt &amp;&amp;
sed -i "s/ADD_SUBDIRECTORY(libmysql)/&amp;\\nADD_SUBDIRECTORY(sql\/share)/" CMakeLists.txt &amp;&amp;
sed -i "s@data/test@\${INSTALL_MYSQLSHAREDIR}@g" sql/CMakeLists.txt &amp;&amp;
sed -i "s@data/mysql@\${INSTALL_MYSQLTESTDIR}@g" sql/CMakeLists.txt &amp;&amp;
mkdir build &amp;&amp;
cd build &amp;&amp;
cmake -DCMAKE_BUILD_TYPE=Release                    \
      -DCMAKE_INSTALL_PREFIX=/usr                   \
-DINSTALL_DOCDIR=share/doc/mysql       \
-DINSTALL_DOCREADMEDIR=share/doc/mysql  \
-DINSTALL_INCLUDEDIR=include/mysql   \
-DINSTALL_INFODIR=share/info        \
-DINSTALL_MANDIR=share/man               \
-DINSTALL_MYSQLDATADIR=/srv/mysql    \
-DINSTALL_MYSQLSHAREDIR=share/mysql    \
-DINSTALL_MYSQLTESTDIR=share/mysql/test  \
-DINSTALL_PLUGINDIR=lib/mysql         \
-DINSTALL_SBINDIR=sbin                \
-DINSTALL_SCRIPTDIR=bin                \
-DINSTALL_SQLBENCHDIR=share/mysql/bench \
-DINSTALL_SUPPORTFILESDIR=share/mysql/support    \
-DMYSQL_DATADIR=/srv/mysql               \
-DMYSQL_UNIX_ADDR=/var/run/mysql/mysql.sock    \
-DSYSCONFDIR=/etc/mysql                 \
-DWITH_PARTITION_STORAGE_ENGINE=OFF         \
-DWITH_PERFSCHEMA_STORAGE_ENGINE=OFF       \
-DWITH_READLINE=system   \
-DWITH_SSL=system      \
.. &amp;&amp;
make</userinput></screen>

    <para>Pour tester les résultats, lancez&nbsp;: <command>make test-force 2>&amp;1 | tee
	test.log</command>.Cela force le test à lancer au départ le log de toutes les sorties de tests.
	Il y a beaucoup de tests qui ne sont pas lancés a cause des options de configuraton et de 
	considérations des programmeurs. Sans cela, beaucoup de tests échoueront.
        Aussi, deux tests échoueront si ipv6 n'est pas activé dans le noyau
        en tant que module ou en dur.</para>

    <note><para>Il se peut que les tests SSL échouent à cause de certificts
    expirés.</para></note>

    <para>
      Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>make install</userinput></screen>

    <tip>
      <para>
        Les seules documentations fournies dans l'archive des sources sont
        <filename>mysql.info</filename> et les pages de manuels. Vous pouvez
        télécharger différents formats du manuel de référence
        <application>MySQL</application>
        à l'adresse <ulink url="http://dev.mysql.com/doc/"/>.
      </para>
    </tip>

   </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para>
      <command>sed -i ...</command>: Le premier des deux seds corrige
      la construction du client seulement, le dernier des deux seds
      initialise les bons répertoires d'installation pour quelques composants.
    </para>

    <para><parameter>-DWITH_&lt;engine&gt;_STORAGE_ENGINE=ON</parameter>&nbsp;:
    Les instructions par défaut ne construisent que le moteur de stockage
    innobase (InnoDB). Si vous désirez d'autres moteurs de stockage, utilisez
    ce paramètre pour les activer. Les choix valides sont ARCHIVE, BLACKHOLE, 
    EXAMPLE, FEDERATED, INNOBASE, NDBCLUSTER,
    PARTITION et PERFSCHEMA.</para>

   <para><parameter>-DWITHOUT_SERVER=ON</parameter>&nbsp;: Utilisez ce
    paramètre si vous ne voulez pas le serveur et si vous ne voulez construire
    que le client.</para>

    <para><parameter>-DWITH_EMBEDDED_SERVER=ON</parameter>&nbsp;: Utilisez ce
    paramètre pour construire la bibliothèque serveur embarquée.</para>
    
    <para><parameter>-DWITH_SSL=system</parameter>&nbsp;: Ce paramètre est utilisé
    pour signaler d'utiliser la version du système de 
      <application>OpenSSL</application>. Effacez le si vous n'avez pas installées
      <application>OpenSSL</application>.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de MySQL</title>

    <sect3 id="mysql-config">
      <title>Fichiers de configuration</title>

      <para>
        <filename>/etc/mysql/my.cnf</filename> et
        <filename>~/.my.cnf</filename>
      </para>

      <indexterm zone="mysql mysql-config">
        <primary sortas="e-AA.my.cnf">~/.my.cnf</primary>
      </indexterm>

      <indexterm zone="mysql mysql-config">
        <primary sortas="e-etc-mysql-my.cnf">/etc/my.cnf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>Vous pouvez utiliser plusieurs fichiers de configuration sont 
      disponibles dans <filename class="directory">/usr/share/mysql</filename>.
      Quand vous créez le fichier, assurez vous que les journaux binaires sont
      désactivés à moins que vous fassiez une copie de la base de données.
      Créez <filename>/etc/mysql/my.cnf</filename> en utilisant la commande suivante
      en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>install -v -Dm644 /usr/share/mysql/support/my-medium.cnf /etc/mysql/my.cnf &amp;&amp;
sed -i 's/^log-bin/#log-bin/' /etc/mysql/my.cnf &amp;&amp;
sed -i 's/^binlog/#binlog/' /etc/mysql/my.cnf</userinput></screen>

      <para>Vous pouvez maintenant installer une base de données et modifier 
      l'appartenance en faveur de l'utilisateur et du groupe non privilégiés 
      (effectuez en tant qu'utilisateur <systemitem
      class="username">root</systemitem> user)&nbsp;:</para>

<screen role="root"><userinput>mysql_install_db --basedir=/usr --datadir=/srv/mysql --user=mysql &amp;&amp;
chown -R mysql:mysql /srv/mysql</userinput></screen>

      <para>La configuration supplémentaire exige que le serveur
      <application>MySQL</application> soit en fonction. Démarrez le serveur en
      utilisant les commandes suivantes en tant qu'utilisateur <systemitem
      class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>install -v -m755 -o mysql -g mysql -d /var/run/mysql &amp;&amp;
mysqld_safe --user=mysql 2&gt;&amp;1 &gt;/dev/null &amp;</userinput></screen>

      <para>Une installation par défaut n'initialise pas de mot de passe pour
      l'administrateur, utilisez donc la commande suivante en tant qu'utilisateur 
      <systemitem class="username">root</systemitem> pour en régler un. Remplacez
      <replaceable>&lt;nouveau-mot-de-passe&gt;</replaceable> par le
      vôtre.</para>

<screen role="root"><userinput>mysqladmin -u root password <replaceable>&lt;nouveau-mot-de-passe&gt;</replaceable></userinput></screen>

      <para>La configuration du serveur est maintenant terminée. Éteignez le
      serveur en utilisant la commande suivante en tant qu'utilisateur <systemitem
      class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>mysqladmin -p shutdown</userinput></screen>

    </sect3>

    <sect3  id="mysql-init">
      <title>Script de démarrage</title>

      <para>Installez le script de démarrage <filename>/etc/rc.d/init.d/mysql</filename> 
      inclu dans le paquet <xref linkend="bootscripts"/> en tant qu'utilisateur
      <systemitem class="username">root</systemitem> pour démarrer le serveur
      <application>MySQL</application> au moment du démarrage du système.</para>

      <indexterm zone="mysql mysql-init">
        <primary sortas="f-mysql">mysql</primary>
      </indexterm>

<screen role="root"><userinput>make install-mysql</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>
          innochecksum, msql2mysql, myisamchk, myisam_ftdump, myisamlog,
          myisampack, my_print_defaults, mysql, mysqlaccess, mysqlaccess.conf,
          mysqladmin, mysqlbinlog, mysqlbug, mysqlcheck, mysql_client_test,
          mysql_client_test_embedded, mysql_config, mysql_convert_table_format,
          mysqld, mysqld_multi, mysqld_safe, mysqldump, mysqldumpslow,
          mysql_embedded, mysql_find_rows, mysql_fix_extensions, mysqlhotcopy,
          mysqlimport, mysql_install_db, mysql_plugin, mysql_secure_installation,
          mysql_setpermission, mysqlshow, mysqlslap, mysqltest,
          mysqltest_embedded, mysql_tzinfo_to_sql, mysql_upgrade, mysql_waitpid,
          mysql_zap, perror, replace, resolveip et resolve_stack_dump
        </seg>
        <seg>
          libmysqlclient.{so,a}, libmysqlclient_r.{so,a}, libmysqld.{so,a},
          libmysqlservices.a et quelques unes dans /usr/lib/mysql
        </seg>
        <seg>
          /etc/mysql,
          /srv/mysql,
          /usr/include/mysql,
          /usr/lib/mysql,
          /usr/share/doc/mysql et
          /usr/share/mysql
        </seg>
      </seglistitem>
    </segmentedlist>

    <bridgehead renderas="sect3">Descriptions courtes</bridgehead>

    <para>Des descriptions de tous les programmes et de toutes les bibliothèques
     prendraient plusieurs pages. Consultez plutôt la documentation de
     <filename>mysql.info</filename> ou le manuel de référence en ligne sur <ulink
    url="http://dev.mysql.com/doc/refman/5.5/en/index.html"/>.</para>

    <para>Les modules DBI de <application>Perl</application> doivent être
    installés pour avoir des programmes de support de <application>MySQL</application> 
    pour fonctionner correctement.</para>

  </sect2>

</sect1>
