<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
   "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY autofs-download-http "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-&autofs-version;.tar.bz2">
  <!ENTITY autofs-download-ftp "ftp://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-&autofs-version;.tar.bz2">
  <!ENTITY autofs-md5sum        "f43a09e94c4bd512ec58ac06e9d42c60">
  <!ENTITY autofs-size          "122 KB">
  <!ENTITY autofs-buildsize     "1.4 MB">
  <!ENTITY autofs-time          "0.01 SBU">
]>

<sect1 id="autofs" xreflabel="autofs-&autofs-version;">
<sect1info>
<othername>$LastChangedBy: larry $</othername>
<date>$Date: 2005-06-16 06:20:36 $</date>
</sect1info>
<?dbhtml filename="autofs.html"?>
<title>Automate Mounting of File Systems</title>
<indexterm zone="autofs">
<primary sortas="a-Autofs">Autofs</primary></indexterm>

<sect2>
<title>Introduction to <application>autofs</application></title>

<para>The <application>autofs</application> package contains userspace
tools that work with the kernel to mount and un-mount removable file
systems. This is useful for allowing users to mount floppies, cdroms and 
other removable storage devices without requiring the system
administrator to mount the devices.  This may not be ideal for all 
installations, so be aware of the risks before implementing this feature.</para>

<sect3><title>Package information</title>
<itemizedlist spacing="compact">
<listitem><para>Download (HTTP): 
<ulink url="&autofs-download-http;"/></para></listitem>
<listitem><para>Download (FTP): 
<ulink url="&autofs-download-ftp;"/></para></listitem>
<listitem><para>Download MD5 sum: &autofs-md5sum;</para></listitem>
<listitem><para>Download size: &autofs-size;</para></listitem>
<listitem><para>Estimated disk space required: 
&autofs-buildsize;</para></listitem>
<listitem><para>Estimated build time: 
&autofs-time;</para></listitem></itemizedlist>
</sect3>

<sect3><title>Additional downloads</title>
<itemizedlist spacing="compact">
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-strict.patch"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-bad_chdir.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-mtab_lock.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-non_block_ping.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-signal-race-fix.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-sock-leak-fix.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-replicated_server_select.patch
"/></para>
</listitem>
<listitem><para>Recommended Patch: <ulink
url="http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-multi-over.patch
"/></para>
</listitem>
</itemizedlist>
</sect3>
<!---
<sect3><title><application>template</application> dependencies</title>
<sect4><title>Required</title>
<para><xref linkend="BLFS DEPENDENCY"/></para>
</sect4>

<sect4><title>Optional</title>
<para><ulink url="http://www.some.url/">EXTERNAL DEPENDENCY</ulink></para>
</sect4>
</sect3> -->

</sect2>

<sect2 id="autofs-kernel">
<title>Installation of <application>autofs</application></title>
<indexterm zone="autofs autofs-kernel">
<primary sortas="d-Automounter">Automounter</primary></indexterm>

<para>Verify that kernel support has been compiled in or built as
modules in the following areas:
<screen>File systems
	Kernel automounter version 4 support	Y or M
Network File Systems
	NFS file system support			Y or M
	SMB file system support			Y or M</screen>
Recompile and install the new kernel, if necessary.</para>

<para>Install <application>autofs</application> by running the following 
commands:</para>

<screen><userinput><command>patch -Np1 -i ../autofs-4.1.3-strict.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-bad_chdir.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-mtab_lock.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-non_block_ping.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-signal-race-fix.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-sock-leak-fix.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-replicated_server_select.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-multi-over.patch &amp;&amp;
./configure --prefix=/ --mandir=/usr/share/man &amp;&amp;
make</command></userinput></screen>

<para>Now, as the root user:</para>

<screen><userinput role='root'><command>make install &amp;&amp;
rm /etc/rc.d/init.d/autofs</command></userinput></screen>

</sect2>

<sect2>
<title>Command explanations</title>

<para><command>rm /etc/rc.d/init.d/autofs</command>: This command
removes the installed script which only works on specific distributions.</para>

</sect2>

<sect2>
<title>Configuring <application>autofs</application></title>

<sect3 id="autofs-config"><title>Config files</title>
<para><filename>/etc/sysconfig/autofs.conf</filename>,
<filename>/etc/auto.master</filename>,
<filename>/etc/auto.misc</filename>, and
<filename>/etc/auto.net</filename></para>
<indexterm zone="autofs autofs-config" >
<primary 
sortas="e-etc-sysconfig-autofs.conf">/etc/sysconfig/autofs.conf</primary>
</indexterm>
<indexterm zone="autofs autofs-config">
<primary sortas="e-etc-auto.master">/etc/auto.master</primary></indexterm>
<indexterm zone="autofs autofs-config">
<primary sortas="e-etc-auto.misc">/etc/auto.misc</primary></indexterm>
<indexterm zone="autofs autofs-config">
<primary sortas="e-etc-auto.net">/etc/auto.net</primary></indexterm>
</sect3>

<sect3><title>Configuration Information</title>

<para>The installation process creates <filename>auto.master</filename>,
<filename>auto.misc</filename> and <filename>auto.net</filename>. You
will replace the <filename>auto.master</filename> with the following
commands.

<screen><userinput role='root'><command>mv /etc/auto.master /etc/auto.master.bak &amp;&amp;
cat &gt; /etc/auto.master &lt;&lt; "EOF"</command>
# Begin /etc/auto.master

/media	/etc/auto.misc

# End /etc/auto.master
<command>EOF</command></userinput></screen></para>

<note><para>This file mounts a new media directory over the one created by
<acronym>LFS</acronym> and will therefore hide any mounts made by the
<filename>fstab</filename> file into that directory.</para></note> 

<para>While this package could be used to mount <acronym>NFS</acronym>
shares and <acronym>SMB</acronym> shares, that feature is not configured
in these instructions. <acronym>NFS</acronym> shares are covered on the
next page.
</para>

<para>The <filename>auto.misc</filename> must be configured to your
working hardware. The loaded configuration file should load your cdrom
if <filename>/dev/cdrom</filename> is active or it can be edited to
match your device setup and examples for floppies are available in the file 
and easily activated. Documentation for this file is available using the
<command>man 5 autofs</command> command.</para>

<para id="autofs-init">Install the 
<filename>/etc/rc.d/init.d/autofs</filename> mount script and 
<filename>/etc/sysconfig/autofs.conf</filename> support file
included with the <xref linkend="intro-important-bootscripts"/>
package.</para>
<indexterm zone="autofs autofs-init">
<primary sortas="f-autofs-init">autofs</primary></indexterm>

<screen><userinput role='root'><command>make install-autofs</command></userinput></screen>

<para>The time-out variable is set in
<filename>/etc/sysconfig/autofs.conf</filename>. The installed file sets
a default of 60 seconds of inactivity before unmounting the device.  A
much shorter time may be necessary to protect buffer writing to a
floppy if users tend to remove the media prior to the timeout
setting.</para>
</sect3>

</sect2>

<sect2>
<title>Contents</title>

<segmentedlist>
<segtitle>Installed Program</segtitle>
<segtitle>Installed Libraries</segtitle>
<seglistitem>
<seg>automount</seg>
<seg>autofs modules</seg>
</seglistitem>
</segmentedlist>

<variablelist>
<bridgehead renderas="sect3">Short Descriptions</bridgehead>
<?dbfo list-presentation="list"?>

<varlistentry id="automount">
<term><command>automount</command></term>
<listitem><para>is the daemon that performs the mounting when a request is 
made for the device.</para>
<indexterm zone="autofs automount">
<primary sortas="b-automount">automount</primary></indexterm>
</listitem>
</varlistentry>
</variablelist>

</sect2>

</sect1>

