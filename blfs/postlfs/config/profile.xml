<sect1 id="postlfs-config-profile">
<?dbhtml filename="profile.html" dir="postlfs"?>
<title>Les fichiers de démarrage du shell Bash</title>

<para>Le programme shell <filename>/bin/bash</filename> (que l'on nommera
simplement "le shell" à partir de maintenant) utilise une collection de fichiers
de démarrage pour aider à la création d'un environnement de travail. Chaque
fichier a une utilisation spécifique et peut affecter différemment la connexion
et les environnements interactifs. Les fichiers dans le répertoire
<filename>/etc</filename> apportent habituellement une configuration globale.
Si un fichier équivalent existe dans votre répertoire personnel, il pourrait
écraser les paramètrages globaux.</para>

<para>Un shell interactif de connexion est lancé après une identification
positive, en utilisant <filename>/bin/login</filename> en lisant le fichier
<filename>/etc/passwd</filename>. Un shell interactif, sans login, est lancé à
la ligne de commande (c'est-à-dire
<prompt>[invite]$</prompt><command>/bin/bash</command>).
Un shell non-interactif est présent habituellement lorsqu'un script shell
tourne. Il est non interactif parce qu'il exécute un script et n'attends pas
d'entrée utilisateur entre les commandes.</para>

<para>Pour plus d'informations, voir <command>info bash</command> --
<emphasis role="strong">Noeud: Bash Startup Files and Interactive
Shells</emphasis>.</para>

<para>Les fichiers suivants sont utilisés pour s'assurer que l'environnement
correct est établi pour chacune des façons dont le shell peut être appelé:
<filename>/etc/profile</filename> et son équivalent privé
<filename>~/.bash_profile</filename>, et
<filename>/etc/bashrc</filename> (non officiel) et son équivalent privé
et <filename>~/.bashrc</filename>.</para>

<para>Le fichier <filename>~/.bash_logout</filename> n'est pas utilisé pour une
invocation du shell. Il est lu par le shell quand un utilisateur se
déconnecte du système.</para>

<para>Les fichiers <filename>/etc/profile</filename> et
<filename>~/.bash_profile</filename> sont lus quand le shell est invoqué comme
shell interactif de connexion. Le fichier <filename>~/.bashrc</filename> est lu
quand le shell est invoqué comme shell interactif sans fonction de connexion.
</para> 

<para>Voici la base d'un <filename>/etc/profile</filename>. Les commentaires sur
ce fichier devraient expliquer tout ce dont vous avez besoin. Pour plus
d'informations sur les séquences d'échappement que vous pouvez utiliser pour
votre invite (par exemple, la variable d'environnement <envar>PS1</envar>),
voir <command>info bash</command> -- <emphasis role="strong">Noeud: Imprimer
une invite</emphasis>.</para>

<screen><userinput><command>cat &gt; /etc/profile &lt;&lt; "EOF"</command>
# Begin /etc/profile
# Ecrit pour Beyond Linux From Scratch
# par James Robertson &lt;jameswrobertson@earthlink.net&gt;

# Variables d'environnement globales et programmes de démarrage

# Les alias systèmes et les fonctions doivent aller dans /etc/bashrc. Les
# variables d'environnements et les programmes de lancement personnels doivent
# aller dans ~/.bash_profile. Les alias et fonctions personnels doivent aller
# dans ~/.bashrc.

# Fonction d'aide à la gestion des chemins.
pathman () {
	if ! echo $PATH | /bin/egrep -q "(^|:)$1($|:)" ; then
		if [ "$2" = "last" ] ; then
			PATH=$PATH:$1
		else
			PATH=$1:$PATH
		fi
	fi
}

# Ajout au chemin standard.
if [ $(id -u) = 0 ] ; then
	if [ -d "/usr/local/sbin" ] ; then
		pathman /usr/local/sbin last
	fi
fi

if [ $(id -u) != 0 ] ; then
	if [ -d "/usr/local/bin" ] ; then
		pathman /usr/local/bin last
	fi
fi

if [ -d "/usr/X11R6/bin" ] ; then
	pathman /usr/X11R6/bin last
fi

# Configuration de quelques variables d'environnement.
HISTSIZE=1000
PS1="[\u@\h \w]\\$ "

# Configuration de la variable d'environnement INPUTRC.
if [ -z "$INPUTRC" -a ! -f "$HOME/.inputrc" ] ; then
	INPUTRC=/etc/inputrc
fi

# Configuration de /bin/ls pour activer le support de la couleur, l'alias se
# trouve dans /etc/bashrc.
if [ -f "/etc/dircolors" ] ; then
	eval $(dircolors -b /etc/dircolors)

	if [ -f "$HOME/.dircolors" ] ; then
		eval $(dircolors -b $HOME/.dircolors)
	fi
fi

export PATH HISTSIZE PS1 LS_COLORS INPUTRC

# Fin /etc/profile
<command>EOF</command></userinput></screen>

<para>Voici la base d'un <filename>/etc/bashrc</filename>. Les commentaires
dans le fichier devraient expliquer tout ce dont vous avez besoin. Si vous
voulez que chaque nouvel utilisateur dispose automatiquement de ce fichier,
changez simplement la sortie de la commande suivante par
<filename>/etc/skel/.bash_profile</filename> et vérifiez les droits après avoir
lancé la commande. Vous pouvez ensuite copier
<filename>/etc/skel/.bash_profile</filename> dans le répertoire personnel de
chaque utilisateur déjà existant, y compris root, et configurer le propriétaire
et le groupe de façon approprié.</para>

<screen><userinput><command>cat &gt; /etc/bashrc &lt;&lt; "EOF"</command>
# Begin /etc/bashrc
# Ecrit pour Beyond Linux From Scratch 
# par James Robertson &lt;jameswrobertson@earthlink.net&gt;

# Alias système et fonctions.

# Les alias systèmes et les fonctions doivent aller dans /etc/bashrc. Les
# variables d'environnements et les programmes de lancement personnels doivent
# aller dans ~/.bash_profile. Les alias et fonctions personnels doivent aller
# dans ~/.bashrc.

# Par défaut, nous voulons mettre en place le masque utilisateur (umask).
# Même pour les shells non interactifs et sans login.
if [ "$(id -gn)" = "$(id -un)" -a $(id -u) -gt 99 ] ; then
	umask 002
else
	umask 022
fi

# Met à disposition une commande /bin/ls colorisée. Utilisé avec du code de
# /etc/profile.
alias ls='ls --color=auto'

# Propose une invite pour les shells non interactifs, spécialement ceux lancés
# depuis l'environnement xfree. [Voir la liste de mails archivés titrée
# "PS1 Environment variable" pour une grande étude de cas de ce script.]
export PS1="[\u@\h \w]\\$ "

# Fin /etc/bashrc
<command>EOF</command></userinput></screen>

<para>Voici la base d'un <filename>~/.bash_profile</filename>. Les commentaires
dans le fichier devraient expliquer tout ce dont vous avez besoin.</para>

<para><screen># Début ~/.bash_profile
# Ecrit pour Beyond Linux From Scratch
# par James Robertson &lt;jameswrobertson@earthlink.net&gt;

# Variables d'environnement et programmes de lancement personnels.

# Les alias systèmes et les fonctions doivent aller dans /etc/bashrc. Les
# variables d'environnements et les programmes de lancement personnels doivent
# aller dans ~/.bash_profile. Les alias et fonctions personnels doivent aller
# dans ~/.bashrc.

if [ -f "$HOME/.bashrc" ] ; then
	source $HOME/.bashrc
fi

if [ -d "$HOME/bin" ] ; then
	pathman $HOME/bin last
fi

export PATH 

# Fin ~/.bash_profile</screen></para>

<para>Voici la base d'un <filename>~/.bashrc</filename>. Les commentaires
dans le fichier devraient expliquer tout ce dont vous avez besoin. Les
commentaires et instructions sur l'utilisation de
<filename>/etc/skel</filename> pour <filename>.bash_profile</filename> ci-dessus
s'appliquent ici aussi. Seuls les noms des fichiers cibles sont différents.
</para>

<para><screen># Début ~/.bashrc
# Ecrit pour Beyond Linux From Scratch
# par James Robertson &lt;jameswrobertson@earthlink.net&gt;

# Alias et fonctions personnels.

# Les alias systèmes et les fonctions doivent aller dans /etc/bashrc. Les
# variables d'environnements et les programmes de lancement personnels doivent
# aller dans ~/.bash_profile. Les alias et fonctions personnels doivent aller
# dans ~/.bashrc.

if [ -f "/etc/bashrc" ] ; then
	source /etc/bashrc
fi

# Fin ~/.bashrc</screen></para>

<para>Voici la base d'un <filename>~/.bash_logout</filename>. Les commentaires
dans le fichier devraient expliquer tout ce dont vous avez besoin.</para>

<para><screen># Début ~/.bash_logout
# Ecrit pour Beyond Linux From Scratch
# par James Robertson &lt;jameswrobertson@earthlink.net&gt;

# Eléments personnels exécutés à la fin de la connexion.

# Fin ~/.bash_logout</screen></para>

<para>Si vous voulez utiliser la capacité <filename>dircolors</filename>, alors
lancez la commande suivante. Les étapes de configuration de
<filename>/etc/skel</filename> vues ci-dessus peuvent aussi être utilisées ici
pour procurer un fichier <filename>.dircolors</filename> lorsqu'un nouvel
utilisateur est configuré. Comme auparavent, modifiez simplement le nom de
fichier en sortie sur la commande suivante et assurez-vous que les droits,
propiétaire et groupe sont corrects sur les fichiers créés et/ou copiés.</para>

<para>
<userinput><command>/bin/dircolors -p > /etc/dircolors</command></userinput>
</para>

<para>Ian Macdonald a écrit une excellente collection d'astuces en tout genre
pour améliorer l'environnement de votre shell. Vous pouvez la lire en ligne sur
<ulink url="http://www.caliban.org/bash/index.shtml">http://www.caliban.org/bash/index.shtml</ulink>.
</para>

</sect1>
