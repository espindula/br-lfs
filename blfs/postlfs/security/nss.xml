<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY nss-download-http "http://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_12_8_RTM/src/nss-&nss-version;.tar.gz">
  <!ENTITY nss-download-ftp  "ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_3_12_8_RTM/src/nss-&nss-version;.tar.gz">
  <!ENTITY nss-md5sum        "40bf1bb0c7567827d3768d1fc6081100">
  <!ENTITY nss-size          "5.7 Mio">
  <!ENTITY nss-buildsize     "73 MB (plus du double pour exécuter la suite de tests)">
  <!ENTITY nss-time          "0.9 SBU (ajouter au moins 3.5 SBU pour éxécuter la suite de tests)">
]>

<sect1 id="nss" xreflabel="NSS-&nss-version;">
  <?dbhtml filename="nss.html"?>

  <sect1info>
    <othername>$LastChangedBy: randy $</othername>
    <date>$Date: 2011-01-06 14:31:37 +0100 (jeu 06 jan 2011) $</date>
  </sect1info>

  <title>NSS-&nss-version;</title>

  <indexterm zone="nss">
    <primary sortas="a-NSS">NSS</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à NSS</title>

    <para>Le paquet <foreignphrase>Network Security Services</foreignphrase> (services
    de sécurité réseau) (<application>NSS</application>) est un ensemble de
    bibliothèques conçues pour supporter le développement en plateforme croisée 
    d'applications et de serveurs sécurisés. Les applications construites avec
    NSS peuvent supporter SSL v2 et v3, TLS, les certificats PKCS #5,
    PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 et d'autres 
    standards de sécurité. C'est utile pour implémenter SSL et S/MIME ou d'autres
    standards de sécurité sur Internet dans une application.</para>

    &lfs67_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&nss-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&nss-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &nss-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &nss-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &nss-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &nss-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="&patch-root;/nss-&nss-version;-standalone-1.patch"/></para>
      </listitem>
    </itemizedlist>
    
    <bridgehead renderas="sect3">Dépendances de NSS</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="nspr"/></para>

    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended"><xref linkend="sqlite"/> (Le sqlite interne est incompatible 
    avec une installation existante ou future)</para>


    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/nss"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de NSS</title>

    <para>Installez <application>NSS</application> en lançant les commandes
    suivantes&nbsp;:</para>

<screen><userinput>bash

export BUILD_OPT=1 &amp;&amp;
export NSS_USE_SYSTEM_SQLITE=1 &amp;&amp;
export NSPR_INCLUDE_DIR=/usr/include/nspr &amp;&amp;
export USE_SYSTEM_ZLIB=1 &amp;&amp;
export ZLIB_LIBS=-lz &amp;&amp;
patch -Np1 -i ../nss-&nss-version;-standalone-1.patch &amp;&amp;
make -C mozilla/security/nss nss_build_all</userinput></screen>

    <para>Si vous souhaitez tester les résultats, vous devez initialiser le nom de domaine de
    votre systeme dans la variable d'environnement <envar>DOMSUF</envar>. La plupart des tests
    échoueront si vous ne mettez pas le nom de domaine correct. La sortie volumineuse
    indiquera combien des milliers de tests seront réussi, et si quelques uns echoue.
    Pour revoir le détail des echecs, vous pouvez rediriger stdout et stderr dans un fichier.</para>

    <para>To run the tests, ensure you change the
    <command>export DOMSUF</command> ci-dessous avec la valeur adéquate, 
    par exemple <parameter>mydomain.com</parameter> ou si vous n'avez aucun domaine dans
    votre <filename>/etc/hosts</filename> remplacez le selon la recommandation des developpeurs
    par <command>"export HOST=localhost DOMSUF=localdomain"</command> et lancez les commandes
    suivantes&nbsp;:</para>

<screen><userinput>bash

export NSS_LINUXDIR=$(basename `ls -d $PWD/mozilla/dist/Linux*`) &amp;&amp;
export DOMSUF=<replaceable>&lt;validdomain.name&gt;</replaceable> &amp;&amp;
export PATH=$PATH:$PWD/mozilla/dist/$NSS_LINUXDIR/bin &amp;&amp;
export TEST_RESULTSDIR=$PWD/mozilla/tests_results/security &amp;&amp;

cd mozilla/security/nss/tests &amp;&amp;
sed -i 's/gmake/make/' common/init.sh &amp;&amp;
./all.sh &amp;&amp;

grep Passed $TEST_RESULTSDIR/$(hostname).1/results.html | wc -l &amp;&amp;

exit</userinput></screen>

   <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>export NSS_LINUXDIR=$(basename `ls -d $PWD/mozilla/dist/Linux*`) &amp;&amp;
cd mozilla/dist &amp;&amp;
install -v -m755 $NSS_LINUXDIR/lib/*.so /usr/lib &amp;&amp;
install -v -m644 $NSS_LINUXDIR/lib/{*.chk,libcrmf.a} /usr/lib &amp;&amp;
install -v -m755 -d /usr/include/nss &amp;&amp;
install -v -m755 $NSS_LINUXDIR/bin/{certutil,nss-config,pk12util} /usr/bin &amp;&amp;
install -v -m644 $NSS_LINUXDIR/lib/pkgconfig/nss.pc /usr/lib/pkgconfig &amp;&amp;
cp -v -RL {public,private}/nss/* /usr/include/nss &amp;&amp;
chmod 644 /usr/include/nss/*</userinput></screen>

    <para>Maintenant, en tant qu'utilisateur non privilégié, quittez le shell 
    <command>bash</command> ouvert au début de l'installation pour restaurer 
    l'environnement dans son état d'origine.</para>

<screen><userinput>exit</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>bash</command>&nbsp;: Autant de sells que de variables
    d'environnement sont ouverts lors du processus d'installation. Quitter les 
    shells a pour but de restaurer l'environnement et de revenir au répertoire
    de départ quand l'installation est finie.</para>

    <para><command>export USE_64=1</command>:Cette commande est
    <emphasis>requise pour x86_64</emphasis>, sinon la construction va essayer de créer des 
    objets 32-bits et echouera dans un système non-multilib.</para>

    <para><command>export BUILD_OPT=1</command>&nbsp;: Cette variable est
    réglée pour que la construction se fasse sans symboles de débogage dans les
    binaires et pour que les optimisations du compilateur par défaut soient
    utilisées.</para>

    <para><command>export NSPR_INCLUDE_DIR=/usr/include/nspr</command>: Cette comande
    initialise l'emplacement des entêtes de nspr.</para>

    <para><command>export USE_SYSTEM_*</command>: Ces commandes assurent que les bibliothèques
    du système installé sont utilisés au lieu des versions de l'arborescence.</para>

    <para><command>export ZLIB_LIBS=-lz</command>: Cette commande fournit le drapeau nécessaire pour
    lier au systeme zlib.</para>

    <para><command>export NSS_LINUXDIR=...</command>&nbsp;: Cette variable est
    réglée pour pouvoir déterminer le nom exact des répertoires spécifiques à 
    l'architecture où sont stoclés les binaires dans l'arborescence des sources.</para>

    <para><command>make -C mozilla/security/nss nss_build_all</command>&nbsp;: Cette 
    commande construit les bibliothèques NSPR et <application>NSS</application> et crée un 
    répertoire <filename class='directory'>dist</filename> qui abrite tous les
    programmes, les bibliothèques et les en-têtes d'interface. Aucun programme créé par
    par ce processus n'est installé sur le système en utilisant les instructions
    par défaut (exepté pour <application>nss-config</application>). Si un de ces programmes 
    doit être installé, vous pouvez les trouver dans le répertoire
    <filename class='directory'>mozilla/dist/bin</filename> de l'arborescence des
    sources.</para>

    <para><command>export PATH=...</command>&nbsp;: Cette commande règle la 
    variable d'environnement <envar>PATH</envar> pour inclure les exécutables 
    dans l'arborescence des sources vu que certains d'entre eux sont nécessaires
    pour lancer la suite de tests.</para>

    <para><command>sed -i 's/gmake/make/' common/init.sh</command>&nbsp;: Cette
    commande modifie la commande utilisée pour compiler des programmes de test.</para>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>nss-config</seg>
        <seg>libcrmf.a, libfreebl3.so, libnss3.so, libnssckbi.so,
        libnssdbm3.so, libnssutil3.so, libsmime3.so, libsoftokn3.so
        et libssl3.so</seg>
        <seg>/usr/include/nss</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="nss-config">
        <term><command>nss-config</command></term>
        <listitem>
          <para>est utilisé pour déterminer les paramètres de la bibliothèque
          NSS et des bibliothèques NSS installées.</para>
          <indexterm zone="nss nss-config">
            <primary sortas="b-nss-config">nss-config</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>

  </sect2>

</sect1>
