<?xml version="1.0" encoding="ISO-8859-1"?>
<sect2>
<title>Configurer Heimdal</title>

<sect3><title>Fichiers de configuration</title>
<para><filename>/etc/heimdal/*</filename></para>
</sect3>

<sect3><title>Informations de configuration</title>

<sect4><title>Configuration du serveur maître KDC</title>

<para>Créez le fichier de configuration Kerberos avec la commande
suivante&nbsp;:</para>

<screen><userinput><command>install -d /etc/heimdal &amp;&amp;
cat &gt; /etc/heimdal/krb5.conf &lt;&lt; "EOF"</command>
# Début /etc/heimdal/krb5.conf
        
[libdefaults]
    default_realm = <replaceable>[LFS.ORG]</replaceable>
    encrypt = true

[realms]
    <replaceable>[LFS.ORG]</replaceable> = {
        kdc = <replaceable>[belgarath.lfs.org]</replaceable>
        admin_server = <replaceable>[belgarath.lfs.org]</replaceable>
        kpasswd_server = <replaceable>[belgarath.lfs.org]</replaceable>
    }

[domain_realm]
    .<replaceable>[lfs.org]</replaceable> = <replaceable>[LFS.ORG]</replaceable>

[logging]
    kdc = FILE:/var/log/kdc.log
    admin_server = FILE:/var/log/kadmin.log
    default = FILE:/var/log/krb.log

# Fin /etc/heimdal/krb5.conf
<command>EOF</command></userinput></screen>

<para>Vous aurez besoin de substituer votre domaine et votre nom d'hôte pour les
différentes occurences des noms belgarath et lfs.org.</para>

<para><userinput>default_realm</userinput> devrait être le nom de votre domaine
en majuscule. Ce n'est pas requis mais Heimdal et <acronym>MIT</acronym> le
recommandent.</para>

<para><userinput>encrypt = true</userinput> fournit un cryptage de tout le
trafic
entre clients et serveurs Kerberos. Il n'est pas nécessaire et peut être oublié.
Si vous l'oubliez, vous pouvez crypter tout le trafic entre le client et le
serveur en utilisant une option sur le programme client.</para>

<para>Le paramètre <userinput>[realms]</userinput> indique aux programmes client
où chercher les services d'authentification <acronym>KDC</acronym>.</para>

<para>La section <userinput>[domain_realm]</userinput> fait correspondre un
domaine à un royaume.</para>

<para>Stockez le mot de passe maître dans un fichier clé en utilisant les
commandes suivantes&nbsp;:</para>

<screen><userinput><command>install -d -m 755 /var/lib/heimdal &amp;&amp;
kstash</command></userinput></screen>

<para>Créez la base de données <acronym>KDC</acronym>&nbsp;:</para>

<screen><userinput><command>kadmin -l</command></userinput></screen>

<para>Choisissez les valeurs par défaut pour l'instant. Vous pourrez y
retourner plus tard et changer les valeurs si vous en sentez la nécessité. À
l'invite de <userinput>kadmin&gt;</userinput>, lancez l'instruction
suivante&nbsp;:</para>

<screen><userinput><command>init <replaceable>[LFS.ORG]</replaceable></command></userinput></screen>

<para>Maintenant, vous devez remplir la base de données avec des principes
(utilisateurs). Pour l'instant, utilisez votre nom de connexion ou root.
</para>

<screen><userinput><command>add <replaceable>[loginname]</replaceable></command></userinput></screen>

<para>Le serveur <acronym>KDC</acronym> et toute autre machine disposant de
serveurs Kerberos doivent avoir une clé d'hôte installée&nbsp;:</para>

<screen><userinput><command>add --random-key host/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Après avoir choisir les valeurs par défaut proposés, vous devez exporter
les données dans un fichier keytab&nbsp;:</para>

<screen><userinput><command>ext host/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Ceci doit avoir créé deux fichiers dans
<filename class="directory">/etc</filename> nommé
<filename>krb5.keytab</filename> (Kerberos 5) et
<filename>srvtab</filename> (Kerberos 4). Ces deux fichier devraient avoir les
droits 600 (lecture écriture pour root seulement). Protéger les fichiers keytab
d'un accès public est crucial pour la sécurité complète de votre installation
Kerberos.</para>

<para>Éventuellement, vous voudrez ajouter des principes au serveur dans la base
de données et les extaire dans le fichier keytab. Vous le ferez de la même façon
que vous avez créé les principes de l'hôte. Ci-dessous se trouve un
exemple&nbsp;:
</para>

<screen><userinput><command>add --random-key
ftp/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen
>

<para>(choisissez les valeurs par défaut)</para>

<screen><userinput><command>ext ftp/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Quittez le programme <command>kadmin</command> (utilisez
<command>quit</command> ou <command>exit</command>) et retournez à l'invite du
shell. Lancez le démon <acronym>KDC</acronym> manuellement pour tester
l'installation&nbsp;:</para>

<screen><userinput><command>/usr/sbin/kdc &amp;</command></userinput></screen>

<para>Essayez d'obtenir un <acronym>TGT</acronym> (ticket d'obtention de
tickets) avec la commande suivante&nbsp;:</para>

<screen><userinput><command>kinit
<replaceable>[nom_connexion]</replaceable></command></userinput></screen>

<para>Le mot de passe que vous avez ajouté vous sera demandé. Après avoir
obtenu votre ticket, vous pourrez l'afficher avec la commande&nbsp;:</para>

<screen><userinput><command>klist</command></userinput></screen>

<para>Des informations sur le ticket devraient apparaître à l'écran.</para>

<para>Pour tester les fonctionnalités du fichier keytab, lancez la commande
suivante&nbsp;:</para>

<screen><userinput><command>ktutil list</command></userinput></screen>

<para>Ceci devrait afficher une liste de l'hôte principal avec les méthodes
de cryptage utilisées pour accèder au principal.</para>

<para>Arrivé là, si tout fonctionne correctement, vous pouvez être assez
confiant sur l'installation et la configuration du paquetage.
</para>

<para>Installez le script de démarrage
<filename>/etc/rc.d/init.d/heimdal</filename>
inclus dans le paquetage <xref linkend="intro-important-bootscripts"/>.</para>
package.</para>

<screen><userinput><command>make install-heimdal</command></userinput></screen>

</sect4>

<sect4><title>Utiliser des programmes clients Kerberos</title>

<para>Pour utiliser les programmes client Kerberos (<command>telnet</command>,
<command>ftp</command>, <command>rsh</command>, <command>rxterm</command>,
<command>rxtelnet</command>, <command>rcp</command>, <command>xnlock</command>),
vous devez tout d'abord obtenir un <acronym>TGT</acronym>. Utilisez le programme
<command>kinit</command> pour obtenir le ticket. Après avoir acquis le
ticket, vous pouvez utiliser les programmes Kerberos pour vous connecter à tout
serveur Kerberos sur le réseau. Aucune authentification ne vous sera demandée
jusqu'à l'expiration de votre ticket (par défaut, un jour) sauf si vous
spécifiez un autre utilisateur comme argument en ligne de commande pour le
programme.</para>

<para>Les programmes Kerberos se connecteront à des démons non Kerberos, vous
avertissant que l'authentication n'est pas cryptée. Comme mentionné plus tôt,
seul le programme <command>ftp</command> pose problème pour se connecter à des
démons non Kerberos.</para>

<para>Pour plus d'informations, consultez l'<ulink
url="http://www.linuxfromscratch.org/hints/downloads/files/heimdal.txt">astuce
Heimdal</ulink> sur laquelle ces instructions sont basées.</para>

</sect4>

</sect3>

</sect2>
