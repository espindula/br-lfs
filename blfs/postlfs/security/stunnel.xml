<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY stunnel-download-http "http://mirrors.zerg.biz/stunnel/stunnel-&stunnel-version;.tar.gz">
  <!ENTITY stunnel-download-ftp  "ftp://ftp.stunnel.org/stunnel/stunnel-&stunnel-version;.tar.gz">
  <!ENTITY stunnel-md5sum        "f5e713dda0e8efa659f372832ecd0c2c">
  <!ENTITY stunnel-size          "520 Kio">
  <!ENTITY stunnel-buildsize     "5.5 Mio">
  <!ENTITY stunnel-time          "0.5 SBU">
]>

<sect1 id="stunnel" xreflabel="Stunnel-&stunnel-version;">
  <?dbhtml filename="stunnel.html"?>

  <sect1info>
    <othername>$LastChangedBy&nbsp;: bdubbs $</othername>
    <date>$Date&nbsp;: 2012-03-01 01:56:18 +0100 (jeu. 01 mars 2012) $</date>
  </sect1info>

  <title>Stunnel-&stunnel-version;</title>

  <indexterm zone="stunnel">
    <primary sortas="a-Stunnel">Stunnel</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Stunnel</title>

    <para>Le paquet <application>Stunnel</application> contient un programme
    qui vous permet de chiffrer des connexions TCP de votre choix en
    SSL (Secure Sockets Layer) pour que vous puissiez communiquer facilement 
    avec des clients par des canaux sécurisés. <application>Stunnel</application> 
    peut être utilisé pour ajouter la fonctionnalité SSL aux démons
    <application>Inetd</application> couramment utilisés comme les serveurs
    POP-2, POP-3, et IMAP, à des démons autonomes comme NNTP,
    SMTP et HTTP, et dans des tunnels PPP par des sockets réseaux sans modifications
    le code source du paquet du serveur.</para>

    &lfs70_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&stunnel-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&stunnel-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &stunnel-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &stunnel-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &stunnel-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &stunnel-time;</para>
      </listitem>
    </itemizedlist>

    <!-- <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink
        url="&patch-root;/stunnel-&stunnel-version;-setuid-1.patch"/></para>
      </listitem>
    </itemizedlist> -->

    <bridgehead renderas="sect3">Dépendances de Stunnel</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="openssl"/></para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/stunnel"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Installation de Stunnel</title>

    <para>Le démon <command>stunnel</command> sera lancé dans une cage
    <command>chroot</command> par un utilisateur non privilégié. Créez le nouvel
    utilisateur et le nouveau groupe en utilisant les commandes suivantes en
    tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>groupadd -g 51 stunnel &amp;&amp;
useradd -c "Stunnel Daemon" -d /var/lib/stunnel \
        -g stunnel -s /bin/false -u 51 stunnel</userinput></screen>

    <note>
      <para>Un certificat SSL signé et une clé privée sont nécessaires pour lancer
      le démon <command>stunnel</command>. Si vous possédez ou si vous avez déjà
      créé un certificat SSL signé que vous souhaitez utiliser, copiez-le dans
      <filename>/etc/stunnel/stunnel.pem</filename> avant de commencer la 
      construction (assurez-vous que seul <systemitem class='username'>root</systemitem> 
      a l'accès en lecture et écriture), sinon on vous demandera d'en créer un 
      pendant la procédure d'installation. Le fichier
      <filename class='extension'>.pem</filename> doit être formaté comme décrit
      ci-dessous&nbsp;:</para>

<screen><literal>-----BEGIN PRIVATE KEY-----
<replaceable>&lt;many encrypted lines of private key&gt;</replaceable>
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
<replaceable>&lt;des lignes chiffrées de certificat&gt;</replaceable>
-----END CERTIFICATE-----
-----BEGIN DH PARAMETERS-----
<replaceable>&lt;encrypted lines of dh parms&gt;</replaceable>
-----END DH PARAMETERS-----</literal></screen>
    </note>

    <para>Installez <application>Stunnel</application> en lançant les commandes
    suivantes&nbsp;:</para>
<screen><userinput>./configure --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-libwrap &amp;&amp;
make</userinput></screen>

    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make docdir=/usr/share/doc/stunnel-&stunnel-version; install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><parameter>--sysconfdir=/etc</parameter>&nbsp;: Ce paramètre oblige
    que le répertoire de configuration soit <filename class='directory'>/etc</filename>
    et non <filename class='directory'>/usr/etc</filename>.</para>

    <para><parameter>--localstatedir=/var</parameter>&nbsp;: Ce paramètre
    paramètre l'installation pour utiliser 
    <filename class='directory'>/var/lib/stunnel</filename> au lieu de créer
    et d'utiliser <filename class='directory'>/usr/var/stunnel</filename>.</para>

    <para><parameter>--disable-libwrap</parameter>&nbsp;: Ce paramètre est
    requis si vous n'avez pas installé <application>tcpwrappers</application>.
    Supprimez le paramètre si <application>tcpwrappers</application> est
    installé.</para>

    <para><command>make docdir=... install</command>&nbsp;: Cette commande
    installe le paquet, modifie le répertoire d'installation de la documentation
    en un nom conforme aux conventions et, si vous n'avez pas copié de fichier
    <filename>stunnel.pem</filename> dans le répertoire
    <filename class='directory'>/etc/stunnel</filename>, vous demande les
    informations nécessaires pour en créer un. Assurez-vous de répondre à
    la question</para>

<screen><prompt>Common Name (FQDN of your server) [localhost]:</prompt></screen>

    <para>par le nom ou l'adresse IP que vous utiliserez pour accéder au(x)
    service(s).</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de Stunnel</title>

    <sect3 id="stunnel-config">
      <title>Fichiers de configuration</title>

      <para><filename>/etc/stunnel/stunnel.conf</filename></para>

      <indexterm zone="stunnel stunnel-config">
        <primary sortas="e-etc-stunnel-stunnel.conf">/etc/stunnel/stunnel.conf</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>En tant qu'utilisateur <systemitem class="username">root</systemitem>,
      créez le répertoire utilisé pour le fichier
      <filename class='extension'>.pid</filename> créé quand le démon
      <application>Stunnel</application> démarre&nbsp;:</para>

<screen role="root"><userinput>install -v -m750 -o stunnel -g stunnel -d /var/lib/stunnel/run</userinput></screen>

      <para>Ensuite, créez un fichier de configuration <filename>/etc/stunnel/stunnel.conf</filename>
      de base en utilisant les commandes suivantes en tant qu'utilisateur
      <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>cat &gt;/etc/stunnel/stunnel.conf &lt;&lt; "EOF" &amp;&amp;
<literal>; File: /etc/stunnel/stunnel.conf

pid    = /run/stunnel.pid
chroot = /var/lib/stunnel
client = no
setuid = stunnel
setgid = stunnel
cert   = /etc/stunnel/stunnel.pem</literal>

EOF
chmod -v 644 /etc/stunnel/stunnel.conf</userinput></screen>

      <para>Enfin, vous avez besoin d'ajouter le(s) service(s) que vous souhaitez
      chiffrer au fichier de configuration. Le format ressemble à ce qui
      suit&nbsp;:</para>

<screen><literal>[<replaceable>&lt;service&gt;</replaceable>]
accept  = <replaceable>&lt;hostname:portnumber&gt;</replaceable>
connect = <replaceable>&lt;hostname:portnumber&gt;</replaceable></literal></screen>

      <para>Si vous utilisez <application>Stunnel</application> pour chiffrer
      un démon lancé à partir de <command>[x]inetd</command>, il se peut
      que vous deviez désactiver ce démon dans le fichier
      <filename>/etc/[x]inetd.conf</filename> et activer un 
      service <replaceable>&lt;service&gt;</replaceable>_stunnel correspondant.
      Il se peut que vous deviez également ajouter une entrée adéquate dans
      <filename>/etc/services</filename>.</para>

      <para>Pour une explication complète des commandes et de leurs syntaxes, 
      utilisées dans le fichier de configuration, lancez <command>man stunnel</command>. 
      Pour voir un exemple BLFS d'une configuration finalisée d'un service
      <command>stunnel</command> chiffré, lisez la <xref linkend="samba3-swat-config"/> 
      dans les instructions de <application>Samba</application>.</para>

    </sect3>

    <sect3  id="stunnel-init">
      <title>Script de démarrage</title>

      <para>Pour démarrer automatiquement le démon <command>stunnel</command> 
      quand on redémarre le système, installez le script de démarrage
      <filename>/etc/rc.d/init.d/stunnel</filename> du paquet
      <xref linkend="bootscripts"/>.</para>

      <indexterm zone="stunnel stunnel-init">
        <primary sortas="f-stunnel">stunnel</primary>
      </indexterm>

<screen role="root"><userinput>make install-stunnel</userinput></screen>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>stunnel et stunnel3</seg>
        <seg>libstunnel.so</seg>
        <seg>/etc/stunnel, /usr/lib/stunnel,
        /usr/share/doc/stunnel-&stunnel-version; et
        /var/lib/stunnel</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="stunnel-prog">
        <term><command>stunnel</command></term>
        <listitem>
          <para>est un programme conçu pour fonctionner en tant qu'enveloppe
          SSL chiffrée entre des clients distants et locaux 
          (<command>{x}inetd</command>-startable) ou des serveurs distants.</para>
          <indexterm zone="stunnel stunnel-prog">
            <primary sortas="b-stunnel">stunnel</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="stunnel3">
        <term><command>stunnel3</command></term>
        <listitem>
          <para>est un script enveloppe <application>Perl</application> pour
          utiliser la syntaxe <command>stunnel</command> 3.x avec
          <command>stunnel</command> >=4.05.</para>
          <indexterm zone="stunnel stunnel3">
            <primary sortas="b-stunnel3">stunnel3</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libstunnel">
        <term><filename class='libraryfile'>libstunnel.so</filename></term>
        <listitem>
          <para>contient les fonctions API exigées par
          <application>Stunnel</application>.</para>
          <indexterm zone="stunnel libstunnel">
            <primary sortas="c-libstunnel">libstunnel.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
