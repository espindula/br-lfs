<?xml version="1.0" encoding="ISO-8859-1"?>
<sect2>
<title>Configurer <application><acronym>MIT</acronym> krb5</application></title>

<sect3><title>Fichiers de configuration</title>
<para><filename>/etc/krb5.conf</filename> et
<filename>/var/lib/krb5kdc/kdc.conf</filename></para>
</sect3>

<sect3><title>Informations de configuration</title>

<sect4><title>Configuration de Kerberos</title>

<para>Créez le fichier de configuration de Kerberos avec la commande
suivante&nbsp;:</para>

<screen><userinput><command>cat &gt; /etc/krb5.conf &lt;&lt; "EOF"</command>
# Début /etc/krb5.conf
        
[libdefaults]
    default_realm = <replaceable>[LFS.ORG]</replaceable>
    encrypt = true

[realms]
    <replaceable>[LFS.ORG]</replaceable> = {
        kdc = <replaceable>[belgarath.lfs.org]</replaceable>
        admin_server = <replaceable>[belgarath.lfs.org]</replaceable>
    }

[domain_realm]
    .<replaceable>[lfs.org]</replaceable> = <replaceable>[LFS.ORG]</replaceable>

[logging]
    kdc = SYSLOG[:INFO[:AUTH]]
    admin_server = SYSLOG[INFO[:AUTH]]
    default = SYSLOG[[:SYS]]

# Fin /etc/krb5.conf
<command>EOF</command></userinput></screen>

<para>Vous aurez besoin de substituer votre domaine et votre nom d'hôte pour les
différentes occurences des noms belgarath et lfs.org.</para>

<para><userinput>default_realm</userinput> devrait être le nom de votre domaine
en majuscule. Ce n'est pas requis mais Heimdal et <acronym>MIT</acronym> le
recommandent.</para>

<para><userinput>encrypt = true</userinput> fournit un cryptage de tout le trafic
entre clients et serveurs Kerberos. Il n'est pas nécessaire et peut être oublié.
Si vous l'oubliez, vous pouvez crypter tout le trafic entre le client et le
serveur en utilisant une option sur le programme client.</para>

<para>Le paramètre <userinput>[realms]</userinput> indique aux programmes client
où chercher les services d'authentification <acronym>KDC</acronym>.</para>

<para>La section <userinput>[domain_realm]</userinput> fait correspondre un domaine
à un royaume.</para>

<para>Créez la base de données <acronym>KDC</acronym>&nbsp;:
</para>

<screen><userinput><command>kdb5_util create -r <replaceable>[LFS.ORG]</replaceable> -s </command></userinput></screen>

<para>Maintenant, vous devez remplir la base de données avec des principes
(utilisateurs). Pour l'instant, utilisez votre nom de connexion ou root.
</para>

<screen><userinput><command>kadmin.local</command></userinput>
<prompt>kadmin:</prompt><userinput><command>addprinc <replaceable>[nom de connexion]</replaceable></command></userinput></screen>

<para>Le serveur <acronym>KDC</acronym> et toute autre machine disposant de
serveurs Kerberos doivent avoir une clé d'hôte installée&nbsp;:</para>

<screen><prompt>kadmin:</prompt><userinput><command>addprinc --randkey host/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Après avoir choisir les défaut proposés, vous devez exporter les données
dans un fichier keytab&nbsp;:
</para>

<screen><prompt>kadmin:</prompt><userinput><command>ktadd host/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Ceci doit avoir créé un fichier dans
<filename class="directory">/etc</filename> nommé <filename>krb5.keytab</filename>
(Kerberos 5). Ce fichier devrait avoir les droits 600 (lecture écriture pour root
seulement). Protéger les fichiers keytab d'un accès public est crucial pour la
sécurité complète de votre installation Kerberos.
</para>

<para>Éventuellement, vous voudrez ajouter des principes au serveur dans la base
de données et les extaire dans le fichier keytab. Vous le ferez de la même façon
que vous avez créé les principes de l'hôte. Ci-dessous se trouve un exemple&nbsp;:
</para>

<screen><prompt>kadmin:</prompt><userinput><command>addprinc --randkey ftp/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput>
<prompt>kadmin:</prompt><userinput><command>ktadd ftp/<replaceable>[belgarath.lfs.org]</replaceable></command></userinput></screen>

<para>Quittez le programme <command>kadmin</command> (utilisez <command>quit</command>
ou <command>exit</command>) et retournez à l'invite du shell. Lancez le démon
<acronym>KDC</acronym> manuellement pour tester l'installation&nbsp;:</para>

<screen><userinput><command>/usr/sbin/krb5kdc &amp;</command></userinput></screen>

<para>Essayez d'obtenir un ticket avec la commande suivante&nbsp;:
</para>

<screen><userinput><command>kinit <replaceable>[loginname]</replaceable></command></userinput></screen>

<para>Le mot de passe que vous avez ajouté vous sera demandé. Après avoir
obtenu votre ticket, vous pourrez l'afficher avec la commande&nbsp;:</para>

<screen><userinput><command>klist</command></userinput></screen>

<para>Des informations sur le ticket devraient apparaître à l'écran.</para>

<para>Pour tester les fonctionnalités du fichier keytab, lancez la commande
suivante&nbsp;:</para>

<screen><userinput><command>ktutil</command></userinput>
<prompt>ktutil:</prompt><userinput><command>rkt /etc/krb5.keytab</command></userinput>
<prompt>ktutil:</prompt><userinput><command>l</command></userinput></screen>

<para>Ceci devrait afficher une liste de l'hôte principal avec les méthodes
de cryptage utilisées pour accèder au principal.</para>

<para>Arrivé là, si tout fonctionne correctement, vous pouvez être assez
confiant sur l'installation et la configuration du paquetage.
</para>

<para>Installez le script de démarrage <filename>/etc/rc.d/init.d/kerberos</filename>
inclus dans le paquetage <xref linkend="intro-important-bootscripts"/>.</para>

<screen><userinput><command>make install-kerberos</command></userinput></screen>

</sect4>

<sect4><title>Utiliser des programmes client Kerberos</title>

<para>Pour utiliser des programmes client Kerberos (<command>telnet</command>,
<command>ftp</command>, <command>rsh</command>,
<command>rcp</command>, <command>rlogin</command>), vous devez tout d'abord
obtenir un ticket d'authentification. Utilisez le programme <command>kinit</command>
pour obtenir ce ticket. Une fois obtenu, vous pouvez utiliser les programmes
Kerberos pour vous connecter à tout serveur Kerberos du réseau. Aucune
authentification ne vous sera demandé jusqu'à l'expiration de votre ticket
(par défaut un jour) sauf si vous avez spécifié un autre utilisateur en argument
de la ligne de commande d'un programme.</para>

<para>Les programmes Kerberos se connecteront à des démons non Kerberos, vous
avertissant que l'authentication n'est pas cryptée.</para></sect4>


<sect4><title>Utiliser des programmes serveur Kerberos</title>

<para>Utiliser des programmes serveur Kerberos (<command>telnetd</command>,
<command>kpropd</command>, <command>klogind</command> et <command>kshd</command>)
requiert deux étapes supplémentaires de configuration. Tout d'abord, le fichier
<filename>/etc/services</filename> doit être mis à jour pour inclure eklogin et
krb5_prop. Ensuite, <filename>inetd.conf</filename> ou <filename>xinetd.conf</filename>
doivent être modifiés sur chaque serveur activé, généralement en remplaçant le
serveur d'<application>inetutils</application>.</para></sect4>

<sect4><title>Informations supplémentaires</title>

<para>Pour plus d'informations, consultez <ulink
url="http://web.mit.edu/kerberos/www/krb5-1.3/#documentation">Documentation
de krb-&mitkrb-version;</ulink> sur lequel les instructions ci-dessus sont
basées.</para>

</sect4>

</sect3>

</sect2>
