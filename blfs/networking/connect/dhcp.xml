<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY dhcp-download-http " ">
  <!ENTITY dhcp-download-ftp  "ftp://ftp.isc.org/isc/dhcp/&dhcp-version;/dhcp-&dhcp-version;.tar.gz">
  <!ENTITY dhcp-md5sum        "b3a42ece3c7f2cd2e74a3e12ca881d20">
  <!ENTITY dhcp-size          "8.6 Mo">
  <!ENTITY dhcp-buildsize     "109 Mo">
  <!ENTITY dhcp-time          "0.4 SBU">
]>
<sect1 id="dhcp" xreflabel="DHCP-&dhcp-version;">
  <?dbhtml filename="dhcp.html"?>
  <sect1info>
    <othername>$LastChangedBy : krejzi $</othername>
    <date>$Date : 2013-03-31 12:41:33 +0200 (Sun, 31 Mar 2013) $</date>
  </sect1info>
  <title>DHCP-&dhcp-version;</title>
  <indexterm zone="dhcp">
    <primary sortas="a-dhcp">Dhcp</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à ISC DHCP</title>
    <para>Le paquet <application>ISC DHCP</application> contient le client
    et le serveur DHCP. <command>dhclient</command> (le client) est utile pour
    connecter votre ordinateur à un réseau utilisant DHCP pour attribuer des 
    adresses réseau. <command>dhcpd</command> (le serveur) est utile pour
    affecter des adresses réseau sur votre réseau privé.</para>
   &lfs76_checked;
    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&dhcp-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&dhcp-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &dhcp-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &dhcp-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &dhcp-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &dhcp-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif requis&nbsp;: <ulink url="&patch-root;/dhcp-&dhcp-version;-client-script-1.patch"/></para>
      </listitem>
      <listitem>
        <para>Correctif facultatif&nbsp;:
        <ulink url="&patch-root;/dhcp-&dhcp-version;-missing_ipv6-1.patch"/></para>
      </listitem>
    </itemizedlist>
    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/dhcp"/></para>
  </sect2>
  <sect2 role="kernel" id="dhcp-kernel">
    <title>Configuration du noyau</title>
    <para>Vous devez avoir le support Packet Socket:
    </para>
<screen>
<literal>[*] Networking support ---&gt;          [CONFIG_NET]
      Networking options ---&gt;
        &lt;*&gt; Packet socket            [CONFIG_PACKET]</literal>
</screen>
    <para>
      Si vous n'aves par le support IPv6:
    </para>
<screen>
<literal>[*] Networking support ---&gt;          [CONFIG_NET]
      Networking Options ---&gt;
        &lt;*&gt; The IPv6 Protocol ---&gt;   [CONFIG_IPV6]</literal>
</screen>
    <para>
       compilé, ensutie vous devez utiliser le correctif <quote>missing_ipv6</quote>.
    </para>
   <indexterm zone="dhcp dhcp-kernel">
      <primary sortas="d-dhcp">DHCP</primary>
    </indexterm>
  </sect2>
  <sect2 role="installation">
    <title>Installation d'ISC DHCP</title>
    <para>Si vous n'avez pas compilé en dur dans le noyau le support d'IPV6, 
    appliquez le correctif missing_patch</para>
<screen>
<userinput>patch -Np1 -i ../dhcp-&dhcp-version;-missing_ipv6-1.patch</userinput>
</screen>
    <note><para>Faite attention avec les instructions qui suivent. Le simple et le double quotes
       son important car les variables définies sont utilisés mot pour mot dans le code.</para></note>
    <para>Installez <application>ISC DHCP</application> en lançant
    les commandes suivantes&nbsp;:</para>
<screen>
<userinput>patch -Np1 -i ../dhcp-&dhcp-version;-client_script-1.patch &amp;&amp;
CFLAGS="-D_PATH_DHCLIENT_SCRIPT='\"/sbin/dhclient-script\"'         \
        -D_PATH_DHCPD_CONF='\"/etc/dhcp/dhcpd.conf\"'               \
        -D_PATH_DHCLIENT_CONF='\"/etc/dhcp/dhclient.conf\"'"        \
./configure --prefix=/usr                                           \
            --sysconfdir=/etc/dhcp                                  \
            --localstatedir=/var                                    \
            --with-srv-lease-file=/var/lib/dhcpd/dhcpd.leases       \
            --with-srv6-lease-file=/var/lib/dhcpd/dhcpd6.leases     \
            --with-cli-lease-file=/var/lib/dhclient/dhclient.leases \
            --with-cli6-lease-file=/var/lib/dhclient/dhclient6.leases &amp;&amp;
make</userinput>
</screen>
    <para>Pour tester les résultats, lancez&nbsp;: <command>make check</command></para>
    <para>Si vous ne souhaitez installer que le client <application>ISC DHCP</application>,
    lancez les commandes suivantes en tant qu'utilisateur
    <systemitem class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>make -C client install         &amp;&amp;
mv -v /usr/sbin/dhclient /sbin &amp;&amp;
install -v -m755 client/scripts/linux /sbin/dhclient-script</userinput>
</screen>
    <para>
      Passez au <xref linkend="dhclient-config"/> pour configurer le client
    </para>
    <para>
      Si vous ne voulez installer que le serveur <application>ISC DHCP</application>,
      lancez la commande suivante en tant qu'utilisateur
      <systemitem class="username">root</systemitem>&nbsp;:
    </para>
<screen role="root">
<userinput>make -C server install</userinput>
</screen>
 
    <para>
      Passez au <xref linkend="dhcpd-config"/> pour configurer le serveur.
    </para>
    <para>
      Vous pouvez aussi installer tout le paquet, incluant le client, le
      serveur, le relai, les bibliothèques statiques et les en-têtes de
      développement, en lançant les commandes suivantes en tant qu'utilisateur
      <systemitem class="username">root</systemitem>&nbsp;:
    </para>
<screen role="root">
<userinput>make install                   &amp;&amp;
mv -v /usr/sbin/dhclient /sbin &amp;&amp;
install -v -m755 client/scripts/linux /sbin/dhclient-script</userinput>
</screen>
  </sect2>
  <sect2 role="configuration">
    <title>Configuration d'ISC DHCP</title>
    <sect3 id="dhcp-config">
      <title>Fichiers de configuration</title>
 
      <para>
        <filename>/etc/dhcp/dhclient.conf</filename> and
        <filename>/etc/dhcp/dhcpd.conf</filename>
      </para>
      <indexterm zone="dhcp dhcp-config">
        <primary sortas="e-etc-dhcp-dhclient.conf">/etc/dhcp/dhclient.conf</primary>
      </indexterm>
      <indexterm zone="dhcp dhcp-config">
        <primary sortas="e-etc-dhcp-dhcpd.conf">/etc/dhcp/dhcpd.conf</primary>
      </indexterm>
    </sect3>
    <sect3 id="dhclient-config">
      <title>Configuration du client</title>
      <para>
        Créez un <filename>/etc/dhcp/dhclient.conf</filename> de base en
        lançant la commande suivante en tant qu'utilisateur
        <systemitem class="username">root</systemitem>&nbsp;:
      </para>
<screen role="root">
<userinput>cat &gt; /etc/dhcp/dhclient.conf &lt;&lt; "EOF"
<literal># Begin /etc/dhcp/dhclient.conf
#
# Basic dhclient.conf(5)
#prepend domain-name-servers 127.0.0.1;
request subnet-mask, broadcast-address, time-offset, routers,
        domain-name, domain-name-servers, domain-search, host-name,
        netbios-name-servers, netbios-scope, interface-mtu,
        ntp-servers;
require subnet-mask, domain-name-servers;
#timeout 60;
#retry 60;
#reboot 10;
#select-timeout 5;
#initial-interval 2;
# End /etc/dhcp/dhclient.conf</literal>
EOF</userinput>
</screen>
 
      <para>
        Voir <command>man 5 dhclient.conf</command> pour des options supplémentaires.
      </para>
      <para>
        Maintenant, créez le répertoire
        <filename class="directory">/var/lib/dhclient</filename> qui contiendra
        les interfaces client DHCP en lançant la
        commande suivante en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:
      </para>
<screen role="root">
<userinput>install -v -dm 755 /var/lib/dhclient</userinput>
</screen>
 
      <para>
        À cet instant, vous pouvez tester si <command>dhclient</command> se
        comporte comme prévu en lançant la commande suivante en tant qu'utilisateur
        <systemitem class="username">root</systemitem>&nbsp;:
      </para>
 
<screen role="root">
<userinput>dhclient <replaceable>&lt;eth0&gt;</replaceable></userinput>
</screen>
 
      <para>
        Remplacez <replaceable>&lt;eth0&gt;</replaceable> par votre interface
        désirée. Si vous voulez une sortie plus verbeuse, ajoutez le paramètre
        <command>-v</command> à la commande ci-dessus.
      </para>
      <para id="dhclient-service">
        Si vous voulez configurer des interfaces réseaux au démarrage en
        utilisant <command>dhclient</command>, vous devez installer le script
        <filename>/lib/services/dhclient</filename> inclus dans le paquet
        <xref linkend="bootscripts"/>&nbsp;:
      </para>
<screen role="root">
<userinput>make install-service-dhclient</userinput>
</screen>
      <indexterm zone="dhcp dhclient-service">
        <primary sortas="f-dhclient">dhclient (service script)</primary>
      </indexterm>
 
      <para id="dhclient-ifconfig">
        Ensuite, créez le fichier de configuration <filename>/etc/sysconfig/ifconfig.eth0</filename>
        avec les commandes suivantes en tant qu'utilisateur
        <systemitem class="username">root</systemitem>&nbsp;:
      </para>
<screen role="root">
<userinput>cat &gt; /etc/sysconfig/ifconfig.eth0 &lt;&lt; "EOF"
<literal>ONBOOT="yes"
IFACE="eth0"
SERVICE="dhclient"
DHCP_START=""
DHCP_STOP=""
# Set PRINTIP="yes" to have the script print
# the DHCP assigned IP address
PRINTIP="no"
# Set PRINTALL="yes" to print the DHCP assigned values for
# IP, SM, DG, and 1st NS. This requires PRINTIP="yes".
PRINTALL="no"</literal>
EOF</userinput>
</screen>
      <indexterm zone="dhcp dhclient-ifconfig">
        <primary sortas="e-etc-sysconfig-...-dhclient">/etc/sysconfig/ifconfig.eth0</primary>
      </indexterm>
      <para>
        Ajustez le fichier pour correspondre à vos besoins.
      </para>
 
      <para>
        Pour plus d'informations sur les bonnes valeurs de <envar>DHCP_START</envar> 
        <envar>DHCP_STOP</envar>, voir
        <command>man 8 dhclient</command>.
      </para>
 
    </sect3>
    <sect3 id="dhcpd-config">
      <title>Configuration du serveur</title>
      <para>
        Remarquez que vous n'avez du serveur DHCP que si vous voulez donner des
        adresses LAN sur votre réseau. Le client DHCP n'a pas besoin de
        serveur pour bien fonctionner.
      </para>
 
      <para>
        Commencez par créer <filename>/etc/dhcp/dhcpd.conf</filename> en lançant
        la commande suivante en tant qu'utilisateur
        <systemitem class="username">root</systemitem>&nbsp;:
      </para>
<screen role="root">
<userinput>cat &gt; /etc/dhcp/dhcpd.conf &lt;&lt; "EOF"
<literal># Begin /etc/dhcp/dhcpd.conf
#
# Example dhcpd.conf(5)
# Use this to enble / disable dynamic dns updates globally.
ddns-update-style none;
# option definitions common to all supported networks...
option domain-name "example.org";
option domain-name-servers ns1.example.org, ns2.example.org;
default-lease-time 600;
max-lease-time 7200;
# This is a very basic subnet declaration.
subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;
}
# End /etc/dhcp/dhcpd.conf</literal>
EOF</userinput>
</screen>
 
      <para>
        Ajustez le fichier pour correspondre à vos besoins. Voir
        <command>man 5 dhcpd.conf</command> pour des options supplémentaires.
      </para>
 
      <para>
        Créez maintenant le répertoire <filename class="directory">/var/lib/dhcpd</filename>
        qui contiendra les interfaces du serveur DHCP en lançant la
        commande suivante en tant qu'utilisateur
        <systemitem class="username">root</systemitem>&nbsp;:
      </para>
<screen role="root">
<userinput>install -v -dm 755 /var/lib/dhcpd</userinput>
</screen>
       <para>
        Si vous voulez démarrer le serveur DHCP au démarrage, installez
        le script de démarrage <filename>/etc/rc.d/init.d/dhcpd</filename> inclus
        dans le paquet <xref linkend="bootscripts"/>&nbsp;:
      </para>
<screen role="root">
<userinput>make install-dhcpd</userinput>
</screen>
      <indexterm zone="dhcp dhcpd-config">
        <primary sortas="f-dhcpd">dhcpd</primary>
      </indexterm>
      <para>
        Vous devrez éditer 
        <filename>/etc/sysconfig/dhcpd</filename> pour régler l'interface
        sur laquelle <command>dhcpd</command> adressera ses requêtes
        DHCP.
      </para>
     </sect3>
 
   </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          dhclient, dhclient-script, dhcpd, dhcrelay et omshell
        </seg>
        <seg>
          libdhcpctl.a, libdst.a et libomapi.a
        </seg>
        <seg>
          /etc/dhcp,
	  /usr/include/dhcpctl,
          /usr/include/isc-dhcp,
          /usr/include/omapip,
          /var/lib/dhclient et
          /var/lib/dhcpd
        </seg>
      </seglistitem>
    </segmentedlist>
    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="dhclient">
        <term><command>dhclient</command></term>
        <listitem>
          <para>est l'implémentation du client DHCP.</para>
          <indexterm zone="dhcp dhclient">
            <primary sortas="b-dhclient">dhclient</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="dhclient-script">
        <term><command>dhclient-script</command></term>
        <listitem>
          <para>est utilisé par dhclient pour (re)configurer les interfaces. 
          Il peut faire des modifications supplémentaires en appelant un
          dhclient-{entry,exit}-hooks personnalisé.</para>
          <indexterm zone="dhcp dhclient-script">
            <primary sortas="b-dhclient-script">dhclient-script</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="dhcpd">
        <term><command>dhcpd</command></term>
        <listitem>
          <para>implémente les requêtes <foreignphrase>Dynamic Host Configuration
          Protocol</foreignphrase> (DHCP, protocole de configuration d'hôte
          dynamique) et <foreignphrase>Internet Bootstrap Protocol</foreignphrase> (BOOTP) 
          pour les adresses réseaux.</para>
          <indexterm zone="dhcp dhcpd">
            <primary sortas="b-dhcpd">dhcpd</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="dhcrelay">
        <term><command>dhcrelay</command></term>
        <listitem>
          <para>offre un moyen d'accepter des requêtes DHCP et BOOTP sur un 
          sous-réseau sans serveur DHCP et les relayer vers le serveur DHCP d'un
          autre sous-réseau.</para>
          <indexterm zone="dhcp dhcrelay">
            <primary sortas="b-dhcrelay">dhcrelay</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="omshell">
        <term><command>omshell</command></term>
        <listitem>
          <para>fournit une façon interactive de se connecter, de chercher et
          éventuellement de modifier, l'état du serveur ISC DHCP via OMAPI
          <foreignphrase>Object Management API</foreignphrase>, 2l'API de gestion
          des objets).</para>
          <indexterm zone="dhcp omshell">
            <primary sortas="b-omshell">omshell</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
