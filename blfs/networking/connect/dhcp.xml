<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!-- isc have a weird way of offering the tarballs and without dots in version!
    FIXME - change hardcoded 423s in http url and version in ftp when upgrading -->
  <!ENTITY dhcp-download-http "http://www.isc.org/software/dhcp/423/download/dhcp-423targz?download=">
  <!ENTITY dhcp-download-ftp "ftp://ftp.isc.org/isc/dhcp/4.2.3/dhcp-&dhcp-version;.tar.gz">
  <!ENTITY dhcp-md5sum "a06649ec5336d284fc86a0232c0edd63">
  <!ENTITY dhcp-size "9.1 Mio">
  <!ENTITY dhcp-buildsize "185 Mio">
  <!ENTITY dhcp-time "0.7 SBU">
]>

<sect1 id="dhcp" xreflabel="DHCP-&dhcp-version;">
  <?dbhtml filename="dhcp.html"?>

  <sect1info>
    <othername>$LastChangedBy: ken $</othername>
    <date>$Date: 2011-12-01 06:09:32 +0100 (jeu. 01 dÃ©c. 2011) $</date>
  </sect1info>

  <title>DHCP-&dhcp-version;</title>

  <indexterm zone="dhcp">
    <primary sortas="a-dhcp">Dhcp</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à DHCP</title>

    <para>Le paquet <application>DHCP</application> contient le client
    et le serveur DHCP. <command>dhclient</command> (le client) est utile pour
    connecter votre ordinateur à un réseau utilisant DHCP pour attribuer des 
    adresses réseau. <command>dhcpd</command> (le serveur) est utile pour
    affecter des adresses réseau sur votre réseau privé.</para>

    &lfs70_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&dhcp-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&dhcp-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &dhcp-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &dhcp-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &dhcp-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &dhcp-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing='compact'>
      <listitem>
        <para>Correctif recommandé (pour le client)&nbsp;:
        <ulink url="&patch-root;/dhcp-&dhcp-version;-iproute2-1.patch"/></para>
      </listitem>
      <listitem>
        <para>Correctif facultatif&nbsp;:
        <ulink url="&patch-root;/dhcp-&dhcp-version;-missing_ipv6-1.patch"/></para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de DHCP</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="net-tools"/> est requis lors de l'exécution
    par <command>dhclient</command> si vous n'utilisez pas le correctif iproute2.</para>


    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/dhcp"/></para>

  </sect2>

  <sect2 role="kernel" id='dhcp-kernel'>
    <title>Configuration du noyau</title>

    <para>Vous devez avoir compilé en dur le support de Packet Socket
    (Networking Support &rArr; Networking Options &rArr; Packet Socket). Si vous
    n'avez pas compilé en dur le support d'IPv6 (Networking Support &rArr;
    Networking Options &rArr; The IPv6 Protocol), vous utilisez le correctif
    missing_ipv6.</para>


    <indexterm zone="dhcp dhcp-kernel">
      <primary sortas="d-dhcp">DHCP</primary>
    </indexterm>

  </sect2>

  <sect2 role="installation">
    <title>Installation de DHCP</title>

    <para>Si vous n'avez pas compilé en dur dans le noyau le support d'IPV6, 
    appliquez le correctif missing_patch</para>

<screen><userinput>patch -Np1 -i ../dhcp-&dhcp-version;-missing_ipv6-1.patch</userinput></screen>

    <para>Si vous n'installez que le client, appliquez le correctif iproute2
    sauf si vous prévoyez d'installer <application>net-tools</application> et
    si vous ne souhaitez utiliser que le client&nbsp;:</para>

<screen><userinput>patch -Np1 -i ../dhcp-&dhcp-version;-iproute2-1.patch</userinput></screen>

    <para>Installez <application>DHCP</application> en lançant
    les commandes suivantes&nbsp;:</para>

<screen><userinput>sed -i 's%\(^sbindir =\).*%\1 @prefix@@sbindir@%' server/Makefile.in &amp;&amp;
./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
 --sbindir=/sbin \
  --with-srv-lease-file=/var/state/dhcp/dhcpd.leases \
   --with-srv6-lease-file=/var/state/dhcp/dhcpd6.leases \
    --with-cli-lease-file=/var/state/dhclient.leases \
     --with-cli6-lease-file=/var/state/dhclient6.leases  &amp;&amp;
sed -i 's/-Werror//' {client,common,dst,omapip,relay,server,tests}/Makefile</userinput></screen>

    <para>Si vous ne souhaitez construire que le serveur, entrez&nbsp;:</para>
    
<screen><userinput>sed -i 's/ client//' Makefile</userinput></screen>

    <para>Si vous ne souhaitez construire que le client, entrez&nbsp;:</para>
    
<screen><userinput>sed -i 's/ dhcpctl relay server//' Makefile</userinput></screen>

    <para>Construisez la/les variante(s) choisie(s) avec&nbsp;:</para>
    
<screen><userinput>make</userinput></screen>

    <para>Pour tester les résultats, lancez&nbsp;: <command>make check</command></para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install</userinput></screen>

    <para>Le <filename>/etc/dhcpd.conf</filename> (serveur) et
    <filename>/etc/dhclient.conf</filename> (client) fournis sont des exemples 
    valant pour des systèmes <literal>BSD</literal> spécifiques. Il est peu 
    probable qu'ils s'adaptent à vos besoins, mais vous pourriez souhaiter les 
    lire pour pour récupérer des idées avant de les effacer ou de les déplacer 
    vers un autre endroit.</para>

 
   <para>Maintenant, créez le/les répertoire(s) pour les interfaces.</para>

    <para>Pour le serveur&nbsp;:</para>

<screen role="root"><userinput>mkdir -pv /var/state/dhcp</userinput></screen>

    <para>Pour le client&nbsp;:</para>
<screen role="root"><userinput>mkdir -pv /var/state</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>sed -i 's%\(^sbindir =\).*%\1 @prefix@@sbindir@%' server/Makefile.in</command>
    Cette commande déplace le programme <command>dhcp</command> vers
    <filename class='directory'>/usr/sbin</filename> au lieu de
    <filename class='directory'>/sbin</filename> car il est inutile pendant que
    le serveur démarre.</para>

    <para><command>--sbindir=/sbin</command> Déplace le programme <command>dhclient</command>
    vers <filename class='directory'>/sbin</filename> au lieu de
    <filename class='directory'>/usr/sbin</filename> pour qu'il soit disponible
    au moment du démarrage, par exemple si <filename class='directory'>/usr</filename> 
    sera un montage <literal>nfs</literal>.</para>

    <para><command>--with-*-lease-files=...</command> Par défaut, les fichiers de lease
    (interfaces) vont dans <filename class='directory'>/var/db</filename>, ce
    qui est un anachronisme.</para>

    <para><command>sed -i 's/-Werror//' {client,common,...}/Makefile</command> -
    les Makefiles de ce paquet ajoutent <literal>-Werror</literal> à
    <literal>CFLAGS</literal>.  Sur les versions récentes de <application>gcc</application>
    davantage d'éléments, en particulier des variables inutiles, créent des
    avertissements. Le drapeau <literal>-Werror</literal> fait casser la construction
    par les avertissements, donc nous le supprimons là où il le faut.</para>

    <para><command>sed -i 's/ something//' Makefile</command> - ceci arrête
    la construction à l'entrée dans le/les répertoire(s) nommé(s) ici.</para>

    <para><option>rm -v /usr/lib/lib{dhcpctl,dst,omapi}.a</option> - il n'y a
    aucun moyen facile d'empêcher l'installation de ces bibliothèques statiques.
    Mais on ne s'en sert que lors de la construction du paquet. <filename>libdhcpctl.a</filename>
    n'est installé que si vous construisez le serveur.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de DHCP</title>

    <sect3 id='dhcp-config'>
      <title>Fichiers de configuration</title>

      <para><filename>/etc/dhclient.conf</filename> et
      <filename>/etc/dhcpd.conf</filename></para>

      <indexterm zone="dhcp dhcp-config">
        <primary sortas="e-etc-dhclient.conf">/etc/dhclient.conf</primary>
      </indexterm>

      <indexterm zone="dhcp dhcp-config">
        <primary sortas="e-etc-dhcpd.conf">/etc/dhcpd.conf</primary>
      </indexterm>

    </sect3>

    <sect3 id='dhcp-init'>
      <title>Informations de configuration</title>

      <para>Vous pouvez trouver des informations sur la configuring du client
      DHCP au chapitre <xref linkend="basicnet-connect"/>.</para>

      <para>Remarquez que vous n'avez besoin du serveur DHCP que si voulez gérer 
      des adresses LAN sur votre réseau. Le client DHCP n'a pas besoin que ce
      script soit utilisé. Remarquez aussi que ce script est codé pour l'interface
      <emphasis role="strong">eth1</emphasis>, ce qui peut se changer selon votre
      configuration matérielle.</para>

      <para>Installez le script de démarrage <filename>/etc/rc.d/init.d/dhcp</filename>
      inclu dans le paquet <xref linkend="bootscripts"/>.</para>

      <indexterm zone="dhcp dhcp-init">
        <primary sortas="f-dhcp">dhcpd</primary>
      </indexterm>

<screen role="root"><userinput>make install-dhcp</userinput></screen>

      <para>Le fichier lease doit exister au démarrage. La commande suivante
      satisfera cette exigence&nbsp;:</para>

<screen role="root"><userinput>touch /var/state/dhcp/dhcpd.leases</userinput></screen>

      <para>Les commandes suivantes créeront un fichier de configuration de base
      d'un serveur DHCP. Ce sont plusieurs options que vous pourriez vouloir
      ajouter (des informations passées au client DHCP) et ils sont
      traités dans les pages de man de <filename>dhcp.conf</filename>.</para>

<screen role="root"><userinput>cat &gt; /etc/dhcpd.conf &lt;&lt; "EOF"
<literal>default-lease-time 72000;
max-lease-time 144000;


subnet <replaceable>&lt;192.168.5.0&gt;</replaceable> netmask <replaceable>&lt;255.255.255.0&gt;</replaceable> {
  range <replaceable>&lt;192.168.5.10&gt; &lt;192.168.5.240&gt;</replaceable>;
  option broadcast-address <replaceable>&lt;192.168.5.255&gt;</replaceable>;
  option routers <replaceable>&lt;192.168.5.1&gt;</replaceable>;
}</literal>
EOF</userinput></screen>

      <para>Vous devriez modifier toutes les adresses pour correspondre à votre
      votre contexte.</para>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>dhcpd, dhcrelay, dhclient, dhclient-script, et omshell</seg>
        <seg>libbdhcpctl.a, libdst.a, libomapi.a</seg>
        <seg>/var/state/dhcp, /usr/include/omapip, et /usr/include/isi-dhcp</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="dhclient">
        <term><command>dhclient</command></term>
        <listitem>
          <para>est l'implémentation du client DHCP.</para>
          <indexterm zone="dhcp dhclient">
            <primary sortas="b-dhclient">dhclient</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dhclient-script">
        <term><command>dhclient-script</command></term>
        <listitem>
          <para>est utilisé par dhclient pour (re)configurer les interfaces. 
          Il peut faire des modifications supplémentaires en appelant un
          dhclient-{entry,exit}-hooks personnalisé.</para>
          <indexterm zone="dhcp dhclient-script">
            <primary sortas="b-dhclient-script">dhclient-script</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dhcpd">
        <term><command>dhcpd</command></term>
        <listitem>
          <para>implémente les requêtes <foreignphrase>Dynamic Host Configuration
          Protocol</foreignphrase> (DHCP, protocole de configuration d'hôte
          dynamique) et <foreignphrase>Internet Bootstrap Protocol</foreignphrase> (BOOTP) 
          pour les adresses réseaux.</para>
          <indexterm zone="dhcp dhcpd">
            <primary sortas="b-dhcpd">dhcpd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dhcrelay">
        <term><command>dhcrelay</command></term>
        <listitem>
          <para>offre un moyen d'accepter des requêtes DHCP et BOOTP sur un 
          sous-réseau sans serveur DHCP et les relayer vers le serveur DHCP d'un
          autre sous-réseau.</para>
          <indexterm zone="dhcp dhcrelay">
            <primary sortas="b-dhcrelay">dhcrelay</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="omshell">
        <term><command>omshell</command></term>
        <listitem>
          <para>fournit une façon interactive de se connecter, de chercher et
          éventuellement de modifier, l'état du serveur ISC DHCP via OMAPI
          <foreignphrase>Object Management API</foreignphrase>, 2l'API de gestion
          des objets).</para>
          <indexterm zone="dhcp omshell">
            <primary sortas="b-omshell">omshell</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
