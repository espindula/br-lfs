<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY logrotate-download-http "http://fedorahosted.org/releases/l/o/logrotate/logrotate-&logrotate-version;.tar.gz">
  <!ENTITY logrotate-download-ftp  " ">
  <!ENTITY logrotate-md5sum        "99e08503ef24c3e2e3ff74cc5f3be213">
  <!ENTITY logrotate-size          "64 Ko">
  <!ENTITY logrotate-buildsize     "1.3 Mo">
  <!ENTITY logrotate-time          "less than 0.1 SBU">
]>
<sect1 id="logrotate" xreflabel="logrotate-&logrotate-version;">
  <?dbhtml filename="logrotate.html"?>
  <sect1info>
    <othername>$LastChangedBy: bdubbs $</othername>
    <date>$Date: 2014-06-15 13:40:02 -0500 (Sun, 15 Jun 2014) $</date>
  </sect1info>
  <title>Logrotate-&logrotate-version;</title>
  <indexterm zone="logrotate">
    <primary sortas="a-logrotate">logrotate</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à Logrotate</title>
    <para>
      Le paquet <application>logrotate</application> permet la rotation automatique, la compression,
      la suppression et l'envoi par mail des fichiers de log.
    </para>
    &lfs75_checked;
    <bridgehead renderas="sect3">Information sur le paquet </bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Téléchargement (HTTP) : <ulink url="&logrotate-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Téléchargement (FTP) : <ulink url="&logrotate-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle MD5 du téléchargement : &logrotate-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille du téléchargement : &logrotate-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation de l'espace disque requis : &logrotate-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimation du temps de construction : &logrotate-time;
        </para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de Logrotate</bridgehead>
    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="popt"/>
    </para>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="fcron"/> (exécution)
    </para>
    <bridgehead renderas="sect4">Facultative</bridgehead>
    <para role="optional">
      Un <xref linkend="server-mail"/> (exécution)
    </para>
    <para condition="html" role="usernotes">Notes utilisateur :
      <ulink url="&blfs-wiki;/logrotate"/>
    </para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de Logrotate</title>
    <para>
      Installez <application>logrotate</application> en lançant les commandes suivantes :
      command:
    </para>
<screen>
<userinput>make</userinput>
</screen>
    <para>
      Pour tester le résultat, tapez : <command>make test</command>. 
    </para>
    <para>
      Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> :
    </para>
<screen role="root">
<userinput>make MANDIR=/usr/share/man install</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explications des commandes</title>
    <para>
      <envar>MANDIR=/usr/share/man</envar> : Assure que les pages de man sont installées dans le bon endroit.
    </para>
  </sect2>
  <sect2 role="configuration">
     <title>Configuration de Logrotate</title>
     <para><application>Logrotate</application> nécessite un fichier de configuration,
     qui peut être passé en argiment à la commande quand elle est lancée. Créez le fichier en tant qu'utilisateur
     <systemitem class="username">root</systemitem> :</para>
<screen role="root">
<userinput>cat &gt; /etc/logrotate.conf &lt;&lt; EOF
# Begin of /etc/logrotate.conf
# Rotate log files weekly
weekly
# Don't send mail to anybody
nomail
# If the log file is empty, it will not be rotated
notifempty
# Number of backups that will be kept
# This will keep the 2 newest backups only
rotate 2
# Create new empty files after rotating old ones
# This will create empty log files, with owner
# set to root, group set to sys, and permissions 644
create 0664 root sys
# Compress the backups with gzip
compress
# No packages own lastlog or wtmp -- rotate them here
/var/log/wtmp {
    monthly
    create 0664 root utmp
    rotate 1
}
/var/log/lastlog {
    monthly
    rotate 1
}
# Some packages drop log rotation info in this directory
# so we include any file in it.
include /etc/logrotate.d
# End of /etc/logrotate.conf
EOF
chmod -v 0644 /etc/logrotate.conf</userinput>
</screen>
    <para>Maintenant créez le répertoire <filename class='directory'>/etc/logrotate.d</filename>
    en tant qu'utilisateur <systemitem class="username">root</systemitem>:</para>
<screen role="root">
<userinput> mkdir -p /etc/logrotate.d</userinput>
</screen>
  <para>A ce point des commandes de rotation de log supplémentaires peuvet être entrées, typiquement dans le répertoire
  <filename class='directory'>/etc/logrotate.d</filename>.
  Par exemple:</para>
<screen role="root">
<userinput>cat &gt; /etc/logrotate.d/sys.log &lt;&lt; EOF
/var/log/sys.log {
   # If the log file is larger than 100kb, rotate it
   size   100k
   rotate 5
   weekly
   postrotate
      /bin/killall -HUP syslogd
   endscript
}
EOF
chmod -v 0644 /etc/logrotate.d/sys.log</userinput>
</screen>
 <para>Vous pouvez indiquer des fichiers multiples dans une seule entrée:</para>

<screen role="root"><userinput>cat &gt; /etc/logrotate.d/example.log &lt;&lt; EOF
file1
file2
file3 {
   ...
   postrotate
    ...
   endscript
}
EOF

chmod -v 0644 /etc/logrotate.d/example.log</userinput></screen>
  <para>Vous pouvez utiliser dans la même ligne la liste de fichiers: file1 file2 file3.
    Regardez la page de man de logrotate ou 
  <ulink url='http://www.techrepublic.com/article/manage-linux-log-files-with-logrotate/'/>
  pour plus d'exemples.</para>
  <para>La commande <command>logrotate /etc/logrotate.conf</command> peut être lancées manuellement, cependant, la commande
   peut être lancées quotidiennement.
  D'autres commandes utiles sont <command>logrotate -d /etc/logrotate.conf</command>
  pour le déboguage et <command>logrotate -f /etc/logrotate.conf</command>
  pour forcer les commandes à être lancée immédiatement. En combinant avec les options
  <option>-df</option>, vous pouvez déboguer les effets des commandes forcées.
  Pendant le déboguage, la commande est seulement simulée, pas vraiment lancée, donc, éventuellement
  des erreurs qui n'existent pas apparaissent, quand des fichiers intermédiaires sont créés,
  car ils ne sont pas actuellement créés.</para>
  <para>Pour initialiser <xref linkend='fcron'/> pour lancer
  <command>logrotate ...</command> quotidienneement à 3h00, le crontab de root doit être édité
  pour ajouter:</para>
<screen><literal>0 3 * * *   /usr/sbin/logrotate /etc/logrotate.conf</literal></screen>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg> logrotate </seg>
        <seg> Aucun </seg>
        <seg> Aucun </seg>
      </seglistitem>
    </segmentedlist>
    <variablelist>
      <bridgehead renderas="sect3">Description courte</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="logrotate-prog">
        <term><command>logrotate</command></term>
        <listitem>
          <para>
            fournit des fonctions de maintenance de log défini dans les fichiers de configuration.
          </para>
          <indexterm zone="logrotate logrotate-prog">
            <primary sortas="b-logrotate-prog">logrotate</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
