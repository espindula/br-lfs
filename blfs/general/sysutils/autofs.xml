<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY autofs-patch-dir     "http://ftp.kernel.org/pub/linux/daemons/autofs/v5">
  <!ENTITY autofs-download-http "http://ftp.kernel.org/pub/linux/daemons/autofs/v5/autofs-&autofs-version;.tar.bz2">
  <!ENTITY autofs-download-ftp  "ftp://ftp.kernel.org/pub/linux/daemons/autofs/v5/autofs-&autofs-version;.tar.bz2">
  <!ENTITY autofs-md5sum        "27839fe6fa8105b2b7d31bc922fd7cf6">
  <!ENTITY autofs-size          "221 Kio">
  <!ENTITY autofs-buildsize     "9 Mio">
  <!ENTITY autofs-time          "moins de 0.1 SBU">
]>

<sect1 id="autofs" xreflabel="Autofs-&autofs-version;">
  <?dbhtml filename="autofs.html"?>

  <sect1info>
    <othername>$LastChangedBy: bdubbs $</othername>
    <date>$Date: 2011-11-09 18:37:35 +0100 (mer. 09 nov. 2011) $</date>
  </sect1info>

  <title>Montage automatique des systèmes de fichiers</title>

  <indexterm zone="autofs">
    <primary sortas="a-Autofs">Autofs</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à Autofs</title>

    <para>Le paquet <application>Autofs</application> contient des outils
    pour les utilisateurs fonctionnant avec le noyau pour monter et démonter des
    systèmes de fichiers amovibles. Son utilisation première consiste dans le
    montage de systèmes de fichiers réseaux externes comme <!-- NFS (voir
    <xref linkend="nfs-utils"/>) ou--> Samba (voir <xref linkend="samba3"/>)
     à la demande.</para>

    <para>Il peut aussi être utile pour permettre aux utilisateurs de monter des
    disquettes, des cdroms et d'autres périphériques de stockage amovibles sans
    devoir faire appel à l'administrateur szstème pour monter les périphériques,
    bien que cette possibilité est en général offerte aujourd'hui par HAL (voir
   <xref linkend="hal"/>). Il se peut que cela ne soit pas idéal pour toutes les
    installations, donc gardez à l'esprit les risques avant d'implémenter cette
    fonctionnalité.</para>

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&autofs-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&autofs-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &autofs-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &autofs-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &autofs-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &autofs-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>

    <para>Correctifs recommandés&nbsp;: Il y a des correctifs fréquents appliqués
    à <application>Autofs</application>. Une des méthodes que vous pouvez utiliser
    pour récupérer les correctifs actuels exige d'installer préalablement le
    paquet <xref linkend="wget"/>. Après vous être assuré que la commande
    <command>wget</command> est installée dans un répertoire identifié dans la
    variable <envar>PATH</envar>, placez-vous dans le même répertoire que le 
    fichier tar principal et lancez les commandes suivantes&nbsp;:</para>
 
<screen><userinput>wget &autofs-patch-dir;/patch_order-&autofs-version; &amp;&amp;
sed 's;autofs;&autofs-patch-dir;/autofs;' \
    patch_order-&autofs-version; &gt; wget-list &amp;&amp;
wget -i wget-list</userinput></screen>

    <bridgehead renderas="sect3">Dépendances d'Autofs</bridgehead>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="openldap"/> et
    <xref linkend="cyrus-sasl"/></para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/autofs"/></para>

  </sect2>

  <sect2 role="kernel" id="autofs-kernel">
    <title>Configuration du noyau</title>

    <indexterm zone="autofs autofs-kernel">
      <primary sortas="d-Automounter">Automounter</primary>
    </indexterm>

    <para>Vérifiez que le support du noyau a été construit en dur ou en module
    dans les endroits suivants&nbsp;:</para>

<screen><literal>File systems &rArr;
    Kernel automounter version 4 support  Y or M
    Network File Systems &rArr;
        NFS file system support     Y or M (optional)
        SMB file system support     Y or M (optional)</literal></screen>

    <para>Recompilez et installez le nouveau noyau si nécessaire.</para>

  </sect2>

  <sect2 role="installation">

    <title>Installation d'Autofs</title>

    <para>Installez <application>Autofs</application> en lançant les commandes
    suivantes&nbsp;:</para>

<screen><userinput>for f in `cat ../patch_order-&autofs-version;`; do
  patch -Np1 -i ../$f
done &amp;&amp;
./configure --prefix=/ --mandir=/usr/share/man &amp;&amp;
make</userinput></screen>

    <para>Ce paquet n'est pas fourni avec une suite de tests.</para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install &amp;&amp;
ln -sf  ../init.d/autofs /etc/rc.d/rcsysinit.d/S52autofs</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><command>for f in `cat ../patch_order-&autofs-version;`; do
    patch -Np1 -i ../$f;  done</command>>:nbsp;: Cette commande applique tous les
    correctifs téléchargés plus haut dans le bon ordre.</para>

    <para><command>ln -sf  ../init.d/autofs
    /etc/rc.d/rcsysinit.d/S52autofs</command>>:nbsp;: Cette commande règle le lien
    pour démarrer correctement autofs au démarrage.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration d'Autofs</title>

    <sect3 id="autofs-config">
      <title>Fichiers de configuration</title>

      <para><filename>/etc/sysconfig/autofs.conf</filename>,
      <filename>/etc/auto.master</filename>,
      <filename>/etc/auto.misc</filename> et
      <filename>/etc/auto.net</filename></para>

      <indexterm zone="autofs autofs-config" >
        <primary sortas="e-etc-sysconfig-autofs.conf">/etc/sysconfig/autofs.conf</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.master">/etc/auto.master</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.misc">/etc/auto.misc</primary>
      </indexterm>

      <indexterm zone="autofs autofs-config">
        <primary sortas="e-etc-auto.net">/etc/auto.net</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informations de configuration</title>

      <para>Le processus d'installation crée <filename>auto.master</filename>,
      <filename>auto.misc</filename>,  <filename>auto.smb</filename> et
      <filename>auto.net</filename>. Remplace thez le fichier
      <filename>auto.master</filename> avec les commandes suivantes&nbsp;:</para>

<screen role="root"><userinput>mv /etc/auto.master /etc/auto.master.bak &amp;&amp;
cat &gt; /etc/auto.master &lt;&lt; "EOF"
<literal># Début de /etc/auto.master

/media/auto  /etc/auto.misc  --ghost
#/home        /etc/auto.home

# Fin /etc/auto.master</literal>
EOF</userinput></screen>

      <para>Ce fichier crée un nouveau répertoire de médias, <filename>/media/auto</filename>
      qui englobera tous les répertoires existants du même nom. Dans l'exemple,
      le fichier <filename>/etc/auto.misc</filename>, contient une ligne&nbsp;:</para>

<screen>cd   -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom</screen>

      <para>ce qui montera un cdrom en tant que <filename>/media/auto/cd</filename> si 
      ce répertoire est accessible. L'option <option>--ghost</option> dit à
      l'automounteur de créer des versions <quote>fantômes</quote> (c'est-à-dire
      des répertoires vides) de tous les points de montage listés dans le
      fichier de configuration, que les systèmes de fichiers soient effectivement 
      montés ou pas. C'est très pratique et fortement recommandé car cela vous
      affichera les systèmes de fichiers qu'on peut monter automatiquement comme
      des répertoires existants, même quand leur système de fichiers n'est pas 
      actuellement monté. Sans l'option <option>--ghost</option>, vous devrez
      vous souvenir des noms des répertoires. Dès que vous essaierez d'accéder à
      l'un d'entre eux, le répertoire sera créé et le szstème de fichiers sera 
      monté. Quand le système de fichiers est de nouveau démonté, le répertoire est
      lui aussi détruit, sauf si on a donné l'option <option>--ghost</option>.</para>
      <note>
        <para>Une méthode alternative serait de spécifier un autre emplacement 
        d'automontage tel que <filename
        class='directory'>/var/lib/auto/cdrom</filename> et de créar un lien
        symbolique de <filename class='directory'>/media/cdrom</filename>
        vers l'emplacement de l'automontage.</para>
      </note>

      <para>Le fichier <filename>auto.misc</filename> doit être configuré
      pour votre matériel. Le fichier de configuration chargé chargerait votre 
      cdrom si <filename>/dev/cdrom</filename> est actif ou s'il peut être
      édité pour s'adapter à votre configuration de périphériques. Des exemples
      pour les disquettes sont disponibles dans le fichier et facilement
      activables. La documentation de ce fichier est disponible en utilisant
      la commande <command>man 5 autofs</command>.</para>

      <para>Sur la deuxième ligne, s'il est activé, un répertoire home pour 
      l'utilisateur serait monté via NFS lors de la connexion.  Le
      <filename>/etc/home.auto</filename> devrait exister et contenir une
      entrée du genre&nbsp;:</para>

<screen>joe  example.org:/export/home/joe</screen>

       <para>où le répertoire <filename>/export/home/joe</filename> est 
      exporté via NFS à partir du système example.org. Les partages
      NFS sont traités à la page suivante.</para>

      <para>On pourrait aussi utiliser ce paquet pour monter des partages SMB 
      mais cette fonctionnalité n'est pas configurée dans ces instructions. Pour
      des informations de configuration supplémentaires, voir les pages de
      man d'auto.master(5).  Il y a aussi des ressources Internet telles que 
      celle disponible sur<ulink
      url='http://gentoo-wiki.com/HOWTO_Auto_mount_filesystems_(AUTOFS)#Config_files'>AUTOFS
      HOWTO</ulink>.</para>

    </sect3>

<!--
    <sect3  id="autofs-init">
      <title>Boot Script</title>


      <para>Installez le script de montage <filename>/etc/rc.d/init.d/autofs</filename>
      et le fichier de configuration <filename>/etc/sysconfig/autofs.conf</filename> inclus dans le paquet <xref linkend="bootscripts"/>.</para>

      <indexterm zone="autofs autofs-init">
        <primary sortas="f-autofs-init">autofs</primary>
      </indexterm>

<screen role="root"><userinput>make install-autofs</userinput></screen>

      <para>The time-out variable is set in
      <filename>/etc/sysconfig/autofs.conf</filename>. The installed file sets
      a default of 60 seconds of inactivity before unmounting the device.  A
      much shorter time may be necessary to protect buffer writing to a floppy
      if users tend to remove the media prior to the timeout setting.</para>

    </sect3>
-->

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programme installé</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>automount</seg>
        <seg>lookup_file.so, lookup_hosts.so, lookup_multi.so,
        lookup_nisplus.so, lookup_program.so, lookup_userhome.so,
        lookup_yp.so, mount_afs.so, mount_autofs.so, mount_bind.so,
        mount_changer.so, mount_ext2.so, mount_generic.so,
        mount_nfs.so, parse_sun.so</seg>
        <seg>/lib/autofs et /var/run/autofs</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="automount">
        <term><command>automount</command></term>
        <listitem>
          <para>est le démon qui effectue un montage quand on sollicite un
          périphérique.</para>
          <indexterm zone="autofs automount">
            <primary sortas="b-automount">automount</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
