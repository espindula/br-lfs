<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY dbus-download-http "http://dbus.freedesktop.org/releases/dbus/dbus-&dbus-version;.tar.gz">
  <!--<!ENTITY dbus-download-ftp  "&gentoo-ftp-repo;/dbus-&dbus-version;.tar.gz">-->
  <!ENTITY dbus-download-ftp  " ">
  <!ENTITY dbus-md5sum        "565346cecd9cfecf1463540c6086cc2c">
  <!ENTITY dbus-size          "1.6 Mio">
  <!ENTITY dbus-buildsize     "26 Mio (65 Mio si toutes les docs et les pages de man de l'API sont installées)">
  <!ENTITY dbus-time          "0.4 SBU">
]>

<sect1 id="dbus" xreflabel="D-BUS-&dbus-version;">
  <?dbhtml filename="dbus.html"?>

  <sect1info>
    <othername>$LastChangedBy: randy $</othername>
    <date>$Date>&nbsp;: 2011-01-04 20:10:04 +0100 (mar 04 jan 2011) $</date>
  </sect1info>

  <title>D-BUS-&dbus-version;</title>

  <indexterm zone="dbus">
    <primary sortas="a-D-BUS">D-BUS</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction à D-BUS</title>

    <para><application>D-BUS</application> est un système bus de message, une
    manière simple pour les applications de parler entre elles.
    <application>D-BUS</application> fournit un démon système (pour des événements
    tels que <quote>nouveau périphérique ajouté</quote> ou <quote>queue de l'imprimante
    modifiée</quote>) et un démon aligné sur la session de l'utilisateur (pour
    les besoins IPC généraux des applications de l'utilisateur). Le bus de
    message est aussi construit au sommet d'un environnement de passagede message
    entre éléments général, qui peut être utilisé par  deux
    applications pour communiquer directement (sans passer par le démon de
    bus de message).</para>

    &lfs65_checked;

    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&dbus-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&dbus-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &dbus-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &dbus-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &dbus-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &dbus-time;</para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dépendances de D-BUS</bridgehead>

    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="expat"/> (préféré) ou <!-- both
    <xref linkend="pkgconfig"/> et --> <xref linkend="libxml2"/></para>

    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional"><xref linkend="xorg7-lib"/> et
    <xref linkend="doxygen"/> (to generate the API documentation)</para>
    
    <para>Notez que le script <command>configure</command> regardera dans
    <xref linkend="xmlto"/> mais il ne fait rien car la documentation XML/HTML 
    est déjà incluse dans l'arborescence des sources.</para>

    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/dbus"/></para>

  </sect2>

  <sect2 role="kernel" id='dbus-kernel'>
    <title>Configuration du noyau</title>

    <para>Assurez-vous que l'option suivante est activée dans la configuration
    du noyau et recompilez le noyau si nécessaire&nbsp;:</para>

<screen><literal>General Setup
  System V IPC</literal></screen>

    <indexterm zone="dbus dbus-kernel">
      <primary sortas="d-dbus">dbus</primary>
    </indexterm>

  </sect2>

  <sect2 role="installation">
    <title>Installation de D-BUS</title>

    <para>En tant qu'utilisateur <systemitem class="username">root</systemitem>,
    créez un utilisateur et un groupe systèmes pour gérer l'activité du bus de
    messages système&nbsp;:</para>

<screen role="root"><userinput>groupadd -fg 18 messagebus &amp;&amp;
useradd -c "D-BUS Message Daemon User" -d /dev/null \
        -u 18 -g messagebus -s /bin/false messagebus || [ $? == 9 ]</userinput></screen>

    <para>On ne peut lancer la suite de tests de ce paquet sans passer de
    paramètres à <command>configure</command> et sans mettre une fonctionnalité
    supplémentaire dans les binaires. Ces interfaces ne sont pas conçues pour
    être utilisées dans une construction pour production de <application>D-BUS</application>, 
    donc elles devront être construites deux fois dans cette situation. Si
    vous aimeriez lancer les tests d'unité, exécutez les commandes suivantes&nbsp;:</para>

<screen><userinput>./configure --enable-tests --enable-asserts &amp;&amp;
make &amp;&amp;
make check &amp;&amp;
make distclean</userinput></screen>

    <para>Remarquez qu'il y a le signalement selon lequel il se peut que les 
    tests échouent lors d'une exécution dans le shell de Midnight Commander.</para>

    <para>Installez <application>D-BUS</application> en lançant les commandes
    suivantes (vous pouvez d'abord souhaiter observer la sortie de
    <command>./configure --help</command> et ajouter des paramètres désirés
    à la commande <command>configure</command> affichée ci-dessous)&nbsp;:</para>

<screen><userinput>./configure --prefix=/usr \
            --sysconfdir=/etc \
            --libexecdir=/usr/lib/dbus-1.0  \
            --localstatedir=/var &amp;&amp;
make</userinput></screen>

    <para>Le paramètre <option>--enable-doxygen-docs</option> ne fonctionne pas
    correctement. Si vous avez installé <application>Doxygen</application> et
    si vous souhaiter construire la documentation de l'API, exécutez
    <command>doxygen</command>.</para>

    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>make install &amp;&amp;
install -v -m755 -d /usr/share/doc/dbus-&dbus-version; &amp;&amp;
install -v -m644 doc/{TODO,*.{dtd,html,xml,xsl,txt,c}} \
    /usr/share/doc/dbus-&dbus-version;</userinput></screen>

    <para>Si vous avez construit la documentation de l'API, installez-la en
    exécutant les commandes suivantes en tant qu'utilisateur
    <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>install -v -m755 -d /usr/share/doc/dbus-&dbus-version;/api \
                    /usr/share/man/man3dbus &amp;&amp;
install -v -m644    doc/api/html/* \
                    /usr/share/doc/dbus-&dbus-version;/api &amp;&amp;
install -v -m644    doc/api/man/man3dbus/* \
                    /usr/share/man/man3dbus</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explication des commandes</title>

    <para><parameter>--libexecdir=/usr/lib/dbus-1.0 </parameter>&nbsp;: Ceci 
    installera des binaires conçus pour n'être utilisés qu'en interne par 
    <application>D-BUS</application> et le répertoire 
    <filename class="directory">dbus-1</filename> dans
    <filename class="directory">/usr/lib/dbus-1.0</filename> au lieu de
    <filename class="directory">/usr/libexec</filename>.</para>

    <para><parameter>--localstatedir=/var</parameter>&nbsp;: Il résulte
    de ce paramètre que le fichier PID du démon, le socket du bus système et le
    fichier uuid de la machine, seront créés dans le répertoire
    <filename class="directory">/var</filename> plutôt que dans
    le répertoire <filename class="directory">/usr/var</filename>.</para>

    <para><parameter>--enable-tests</parameter>&nbsp;: Construit des parties
    supplémentaires du code pour supporter le test. Configure se finira avec
    un avertissement NOTE concernant cela.</para>

    <para><parameter>--enable-asserts</parameter>&nbsp;: Active le code de
    débogage pour exécuter des déclarations d'éléments supposées normalement
    vraies. Cela empêche un avertissement selon lequel 
    '<parameter>--enable-tests</parameter>' n'est utile en lui-même que 
    pour le profilage et il pourrait ne pas donner de bon résultats pour tous 
    les tests, mais il ajoute sa propre remarque selon laquelle cela ne devrait 
    pas être utilisé dans une construction de production.
    </para>

    <para><parameter>--disable-static</parameter>&nbsp;: Empêche les
    bibliothèques statique de se construire et de s'installer.</para>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration de dbus</title>

    <sect3 id="dbus-config">
      <title>Fichiers de configuration</title>
      <para><filename>/etc/dbus-1/session.conf</filename>,
      <filename>/etc/dbus-1/system.conf</filename> et
      <filename>/etc/dbus-1/system.d/*</filename></para>

      <indexterm zone="dbus dbus-config">
        <primary sortas="e-etc-dbus-1-session.conf">/etc/dbus-1/session.conf</primary>
      </indexterm>

      <indexterm zone="dbus dbus-config">
        <primary sortas="e-etc-dbus-1/system.conf">/etc/dbus-1/system.conf</primary>
      </indexterm>

      <indexterm zone="dbus dbus-config">
        <primary sortas="e-etc-dbus-1-system.d-star">/etc/dbus-1/system.d/*</primary>
      </indexterm>

    </sect3>

    <sect3 id="dbus-session-config" xreflabel="D-Bus custom services directory">
      <title>Informations de configuration</title>

      <para>On ne devrait probablement pas modifier les fichiers de configuration
      listés ci-dessus. Si des modifications sont requises, vous devriez créer
      <filename>/etc/dbus-1/session-local.conf</filename> et/ou
      <filename>/etc/dbus-1/system-local.conf</filename> et faire les changements
      désirés à ces fichiers.</para>

      <para>Si un paquet installe un fichier <filename>.service</filename> de
      <application>D-Bus</application> hors du répertoire
      <filename class="directory">/usr/share/dbus-1/services</filename> standard,
      vous devriez ajouter ce répertoire à la configuration de la session 
      locale. Par exemple, <filename
      class="directory">/usr/local/share/dbus-1/services</filename> peut être
      ajouté en effectuant les commandes suivantes en tant qu'utilisateur
      <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen role="root"><userinput>cat &gt; /etc/dbus-1/session-local.conf &lt;&lt; "EOF"
<literal>&lt;!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd"&gt;
&lt;busconfig&gt;

  &lt;!-- Search for .service files in /usr/local --&gt;
  &lt;servicedir&gt;/usr/local/share/dbus-1/services&lt;/servicedir&gt;

&lt;/busconfig&gt;</literal>
EOF</userinput></screen>

      <!-- <para>Many packages will refuse to run if the file
      <literal>/var/lib/dbus/machine-id</literal> does not exist, et
      complain that <application>dbus</application> has not been properly
      installed. To prevent this, run the following command as the
       <systemitem class="username">root</systemitem>&nbsp;:</para>

<screen><userinput>dbus-uuidgen - -ensure</userinput></screen>

      <para>This will create a unique identifier for the machine.</para> -->

    </sect3>

    <sect3  id="dbus-init">
      <title>Script de démarrage</title>

      <para>Pour démarrer automatiquement <command>dbus-daemon</command> quand
      on redémarre le système, installez le script de démarrage
      <filename>/etc/rc.d/init.d/dbus</filename> depuis le paquet
      <xref linkend="bootscripts"/>.</para>

      <indexterm zone="dbus dbus-init">
        <primary sortas="f-dbus">dbus</primary>
      </indexterm>

<screen role="root"><userinput>make install-dbus</userinput></screen>

      <para>Remarquez que ce script de démarrage ne démarre que démon
      <application>D-BUS</application> de tout le système. Chaque utilisateur
      ayant besoin d'un accès aux services de
      <application>D-BUS</application> devront exécuter en plus un démon de
      session. Il y a beaucoup de méthodes utilisables pour démarrer un
      démon de session en utilisant la commande <command>dbus-launch</command>.
      Revoyez la page de man de <command>dbus-launch</command> pour des détails
      sur les paramètres et les options disponibles. Voici quelques suggestions
      et exemples&nbsp;:</para>

      <itemizedlist spacing="compact">
        <listitem>
          <para>Ajouter <command>dbus-launch</command> à la ligne dans le fichier
          <filename>~/.xinitrc</filename> qui démarre votre environnement graphique
          comme décrit au  <xref linkend="gnome-config"/>.</para>
        </listitem>
        <listitem>
          <para>Si vous utilisez <command>xdm</command> ou un autre gestionnaire
          d'affichage qui appelle le fichier <filename>~/.xsession</filename>,
          vous pouvez ajouter <command>dbus-launch</command> à la ligne
          dans votre fichier
          <filename>~/.xsession</filename> qui démarre votre environnement
          graphique. La syntaxe ressemblerait à celle de l'exemple dans le
          fichier <filename>~/.xinitrc</filename>.</para>
        </listitem>
        <listitem>
          <para>Si vous utilisez <command>gdm</command> ou un autre gestionnaire
          d'affichage qui utilise des fichiers personnalisés pour ouvrir des
          sessions, utilisez l'exemple dans
          <xref linkend="gdm-config-dbus"/> des instructions de
          <application>GDM</application> pour créer un fichier contenant
          <command>dbus-launch</command>.</para>
        </listitem>
        <listitem>
          <para>Les exemples décrits précédemment utilisent 
          <command>dbus-launch</command> pour dire à un programme de se lancer.
          Ceci a l'avantage (lorsqu'on utilise aussi le paramètre
          <parameter>--exit-with-session</parameter>) d'arrêter le démon de
          session quand le programme spécifié est arrêté. Vous pouvez aussi
          démarrer le démon de session dans votre système ou par vos scripts
          de démarrage personnels en ajoutant les lignes suivantes&nbsp;:</para>

<screen><userinput><literal># Start the D-BUS session daemon
eval `dbus-launch`
export DBUS_SESSION_BUS_ADDRESS</literal></userinput></screen>

          <para>Cette méthode n'arrêtera pas le démon de session quand vous quittez
          votre shell, donc vous devriez ajouter la ligne suivante à votre
          fichier <filename>~/.bash_logout</filename>&nbsp;:</para>

<screen><userinput><literal># Kill the D-BUS session daemon
kill $DBUS_SESSION_BUS_PID</literal></userinput></screen>
        </listitem>

        <listitem>
          <para>Une astuce a été écrite offrant des moyens de démarrer
          des scripts utilisant le gestionnaire de sessions KDM de KDE. Les
          concepts de cette astuce pourraient être éventuellement utilisés aussi
          avec d'autres gestionnaires de session. L'astuce se trouve sur
          <ulink
          url="&hints-root;/downloads/files/execute-session-scripts-using-kdm.txt"/>.
          </para>
        </listitem>

      </itemizedlist>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contenu</title>

    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèque installée</segtitle>
      <segtitle>Répertoires installés</segtitle>

      <seglistitem>
        <seg>dbus-cleanup-sockets, dbus-daemon, dbus-launch, dbus-monitor,
        dbus-send, dbus-uuidgen</seg>
        <seg>libdbus-1.{so,a}</seg>
        <seg>/etc/dbus-1, /usr/include/dbus-1.0, /usr/lib/dbus-1.0,
        /usr/share/dbus-1, /usr/share/doc/dbus-&dbus-version;,
        /usr/share/man/man3dbus, /var/lib/dbus et /var/run/dbus</seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="dbus-cleanup-sockets">
        <term><command>dbus-cleanup-sockets</command></term>
        <listitem>
          <para>nettoie les sockets superflus dans un répertoire.</para>
          <indexterm zone="dbus dbus-cleanup-sockets">
            <primary sortas="b-dbus-cleanup-sockets">dbus-cleanup-sockets</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dbus-daemon">
        <term><command>dbus-daemon</command></term>
        <listitem>
          <para>est le démon de bus de messages <application>D-BUS</application>.</para>
          <indexterm zone="dbus dbus-daemon">
            <primary sortas="b-dbus-daemon">dbus-daemon</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dbus-launch">
        <term><command>dbus-launch</command></term>
        <listitem>
          <para>est utilisé pour démarrer <command>dbus-daemon</command> depuis
          un script shell. Il est en principe appelé par des scripts de connexion
          d'un utilisateur.</para>
          <indexterm zone="dbus dbus-launch">
            <primary sortas="b-dbus-launch">dbus-launch</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dbus-monitor">
        <term><command>dbus-monitor</command></term>
        <listitem>
          <para>est utilisé pour surveiller les messages à travers un bus de
          messages <application>D-BUS</application>.</para>
          <indexterm zone="dbus dbus-monitor">
            <primary sortas="b-dbus-monitor">dbus-monitor</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dbus-send">
        <term><command>dbus-send</command></term>
        <listitem>
          <para>est utilisé pour envoyer un message à un bus de messages
          <application>D-BUS</application>.</para>
          <indexterm zone="dbus dbus-send">
            <primary sortas="b-dbus-send">dbus-send</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="dbus-uuidgen">
        <term><command>dbus-uuidgen</command></term>
        <listitem>
          <para>est utilisé pour générer ou lire un ID gunique universel.</para>
          <indexterm zone="dbus dbus-uuidgen">
            <primary sortas="b-dbus-uuidgen">dbus-uuidgen</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libdbus-1">
        <term><filename class='libraryfile'>libdbus-1.{so,a}</filename></term>
        <listitem>
          <para>contient les fonctions de l'API utilisées par le démon de
          messages <application>D-BUS</application>.
          <application>D-BUS</application> est d'abord une bibliothèque qui
          fournit une communication directe entre deux applications&nbsp;;
          <command>dbus-daemon</command> est une application qui utilise cette
          bibliothèque pour implémenter un démon de bus de messages.</para>
          <indexterm zone="dbus libdbus-1">
            <primary sortas="c-libdbus-1">libdbus-1.{so,a}</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
