<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY gcc-download-http     "https://ftp.gnu.org/gnu/gcc/gcc-&gcc-version;/gcc-&gcc-version;.tar.bz2">
  <!ENTITY gcc-download-ftp      "ftp://ftp.gnu.org/gnu/gcc/gcc-&gcc-version;/gcc-&gcc-version;.tar.bz2">
  <!ENTITY gcc-md5sum            "d5525b1127d07d215960e6051c5da35e">
  <!ENTITY gcc-size              "91 Mo">
  <!ENTITY gcc-ada-buildsize     "6.4 Go (0.7 Go added if GNAT install dir is not removed)">
  <!ENTITY gcc-ada-time          "125 SBU (including 73 SBU for tests)">
  <!ENTITY gnat-download-http    "https://libre.adacore.com/download/">
  <!ENTITY gnat-64-download-http "http://mirrors.cdn.adacore.com/art/7427735035ecc98968ebfcee17494161b0de28ef">
  <!ENTITY gnat-64-md5sum        "c0863ed75109b5aa737becfd5a6ec038">
  <!ENTITY gnat-64-size          "225 Mo">
  <!ENTITY gnat-32-download-http "http://mirrors.cdn.adacore.com/art/3fc05fc61cbc7ab4f291ed19ea4cb269fffd17bd">
  <!ENTITY gnat-32-md5sum        "69423c7ad8d9759377d4fff71a78992d">
  <!ENTITY gnat-32-size          "222 Mo">
]>
<sect1 id="gcc-ada" xreflabel="GCC-Ada-&gcc-version;">
  <?dbhtml filename="gcc-ada.html" ?>
  <sect1info>
    <othername>$LastChangedBy: fernando $</othername>
    <date>$Date: 2014-05-10 22:28:15 +0200 (sam. 10 mai 2014) $</date>
  </sect1info>
  <title>GCC-Ada-&gcc-version;</title>
  <indexterm zone="gcc-ada">
    <primary sortas="a-gcc-4-0">GCC-Ada&gcc-version;</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction au compilateur Ada de GCC</title>
    <para>Ada est un langage de programmation moderne pour des applications larges  &mdash; et pour des systèmes embarqués en particulier  &mdash;
    ou la fiabilité et l'efficatité sont essentielles. Il a un ensemble de fonctions techniques uniques qui font qu'il est très efficace pour une
    utilisation dans des projets importants, complexes et critiques en terme de sécurité.
    </para>
    <para>Le compilateur et les outils associés de cette page sont connus sous le nom de technologie 
    <application>GNAT</application>, développés par Adacore, en utilisant le moteur de <application>GCC</application>.
     Depuis qu'une partie du compilateur
    Ada est écrit en Ada, il y a une dépendance circulaire dans le compilateur Ada. Les instructions dessous commencent par
    installer un binaire de compilateur. Vous n'avez pas besoin de faire cela si vous avez déjà construit les outils
    <application>GNAT</application> .
</para>


    &lfs77_checked;

    <caution>
      <para>L'utilisation des instructions de cette page aura pour effet
      que les compilateurs et bibliothèques C et C++ seront réinstallés, écrasant celle de votre système.
      Cela peut causer des problèmes. Mercu de lire la note et l'avertissement sur la page
      <xref linkend="gcc"/>.</para>
    </caution>

    <note>
      <para>
        Si vous souhaitez installer d'autres compilateurs dans la collection <application>GCC
        </application>, fait cela en premier, ou spécifier ada dans le paramètre 
        <parameter>--enable-languages</parameter> de <command>
        configure</command>. Si vous reconstruisez <application>GCC</application>
        sans activer ada après avoir lancé les instructions de cette page,
        le nouveau compilateur ne sera plus capable de compiler ADA.
      </para>
    </note>


    <bridgehead renderas="sect3">Information sur le paquet </bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP) : <ulink url="&gcc-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP) : <ulink url="&gcc-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement : &gcc-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement : &gcc-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis : &gcc-ada-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction : &gcc-ada-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <note>
      <para>Vous aurez besoin d'installer <application>GNAT</application>
      temporairement pour satisfaire la dépendance circulaire. vous pouvez pointer avec
      votre navigateur sur 
      <ulink url="&gnat-download-http;">la page de téléchargement de AdaCore</ulink>,
      choisissez votre plateforme et 2014, ensuite sélectionnez le fichier à télécharger.
      Alternativement, des liens directs pour les versions de linux 32 bits et 64 bits sont donnés
      en dessous.</para>
    </note>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Binaire GNAT 64 bits: <ulink url="&gnat-64-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle de GNAT 64 bits: &gnat-64-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille de GNAT 64 bits: &gnat-64-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Binaire GNAT 32 bits: <ulink url="&gnat-32-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Somme de contrôle de GNAT 32 bits: &gnat-32-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Taille de GNAT 32 bits: &gnat-32-size;
        </para>
      </listitem>
      <listitem>
         <para>
           correctif requis:
          <ulink url="&patch-root;/gcc-&gcc-version;-upstream_fixes-1.patch"/>
         </para>
      </listitem>

    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de GCC Ada</bridgehead>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="dejagnu"/>, pour les tests
    </para>
    <para condition="html" role="usernotes">Notes utilisateur :
    <ulink url="&blfs-wiki;/gcc-ada"/></para>
  </sect2>
  <sect2 role="installation">
    <title>Installation du binaire GNAT</title>
    <para>Avant de déballer et aller dans le répertoire des sources de GCC, en premier déballez
    l'archive <application>GNAT</application>, et allez dans le répertoire de 
    GNAT. Ensuit, installez le binaire <application>GNAT</application> en lançant la commande
    suivante en tant qu'utilisateur 
    <systemitem class="username">root</systemitem> :</para>
<screen role="root">
<userinput>make ins-all prefix=/opt/gnat</userinput>
</screen>
    <para>Le compilateur <application>GNAT</application> peut être appelé en éxécutant 
    le binaire <command>gcc</command> installé dans <filename
    class="directory">/opt/gnat/bin</filename>.</para>
    <para>vous pouvez maintenant enlever le répertoire des sources de <application>GNAT</application>
    si désiré.</para>
    <para>Preparez la compilation de <application>GCC</application> en plaçant la version de 
    <application>GNAT</application> de <command>gcc</command> au début de la variable 
    <envar>PATH</envar> en utilisant la suite
    </para>
<screen>
<userinput>PATH_HOLD=$PATH &amp;&amp;
export PATH=/opt/gnat/bin:$PATH_HOLD</userinput>
</screen>
    <para>Faire cela à l'inconvénient que les exécutables <application>GCC</application>
    et <application>Binutils</application> sont pris dans le paquet 
    <application>GNAT</application> qui est juste installé, mais les versions de ses éxécutables sont
    dépassés comparés à ceux installés dans LFS. Ce n'est pas important pour les compilateurs <application>GCC</application>
    depuis qu'ils se recompilent eux même pendant le processus de "bootstrap".
    D'un autre coté, les outils dépassés
    <command>ld</command> et <command>as</command> sont utilisés pendant tous le temps. Pour utiliser
    les outiles LFS, tappez en tant qu'utilisateur
    <systemitem class="username">root</systemitem>:</para>
<screen role="root">
<userinput>find /opt/gnat -name ld -exec mv -v {} {}.old ;
find /opt/gnat -name as -exec mv -v {} {}.old ;</userinput>
</screen>
  </sect2>
  <sect2 role="installation">
    <title>Installation de GCC Ada</title>
<para>
Comme dans LFS, corrigez des problèmes identifiés par les développeurs:
</para>
<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-upstream_fixes-1.patch</userinput></screen>


 
    <para>Installez <application>GCC Ada</application> en lançant la suite </para>
<screen>
<userinput>
mkdir ../gcc-build &amp;&amp;
cd    ../gcc-build &amp;&amp;
../gcc-&gcc-version;/configure              --prefix=/usr                   --libdir=/usr/lib               --enable-shared                 --enable-threads=posix          --enable-__cxa_atexit           --enable-clocale=gnu            --disable-multilib              --with-system-zlib              --enable-languages=ada &amp;&amp;
make</userinput>
</screen>
    <para>si vous avez installé des paquets supplémentaires comme 
    <application>Valgrind</application> et <application>GDB</application>,
    La partie <application>GCC</application> de la suite de tests lancera plus de tests que 
    dans LFS. Certain d'entre eux seront signalé FAIL et d'autres XPASS
    (passé avec un FAIL attendu). Pour lancer les tests, tapez:</para>
<screen>
<userinput>ulimit -s 32768 &amp;&amp;
make -k check</userinput>
</screen>
    <para>Les tests sont très longs, et les résultats peuvent être difficiles à trouver dans
    les logs, spécialmeent si vous avez utilisé des travaux parallèles avec make, Vous pouvez avoir
    un résumé des tests avec:</para>
<screen>
<userinput>../gcc-&gcc-version;/contrib/test_summary</userinput>
</screen>
    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> :</para>
<screen role="root">
<userinput>make install &amp;&amp;
mkdir -pv /usr/share/gdb/auto-load/usr/lib              &amp;&amp;
mv -v /usr/lib/*gdb.py /usr/share/gdb/auto-load/usr/lib &amp;&amp;
chown -v -R root:root     /usr/lib/gcc/*linux-gnu/&gcc-version;/include{,-fixed}     /usr/lib/gcc/*linux-gnu/&gcc-version;/ada{lib,include}</userinput>
</screen>
    <para>Vous pouvez maintenant supprimer l'installation de <application>GNAT</application>
    et faire d'autres nettoyages. Pour commencer, en tant qu'utilisateur <systemitem
      class="username">root</systemitem>:</para>
<screen role="root"><userinput>rm -rf /opt/gnat</userinput></screen>

<para> ensuite, en tant que simple utilisateur : </para>

<screen>
<userinput>rm -rf /opt/gnat &amp;&amp;
export PATH=$PATH_HOLD &amp;&amp;
unset PATH_HOLD</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explications des commandes</title>
    <para><command>mkdir ../gcc-build; cd ../gcc-build</command> : La documentation de 
    <application>GCC</application> recommande
    de construire le paquet dans un répertoire de construction dédié.</para>
    <para><parameter>--disable-multilib</parameter> : Ce paramètre assure que les fichiers sont créés pour l'architecture
    spécifique à votre ordinateur.
    </para>
    <para>
      <parameter>--with-system-zlib</parameter> : utilise la version
      <application>zlib</application> au lieu de celle empaqueté.
      <application>zlib</application> est utilisé pour compresser
      et décompresser les langages intermédiaires de <application>GCC</application>
      dans les fichiers objets LTO (Link Time Optimization).
    </para>
    <para>
      <option>--with-default-libstdcxx-abi=c++98</option>: Utilisez ce paramètre si vous construisez les outils
      <application>GNAT</application> en utilisant une version de 
      <application>GCC</application> inférieur à 5.1.0,
      et que vous ne voulez pas recompiler toutes les bibliothèques écrites en C++.
    </para>

    <para><command>ulimit -s 32768</command> : Cette commande empêche plusieurs tests de se lancer
    en dehors de la pile.</para>
    <para><command>make -k check</command> : Cette commande lance la suite de tests sans stopper si quelques erreurs sont générées.
    </para>
    <para><command>../gcc-&gcc-version;/contrib/test_summary</command> : Cette commande produira un résumé des résultats
     de la suite de tests. Vous pouvez ajouter
    <command>| grep -A7 Summ</command> à la commande pour produite une version encore plus condensée du résumé.
    Vous pouvez également souhaiter rediriger la sortie dans un fichier pour
    étudier et comparer plus tard.
    </para>
    <para><command>chown -v -R root:root
    /usr/lib/gcc/*linux-gnu/...</command> :
    Si le paquet est construit par un utilisateur autre que root, les droits des répertoires
    <filename class="directory">include</filename> et <filename class="directory">adalib</filename> installés (et leur contenu) seront incorrects.
    Ces commandes changes les droits vers l'utilisateur et le groupe
    <systemitem class="username">root</systemitem>.</para>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          gnat, gnatbind, gnatchop, gnatclean, gnatfind, gnatkr,
          gnatlink, gnatls, gnatmake, gnatname, gnatprep, gnatxref,
          et un éxécutable run-time, gnat1, dans <filename class="directory">
          /usr/libexec/&lt;arch-triplet&gt;/&gcc-version;</filename>
        </seg>
        <seg>
          libgnat.{so,a}, libgnarl.{so,a} in <filename class="directory">
          /usr/lib/gcc/&lt;arch-triplet&gt;/&gcc-version;/adalib</filename>
        </seg>
        <seg>
          /usr/lib/gcc/&lt;arch-triplet&gt;/&gcc-version;/ada{include,lib}
        </seg>
      </seglistitem>
    </segmentedlist>
    <para>Seulement mes fichiers spécifiques à Ada sont listés ici. Les autres peuvent être trouvés sur la page
    <ulink url="&lfs-root;/chapter06/gcc.html#contents-gcc"/> comme ils ont été installé
    initialement pendant la construction de LFS.</para>
    <variablelist>
      <bridgehead renderas="sect3">Description courte</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="gnat">
        <term><command>gnat</command></term>
        <listitem>
          <para>est une enveloppe qui accepte un nombre de commandes et d'appels aux outils correspondants dans la liste suivante.
          </para>
          <indexterm zone="gcc-ada gnat">
            <primary sortas="b-gnat">gnat</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatbind">
        <term><command>gnatbind</command></term>
        <listitem>
<para>est utilisé pour attacher des objets compilés.</para>
          <indexterm zone="gcc gnatbind">
            <primary sortas="b-gnatbind">gnatbind</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatchop">
        <term><command>gnatchop</command></term>
        <listitem>
<para>est utile pour renommer des fichiers pour satisfaire
          les conventions de nommage standard par défaut du fichier
          <application>Ada</application>.</para>
          <indexterm zone="gcc gnatchop">
            <primary sortas="b-gnatchop">gnatchop</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatclean">
        <term><command>gnatclean</command></term>
        <listitem>
<para>est utilisé pour supprimer des fichiers associés à un projet
          <application>GNAT</application>.</para>
          <indexterm zone="gcc gnatclean">
            <primary sortas="b-gnatclean">gnatclean</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatfind">
        <term><command>gnatfind</command></term>
        <listitem>
<para>est le chercheur de définitions/utilisation <application>GNAT</application>.</para>
          <indexterm zone="gcc gnatfind">
            <primary sortas="b-gnatfind">gnatfind</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatkr">
        <term><command>gnatkr</command></term>
        <listitem>
<para>est utilisé pour déterminer le nom crunché d'un fichier donné, lorsqu'un crunch
          a été réglé à une longueur maximum spécifiée.</para>
          <indexterm zone="gcc gnatkr">
            <primary sortas="b-gnatkr">gnatkr</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatlink">
        <term><command>gnatlink</command></term>
        <listitem>
<para>est utilisé pour lier des programmes et construire un fichier
          exécutable.</para>
          <indexterm zone="gcc gnatlink">
            <primary sortas="b-gnatlink">gnatlink</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatls">
        <term><command>gnatls</command></term>
        <listitem>
<para>est le navigateur d'unités compilées.</para>
          <indexterm zone="gcc gnatls">
            <primary sortas="b-gnatls">gnatls</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatmake">
        <term><command>gnatmake</command></term>
        <listitem>
<para>est une possibilité <command>make</command> automatique.</para>
          <indexterm zone="gcc gnatmake">
            <primary sortas="b-gnatmake">gnatmake</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatname">
        <term><command>gnatname</command></term>
        <listitem>
<para>listera les fichiers associés à un projet
          <application>GNAT</application>.</para>
          <indexterm zone="gcc gnatname">
            <primary sortas="b-gnatname">gnatname</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatprep">
        <term><command>gnatprep</command></term>
        <listitem>
<para>est le préprocesseur externe de <application>GNAT</application>.</para>
          <indexterm zone="gcc gnatprep">
            <primary sortas="b-gnatprep">gnatprep</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnatxref">
        <term><command>gnatxref</command></term>
        <listitem>
<para>est le référenceur croisé <application>GNAT</application>.</para>
          <indexterm zone="gcc gnatxref">
            <primary sortas="b-gnatxref">gnatxref</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect2>
</sect1>
