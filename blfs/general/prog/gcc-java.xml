<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY gcc-java-download-http  "https://ftp.gnu.org/gnu/gcc/gcc-&gcc-version;/gcc-&gcc-version;.tar.bz2">
  <!ENTITY gcc-java-download-ftp   "ftp://ftp.gnu.org/gnu/gcc/gcc-&gcc-version;/gcc-&gcc-version;.tar.bz2">
  <!ENTITY gcc-java-md5sum         "d5525b1127d07d215960e6051c5da35e">
  <!ENTITY gcc-java-size           "91 Mo">
  <!ENTITY gcc-java-buildsize      "4.1 Go">
  <!ENTITY gcc-java-time           "78 SBU (including 65 SBU for tests)">
  <!ENTITY ecj-download-ftp    "ftp://sourceware.org/pub/java/ecj-latest.jar">
  <!ENTITY antlr-version       "4.5">
  <!ENTITY antlr-download-http "http://www.antlr.org/download/antlr-&antlr-version;-complete.jar">
]>
<sect1 id="gcc-java" xreflabel="GCC-Java-&gcc-version;">
  <?dbhtml filename="gcc-java.html" ?>
  <sect1info>
    <othername>$LastChangedBy: fernando $</othername>
    <date>$Date: 2014-05-10 22:28:15 +0200 (sam. 10 mai 2014) $</date>
  </sect1info>
  <title>GCC-Java-&gcc-version;</title>
  <indexterm zone="gcc">
    <primary sortas="a-gcc-java-5-0">GCC-Java-&gcc-version;</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à GCC-Java</title>
    <para>Regardez l'introduction au langage et au système Java
    <xref linkend="java"/>. La collection de compilateur GNU (GCC) contient
    un compilateur Java de code natif. Et avec le compilateur Java 
    <application>ecj</application> d'Eclipse (vers du bytecode),
    il fournit un moyen de construire un JVM acceptable depuis les sources.
    Cependant, depuis la publication de <application>OpenJDK</application>, le développement
    de GCC-Java a été stoppé, et le JVM construit est une ancienne version, qui ne peut pas
    être utilisée pour construire <xref linkend="openjdk"/>.
    &lfs77_checked;
    <caution>
      <para>L'utilisation des instructions de cette page aura pour effet
      que les compilateurs et bibliothèques C et C++ seront réinstallés, écrasant celle de votre système.
      Cela peut causer des problèmes. Mercu de lire la note et l'avertissement sur la page
      <xref linkend="gcc"/>.</para>
    </caution>
    <bridgehead renderas="sect3">Information sur le paquet </bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP) : <ulink url="&gcc-java-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP) : <ulink url="&gcc-java-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement : &gcc-java-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement : &gcc-java-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis : &gcc-java-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction : &gcc-java-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Compilateur Java d'Eclipse:
          <ulink url="&ecj-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          binaire ANTLR, pour construire <command>gjdoc</command> (facultatif):
          <ulink url="&antlr-download-http;"/>
        </para>
      </listitem>
      <listitem>
         <para>
           Correctif requis:
          <ulink url="&patch-root;/gcc-&gcc-version;-upstream_fixes-1.patch"/>
         </para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de GCC Java</bridgehead>
    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required">
      <xref linkend="unzip"/>,
      <xref linkend="which"/>, et
      <xref linkend="zip"/>
    </para>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
      <xref linkend="dejagnu"/>, pour les tests
    </para>
    <bridgehead renderas="sect4">Facultative</bridgehead>
    <para role="optional">
      <xref linkend="gtk2"/> et
      <ulink url="https://download.gnome.org/sources/libart_lgpl/">
        Libart
      </ulink> pour la construction de AWT
    </para>
    <para condition="html" role="usernotes">Notes utilisateur :
    <ulink url="&blfs-wiki;/gcc-java"/></para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de GCC Java</title>
    <para>Les instructions dessous considèrent que les compilateurs C et C++ ont la même version que ceux 
    que vous avez installé, pour qu'un 
    <quote>bootstrap</quote> ne soit pas nécessaire. si vous avez mis à jour 
    la version de GCC, alors effacez <option>--disable-bootstrap</option> des options de 
    <command>./configure</command>.</para>
 
    <para>
      Comme dans LFS, corrigez des problèmes identifiés par les développeurs:
    </para>
<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-upstream_libgomp_fix-1.patch</userinput></screen>



    <para>Installez <application>GCC Java</application> en lançant la suite
    </para>
<screen>
<userinput>sed -i 's/(install.*:) install-.*recursive/1/' libffi/Makefile.in         &amp;&amp;
sed -i 's/(install-data-am:).*/1/'             libffi/include/Makefile.in &amp;&amp;
cp ../ecj-latest.jar ./ecj.jar &amp;&amp;
mkdir ../gcc-build &amp;&amp;
cd    ../gcc-build &amp;&amp;
../gcc-&gcc-version;/configure               --prefix=/usr                    --libdir=/usr/lib                --enable-shared                  --enable-threads=posix           --enable-__cxa_atexit            --enable-clocale=gnu             --disable-multilib               --with-system-zlib               --disable-bootstrap              --enable-java-home               --with-jvm-root-dir=/opt/gcj     --with-antlr-jar=$(pwd)/../antlr-&antlr-version;-complete.jar     --enable-languages=java &amp;&amp;
make</userinput>
</screen>
    <para>si vous avez installé des paquets supplémentaires comme
    <application>Valgrind</application> et <application>GDB</application>,
    la suite de tests de <application>GCC</application> lancera plus de tests que dans LFS. Certain de
    ceux la seront signalés FAIL (en ECHEC) et d'autres XPASS (passage avec un échec attendu). Pour lancer
    les test, tapez :</para>
<screen>
<userinput>ulimit -s 32768 &amp;&amp;
make -k check</userinput>
</screen>
    <para>Les tests sont très longs, et les résultats peuveut être difficiles à trouver
    dans les logs, principalement si vous utilisez un contrôle de travaux avec make. Vous pouvez
    avoir un résumé des tests avec :</para>
<screen>
<userinput>../gcc-&gcc-version;/contrib/test_summary</userinput>
</screen>
    <para>Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> :</para>
<screen role="root">
<userinput>make install &amp;&amp;
mkdir -pv /usr/share/gdb/auto-load/usr/lib              &amp;&amp;
mv -v /usr/lib/*gdb.py /usr/share/gdb/auto-load/usr/lib &amp;&amp;
chown -v -R root:root     /usr/lib/gcc/*linux-gnu/&gcc-version;/include{,-fixed} &amp;&amp;
gcj -o ecj ../ecj-latest.jar     --main=org.eclipse.jdt.internal.compiler.batch.Main &amp;&amp;
mv ecj /usr/bin &amp;&amp;
ln -sfv ../../../usr/bin/ecj /opt/gcj/bin/javac</userinput>
</screen>
  </sect2>
  <sect2 role="commands">
    <title>Explications des commandes</title>
    <para>Les deux commandes <command>sed</command> empêchent l'installation
    de la bibliothèque <application>libffi</application> livrée avec 
    <application>GCC</application>, depuis qu'elle est dépassée comparée à 
    <xref linkend="libffi"/>.</para>
    <para><command>mkdir ../gcc-build; cd ../gcc-build</command> : La documentation de 
    <application>GCC</application> recommande de construire le paquet dans un répertoire
    de construction dédié.</para>
    <para><parameter>--disable-multilib</parameter> : Ce paramètre assure que les fichiers sont créés pour l'architecture
    spécifique à votre ordinateur.
    </para>
    <para>
      <parameter>--with-system-zlib</parameter> : Utilise la version 
      <application>zlib</application> du système à la place de celle empaquetée.
    </para>
    <para>
      <parameter>--disable-bootstrap</parameter> : Empêche les compilateurs C et C++
      de se recompiler eux-même. Vous devez utiliser ce paramètre seulement si
      les compilateurs C et C++ sotn de la même version que cele que vous installez.
    </para>
     <para>
      <parameter>--enable-java-home</parameter>: Crée une couche de répertoires similaire à JVM.
    </para>
    <para>
      <parameter>--with-jvm-root-dir=/opt/gcj</parameter> : Installe
      JVM dans un endroit spécifique.
    </para>
    <para>
      <parameter>--with-antlr-jar=...</parameter> : Spécifie l'endroit pour
      <application>ANTLR</application>, qui est utilisé pour construire
      <command>gjdoc</command>. A supprimer si vous n'avez pas téléchargé antlr.
    </para>
    <para>
    <parameter>--enable-languages=java</parameter> :
    Cette commande identifie quel langage construire. Notez qu'il est inévitable que les compilateurs
    <application>C</application> et <application>C++</application>
    soient reconstruit également.</para>
    <para>
      <option>--enable-java-awt=gtk</option> : Permet de construire le pair 
      <application>GTK+2</application> de Java AWT. Utile pour avoir un JVM pleinement fonctionnel.
    </para>
    <para><command>ulimit -s 32768</command> : Cette commande empêche plusieurs tests de se lancer
    en dehors de la pile.</para>
    <para><command>make -k check</command> : Cette commande lance la suite de tests sans stopper si quelques erreurs sont générées.
    </para>
    <para><command>../gcc-&gcc-version;/contrib/test_summary</command> : Cette commande produira un résumé des résultats
     de la suite de tests. Vous pouvez ajouter 
    <command>| grep -A7 Summ</command> à la commande pour produite une version encore plus condensée du résumé.
    Vous pouvez également souhaiter rediriger la sortie dans un fichier pour
    étudier et comparer plus tard.
    </para>
    <para><command>chown -v -R root:root
    /usr/lib/gcc/*linux-gnu/...</command> :
    Si le paquet est construit par un utilisateur autre que root, les droits du répertoire
    <filename class="directory">include</filename> installé (et son contenu) seront incorrects.
    Ces commandes changes les droits vers l'utilisateur et le groupe
    <systemitem class="username">root</systemitem>.</para>
    <para>
      <command>gcj -o ecj ...</command> : compile le compilateur eclipse depuis le code natif, qui est plus rapide
      que le bytecode. Ce compilateur est également utilisé comme une alternative à
      <command>javac</command> dans JVM.
    </para>
  </sect2>
  <sect2 role="configuration">
    <title>Configuration de GCC-Java</title>
    <sect3>
      <title>Informations de configuration</title>
      <para>
        La configuration est la même que pour <xref linkend="ojdk-conf"/>,
        en remplaçant <filename class="directory">/opt/jdk</filename> par
        <filename class="directory">/opt/gcj</filename>.
      </para>
    </sect3>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          aot-compile, ecj, gappletviewer, gc-analyze, gcj, gcj-dbtool,
          gcjh, gij, gjar, gjarsigner, gjavah, gjdoc, gkeytool, gnative2ascii,
          gorbd, grmic, grmid, grmiregistry, gserialver, gtnameserv, jcf-dump,
          jv-convert, rebuild-gcj-db. des liens symboliques vers ses fichiers sont situés dans
          <filename class="directory">/opt/gcj/bin</filename>
        </seg>
        <seg>
          libgcj_bc.so, libgcj.so, libgcj-tools.so
          libgij.so, et de nombreux autres bibliothèques et exécutables dans
          <filename class="directory">/usr/lib/gcc</filename> et
          <filename class="directory">/usr/libexec/gcc</filename>
        </seg>
        <seg>
          /usr/include/c++/&gcc-version;/{gcj,gnu,java,javax,org,sun},
          /usr/lib/gcj-&gcc-version;-16, /usr/lib/jvm-exports,
          /usr/lib/security, /opt/gcj et
          /usr/share/java
        </seg>
      </seglistitem>
    </segmentedlist>
    <para>Quelques programmes et bibliothèques ne sont pas listés ici, mais peuvent être trouvés
    <ulink url="&lfs-root;/chapter06/gcc.html#contents-gcc"/> comme ils sont initialement installés pendant la construction
     de LFS.</para>
    <variablelist>
      <bridgehead renderas="sect3">Description courte</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>
      <varlistentry id="aot-compile">
        <term><command>aot-compile</command></term>
        <listitem>
          <para>cherche un répertoire pour le bytecode de Java et utilise 
         <command>gcj</command> pour le compiler en code natif.</para>
          <indexterm zone="gcc aot-compile">
            <primary sortas="b-aot-compile">aot-compile</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="ecj">
        <term><command>ecj</command></term>
        <listitem>
          <para>est le compialteur eclipse.</para>
          <indexterm zone="gcc ecj">
            <primary sortas="b-ecj">ecj</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gappletviewer">
        <term><command>gappletviewer</command></term>
        <listitem>
          <para>charge et lance une applet <application>Java</application>.</para>
          <indexterm zone="gcc gappletviewer">
            <primary sortas="b-gappletviewer">gappletviewer</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gc-analyze">
        <term><command>gc-analyze</command></term>
        <listitem>
          <para>analyse les "garbage collector" (GC) des vidages de mémoire du code
          <application>Java</application> code.</para>
          <indexterm zone="gcc gc-analyze">
            <primary sortas="b-gc-analyze">gc-analyze</primary>
          </indexterm>
        </listitem>
      </varlistentry>
    <varlistentry id="gcj">
        <term><command>gcj</command></term>
        <listitem>
          <para>est un compilateur d'avance de temps pour le langage
          <application>Java</application>.</para>
          <indexterm zone="gcc gcj">
            <primary sortas="b-gcj">gcj</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gcj-dbtool">
        <term><command>gcj-dbtool</command></term>
        <listitem>
          <para>est un outil pour créer et manipuler des bases de données
            cartographique de fichier de classes.</para>
          <indexterm zone="gcc gcj-dbtool">
            <primary sortas="b-gcj-dbtool">gcj-dbtool</primary>
          </indexterm>
        </listitem>
      </varlistentry>
     <varlistentry id="gcjh">
        <term><command>gcjh</command></term>
        <listitem>
          <para>génère les fichiers d'entêtes des fichiers de classes de
            <application>Java</application>.</para>
          <indexterm zone="gcc gcjh">
            <primary sortas="b-gcjh">gcjh</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gij">
        <term><command>gij</command></term>
        <listitem>
          <para>est l'interpréteur GNU pour le code binaire
            <application>Java</application>.</para>
          <indexterm zone="gcc gij">
            <primary sortas="b-gij">gij</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gjar">
        <term><command>gjar</command></term>
          <listitem>
<para>est une implémentation (partielle) de l'utilitaire <command>jar</command>
          qui vient avec le JDK de Sun.</para>
          <indexterm zone="gcc gjar">
            <primary sortas="b-gjar">gjar</primary>
           </indexterm>
         </listitem>
       </varlistentry>
      <varlistentry id="gjarsigner">
        <term><command>gjarsigner</command></term>
        <listitem>
<para>est un outil de vérification et signature des fichiers Java ARchive (JAR).</para>
          <indexterm zone="gcc gjarsigner">
            <primary sortas="b-gjarsigner">gjarsigner</primary>
         </indexterm>
        </listitem>
      </varlistentry>
     <varlistentry id="gjavah">
        <term><command>gjavah</command></term>
        <listitem>
<para>génére les fichiers d'entêtes depuis les fichiers de class Java.</para>
          <indexterm zone="gcc gjavah">
            <primary sortas="b-gjavah">gjavah</primary>
          </indexterm>
       </listitem>
      </varlistentry>
      <varlistentry id="gjdoc">
        <term><command>gjdoc</command></term>
        <listitem>
          <para>est un outil de documentation similaire à <command>javadoc</command>.
          </para>
          <indexterm zone="gcc gjdoc">
            <primary sortas="b-gjdoc">gjdoc</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gkeytool">
        <term><command>gkeytool</command></term>
       <listitem>
<para>gère les clés privés et les certificats publiques dans un environnement
          <application>Java</application>.</para>
          <indexterm zone="gcc gkeytool">
            <primary sortas="b-gkeytool">gkeytool</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gnative2ascii">
        <term><command>gnative2ascii</command></term>
        <listitem>
          <para>est un convertisseur d'encodage pour <application>Java</application>.</para>
          <indexterm zone="gcc gnative2ascii">
            <primary sortas="b-gnative2ascii">gnative2ascii</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gorbd">
        <term><command>gorbd</command></term>
          <listitem>
<para>est un démon de demandes d'objets cassés.</para>
          <indexterm zone="gcc gorbd">
            <primary sortas="b-gorbd">gorbd</primary>
           </indexterm>
         </listitem>
 </varlistentry>
      <varlistentry id="grmic-gcc">
        <term><command>grmic</command></term>
        <listitem>
<para>génère des bouts d'appels à une méthode distante.</para>
          <indexterm zone="gcc grmic-gcc">
            <primary sortas="b-grmic">grmic</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="grmid-gcc">
        <term><command>grmid</command></term>
        <listitem>
<para>est un démon d'activation du sytème RMI.</para>
          <indexterm zone="gcc grmid-gcc">
            <primary sortas="b-grmid">grmid</primary>
         </indexterm>
        </listitem>
      </varlistentry>
        <varlistentry id="grmiregistry-gcc">
        <term><command>grmiregistry</command></term>
        <listitem>
<para>démarre un registre objet distant sur l'hôte actuel.</para>
          <indexterm zone="gcc grmiregistry-gcc">
            <primary sortas="b-grmiregistry">grmiregistry</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="gserialver">
        <term><command>gserialver</command></term>
       <listitem>
<para> affiche le serialVersionUID de la classe spécifiée.</para>
          <indexterm zone="gcc gserialver">
            <primary sortas="b-gserialver">gserialver</primary>
           </indexterm>
         </listitem>
       </varlistentry>
       <varlistentry id="gtnameserv">
        <term><command>gtnameserv</command></term>
        <listitem>
<para> démarre un service de noms.</para>
          <indexterm zone="gcc gtnameserv">
            <primary sortas="b-gtnameserv">gtnameserv</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="jcf-dump">
        <term><command>jcf-dump</command></term>
        <listitem>
<para>affiche des informations sur les fichiers de classe
          <application>Java</application>.</para>
          <indexterm zone="gcc jcf-dump">
            <primary sortas="b-jcf-dump">jcf-dump</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="jv-convert">
        <term><command>jv-convert</command></term>
        <listitem>
<para>convertit des fichiers d'un encodage à l'autre.</para>
          <indexterm zone="gcc jv-convert">
            <primary sortas="b-jv-convert">jv-convert</primary>
          </indexterm>
        </listitem>
      </varlistentry>
      <varlistentry id="rebuild-gcj-db">
        <term><command>rebuild-gcj-db</command></term>
          <listitem>
         <para>Fusionne la base de données de per-solib fait par
          <application>aot-compile</application> dans la base de données coté système.</para>
          <indexterm zone="gcc rebuild-gcj-db">
            <primary sortas="b-rebuild-gcj-db">rebuild-gcj-db</primary>
           </indexterm>
         </listitem>
       </varlistentry>
    </variablelist>
  </sect2>
</sect1>
