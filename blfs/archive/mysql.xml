<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
  <!ENTITY mysql-download-http "http://cdn.mysql.com/Downloads/MySQL-5.6/mysql-&mysql-version;.tar.gz">
  <!ENTITY mysql-download-ftp  " ">
  <!ENTITY mysql-md5sum        "1d3d91e8459c719bbef7c97bb499634d">
  <!ENTITY mysql-size          "32 Mo">
  <!ENTITY mysql-buildsize     "572 Mo (additional 359 Mo installed)">
  <!ENTITY mysql-time          "6.3 SBU">
]>
<sect1 id="mysql" xreflabel="MySQL-&mysql-version;">
  <?dbhtml filename="mysql.html"?>
  <sect1info>
    <othername>$LastChangedBy&nbsp;: krejzi $</othername>
    <date>$Date&nbsp;: 2013-04-29 18:18:11 +0200 (lun. 29 avril 2013) $</date>
  </sect1info>
  <title>MySQL-&mysql-version;</title>
  <indexterm zone="mysql">
    <primary sortas="a-MySQL">MySQL</primary>
  </indexterm>
  <sect2 role="package">
    <title>Introduction à MySQL</title>
    <para><application>MySQL</application> est un serveur de base de données rapide et
    largement utilisé. C'est une implémentation client/serveur consistant dans 
    un démon serveur et de nombreux programmes et bibliothèques différents.</para>
   &lfs78_checked;
    <bridgehead renderas="sect3">Informations sur le paquet</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Téléchargement (HTTP)&nbsp;: <ulink url="&mysql-download-http;"/></para>
      </listitem>
      <listitem>
        <para>Téléchargement (FTP)&nbsp;: <ulink url="&mysql-download-ftp;"/></para>
      </listitem>
      <listitem>
        <para>Somme de contrôle MD5 du téléchargement&nbsp;: &mysql-md5sum;</para>
      </listitem>
      <listitem>
        <para>Taille du téléchargement&nbsp;: &mysql-size;</para>
      </listitem>
      <listitem>
        <para>Estimation de l'espace disque requis&nbsp;: &mysql-buildsize;</para>
      </listitem>
      <listitem>
        <para>Estimation du temps de construction&nbsp;: &mysql-time;</para>
      </listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Téléchargements supplémentaires</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>Correctif facultatif (requis si vous construisez pour Amarok)&nbsp;: <ulink
        url="&patch-root;/mysql-&mysql-version;-embedded_library_shared-1.patch"/></para>
      </listitem>
      <listitem>
        <para>Documentation facultative (voir l'astuce ci-dessous):
          <ulink url="http://dev.mysql.com/doc/"/>
        </para>      
		</listitem>
    </itemizedlist>
    <bridgehead renderas="sect3">Dépendances de MySQL</bridgehead>
    <bridgehead renderas="sect4">Requises</bridgehead>
    <para role="required"><xref linkend="cmake"/></para>
    <bridgehead renderas="sect4">Recommandées</bridgehead>
    <para role="recommended">
       <xref linkend="libevent"/> et
       <xref linkend="openssl"/></para>
    <bridgehead renderas="sect4">Facultatives</bridgehead>
    <para role="optional">
      <ulink url="http://packages.debian.org/source/sid/libaio">libaio</ulink> et
      <ulink url="http://www.thrysoee.dk/editline/">libedit</ulink>
    </para>
    <para condition="html" role="usernotes">Notes utilisateur&nbsp;:
    <ulink url="&blfs-wiki;/mysql"/></para>
  </sect2>
  <sect2 role="installation">
    <title>Installation de MySQL</title>
    <para>Pour des raisons de sécurité, vous êtes fortement encouragé à exécuter
    le serveur en tant qu'utilisateur et groupe non privilégiés. Lancez ce
    qui suit (en tant qu'utilisateur <systemitem class="username">root</systemitem>)
    pour créer l'utilisateur et le groupe&nbsp;:</para>
<screen role="root">
<userinput>groupadd -g 40 mysql &amp;&amp;
useradd -c "MySQL Server" -d /srv/mysql -g mysql -s /bin/false -u 40 mysql</userinput>
</screen>
    <para>Si le serveur MySQL n'est pas nécessaire, il est possible de ne
    construire que les bibliothèques clients de MySQL. Pour cela, vous devez
    ajouter <parameter>-DWITHOUT_SERVER=ON</parameter> dans la commande <command>cmake</command>
    ci-dessous.</para>
    <para>MySQL contient une bibliothèque serveur embarquée. Par défaut, elle est construite
       comme une bibliothèque liée statiquement, <filename>libmysqld.a</filename>, mais en appliquant le
    correctif facultatif, une version partagée de cette
    bibliothèque peut être construite. La bibliothèque est nécessaire pour certaines
    applications, telles que <application>Amarok</application> et il est recommandé
    d'utiliser des bibliothèques partagées quand c'est possible.</para>
     
    <para>Beaucoup d'options sont disponibles avec
    <command>cmake</command>. Vérifiez la sortie de `<command>cmake -LH</command>` 
    pour des options supplémentaires de personnalisation. Voir
    la <ulink url="http://dev.mysql.com/doc/refman/5.6/en/source-configuration-options.html">
    Documentation MySQL </ulink> pour une liste complète des options.</para>
     
    <para>Si vous voulez la version partagée de la bibliothèque serveur
    embarquée, appliquez le correctif suivant&nbsp;:</para>
<screen>
<userinput>patch -Np1 -i ../mysql-&mysql-version;-embedded_library_shared-1.patch</userinput>
</screen>
 
    <para>Installez <application>MySQL</application> en
    lançant les commandes suivantes&nbsp;:</para>
     
<screen>
<userinput>sed -i "/ADD_SUBDIRECTORY(sql\/share)/d" CMakeLists.txt &amp;&amp;
sed -i "s/ADD_SUBDIRECTORY(libmysql)/&amp;\\nADD_SUBDIRECTORY(sql\/share)/" CMakeLists.txt &amp;&amp;
sed -i "s@data/test@\${INSTALL_MYSQLSHAREDIR}@g" sql/CMakeLists.txt &amp;&amp;
sed -i "s@data/mysql@\${INSTALL_MYSQLTESTDIR}@g" sql/CMakeLists.txt &amp;&amp;
sed -i "s/srv_buf_size/srv_sort_buf_size/" storage/innobase/row/row0log.cc &amp;&amp;
mkdir build &amp;&amp;
cd build &amp;&amp;
cmake -DCMAKE_BUILD_TYPE=Release                    \
      -DCMAKE_INSTALL_PREFIX=/usr                   \
      -DINSTALL_DOCDIR=share/doc/mysql              \
      -DINSTALL_DOCREADMEDIR=share/doc/mysql        \
      -DINSTALL_INCLUDEDIR=include/mysql            \
      -DINSTALL_INFODIR=share/info                  \
      -DINSTALL_MANDIR=share/man                    \
      -DINSTALL_MYSQLDATADIR=/srv/mysql             \
      -DINSTALL_MYSQLSHAREDIR=share/mysql           \
      -DINSTALL_MYSQLTESTDIR=share/mysql/test       \
      -DINSTALL_PLUGINDIR=lib/mysql/plugin          \
      -DINSTALL_SBINDIR=sbin                        \
      -DINSTALL_SCRIPTDIR=bin                       \
      -DINSTALL_SQLBENCHDIR=share/mysql/bench       \
      -DINSTALL_SUPPORTFILESDIR=share/mysql         \
      -DMYSQL_DATADIR=/srv/mysql                    \
      -DMYSQL_UNIX_ADDR=/run/mysqld/mysqld.sock     \
      -DSYSCONFDIR=/etc/mysql                       \
      -DWITH_PERFSCHEMA_STORAGE_ENGINE=OFF          \
      -DWITH_EXTRA_CHARSETS=complex                 \
      -DWITH_LIBEVENT=system                        \
      -DWITH_SSL=system                             \
      .. &amp;&amp;
make</userinput>
</screen>
    <para>Pour tester les résultats, lancez&nbsp;: <command>make test</command>.</para>
    <para>
      Maintenant, en tant qu'utilisateur <systemitem class="username">root</systemitem> user:
    </para>
<screen role="root">
<userinput>make install</userinput>
</screen>
    <tip>
      <para>
        Les seules documentations fournies dans l'archive des sources sont
        <filename>mysql.info</filename> et les pages de manuels. Vous pouvez
        télécharger différents formats du manuel de référence
        <application>MySQL</application>
        à l'adresse <ulink url="http://dev.mysql.com/doc/"/>.
      </para>
    </tip>
   </sect2>
  <sect2 role="commands">
    <title>Explication des commandes</title>
    <para>
      <command>sed -i ...</command>&nbsp;: Le premier des deux seds corrige
      la construction du client seulement, les deux seds suivants
      initialisent les bons répertoires d'installation pour quelques composants.
      Le dernier corrige un bogue dans le code.
    </para>
   <para><parameter>-DWITHOUT_SERVER=ON</parameter>&nbsp;: Utilisez ce
    paramètre si vous ne voulez pas le serveur et si vous ne voulez construire
    que le client.</para>
  <para>
      <parameter>-DWITH_EXTRA_CHARSETS=complex</parameter>&nbsp;: Ce paramètre active le support pour les ensembles de caractères complexes.
  </para>
    <para>
      <parameter>-DWITH_LIBEVENT=system</parameter>&nbsp;: Ce paramètre est utilisé pour dire de construire le système en utilisant
      <application>libevent</application> qui est installé.
      Enlevez le si vous n'avez pas installé  <application>libevent</application>.
</para>
    
    <para><parameter>-DWITH_SSL=system</parameter>&nbsp;: Ce paramètre est utilisé
    pour signaler d'utiliser la version installée de
      <application>OpenSSL</application>. Effacez le si vous n'avez pas installées
      <application>OpenSSL</application>.</para>
  </sect2>
  <sect2 role="configuration">
    <title>Configuration de MySQL</title>
    <sect3 id="mysql-config">
      <title>Fichiers de configuration</title>
      <para>
        <filename>/etc/mysql/my.cnf</filename> et
        <filename>~/.my.cnf</filename>
      </para>
      <indexterm zone="mysql mysql-config">
        <primary sortas="e-AA.my.cnf">~/.my.cnf</primary>
      </indexterm>
      <indexterm zone="mysql mysql-config">
        <primary sortas="e-etc-mysql-my.cnf">/etc/my.cnf</primary>
      </indexterm>
    </sect3>
    <sect3>
      <title>Informations de configuration</title>
      <note>
        <para>
          Si vous avez mis à jour depuis une version majeure précédente de 
          <application>MySQL</application>, consultez
          le <ulink
          url="https://dev.mysql.com/doc/refman/5.6/en/upgrading-from-previous-series.html">
          Manuel de référence MySQL</ulink> pour les notes de mises à jour.
        </para>
      </note>
<para>
      Créez un <filename>/etc/mysql/my.cnf</filename> basique en utilisant la commande suivante
      en tant qu'utilisateur <systemitem class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>install -v -dm 755 /etc/mysql &amp;&amp;
cat &gt; /etc/mysql/my.cnf &lt;&lt; "EOF"
<literal># Begin /etc/mysql/my.cnf
# The following options will be passed to all MySQL clients
[client]
#password       = your_password
port            = 3306
socket          = /run/mysqld/mysqld.sock
# The MySQL server
[mysqld]
port            = 3306
socket          = /run/mysqld/mysqld.sock
datadir         = /srv/mysql
skip-external-locking
key_buffer_size = 16M
max_allowed_packet = 1M
sort_buffer_size = 512K
net_buffer_length = 16K
myisam_sort_buffer_size = 8M
# Don't listen on a TCP/IP port at all.
skip-networking
# required unique id between 1 and 2^32 - 1
server-id       = 1
# Uncomment the following if you are using BDB tables
#bdb_cache_size = 4M
#bdb_max_lock = 10000
# Uncomment the following if you are using InnoDB tables
#innodb_data_home_dir = /srv/mysql
#innodb_data_file_path = ibdata1:10M:autoextend
#innodb_log_group_home_dir = /srv/mysql
# You can set .._buffer_pool_size up to 50 - 80 %
# of RAM but beware of setting memory usage too high
#innodb_buffer_pool_size = 16M
#innodb_additional_mem_pool_size = 2M
# Set .._log_file_size to 25 % of buffer pool size
#innodb_log_file_size = 5M
#innodb_log_buffer_size = 8M
#innodb_flush_log_at_trx_commit = 1
#innodb_lock_wait_timeout = 50
[mysqldump]
quick
max_allowed_packet = 16M
[mysql]
no-auto-rehash
# Remove the next comment character if you are not familiar with SQL
#safe-updates
[isamchk]
key_buffer = 20M
sort_buffer_size = 20M
read_buffer = 2M
write_buffer = 2M
[myisamchk]
key_buffer_size = 20M
sort_buffer_size = 20M
read_buffer = 2M
write_buffer = 2M
[mysqlhotcopy]
interactive-timeout
# End /etc/mysql/my.cnf</literal>
EOF</userinput>
</screen>
      <para>Vous pouvez maintenant installer une base de données et modifier 
      l'appartenance en faveur de l'utilisateur et du groupe non privilégiés 
      (effectuez en tant qu'utilisateur <systemitem
      class="username">root</systemitem> user)&nbsp;:</para>
<screen role="root">
<userinput>mysql_install_db --basedir=/usr --datadir=/srv/mysql --user=mysql &amp;&amp;
chown -R mysql:mysql /srv/mysql</userinput>
</screen>
      <para>La configuration supplémentaire exige que le serveur
      <application>MySQL</application> soit en fonction. Démarrez le serveur en
      utilisant les commandes suivantes en tant qu'utilisateur <systemitem
      class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>install -v -m755 -o mysql -g mysql -d /run/mysqld &amp;&amp;
mysqld_safe --user=mysql 2&gt;&amp;1 &gt;/dev/null &amp;</userinput>
</screen>
      <para>Une installation par défaut n'initialise pas de mot de passe pour
      l'administrateur, utilisez donc la commande suivante en tant qu'utilisateur 
      <systemitem class="username">root</systemitem> pour en régler un. Remplacez
      <replaceable>&lt;nouveau-mot-de-passe&gt;</replaceable> par le
      vôtre.</para>
<screen role="root">
<userinput>mysqladmin -u root password <replaceable>&lt;new-password&gt;</replaceable></userinput>
</screen>
      <para>La configuration du serveur est maintenant terminée. Éteignez le
      serveur en utilisant la commande suivante en tant qu'utilisateur <systemitem
      class="username">root</systemitem>&nbsp;:</para>
<screen role="root">
<userinput>mysqladmin -p shutdown</userinput>
</screen>
    </sect3>
    <sect3  id="mysql-init">
      <title>Script de démarrage</title>
      <para>Installez le script de démarrage <filename>/etc/rc.d/init.d/mysql</filename> 
      inclu dans le paquet <xref linkend="bootscripts"/> en tant qu'utilisateur
      <systemitem class="username">root</systemitem> pour démarrer le serveur
      <application>MySQL</application> au moment du démarrage du système.</para>
      <indexterm zone="mysql mysql-init">
        <primary sortas="f-mysql">mysql</primary>
      </indexterm>
<screen role="root">
<userinput>make install-mysql</userinput>
</screen>
    </sect3>
  </sect2>
  <sect2 role="content">
    <title>Contenu</title>
    <segmentedlist>
      <segtitle>Programmes installés</segtitle>
      <segtitle>Bibliothèques installées</segtitle>
      <segtitle>Répertoires installés</segtitle>
      <seglistitem>
        <seg>
          innochecksum, msql2mysql, myisamchk, myisam_ftdump, myisamlog,
          myisampack, my_print_defaults, mysql, mysqlaccess, mysqlaccess.conf,
          mysqladmin, mysqlbinlog, mysqlbug, mysqlcheck, mysql_client_test,
          mysql_client_test_embedded, mysql_config, mysql_config_editor,
          mysql_convert_table_format, mysqld, mysqld_multi, mysqld_safe, mysqldump,
          mysqldumpslow, mysql_embedded, mysql_find_rows, mysql_fix_extensions,
          mysqlhotcopy, mysqlimport, mysql_install_db, mysql_plugin,
          mysql_secure_installation, mysql_setpermission, mysqlshow, mysqlslap,
          mysqltest, mysqltest_embedded, mysql_tzinfo_to_sql, mysql_upgrade,
          mysql_waitpid, mysql_zap, perror, replace, resolveip et
          resolve_stack_dump
        </seg>
        <seg>
          libmysqlclient.{so,a}, libmysqlclient_r.{so,a}, libmysqld.{so,a},
          libmysqlservices.a and several under /usr/lib/mysql/plugin/
        </seg>
        <seg>
          /etc/mysql,
          /srv/mysql,
          /usr/include/mysql,
          /usr/lib/mysql,
          /usr/share/doc/mysql et
          /usr/share/mysql
        </seg>
      </seglistitem>
    </segmentedlist>
    <bridgehead renderas="sect3">Descriptions courtes</bridgehead>
    <para>Des descriptions de tous les programmes et de toutes les bibliothèques
     prendraient plusieurs pages. Consultez plutôt la documentation de
     <filename>mysql.info</filename> ou le manuel de référence en ligne sur <ulink
    url="http://dev.mysql.com/doc/refman/5.6/en/index.html"/>.</para>
    <para>Les modules DBI de <application>Perl</application> doivent être
    installés pour avoir des programmes de support de <application>MySQL</application> 
    pour fonctionner correctement.</para>
  </sect2>
</sect1>
