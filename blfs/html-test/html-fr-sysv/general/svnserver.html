<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      Exécuter un serveur subversion
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-r10.1-1007+">
    <div class="navheader">
      <h4>
        Au-delà de Linux<sup>®</sup> From Scratch (édition <span class=
        "phrase">System V)</span> - Version r10.1-1007+
      </h4>
      <h3>
        Chapitre&nbsp;13.&nbsp;Programmation
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="subversion.html" title=
          "Subversion-1.14.1">Précédent</a>
          <p>
            Subversion-1.14.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="swig.html" title="SWIG-4.0.2">Suivant</a>
          <p>
            SWIG-4.0.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="prog.html" title=
          "Chapitre&nbsp;13.&nbsp;Programmation">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition System V) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="fr" xml:lang="fr">
      <h1 class="sect1">
        <a id="svnserver" name="svnserver"></a>Exécuter un serveur subversion
      </h1>
      <div class="package" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Exécuter un serveur subversion
        </h2>
        <p>
          Cette section décrira la façon de paramétrer, administrer et
          sécuriser un serveur <span class="application">Subversion</span>.
        </p>
        <h3>
          Dépendances de Subversion Server
        </h3>
        <h4>
          Requises
        </h4>
        <p class="required">
          <a class="xref" href="subversion.html" title=
          "Subversion-1.14.1">Subversion-1.14.1</a> et <a class="xref" href=
          "../postlfs/openssh.html" title="OpenSSH-8.7p1">OpenSSH-8.7p1</a>
        </p>
      </div>
      <div class="configuration" lang="fr" xml:lang="fr">
        <h2 class="sect2">
          Paramétrage d'un serveur Subversion.
        </h2>
        <p>
          Les instructions suivantes installeront un serveur <span class=
          "application">Subversion</span>, qui sera paramétré pour utiliser
          <span class="application">OpenSSH</span> comme méthode sécurisée à
          distance, avec <span class=
          "command"><strong>svnserve</strong></span> disponible pour un accès
          anonyme.
        </p>
        <p>
          La configuration du serveur <span class=
          "application">Subversion</span> consiste en les étapes
          suivantes&nbsp;:
        </p>
        <div class="sect3">
          <h3 class="sect3">
            1. Régler l'utilisateur, le groupe et les droits
          </h3>
          <p>
            Vous devrez être l'utilisateur <code class=
            "systemitem">root</code> pour la partie initiale de la
            configuration. Créez l'utilisateur et le groupe <code class=
            "systemitem">svn</code> avec les commandes suivantes&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">groupadd -g 56 svn &amp;&amp;
useradd -c "SVN Owner" -d /home/svn -m -g svn -s /bin/false -u 56 svn</kbd></pre>
          <p>
            Si vous envisagez d'avoir plusieurs dépôts, vous devriez avoir un
            groupe dédié à chaque dépôt pour faciliter l'administration.
            Créez le groupe <code class="systemitem">svntest</code> pour le
            dépôt de test et ajoutez l'utilisateur <code class=
            "systemitem">svn</code> au groupe avec les commandes
            suivantes&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">groupadd -g 57 svntest &amp;&amp;
usermod -G svntest -a svn</kbd></pre>
          <p>
            En outre, vous devriez régler <span class="command"><strong>umask
            002</strong></span> pendant que vous travaillez avec un dépôt
            pour que tous les nouveaux fichiers soient accessibles en
            écriture au propriétaire et au groupe. Ceci est rendu obligatoire
            par la création d'un script enveloppe pour <span class=
            "command"><strong>svn</strong></span> et <span class=
            "command"><strong>svnserve</strong></span>&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">mv /usr/bin/svn /usr/bin/svn.orig &amp;&amp;
mv /usr/bin/svnserve /usr/bin/svnserve.orig &amp;&amp;
cat &gt;&gt; /usr/bin/svn &lt;&lt; "EOF"
<code class="literal">#!/bin/sh
umask 002
/usr/bin/svn.orig "$@"</code>
EOF
cat &gt;&gt; /usr/bin/svnserve &lt;&lt; "EOF"
<code class="literal">#!/bin/sh
umask 002
/usr/bin/svnserve.orig "$@"</code>
EOF
chmod 0755 /usr/bin/svn{,serve}</kbd></pre>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Si vous utilisez <span class="application">Apache</span> pour
              travailler avec le dépôt par HTTP, même pour un accès anonyme,
              vous devriez envelopper <span class=
              "command"><strong>/usr/sbin/httpd</strong></span> dans un
              script similaire.
            </p>
          </div>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            2. Créer un dépôt Subversion.
          </h3>
          <p>
            Il y a de nombreuses manières d'initialiser un répertoire
            subversion. Il est recommandé de regarder le chapitre
            correspondant du <a class="ulink" href=
            "http://svnbook.red-bean.com/nightly/en/svn.reposadmin.html">Livre
            SVN</a>. Un répertoire de base peut être initialisé avec les
            instructions ci-dessous.
          </p>
          <p>
            Créez un nouveau dépôt <span class=
            "application">Subversion</span> avec les commandes suivantes (en
            tant qu'utilisateur <code class="systemitem">root</code>)&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">install -v -m 0755 -d /srv/svn &amp;&amp;
install -v -m 0755 -o svn -g svn -d /srv/svn/repositories &amp;&amp;
svnadmin create /srv/svn/repositories/svntest</kbd></pre>
          <p>
            Maintenant que le dépôt est créé, vous devriez le peupler avec
            quelque chose d'utile. Vous devrez avoir une disposition de
            répertoires prédéfinie paramétrée comme ce à quoi vous voudriez
            que votre dépôt ressemble. Par exemple, voici un modèle du
            paramétrage de BLFS avec une racine de <code class=
            "filename">svntest/</code>. Vous devrez paramétrer une
            arborescence de répertoire ressemblant à ce qui suit&nbsp;:
          </p>
          <pre class="screen"><code class=
          "literal">svntest/            # The name of the repository
   trunk/           # Contains the existing source tree
      BOOK/
      bootscripts/
      edguide/
      patches/
      scripts/
   branches/        # Needed for additional branches
   tags/            # Needed for tagging release points</code></pre>
          <p>
            Une fois que vous avez créé votre aménagement de répertoire,
            comme indiqué ci-dessus, vous êtes prêt à faire l'importation
            initiale&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">svn import -m "Initial import." \
    <em class=
"replaceable"><code>&lt;/path/to/source/tree&gt;</code></em>      \
    file:///srv/svn/repositories/svntest</kbd></pre>
          <p>
            Maintenant modifiez les informations de propriétaire et de groupe
            du dépôt et ajoutez un utilisateur non privilégié aux groupes
            <code class="systemitem">svn</code> et <code class=
            "systemitem">svntest</code>&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">chown -R svn:svntest /srv/svn/repositories/svntest    &amp;&amp;
chmod -R g+w         /srv/svn/repositories/svntest    &amp;&amp;
chmod g+s            /srv/svn/repositories/svntest/db &amp;&amp;
usermod -G svn,svntest -a <em class=
"replaceable"><code>&lt;username&gt;</code></em></kbd></pre>
          <p>
            <code class="systemitem">svntest</code> est le groupe affecté au
            dépôt svntest. Comme indiqué plus haut, cela facilite
            l'administration de plusieurs dépôts lors de l'utilisation de
            <span class="application">OpenSSH</span> pour l'authentification.
            En anticipant, vous devrez ajouter votre utilisateur non
            privilégié et n'importe quel utilisateur supplémentaire auquel
            vous pouvez vouloir donner accès en écriture au dépôt, aux
            groupes <code class="systemitem">svn</code> et <code class=
            "systemitem">svntest</code>.
          </p>
          <p>
            En outre, vous remarquerez que le nouveau répertoire du dépôt
            <code class="filename">db</code> est set-groupID. Si le
            raisonnement n'est pas immédiatement évident, quand on utilise
            une méthode d'authentification externe (telle que <span class=
            "command"><strong>ssh</strong></span>), le bit sticky est réglé
            de sorte que tout les nouveaux fichiers appartiendront à
            l'utilisateur, mais au groupe <code class=
            "systemitem">svntest</code>. Quiconque dans le groupe
            <code class="systemitem">svntest</code> peut créer des fichiers,
            mais donnez encore l'accès en écriture à tout le groupe à ces
            fichiers. Ceci évite d'exclure d'autres utilisateurs du dépôt.
          </p>
          <p>
            Maintenant, repassez en accès pour utilisateur non privilégié, et
            jetez un œil sur le nouveau dépôt en utilisant <span class=
            "command"><strong>svnlook</strong></span>&nbsp;:
          </p>
          <pre class="userinput"><kbd class=
          "command">svnlook tree /srv/svn/repositories/svntest/</kbd></pre>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Il se peut que vous deviez vous déconnecter et y revenir pour
              rafraîchir vos appartenances de groupes. <span class=
              "command"><strong>su <em class=
              "replaceable"><code>&lt;nom_utilisateur&gt;</code></em></strong></span>
              devrait aussi fonctionner.
            </p>
          </div>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            3. Configurer le Serveur
          </h3>
          <p>
            Comme indiqué précédemment, ces instructions configureront le
            serveur pour n'utiliser que <span class=
            "command"><strong>ssh</strong></span> pour un accès en écriture
            au dépôt et pour fournir un accès anonyme en utilisant
            <span class="command"><strong>svnserve</strong></span>. Il y a
            plusieurs autres manières de fournir un accès au dépôt. Ces
            configurations supplémentaires sont mieux expliquées sur
            <a class="ulink" href=
            "http://svnbook.red-bean.com/">http://svnbook.red-bean.com/</a>.
          </p>
          <p>
            La configuration de l'accès doit se faire pour chaque dépôt.
            Créez le fichier <code class="filename">svnserve.conf</code> pour
            le dépôt svntest en utilisant les commandes suivantes&nbsp;:
          </p>
          <pre class="root"><kbd class=
          "command">cp /srv/svn/repositories/svntest/conf/svnserve.conf \
   /srv/svn/repositories/svntest/conf/svnserve.conf.default &amp;&amp;

cat &gt; /srv/svn/repositories/svntest/conf/svnserve.conf &lt;&lt; "EOF"
<code class="literal">[general]
anon-access = read
auth-access = write</code>
EOF</kbd></pre>
          <p>
            Il n'y a pas grand à chose du tout avoir avec le fichier de
            configuration. Vous remarquerez que seule la section générale est
            nécessaire. Jetez un œil sur le fichier <code class=
            "filename">svnserve.conf.default</code> pour des informations sur
            l'utilisation de la méthode d'authentification de <span class=
            "command"><strong>svnserve</strong></span> intégrée.
          </p>
        </div>
        <div class="sect3">
          <h3 class="sect3">
            <a id="svnserver-init" name="svnserver-init"></a>4. Démarrage du
            Serveur
          </h3>
          <p>
            Pour démarrer le serveur au démarrage, installez le script de
            démarrage svn inclus dans le paquet <a class="xref" href=
            "../introduction/bootscripts.html" title=
            "Scripts de démarrage BLFS">blfs-bootscripts-20210826</a>&nbsp;:
          </p>
          <pre class="root"><kbd class="command">make install-svn</kbd></pre>
        </div>
      </div>
      <p class="updated">
        Last updated on
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="subversion.html" title=
          "Subversion-1.14.1">Précédent</a>
          <p>
            Subversion-1.14.1
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="swig.html" title="SWIG-4.0.2">Suivant</a>
          <p>
            SWIG-4.0.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="prog.html" title=
          "Chapitre&nbsp;13.&nbsp;Programmation">Niveau supérieur</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Au-delà de Linux® From Scratch (édition System V) - Version r10.1-1007+">
          Sommaire</a>
        </li>
      </ul>
    </div>
  </body>
</html>
